var Rn=Object.defineProperty;var In=(r,s,t)=>s in r?Rn(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var ye=(r,s,t)=>In(r,typeof s!="symbol"?s+"":s,t);import{r as l,j as e,V as Ya,d as Va,A as Ka,C as Ha,X as ys,T as Ja,D as Qa,e as En,f as Xa,g as Dn,h as Fn,i as $n,u as Zs,S as Un,k as _e,l as ds,M as Lt,m as zs,n as Gt,U as ms,Z as Kt,o as Bs,B as Ln,p as us,L as ke,q as Ms,W as Gn,s as On,H as Bn,t as Mn,w as _n,x as zn,y as qn,z as Wn,E as Yn,F as fs,G as Ns,I as rs,J as Es,K as Is,N as Ks,O as js,Q as Vn,Y as Za,_ as Ds,$ as Kn,a0 as Ot,a1 as er,a2 as sr,a3 as tr,a4 as Ht,a5 as oa,a6 as nt,a7 as ar,a8 as Qs,a9 as We,aa as rr,ab as nr,ac as Hn,ad as or,ae as ir,af as lr,ag as cr,ah as dr,ai as mr,aj as ur,ak as hr,al as Jn,am as Qn,an as xr,ao as pr,ap as gr,aq as fr,ar as Xn,as as Zn,at as jr,au as eo,av as Bt,aw as so,ax as Mt,ay as pa,az as to,aA as _t,aB as ga,aC as yr,aD as br,aE as ao,aF as vr,aG as wr,aH as ro,aI as no,aJ as oo,aK as Nr,aL as kr,aM as io,aN as fa,aO as lo,aP as Us,aQ as ns,aR as co,aS as zt,aT as $e,aU as _s,aV as Sr,R as ja,aW as Ar,aX as mo,aY as Ve,aZ as qs,a_ as as,a$ as Cr,b0 as Pr,b1 as Tr,b2 as uo,b3 as Rr,b4 as ho,b5 as Ir,b6 as xo,b7 as Er,b8 as Dr,b9 as po,ba as Fr,bb as go,bc as $r,bd as fo,be as Ur,bf as Lr,bg as jo,bh as yo,bi as Gr,bj as bo,bk as vo,bl as wo,bm as Aa,bn as Me,bo as No,bp as ko,bq as Ca,br as Or,bs as Br,bt as Mr,bu as _r,bv as zr,bw as qr,bx as So,by as Ao,bz as Co,bA as Po,bB as To,bC as Wr,bD as Ro,bE as Io,bF as Et,bG as ya,bH as Yr,bI as ia,bJ as Jt,bK as la,bL as Eo,bM as Pa,bN as Do,bO as Fo,bP as bt,bQ as ba,bR as Vr,bS as qt,bT as va,bU as Ta,bV as Dt,bW as ta,bX as $o,bY as Uo,bZ as Lo,b_ as At,b$ as Go,c0 as Oo,c1 as Bo,c2 as Vs,c3 as Mo,c4 as _o,c5 as Wt,c6 as Ra,c7 as zo,c8 as Qt,c9 as qo,ca as Wo,cb as Kr,cc as ft,cd as ca,ce as Yo,cf as da,cg as Vo,ch as Ko,ci as Ho,cj as Jo,ck as Ne,cl as Qo}from"./vendor-react-CCmApd-X.js";import{ab as Xo,ac as Zo,ad as vt,ae as ei,af as si,ag as ti,a8 as Xe,ah as ai,ai as ks,aj as ma,ak as Ts,al as Rs,am as Ss,an as ps,ao as As,ap as Ys,aq as jt,ar as gs,as as Hr,at as Jr,au as Qr,av as ri,aw as ni,ax as oi}from"./vendor-google-sKe0Xo2n.js";import{i as ii,g as li,s as Ft,a as ci,b as di,c as mi,d as Xr,e as ui,o as hi,f as xi,u as pi,h as gi,G as fi,j as ji,k as yi,r as Ct,l as bi,m as vi,n as wi,p as Ni,T as tt,q as Pt,t as Tt,v as Ia,w as Ea,x as Da,y as Fa,z as $a,A as Ua,B as ki}from"./vendor-firebase-4EWM60Pw.js";import"./vendor-ui-BA32w1ww.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();if(typeof window<"u"&&window.trustedTypes)try{window.trustedTypes.createPolicy("default",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r}),console.log("✅ Trusted Types policy created")}catch{console.log("ℹ️ Trusted Types policy already exists or not needed")}const Si=1,Ai=1e6;let aa=0;function Ci(){return aa=(aa+1)%Number.MAX_SAFE_INTEGER,aa.toString()}const ra=new Map,La=r=>{if(ra.has(r))return;const s=setTimeout(()=>{ra.delete(r),gt({type:"REMOVE_TOAST",toastId:r})},Ai);ra.set(r,s)},Pi=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,Si)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?La(t):r.toasts.forEach(a=>{La(a.id)}),{...r,toasts:r.toasts.map(a=>a.id===t||t===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==s.toastId)}}},$t=[];let Ut={toasts:[]};function gt(r){Ut=Pi(Ut,r),$t.forEach(s=>{s(Ut)})}function K({...r}){const s=Ci(),t=n=>gt({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>gt({type:"DISMISS_TOAST",toastId:s});return gt({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:t}}function ss(){const[r,s]=l.useState(Ut);return l.useEffect(()=>($t.push(s),()=>{const t=$t.indexOf(s);t>-1&&$t.splice(t,1)}),[r]),{...r,toast:K,dismiss:t=>gt({type:"DISMISS_TOAST",toastId:t})}}function M(...r){return Xo(Zo(r))}const Ti=En,Zr=l.forwardRef(({className:r,...s},t)=>e.jsx(Ya,{ref:t,className:M("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));Zr.displayName=Ya.displayName;const Ri=vt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),en=l.forwardRef(({className:r,variant:s,...t},a)=>e.jsx(Va,{ref:a,className:M(Ri({variant:s}),r),...t}));en.displayName=Va.displayName;const Ii=l.forwardRef(({className:r,...s},t)=>e.jsx(Ka,{ref:t,className:M("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...s}));Ii.displayName=Ka.displayName;const sn=l.forwardRef(({className:r,...s},t)=>e.jsx(Ha,{ref:t,className:M("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:e.jsx(ys,{className:"h-4 w-4"})}));sn.displayName=Ha.displayName;const tn=l.forwardRef(({className:r,...s},t)=>e.jsx(Ja,{ref:t,className:M("text-sm font-semibold",r),...s}));tn.displayName=Ja.displayName;const an=l.forwardRef(({className:r,...s},t)=>e.jsx(Qa,{ref:t,className:M("text-sm opacity-90",r),...s}));an.displayName=Qa.displayName;function Ei(){const{toasts:r}=ss();return e.jsxs(Ti,{children:[r.map(function({id:s,title:t,description:a,action:n,...o}){return e.jsxs(en,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(tn,{children:t}),a&&e.jsx(an,{children:a})]}),n,e.jsx(sn,{})]},s)}),e.jsx(Zr,{})]})}const Di=({...r})=>{const{theme:s="system"}=ei();return e.jsx(si,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})},ua=Dn,Ga=Fn,Oa=$n,ha=l.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(Xa,{ref:a,sideOffset:s,className:M("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));ha.displayName=Xa.displayName;const Fi=()=>{const r=Zs();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},yt=vt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-hover shadow-primary hover:shadow-glow",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg",outline:"border border-input glass-button hover:border-primary/50 hover:shadow-glow",secondary:"glass-button text-secondary-foreground hover:bg-secondary/60",ghost:"hover:bg-accent/10 hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline hover:text-primary-hover"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),N=l.forwardRef(({className:r,variant:s,size:t,asChild:a=!1,...n},o)=>{const d=a?Un:"button";return e.jsx(d,{className:M(yt({variant:s,size:t,className:r})),ref:o,...n})});N.displayName="Button";const w=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:M("rounded-lg border-border/50 text-card-foreground overflow-x-hidden glass-card",r),...s}));w.displayName="Card";const O=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:M("flex flex-col space-y-1.5 p-2 sm:p-4 md:p-6",r),...s}));O.displayName="CardHeader";const B=l.forwardRef(({className:r,...s},t)=>e.jsx("h3",{ref:t,className:M("text-2xl font-semibold leading-none tracking-tight",r),...s}));B.displayName="CardTitle";const ge=l.forwardRef(({className:r,...s},t)=>e.jsx("p",{ref:t,className:M("text-sm text-muted-foreground",r),...s}));ge.displayName="CardDescription";const k=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:M("p-2 sm:p-4 md:p-6 pt-0",r),...s}));k.displayName="CardContent";const wa=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:M("flex items-center p-2 sm:p-4 md:p-6 pt-0",r),...s}));wa.displayName="CardFooter";const $i=()=>{const r=_e(),[s,t]=l.useState(!1),[a,n]=l.useState(!1);l.useEffect(()=>{const c=()=>{n(window.scrollY>20)};return window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]);const o=[{name:"Real Estate Agents",icon:Ms},{name:"Automotive Repair",icon:Gn},{name:"Beauty Salons",icon:On},{name:"Construction Contractors",icon:Bn},{name:"Fitness Centers",icon:Mn},{name:"Pest Control",icon:_n},{name:"Home Services",icon:zn},{name:"Restaurants & Cafes",icon:qn},{name:"Law Firms",icon:Wn},{name:"Medical Practices",icon:Yn}],d=[{icon:fs,title:"AI SEO Audit",description:"Complete audits of your Google Business Profile to find problems, correct them, and find hidden ranking opportunities."},{icon:Ns,title:"Keyword Finder",description:"Discover the keywords your clients are searching for to bring you the most business at the right moment."},{icon:rs,title:"Auto Posting",description:"Keep your profile current with keyword-rich content uploaded automatically to boost local exposure."},{icon:Es,title:"AI Review Generator",description:"Get meaningful responses to every customer review instantly, improving trust and customer relationships."},{icon:zs,title:"AI Review Writer",description:"Professional and engaging reviews written by AI, saving you time while maintaining consistent brand voice."},{icon:Is,title:"Performance Analytics",description:"Clear reports and measurable results showing your Google Business Profile climbing higher through local SEO."}],m=[{number:"01",title:"Exclusive Partnership",description:"We only onboard three clients per specialty in each location, ensuring you enjoy full benefits without competing for attention."},{number:"02",title:"Data-Driven System",description:"Our AI-driven SEO uses the right keywords, reviews, and ranking signals to boost your search position. Every move is data-backed."},{number:"03",title:"Rankings You Can See",description:"Clear reports and measurable results ensuring your Google Business Profile climbs higher through AI-driven optimization."},{number:"04",title:"Strategy That Fits You",description:"Hire a growth strategist who knows your market and can design the playbook just for you. No one-size-fits-all approach."}],i=[{name:"Sarah Johnson",role:"Business Owner",content:"Google Ranker's AI made SEO effortless for us. It analyzed, optimized, and boosted our rankings faster than any agency ever did."},{name:"Michael Chen",role:"Restaurant Owner",content:"This AI tool simplified everything — from keyword research to site audits. Our organic growth skyrocketed within weeks."},{name:"Jennifer Martinez",role:"Salon Owner",content:"Google Ranker saves hours of manual SEO work. Smart, accurate, and genuinely powerful for scaling online visibility."}],h=[{question:"How does AI make Google Business Profile work better?",answer:"AI improves your profile by finding significant local trends, automatically optimizing keywords, and keeping your information up to date. This makes you show up higher when people search for businesses around them."},{question:"Why is AI important for small businesses to be seen?",answer:"AI makes things fairer by ensuring consistency, predicting what customers want, and giving smaller firms tools that are just as good as enterprise-level SEO tools for a lot less money."},{question:"In what ways does AI make it easier to manage reviews?",answer:"AI tools quickly write personalized comments to reviews, figure out the tone, and highlight useful information that can help you improve your online reputation and customer trust while saving hours every week."},{question:"What is special about targeting keywords with AI?",answer:"AI doesn't just choose common words. It looks at what people want, what your competitors are doing, and how people search in your area to find long-tail phrases that work better and help you show up more in local searches."}];return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsxs("nav",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${a?"bg-background/95 backdrop-blur-lg border-b border-border shadow-lg":"bg-transparent"}`,children:[e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary blur-xl opacity-50"}),e.jsx(ds,{className:"h-8 w-8 text-primary relative"})]}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"Google Ranker"})]}),e.jsxs("div",{className:"hidden lg:flex items-center space-x-8",children:[e.jsx("a",{href:"#home",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Home"}),e.jsx("a",{href:"#features",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Features"}),e.jsx("a",{href:"#pricing",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Pricing"}),e.jsx("a",{href:"#faq",className:"text-muted-foreground hover:text-foreground transition-colors",children:"FAQ"}),e.jsx(N,{variant:"ghost",onClick:()=>r("/login"),className:"text-foreground hover:text-primary",children:"Login"}),e.jsx(N,{onClick:()=>r("/signup"),className:"bg-gradient-primary hover:shadow-primary transition-all duration-300",children:"Get 15 Days Free Trial"})]}),e.jsx("button",{className:"lg:hidden p-2 rounded-lg hover:bg-card transition-colors",onClick:()=>t(!s),children:s?e.jsx(ys,{className:"h-6 w-6"}):e.jsx(Lt,{className:"h-6 w-6"})})]})}),s&&e.jsx("div",{className:"lg:hidden bg-card/95 backdrop-blur-lg border-t border-border",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[e.jsx("a",{href:"#home",className:"block py-2 text-muted-foreground hover:text-foreground transition-colors",children:"Home"}),e.jsx("a",{href:"#features",className:"block py-2 text-muted-foreground hover:text-foreground transition-colors",children:"Features"}),e.jsx("a",{href:"#pricing",className:"block py-2 text-muted-foreground hover:text-foreground transition-colors",children:"Pricing"}),e.jsx("a",{href:"#faq",className:"block py-2 text-muted-foreground hover:text-foreground transition-colors",children:"FAQ"}),e.jsx(N,{variant:"outline",className:"w-full",onClick:()=>r("/login"),children:"Login"}),e.jsx(N,{className:"w-full bg-gradient-primary",onClick:()=>r("/signup"),children:"Get 15 Days Free Trial"})]})})]}),e.jsxs("section",{id:"home",className:"relative pt-32 pb-20 lg:pt-40 lg:pb-32 overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/20 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary-glow/20 rounded-full blur-3xl animate-pulse delay-1000"})]}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 relative z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("div",{className:"inline-flex items-center space-x-2 bg-card/50 backdrop-blur-sm border border-border rounded-full px-4 py-2 mb-8 animate-fade-in",children:[e.jsx(zs,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"AI-Powered Local SEO"})]}),e.jsxs("h1",{className:"text-5xl lg:text-7xl font-bold mb-6 leading-tight animate-slide-up",children:["Dominate Local Search with"," ",e.jsx("span",{className:"bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"AI"})]}),e.jsx("p",{className:"text-xl lg:text-2xl text-muted-foreground mb-12 animate-slide-up animation-delay-200",children:"Enhance your Google Business Profile with Google Ranker's AI tools. Grow easily with postings, managing reviews, and ranking higher."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center animate-slide-up animation-delay-400",children:[e.jsxs(N,{size:"lg",className:"bg-gradient-primary hover:shadow-primary transition-all duration-300 text-lg px-8 py-6",onClick:()=>r("/signup"),children:["Get Your 15 Days Free Trial",e.jsx(Gt,{className:"ml-2 h-5 w-5"})]}),e.jsx(N,{size:"lg",variant:"outline",className:"text-lg px-8 py-6 border-2 hover:bg-card",onClick:()=>r("/login"),children:"Already Registered"})]}),e.jsxs("div",{className:"mt-12 flex items-center justify-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsxs("span",{children:["Join ",e.jsx("span",{className:"text-primary font-semibold",children:"536+"})," businesses already growing"]})]})]})})]}),e.jsx("section",{className:"py-20 bg-card/30",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["The Blueprint for"," ",e.jsx("span",{className:"bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent",children:"Local Market Domination"})]}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"It's not enough to merely be online. Google Ranker helps your business become the go-to choice in your city. Through our exclusive model, we partner with only 3 firms per niche per location."})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:m.map((c,u)=>e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300 group",children:e.jsx(k,{className:"p-8",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"text-4xl font-bold text-primary/30 group-hover:text-primary transition-colors",children:c.number}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:c.title}),e.jsx("p",{className:"text-muted-foreground",children:c.description})]})]})})},u))})]})}),e.jsx("section",{className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold mb-4",children:"Built for Every Industry"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Trusted by professionals across diverse sectors"})]}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"flex animate-scroll",children:[...o,...o].map((c,u)=>e.jsxs("div",{className:"flex-shrink-0 mx-4 flex items-center space-x-3 bg-card/50 backdrop-blur-sm border border-border rounded-full px-6 py-3 hover:border-primary/50 transition-colors",children:[e.jsx(c.icon,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:c.name})]},u))})})]})}),e.jsx("section",{id:"features",className:"py-20 bg-card/30",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("div",{className:"inline-flex items-center space-x-2 bg-primary/10 border border-primary/30 rounded-full px-4 py-2 mb-6",children:[e.jsx(Kt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm text-primary font-medium",children:"Powerful Features"})]}),e.jsx("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"All-in-One GMB Center"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Control multiple business profiles and locations from one simple dashboard. See everything about your Google Business presence at a glance."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:d.map((c,u)=>e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300 group hover:shadow-primary/20 hover:shadow-xl",children:e.jsxs(k,{className:"p-8",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-full group-hover:bg-primary/40 transition-all"}),e.jsx(c.icon,{className:"h-12 w-12 text-primary relative"})]}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:c.title}),e.jsx("p",{className:"text-muted-foreground",children:c.description})]})},u))})]})}),e.jsx("section",{id:"pricing",className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Your First 15 Days are"," ",e.jsx("span",{className:"bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent",children:"FREE"})]}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Choose the plan that works best for you"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300",children:e.jsxs(k,{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"1 Month Plan"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx("span",{className:"text-4xl font-bold",children:"₹1099"})})]}),e.jsx("div",{className:"space-y-3 mb-8",children:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles"].map((c,u)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bs,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c})]},u))}),e.jsx(N,{className:"w-full bg-gradient-primary hover:shadow-primary transition-all duration-300",onClick:()=>r("/signup"),children:"Get Started"})]})}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300",children:e.jsxs(k,{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"6 Months Plan"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx("span",{className:"text-4xl font-bold",children:"₹5999"})}),e.jsx("p",{className:"text-sm text-primary mt-2",children:"Save ₹600 compared to monthly"})]}),e.jsx("div",{className:"space-y-3 mb-8",children:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles"].map((c,u)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bs,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c})]},u))}),e.jsx(N,{className:"w-full bg-gradient-primary hover:shadow-primary transition-all duration-300",onClick:()=>r("/signup"),children:"Get Started"})]})}),e.jsxs(w,{className:"bg-gradient-primary border-0 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-4 right-4 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full z-20",children:"Best Value"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/50 to-primary-glow/50 blur-2xl opacity-50 group-hover:opacity-70 transition-opacity"}),e.jsxs(k,{className:"p-8 relative z-10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"1 Year Plan"}),e.jsx("div",{className:"flex items-baseline",children:e.jsx("span",{className:"text-4xl font-bold",children:"₹9999"})}),e.jsx("p",{className:"text-sm mt-2 opacity-90",children:"Best Value - Save ₹3189 per year"})]}),e.jsx("div",{className:"space-y-3 mb-8",children:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles"].map((c,u)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bs,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:c})]},u))}),e.jsx(N,{className:"w-full bg-white text-primary hover:bg-white/90 transition-all duration-300",onClick:()=>r("/signup"),children:"Get Started"})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-card/30",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(Ln,{className:"h-16 w-16 text-primary mx-auto mb-6"}),e.jsx("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"The Google Ranker Story"})]}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border",children:e.jsxs(k,{className:"p-8 lg:p-12",children:[e.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed mb-6",children:"Google Ranker was built on one realization: small businesses are the backbone of local communities, yet many struggle to gain online visibility. Even with excellent services, many local businesses stay invisible on Google."}),e.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed mb-6",children:"Our goal was clear: give these companies solid, easy-to-use tools. We are experts in Local SEO, and we utilize AI to help businesses expand, keep their good names, and turn internet searches into real customers."}),e.jsx("p",{className:"text-lg text-foreground font-medium",children:"With our intelligent local SEO and AI reputation tools, clients don't just stay visible — they grow, rank higher, and convert better in their local markets."})]})})]})})}),e.jsx("section",{className:"py-20",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"Join Our Growing Community"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Hear what business owners say about Google Ranker"})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:i.map((c,u)=>e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300",children:e.jsxs(k,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((x,f)=>e.jsx(us,{className:"h-5 w-5 fill-primary text-primary"},f))}),e.jsxs("p",{className:"text-muted-foreground mb-6 italic",children:['"',c.content,'"']}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:c.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:c.role})]})]})},u))})]})}),e.jsx("section",{id:"faq",className:"py-20 bg-card/30",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("div",{className:"text-center mb-16",children:e.jsx("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"Frequently Asked Questions"})}),e.jsx("div",{className:"space-y-6",children:h.map((c,u)=>e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border hover:border-primary/50 transition-all duration-300",children:e.jsxs(k,{className:"p-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:c.question}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:c.answer})]})},u))})]})})}),e.jsxs("section",{className:"py-20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-primary opacity-10"}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 relative z-10",children:e.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"Start Dominating Local Search Today"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-12",children:"Let our AI automate your posts and manage reviews, turning your GMB profile into your #1 source for new customers."}),e.jsxs(N,{size:"lg",className:"bg-gradient-primary hover:shadow-primary transition-all duration-300 text-lg px-12 py-6",onClick:()=>r("/signup"),children:["Get Your 15 Days Free Trial",e.jsx(Gt,{className:"ml-2 h-6 w-6"})]})]})})]}),e.jsx("footer",{className:"bg-card/50 backdrop-blur-sm border-t border-border py-12",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 mb-12",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ds,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xl font-bold",children:"Google Ranker"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Built By AI experts in INDIA, Made for U.S.A Local Businesses"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-4",children:"Quick Links"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:"#home",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Home"}),e.jsx("a",{href:"#features",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Features"}),e.jsx("a",{href:"#pricing",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Pricing"}),e.jsx("a",{href:"#faq",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"FAQ"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-4",children:"Legal"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ke,{to:"/terms",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Terms & Conditions"}),e.jsx(ke,{to:"/privacy",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Privacy Policy"}),e.jsx(ke,{to:"/refund",className:"block text-sm text-muted-foreground hover:text-primary transition-colors",children:"Refund Policy"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-4",children:"Contact"}),e.jsx(ke,{to:"/contact",className:"block text-sm text-muted-foreground hover:text-primary transition-colors mb-4",children:"Contact Us"})]})]}),e.jsx("div",{className:"border-t border-border pt-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"© 2024 Google Ranker. All rights reserved."})})]})})]})},Ui=()=>e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx("nav",{className:"bg-card/50 backdrop-blur-lg border-b border-border",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs(ke,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"Google Ranker"})]}),e.jsx(ke,{to:"/",children:e.jsxs(N,{variant:"ghost",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Home"]})})]})})}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:"Terms and Conditions"}),e.jsxs("p",{className:"text-muted-foreground mb-12",children:["Last updated: ",new Date().toLocaleDateString()]}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border mb-8",children:e.jsxs(k,{className:"p-8 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"1. Acceptance of Terms"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"By accessing and using Google Ranker's services, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"2. Service Description"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"Google Ranker provides AI-powered local SEO and Google Business Profile management services. Our services include:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Automated posting to Google Business Profile"}),e.jsx("li",{children:"AI-powered review management and response generation"}),e.jsx("li",{children:"SEO audit and keyword research tools"}),e.jsx("li",{children:"Performance analytics and reporting"}),e.jsx("li",{children:"Multi-profile management dashboard"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"3. Free Trial"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We offer a 15-day free trial period for new users. During this period, you have full access to all features. After the trial period expires, you must subscribe to continue using our services. If you do not wish to continue, you can cancel at any time before the trial ends."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"4. Subscription and Billing"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"Our services are billed annually at $99 per Google Business Profile. By subscribing to our service, you agree to:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Provide accurate billing information"}),e.jsx("li",{children:"Pay all applicable fees and taxes"}),e.jsx("li",{children:"Automatic renewal of your subscription unless cancelled"}),e.jsx("li",{children:"Price changes with 30 days notice"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"5. User Responsibilities"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"You agree to:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Provide accurate and complete information"}),e.jsx("li",{children:"Maintain the security of your account credentials"}),e.jsx("li",{children:"Not share your account with others"}),e.jsx("li",{children:"Use the service in compliance with all applicable laws"}),e.jsx("li",{children:"Not abuse or misuse our services"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"6. Intellectual Property"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"All content, features, and functionality of Google Ranker are owned by us and are protected by international copyright, trademark, and other intellectual property laws. You may not copy, modify, distribute, or reverse engineer any part of our services."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"7. Limitation of Liability"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Google Ranker shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use or inability to use the service. We do not guarantee specific ranking improvements or business outcomes."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"8. Termination"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We reserve the right to terminate or suspend your account at any time for violating these terms. You may cancel your subscription at any time through your account settings."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"9. Changes to Terms"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We reserve the right to modify these terms at any time. We will notify users of significant changes via email or through the platform. Continued use of the service after changes constitutes acceptance of the new terms."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"10. Contact Information"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"For questions about these Terms and Conditions, please contact us through our website's contact form."})]})]})}),e.jsx("div",{className:"text-center",children:e.jsx(ke,{to:"/",children:e.jsx(N,{size:"lg",className:"bg-gradient-primary",children:"Back to Home"})})})]})})]}),Li=()=>e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx("nav",{className:"bg-card/50 backdrop-blur-lg border-b border-border",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs(ke,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"Google Ranker"})]}),e.jsx(ke,{to:"/",children:e.jsxs(N,{variant:"ghost",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Home"]})})]})})}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx(js,{className:"h-16 w-16 text-primary"})}),e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold mb-6 text-center",children:"Privacy Policy"}),e.jsxs("p",{className:"text-muted-foreground mb-12 text-center",children:["Last updated: ",new Date().toLocaleDateString()]}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border mb-8",children:e.jsxs(k,{className:"p-8 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"1. Information We Collect"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"We collect information that you provide directly to us, including:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Account information (name, email, password)"}),e.jsx("li",{children:"Google Business Profile access tokens"}),e.jsx("li",{children:"Business information and profile data"}),e.jsx("li",{children:"Payment and billing information"}),e.jsx("li",{children:"Usage data and analytics"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"2. How We Use Your Information"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"We use the information we collect to:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Provide, maintain, and improve our services"}),e.jsx("li",{children:"Process your transactions and send related information"}),e.jsx("li",{children:"Send you technical notices and support messages"}),e.jsx("li",{children:"Respond to your comments and questions"}),e.jsx("li",{children:"Monitor and analyze trends, usage, and activities"}),e.jsx("li",{children:"Detect, prevent, and address technical issues"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"3. Google OAuth and Data Access"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"When you connect your Google Business Profile, we access only the data necessary to provide our services:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Your Google Business Profile information"}),e.jsx("li",{children:"Posts, reviews, and photos from your profile"}),e.jsx("li",{children:"Insights and analytics data"}),e.jsx("li",{children:"Location information"})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mt-4",children:"We use this data solely to provide automated posting, review management, and analytics features. You can revoke our access at any time through your Google account settings."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"4. Data Security"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We implement appropriate technical and organizational measures to protect your personal information. This includes encryption of data in transit and at rest, secure token storage, and regular security audits. However, no method of transmission over the Internet is 100% secure."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"5. Data Retention"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We retain your information for as long as your account is active or as needed to provide you services. If you wish to delete your account, please contact us, and we will delete your information within 30 days, except where we are required to retain it for legal purposes."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"6. Information Sharing"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"We do not sell your personal information. We may share your information only in the following circumstances:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"With your consent"}),e.jsx("li",{children:"With service providers who assist in our operations"}),e.jsx("li",{children:"To comply with legal obligations"}),e.jsx("li",{children:"To protect our rights and prevent fraud"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"7. Third-Party Services"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"Our service integrates with third-party services including:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Google Business Profile API"}),e.jsx("li",{children:"Firebase Authentication"}),e.jsx("li",{children:"Razorpay for payment processing"}),e.jsx("li",{children:"Azure OpenAI for AI features"})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mt-4",children:"These services have their own privacy policies and terms of service."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"8. Cookies and Tracking"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We use cookies and similar tracking technologies to track activity on our service and hold certain information. You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"9. Your Rights"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"You have the right to:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Access your personal information"}),e.jsx("li",{children:"Correct inaccurate information"}),e.jsx("li",{children:"Request deletion of your information"}),e.jsx("li",{children:"Object to processing of your information"}),e.jsx("li",{children:"Export your data"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"10. Children's Privacy"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Our service is not intended for children under 18 years of age. We do not knowingly collect personal information from children. If you are a parent or guardian and believe your child has provided us with personal information, please contact us."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"11. Changes to This Policy"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:'We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date.'})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"12. Contact Us"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"If you have any questions about this Privacy Policy, please contact us through our website's contact form."})]})]})}),e.jsx("div",{className:"text-center",children:e.jsx(ke,{to:"/",children:e.jsx(N,{size:"lg",className:"bg-gradient-primary",children:"Back to Home"})})})]})})]}),Gi=()=>e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx("nav",{className:"bg-card/50 backdrop-blur-lg border-b border-border",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs(ke,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"Google Ranker"})]}),e.jsx(ke,{to:"/",children:e.jsxs(N,{variant:"ghost",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Home"]})})]})})}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx(Vn,{className:"h-16 w-16 text-primary"})}),e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold mb-6 text-center",children:"Cancellation & Refund Policy"}),e.jsxs("p",{className:"text-muted-foreground mb-12 text-center",children:["Last updated: ",new Date().toLocaleDateString()]}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border mb-8",children:e.jsxs(k,{className:"p-8 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"1. Free Trial Period"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"Google Ranker offers a 15-day free trial for new users. During this period:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"You have full access to all features without any charges"}),e.jsx("li",{children:"You can cancel at any time before the trial ends"}),e.jsx("li",{children:"No payment is required during the trial period"}),e.jsx("li",{children:"You will be notified before your trial expires"})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mt-4",children:"If you do not wish to continue after the trial, simply cancel your account before the 15-day period ends to avoid any charges."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"2. Subscription Cancellation"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"You can cancel your subscription at any time by:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"Going to your account settings"}),e.jsx("li",{children:'Selecting "Billing" from the menu'}),e.jsx("li",{children:'Clicking "Cancel Subscription"'}),e.jsx("li",{children:"Following the confirmation prompts"})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mt-4",children:"Upon cancellation, you will continue to have access to the service until the end of your current billing period. Your subscription will not renew automatically."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"3. Refund Policy"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"We offer a 30-day money-back guarantee for annual subscriptions. To be eligible for a refund:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"You must request a refund within 30 days of your initial payment"}),e.jsx("li",{children:"The refund request must be submitted through our contact form or support email"}),e.jsx("li",{children:"You must provide a valid reason for the refund request"}),e.jsx("li",{children:"The service must not have been abused or misused"})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mt-4",children:"Refunds are typically processed within 5-10 business days and will be credited to the original payment method."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"4. Non-Refundable Circumstances"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-4",children:"Refunds will not be provided in the following cases:"}),e.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2 ml-4",children:[e.jsx("li",{children:"After 30 days from the initial payment date"}),e.jsx("li",{children:"For partial subscription periods"}),e.jsx("li",{children:"If your account was terminated for violating our Terms of Service"}),e.jsx("li",{children:"For additional profiles added to your subscription"}),e.jsx("li",{children:"If you've already received a refund in the past"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"5. Payment Failures and Retries"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"If your payment fails at renewal time, we will attempt to charge your payment method up to 3 times over a 7-day period. If all attempts fail, your subscription will be automatically cancelled, and you will lose access to the service. You will receive email notifications for failed payment attempts."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"6. Partial Refunds"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We do not offer partial refunds for unused portions of the subscription period. If you cancel your subscription, you will retain access until the end of your current billing cycle, but no prorated refund will be issued."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"7. Service Disruptions"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"In case of extended service disruptions (more than 48 hours), we may offer prorated refunds or extend your subscription period at our discretion. This does not apply to planned maintenance or issues with third-party services (like Google APIs)."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"8. Chargebacks"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"If you file a chargeback or payment dispute with your credit card company or payment provider, your account will be immediately suspended. We encourage you to contact us first to resolve any billing issues before initiating a chargeback."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"9. Changes to This Policy"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We reserve the right to modify this Refund and Cancellation Policy at any time. Changes will be effective immediately upon posting to our website. Your continued use of the service after changes constitutes acceptance of the new policy."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"10. Contact for Refunds"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"To request a refund or for any questions about this policy, please contact us through our website's contact form or email. Include your account email, subscription details, and reason for the refund request."})]})]})}),e.jsx("div",{className:"text-center",children:e.jsx(ke,{to:"/",children:e.jsx(N,{size:"lg",className:"bg-gradient-primary",children:"Back to Home"})})})]})})]}),fe=l.forwardRef(({className:r,type:s,...t},a)=>e.jsx("input",{type:s,className:M("flex h-10 w-full max-w-full rounded-md glass-input px-2 sm:px-3 py-2 text-sm sm:text-base file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground/60 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",r),ref:a,...t}));fe.displayName="Input";const lt=l.forwardRef(({className:r,...s},t)=>e.jsx("textarea",{className:M("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s}));lt.displayName="Textarea";const Oi=vt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),oe=l.forwardRef(({className:r,...s},t)=>e.jsx(Za,{ref:t,className:M(Oi(),r),...s}));oe.displayName=Za.displayName;const Bi=()=>{const[r,s]=l.useState({name:"",email:"",subject:"",message:""}),[t,a]=l.useState(!1),[n,o]=l.useState(!1),d=async i=>{i.preventDefault(),a(!0),await new Promise(h=>setTimeout(h,1500)),a(!1),o(!0),setTimeout(()=>{s({name:"",email:"",subject:"",message:""}),o(!1)},3e3)},m=i=>{s(h=>({...h,[i.target.name]:i.target.value}))};return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx("nav",{className:"bg-card/50 backdrop-blur-lg border-b border-border",children:e.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs(ke,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-8 w-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-primary-hover to-primary-glow bg-clip-text text-transparent",children:"Google Ranker"})]}),e.jsx(ke,{to:"/",children:e.jsxs(N,{variant:"ghost",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Home"]})})]})})}),e.jsx("div",{className:"container mx-auto px-4 lg:px-8 py-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx(Es,{className:"h-16 w-16 text-primary"})}),e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold mb-6 text-center",children:"Contact Us"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-12 text-center",children:"Have a question? We'd love to hear from you. Send us a message and we'll respond as soon as possible."}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mb-12",children:[e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border",children:e.jsxs(k,{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Get in Touch"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-full"}),e.jsx(Ds,{className:"h-6 w-6 text-primary relative"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Email Support"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Our support team typically responds within 24 hours during business days."})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-full"}),e.jsx(Es,{className:"h-6 w-6 text-primary relative"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Live Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available Monday-Friday, 9 AM - 6 PM EST for urgent inquiries."})]})]})]}),e.jsxs("div",{className:"mt-8 p-6 bg-primary/10 rounded-lg border border-primary/30",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Business Hours"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Monday - Friday: 9:00 AM - 6:00 PM EST"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Saturday - Sunday: Closed"})]})]})}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border",children:e.jsxs(k,{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Send a Message"}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Kn,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Message Sent!"}),e.jsx("p",{className:"text-muted-foreground",children:"Thank you for contacting us. We'll get back to you soon."})]}):e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"name",children:"Name *"}),e.jsx(fe,{id:"name",name:"name",value:r.name,onChange:m,placeholder:"Your name",required:!0,className:"mt-2 bg-input border-border"})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"email",children:"Email *"}),e.jsx(fe,{id:"email",name:"email",type:"email",value:r.email,onChange:m,placeholder:"your.email@example.com",required:!0,className:"mt-2 bg-input border-border"})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"subject",children:"Subject *"}),e.jsx(fe,{id:"subject",name:"subject",value:r.subject,onChange:m,placeholder:"How can we help?",required:!0,className:"mt-2 bg-input border-border"})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"message",children:"Message *"}),e.jsx(lt,{id:"message",name:"message",value:r.message,onChange:m,placeholder:"Tell us more about your inquiry...",rows:6,required:!0,className:"mt-2 bg-input border-border resize-none"})]}),e.jsx(N,{type:"submit",size:"lg",className:"w-full bg-gradient-primary",disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:["Send Message",e.jsx(Ot,{className:"ml-2 h-4 w-4"})]})})]})]})})]}),e.jsx(w,{className:"bg-card/50 backdrop-blur-sm border-border",children:e.jsxs(k,{className:"p-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Before You Reach Out"}),e.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Check out these common questions that might help you faster:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(ke,{to:"/#faq",className:"p-4 bg-background/50 rounded-lg border border-border hover:border-primary/50 transition-colors",children:[e.jsx("h3",{className:"font-semibold mb-1",children:"How does the free trial work?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Learn about our 15-day trial period"})]}),e.jsxs(ke,{to:"/#pricing",className:"p-4 bg-background/50 rounded-lg border border-border hover:border-primary/50 transition-colors",children:[e.jsx("h3",{className:"font-semibold mb-1",children:"What's included in the plan?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View all features and pricing"})]}),e.jsxs(ke,{to:"/refund",className:"p-4 bg-background/50 rounded-lg border border-border hover:border-primary/50 transition-colors",children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Refund & Cancellation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Our refund policy explained"})]}),e.jsxs(ke,{to:"/#features",className:"p-4 bg-background/50 rounded-lg border border-border hover:border-primary/50 transition-colors",children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Technical Support"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Getting started with features"})]})]})]})})]})})]})},Gs=l.forwardRef(({className:r,orientation:s="horizontal",decorative:t=!0,...a},n)=>e.jsx(er,{ref:n,decorative:t,orientation:s,className:M("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...a}));Gs.displayName=er.displayName;const Mi={apiKey:"AIzaSyBIR-zpFHJMDurVpWCtFT2C5HRZLw4-8mU",authDomain:"gmb-automation-474209-549ee.firebaseapp.com",projectId:"gmb-automation-474209-549ee",storageBucket:"gmb-automation-474209-549ee.firebasestorage.app",messagingSenderId:"317153753727",appId:"1:317153753727:web:8281f982a8e7a05f885d4a"},Na=ii(Mi),Ps=li(Na);console.log("🔧 Firebase - Setting up persistence...");Ft(Ps,mi).then(()=>{console.log("✅ Firebase - IndexedDB persistence set successfully")}).catch(r=>(console.warn("⚠️ Firebase - IndexedDB persistence failed, trying localStorage:",r),Ft(Ps,Xr))).then(()=>{console.log("✅ Firebase - LocalStorage persistence set successfully")}).catch(r=>(console.error("❌ Firebase - All persistence methods failed, using in-memory:",r),Ft(Ps,ui)));const at=ci(Na),Rt=di(Na),rn=l.createContext(void 0),Ye=()=>{const r=l.useContext(rn);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},_i=({children:r})=>{const[s,t]=l.useState(null),[a,n]=l.useState(!0),{toast:o}=ss(),d=async(x,f,v)=>{try{await Ft(Ps,Xr);const T=await xi(Ps,x,f);v&&T.user&&await pi(T.user,{displayName:v}),o({title:"Account created successfully!",description:"Welcome to Google Ranker!"})}catch(T){throw console.error("Signup error:",T),o({title:"Signup failed",description:T.message||"An error occurred during signup",variant:"destructive"}),T}},m=async(x,f)=>{try{await gi(Ps,x,f),o({title:"Welcome back!",description:"You have successfully signed in."})}catch(v){console.error("Login error:",v);let T="An error occurred during login";switch(v.code){case"auth/user-not-found":T="No account found with this email address";break;case"auth/wrong-password":T="Incorrect password";break;case"auth/invalid-email":T="Invalid email address";break;case"auth/too-many-requests":T="Too many failed attempts. Please try again later";break;default:T=v.message}throw o({title:"Login failed",description:T,variant:"destructive"}),v}},i=async()=>{try{console.log("🚀 Starting Google sign-in with popup...");const x=new fi;x.addScope("email"),x.addScope("profile"),x.setCustomParameters({prompt:"select_account"}),console.log("🚀 Calling signInWithPopup...");const f=await ji(Ps,x);console.log("✅ Google sign-in successful:",f.user.email),o({title:"Welcome!",description:"You have successfully signed in with Google."})}catch(x){if(console.error("❌ Google login error:",x),x.code==="auth/popup-closed-by-user"||x.code==="auth/cancelled-popup-request")throw console.log("User closed Google sign-in popup"),x;let f="An error occurred during Google login";switch(x.code){case"auth/popup-blocked":f="Popup was blocked by your browser. Please allow popups for this site.";break;case"auth/unauthorized-domain":f="This domain is not authorized for Google sign-in.";break;case"auth/account-exists-with-different-credential":f="An account already exists with this email using a different sign-in method.";break;default:f=x.message}throw o({title:"Google login failed",description:f,variant:"destructive"}),x}},h=async()=>{try{await yi(Ps),o({title:"Signed out",description:"You have been successfully signed out."})}catch(x){throw console.error("Logout error:",x),o({title:"Logout failed",description:x.message||"An error occurred during logout",variant:"destructive"}),x}},c=async()=>{try{if(s){const x=await s.getIdToken(!0);return console.log("Firebase token refreshed successfully"),x}return null}catch(x){return console.error("Failed to refresh Firebase token:",x),null}};l.useEffect(()=>{console.log("🔍 AuthContext - Setting up auth state listener...");const x=hi(Ps,async v=>{if(console.log("🔍 AuthContext - Auth state changed:",v?"User: "+v.email:"No user"),v)try{await v.getIdToken(!0),console.log("✅ AuthContext - User authenticated and token refreshed:",v.email)}catch(T){console.error("❌ AuthContext - Token refresh failed during auth state change:",T)}t(v),n(!1),console.log("✅ AuthContext - Loading set to false, currentUser:",v?v.email:"null")}),f=setInterval(async()=>{if(s)try{await s.getIdToken(!0),console.log("Auth token automatically refreshed")}catch(v){console.error("Automatic token refresh failed:",v)}},30*60*1e3);return()=>{x(),clearInterval(f)}},[s]);const u={currentUser:s,loading:a,signup:d,login:m,logout:h,loginWithGoogle:i,refreshToken:c};return e.jsx(rn.Provider,{value:u,children:!a&&r})},zi=()=>{var T,y;const[r,s]=l.useState(!1),[t,a]=l.useState(""),[n,o]=l.useState(""),[d,m]=l.useState(!1),{login:i,loginWithGoogle:h}=Ye(),c=_e(),x=((y=(T=Zs().state)==null?void 0:T.from)==null?void 0:y.pathname)||"/dashboard",f=async()=>{m(!0);try{await h(),c(x,{replace:!0})}catch(j){console.error("Google login error:",j),m(!1)}},v=async j=>{if(j.preventDefault(),!(!t||!n)){m(!0);try{await i(t,n),c(x,{replace:!0})}catch(g){console.error("Email login error:",g)}finally{m(!1)}}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md animate-fade-in",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:"/google-ranker-logo.png",alt:"Google Ranker Logo",className:"h-32 w-auto"})})}),e.jsxs(w,{className:"shadow-card border-2 border-border bg-transparent",children:[e.jsxs(O,{className:"text-center",children:[e.jsx(B,{className:"text-2xl font-semibold",children:"Welcome Back"}),e.jsx(ge,{children:"Sign in to access your account"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs(N,{variant:"outline",size:"lg",className:"w-full h-12 border-border hover:bg-muted/50",onClick:f,disabled:d,children:[e.jsx(sr,{className:"mr-2 h-5 w-5"}),"Sign in with Google"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(Gs,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"email",children:"Email"}),e.jsx(fe,{id:"email",type:"email",placeholder:"Your email address",value:t,onChange:j=>a(j.target.value),required:!0,className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{htmlFor:"password",children:"Password"}),e.jsx(ke,{to:"/forgot-password",className:"text-sm text-primary hover:text-primary-hover transition-colors",children:"Forgot password?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{id:"password",type:r?"text":"password",placeholder:"Your password",value:n,onChange:j=>o(j.target.value),required:!0,className:"h-11 pr-10"}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!r),children:r?e.jsx(tr,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Ht,{className:"h-4 w-4 text-muted-foreground"})})]})]}),e.jsx(N,{type:"submit",size:"lg",className:"w-full h-12 bg-primary hover:bg-primary-hover shadow-primary",disabled:d,children:d?"Signing In...":"Sign In"})]})]}),e.jsx(wa,{className:"justify-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(ke,{to:"/signup",className:"text-primary hover:text-primary-hover font-medium transition-colors",children:"Sign up"})]})})]})]})})},qi=()=>{const[r,s]=l.useState(!1),[t,a]=l.useState({name:"",email:"",phone:"",password:"",confirmPassword:""}),[n,o]=l.useState(!1),{signup:d,loginWithGoogle:m}=Ye(),i=_e(),{toast:h}=ss(),c=async()=>{o(!0);try{await m(),i("/dashboard",{replace:!0})}catch(f){console.error("Google signup error:",f),o(!1)}},u=async f=>{if(f.preventDefault(),t.password!==t.confirmPassword){h({title:"Password mismatch",description:"Passwords don't match. Please try again.",variant:"destructive"});return}if(t.password.length<6){h({title:"Password too short",description:"Password must be at least 6 characters long.",variant:"destructive"});return}o(!0);try{await d(t.email,t.password,t.name),i("/dashboard",{replace:!0})}catch(v){console.error("Email signup error:",v)}finally{o(!1)}},x=f=>v=>{a(T=>({...T,[f]:v.target.value}))};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md animate-fade-in",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:"/google-ranker-logo.png",alt:"Google Ranker Logo",className:"h-32 w-auto"})})}),e.jsxs(w,{className:"shadow-card border-2 border-border bg-transparent",children:[e.jsxs(O,{className:"text-center",children:[e.jsx(B,{className:"text-2xl font-semibold",children:"Create Account"}),e.jsx(ge,{children:"Sign up to start managing your business profiles"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs(N,{variant:"outline",size:"lg",className:"w-full h-12 border-border hover:bg-muted/50",onClick:c,disabled:n,children:[e.jsx(sr,{className:"mr-2 h-5 w-5"}),"Sign up with Google"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx(Gs,{className:"w-full"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"name",children:"Full Name"}),e.jsx(fe,{id:"name",type:"text",placeholder:"Your full name",value:t.name,onChange:x("name"),required:!0,className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"email",children:"Email"}),e.jsx(fe,{id:"email",type:"email",placeholder:"Your email address",value:t.email,onChange:x("email"),required:!0,className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"phone",children:"Phone Number (Optional)"}),e.jsx(fe,{id:"phone",type:"tel",placeholder:"Your phone number",value:t.phone,onChange:x("phone"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{id:"password",type:r?"text":"password",placeholder:"Create a password",value:t.password,onChange:x("password"),required:!0,className:"h-11 pr-10"}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!r),children:r?e.jsx(tr,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Ht,{className:"h-4 w-4 text-muted-foreground"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(fe,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:t.confirmPassword,onChange:x("confirmPassword"),required:!0,className:"h-11"})]}),e.jsx(N,{type:"submit",size:"lg",className:"w-full h-12 bg-primary hover:bg-primary-hover shadow-primary",disabled:n,children:n?"Creating Account...":"Create Account"})]})]}),e.jsx(wa,{className:"justify-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx(ke,{to:"/login",className:"text-primary hover:text-primary-hover font-medium transition-colors",children:"Sign in"})]})})]})]})})},Wi=({isOpen:r=!1,onClose:s})=>{const t=Zs();_e();const a=[{label:"Profiles",href:"/dashboard",icon:ms},{label:"Posts",href:"/dashboard/posts",icon:Qs},{label:"Reviews",href:"/dashboard/reviews",icon:us},{label:"Audit Tool",href:"/dashboard/audit",icon:fs},{label:"Request for Reviews",href:"/dashboard/request-reviews",icon:Ds},{label:"Billing",href:"/dashboard/billing",icon:We}],n=o=>o==="/dashboard"?t.pathname==="/dashboard"||t.pathname==="/":t.pathname.startsWith(o);return e.jsxs("div",{className:M("fixed left-0 top-0 z-40 h-screen w-64 glass-card border-r-2 border-primary/30 transition-transform duration-300 ease-in-out","lg:translate-x-0",r?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"h-16 flex items-center justify-between p-4 border-b-2 border-primary/20 bg-transparent",children:[e.jsx("div",{className:"lg:hidden",children:e.jsx(N,{variant:"ghost",size:"sm",onClick:s,className:"h-8 w-8 p-0",children:e.jsx(ys,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center gap-2 lg:mx-0 mx-auto",children:e.jsx("img",{src:"/google-ranker-logo.png",alt:"Google Ranker Logo",className:"h-20 w-auto"})}),e.jsx("div",{className:"lg:hidden w-8"})]}),e.jsxs("nav",{className:"p-4 space-y-2",children:[a.map(o=>e.jsxs(oa,{to:o.href,className:()=>{const d=n(o.href);return M("flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-300 group",d?"":"text-muted-foreground hover:bg-muted/50 hover:text-foreground glass-button")},style:()=>n(o.href)?{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(139, 92, 246, 0.2))",color:"#A78BFA",borderLeft:"3px solid #8B5CF6"}:{},children:[e.jsx(o.icon,{className:"h-5 w-5 transition-all duration-300 group-hover:scale-110",style:n(o.href)?{color:"#A78BFA"}:{}}),e.jsx("span",{className:"font-medium",children:o.label})]},o.href)),e.jsxs(oa,{to:"/dashboard/settings",className:()=>{const o=n("/dashboard/settings");return M("flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-300 group",o?"":"text-muted-foreground hover:bg-muted/50 hover:text-foreground glass-button")},style:()=>n("/dashboard/settings")?{background:"linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(139, 92, 246, 0.2))",color:"#A78BFA",borderLeft:"3px solid #8B5CF6"}:{},children:[e.jsx(nt,{className:"h-5 w-5 transition-all duration-300 group-hover:scale-110",style:n("/dashboard/settings")?{color:"#A78BFA"}:{}}),e.jsx("span",{className:"font-medium",children:"Settings"})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsxs("div",{className:"bg-gradient-primary p-3 sm:p-4 rounded-lg text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ar,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"}),e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-white",children:"Ask for Reviews"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-white opacity-90 mb-3",children:"Generate QR codes for easy reviews"}),e.jsx(ke,{to:"/dashboard/ask-for-reviews",className:"block w-full",children:e.jsx(N,{variant:"secondary",size:"sm",className:"w-full text-white bg-white/20 hover:bg-white/30 text-xs sm:text-sm border-0",children:"Generate QR"})})]})})]})},Xt=Jn,Zt=Qn,Yi=l.forwardRef(({className:r,inset:s,children:t,...a},n)=>e.jsxs(rr,{ref:n,className:M("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",r),...a,children:[t,e.jsx(Gt,{className:"ml-auto h-4 w-4"})]}));Yi.displayName=rr.displayName;const Vi=l.forwardRef(({className:r,...s},t)=>e.jsx(nr,{ref:t,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));Vi.displayName=nr.displayName;const wt=l.forwardRef(({className:r,sideOffset:s=4,...t},a)=>e.jsx(Hn,{children:e.jsx(or,{ref:a,sideOffset:s,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));wt.displayName=or.displayName;const Ze=l.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(ir,{ref:a,className:M("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",r),...t}));Ze.displayName=ir.displayName;const Ki=l.forwardRef(({className:r,children:s,checked:t,...a},n)=>e.jsxs(lr,{ref:n,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(cr,{children:e.jsx(Bs,{className:"h-4 w-4"})})}),s]}));Ki.displayName=lr.displayName;const Hi=l.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(dr,{ref:a,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(cr,{children:e.jsx(mr,{className:"h-2 w-2 fill-current"})})}),s]}));Hi.displayName=dr.displayName;const ka=l.forwardRef(({className:r,inset:s,...t},a)=>e.jsx(ur,{ref:a,className:M("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",r),...t}));ka.displayName=ur.displayName;const ot=l.forwardRef(({className:r,...s},t)=>e.jsx(hr,{ref:t,className:M("-mx-1 my-1 h-px bg-muted",r),...s}));ot.displayName=hr.displayName;const Nt=l.forwardRef(({className:r,...s},t)=>e.jsx(xr,{ref:t,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s}));Nt.displayName=xr.displayName;const Ji=l.forwardRef(({className:r,...s},t)=>e.jsx(pr,{ref:t,className:M("aspect-square h-full w-full",r),...s}));Ji.displayName=pr.displayName;const kt=l.forwardRef(({className:r,...s},t)=>e.jsx(gr,{ref:t,className:M("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s}));kt.displayName=gr.displayName;const Qi=vt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ee({className:r,variant:s,...t}){return e.jsx("div",{className:M(Qi({variant:s}),r),...t})}const nn=l.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(fr,{ref:a,className:M("relative overflow-hidden",r),...t,children:[e.jsx(Xn,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(on,{}),e.jsx(Zn,{})]}));nn.displayName=fr.displayName;const on=l.forwardRef(({className:r,orientation:s="vertical",...t},a)=>e.jsx(jr,{ref:a,orientation:s,className:M("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(eo,{className:"relative flex-1 rounded-full bg-border"})}));on.displayName=jr.displayName;class Xi{constructor(){ye(this,"subscriptionKey");ye(this,"endpoint");ye(this,"deployment");ye(this,"apiVersion");ye(this,"lastRequestTime",0);ye(this,"minRequestInterval",1e3);this.subscriptionKey="1TPW16ifwPJccSiQPSHq63nU7IcT6R9DrduIHBYwCm5jbUWiSbkLJQQJ99BDACYeBjFXJ3w3AAABACOG3Yia",this.endpoint="https://agentplus.openai.azure.com/",this.deployment="gpt-4o",this.apiVersion="2024-02-15-preview",this.subscriptionKey&&this.endpoint?(console.log("✅ Azure OpenAI configuration loaded"),console.log("🔑 Endpoint:",this.endpoint),console.log("🚀 Deployment:",this.deployment),console.log("📅 API Version:",this.apiVersion),this.testApiKey().catch(s=>{console.warn("⚠️ Azure OpenAI API test failed:",s.message)})):console.warn("⚠️ Azure OpenAI not configured. AI features will not work.")}async testApiKey(){if(!this.subscriptionKey||!this.endpoint||!this.deployment||!this.apiVersion)return!1;try{console.log("🧪 Testing Azure OpenAI API configuration...");const s=`${this.endpoint}/openai/deployments/${this.deployment}/chat/completions?api-version=${this.apiVersion}`,t=await fetch(s,{method:"POST",headers:{"api-key":this.subscriptionKey,"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:"test"}],max_tokens:1,temperature:0})});if(t.ok||t.status===400)return console.log("✅ Azure OpenAI API configuration is valid and working!"),!0;{const a=await t.json().catch(()=>({}));return console.error("❌ Azure OpenAI API test failed:",t.status,a),t.status===401&&(console.error("🔑 CRITICAL: Your Azure OpenAI API key is invalid or expired!"),console.error("📋 Possible issues:"),console.error("   • Subscription key is incorrect or has typos"),console.error("   • Key has been revoked or expired"),console.error("   • Endpoint URL is incorrect"),console.error("   • Deployment name is incorrect"),console.error("   • API version is not supported"),console.error("🔗 Check your Azure OpenAI resource in the Azure portal")),!1}}catch(s){return console.error("🚨 Error testing Azure OpenAI API:",s),!1}}async rateLimitedRequest(s,t){const n=Date.now()-this.lastRequestTime;if(n<this.minRequestInterval){const o=this.minRequestInterval-n;console.log(`⏳ Rate limiting: waiting ${o}ms before next request`),await new Promise(d=>setTimeout(d,o))}this.lastRequestTime=Date.now();try{const o=await fetch(s,t);if(o.status===429){console.log("⚠️ Rate limited by OpenAI, implementing exponential backoff...");const d=o.headers.get("retry-after"),m=d?parseInt(d)*1e3:5e3;return console.log(`⏳ Waiting ${m}ms before retry...`),await new Promise(i=>setTimeout(i,m)),this.lastRequestTime=Date.now(),fetch(s,t)}return o}catch(o){throw o.name==="AbortError"?(console.warn("⏰ OpenAI API request timed out"),new Error("OpenAI API request timed out. Please try again.")):(console.error("🚨 OpenAI API request failed:",o),o)}}getSmartButtonForCategory(s,t,a){const n=s.toLowerCase(),o=a||`https://www.google.com/search?q=${encodeURIComponent(t)}`;return n.includes("restaurant")||n.includes("food")||n.includes("cafe")||n.includes("dining")||n.includes("pizza")||n.includes("delivery")?{actionType:"ORDER",url:o}:n.includes("salon")||n.includes("spa")||n.includes("beauty")||n.includes("health")||n.includes("dental")||n.includes("medical")||n.includes("appointment")||n.includes("consultation")||n.includes("fitness")||n.includes("gym")?{actionType:"BOOK",url:o}:n.includes("retail")||n.includes("store")||n.includes("shop")||n.includes("clothing")||n.includes("fashion")||n.includes("jewelry")||n.includes("electronics")||n.includes("furniture")?{actionType:"SHOP",url:o}:n.includes("education")||n.includes("training")||n.includes("school")||n.includes("academy")||n.includes("course")||n.includes("class")||n.includes("learning")||n.includes("tuition")?{actionType:"SIGN_UP",url:o}:{actionType:"LEARN_MORE",url:o}}getFallbackContent(s,t,a,n,o){throw new Error("AI content generation is required. Please configure Azure OpenAI in your environment settings.")}enforceWordLimit(s,t=120){const a=s.trim().split(/\s+/);if(a.length<=t)return s;console.warn(`⚠️ Content exceeds ${t} words (${a.length} words), truncating...`);const n=a.slice(0,t).join(" "),o=n.lastIndexOf("."),d=n.lastIndexOf("!"),m=n.lastIndexOf("?"),i=Math.max(o,d,m);return i>n.length-10?n.substring(0,i+1):n+(n.endsWith(".")||n.endsWith("!")||n.endsWith("?")?"":"...")}async generatePostContent(s,t,a,n,o){var v,T,y,j;if(!s||s.trim()==="")throw new Error("Business information is required to generate content.");if(!this.subscriptionKey||!this.endpoint||!this.deployment||!this.apiVersion)throw new Error("Azure OpenAI not configured. Please configure Azure OpenAI in your environment settings to generate content.");const d=typeof a=="string"?a.split(",").map(g=>g.trim()).filter(g=>g.length>0):a,m=d.length>0?d.join(", "):"quality service, customer satisfaction",i=new Date().getHours(),h=new Date().getDay(),c=Date.now()%10,u=[`Write a post for a ${t} business. Name: ${s}. Location: ${n||"local area"}. Focus on: ${m}. Write exactly 100-120 words. Mention the name once. Talk about actual ${t} services/features. End with one clear action.`,`Create a post about what ${s} offers as a ${t}${n?` in ${n}`:""}. Focus areas: ${m}. Write 100-120 words. For hotels: mention rooms, amenities. For restaurants: food, atmosphere. For services: expertise, results. One name mention only.`,`Write about why customers choose this ${t}. Business: ${s}${n?` in ${n}`:""}. Highlight: ${m}. Exactly 100-120 words. Focus on real benefits specific to ${t}. Single name mention. Natural tone.`,`Describe the ${t} experience at ${s}${n?`, ${n}`:""}. Keywords: ${m}. Write 100-120 words focusing on what customers actually experience. One business name mention. Conversational style.`,`Explain what makes this ${t} special. Name: ${s}${n?`, located in ${n}`:""}. Strengths: ${m}. Write exactly 100-120 words about actual ${t} value. Mention name once only. End with action.`],x=(i+h+c)%u.length,f=u[x];console.log(`🎯 Using prompt variation #${x+1} for variety`),console.log("🤖 Generating content with Azure OpenAI..."),console.log("📝 Prompt:",f.substring(0,100)+"...");try{const g=new AbortController,I=setTimeout(()=>g.abort(),3e4),U=`${this.endpoint}/openai/deployments/${this.deployment}/chat/completions?api-version=${this.apiVersion}`,q=await this.rateLimitedRequest(U,{method:"POST",headers:{"api-key":this.subscriptionKey,"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You write natural Google Business Profile posts. RULES: 1) Write 100-120 words exactly. 2) Mention business name ONLY ONCE. 3) Focus on what the business actually offers - for hotels: rooms, amenities, stays; for restaurants: food, dining; for services: solutions, expertise. 4) Never repeat the business name or use it as an adjective. 5) Write conversationally, not like an ad. 6) Be specific to the business type."},{role:"user",content:f}],max_tokens:150,temperature:.9}),signal:g.signal});if(clearTimeout(I),!q.ok){const p=await q.json().catch(()=>({}));throw console.error("🚨 OpenAI API Error:",q.status,p),q.status===401?(console.error("🔑 API Key Issue - Your Azure OpenAI subscription key is invalid or expired"),console.error("💡 Solutions:"),console.error("   1. Check your subscription key in the Azure portal"),console.error("   2. Verify the endpoint URL is correct"),console.error("   3. Ensure the deployment name matches your Azure OpenAI deployment"),console.error("   4. Check the API version is supported"),new Error("Azure OpenAI API key is invalid or expired. Please check your Azure OpenAI configuration.")):q.status===429?(console.error("🚫 Rate limit exceeded - too many requests"),new Error("Azure OpenAI rate limit exceeded. Please try again later.")):q.status===403?(console.error("🚫 Access denied - insufficient permissions"),new Error("Azure OpenAI access denied. Check your subscription and permissions.")):new Error(`Azure OpenAI API error: ${q.status} - ${((v=p.error)==null?void 0:v.message)||"Unknown error"}`)}const Z=(j=(y=(T=(await q.json()).choices[0])==null?void 0:T.message)==null?void 0:y.content)==null?void 0:j.trim();if(!Z)throw new Error("No content generated by Azure OpenAI");console.log("✅ Content generated successfully with Azure OpenAI"),console.log("📝 Generated content:",Z.substring(0,100)+"...");const $=this.enforceWordLimit(Z),S=$.trim().split(/\s+/).length;return console.log(`📊 Final content word count: ${S}/120 words (min: 100)`),{content:$,callToAction:this.getSmartButtonForCategory(t,s,o)}}catch(g){throw console.error("Failed to generate content with Azure OpenAI:",g),new Error("Failed to generate AI content. Please check your Azure OpenAI configuration and try again.")}}async validateApiKey(){return await this.testApiKey()}getApiKeyStatus(){const s=!!(this.subscriptionKey&&this.endpoint&&this.deployment&&this.apiVersion);return{configured:s,format:s?"Azure OpenAI":"None",preview:s?`Endpoint: ${this.endpoint}, Deployment: ${this.deployment}`:"Not configured"}}async generateAIResponse(s,t){var a,n,o;if(!this.subscriptionKey||!this.endpoint||!this.deployment||!this.apiVersion)throw new Error("Azure OpenAI not configured. Please check your configuration.");console.log("🤖 Generating AI response with Azure OpenAI...");try{const d=new AbortController,m=setTimeout(()=>d.abort(),6e4),i=`${this.endpoint}/openai/deployments/${this.deployment}/chat/completions?api-version=${this.apiVersion}`,h=await this.rateLimitedRequest(i,{method:"POST",headers:{"api-key":this.subscriptionKey,"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:s}],max_tokens:2e3,temperature:.7}),signal:d.signal});if(clearTimeout(m),!h.ok){const x=await h.json().catch(()=>({}));throw console.error("🚨 OpenAI API Error:",h.status,x),new Error(`Azure OpenAI API error: ${h.status}`)}const u=(o=(n=(a=(await h.json()).choices[0])==null?void 0:a.message)==null?void 0:n.content)==null?void 0:o.trim();if(!u)throw new Error("No response generated by Azure OpenAI");return console.log("✅ AI response generated successfully"),u}catch(d){throw console.error("Failed to generate AI response:",d),new Error("Failed to generate AI insights. Please try again.")}}getFallbackReviewResponse(s,t){throw new Error("Azure OpenAI is required to generate review responses. Please configure Azure OpenAI in your environment settings.")}async generateReviewResponse(s,t,a){var d,m,i,h;if(!this.subscriptionKey||!this.endpoint||!this.deployment||!this.apiVersion)throw new Error("Azure OpenAI is required to generate review responses. Please configure Azure OpenAI in your environment settings.");const n=a>=4?"grateful and professional":"understanding and solution-focused",o=`Generate a professional response to this Google Business review for "${s}":

Review (${a}/5 stars): "${t}"

Requirements:
- Keep response under 120 words maximum
- Be ${n}
- ${a>=4?"Thank them for their positive feedback":"Acknowledge their concerns and offer to resolve issues"}
- Include the business name naturally
- Be authentic and personalized
- ${a<4?"Offer to discuss offline if appropriate":"Invite them to return"}

Generate ONLY the response text, no additional formatting.`;try{const c=`${this.endpoint}/openai/deployments/${this.deployment}/chat/completions?api-version=${this.apiVersion}`,u=await this.rateLimitedRequest(c,{method:"POST",headers:{"api-key":this.subscriptionKey,"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You are a professional customer service representative responding to Google Business reviews. Be authentic, helpful, and appropriately emotional. Keep responses under 120 words."},{role:"user",content:o}],max_tokens:120,temperature:.6})});if(!u.ok){const v=await u.json().catch(()=>({}));throw new Error(`Azure OpenAI API error: ${u.status} - ${((d=v.error)==null?void 0:d.message)||"Unknown error"}`)}const f=(h=(i=(m=(await u.json()).choices[0])==null?void 0:m.message)==null?void 0:i.content)==null?void 0:h.trim();if(!f)throw new Error("No response generated by Azure OpenAI");return f}catch(c){throw console.error("Failed to generate review response with Azure OpenAI:",c),new Error("Failed to generate AI review response. Please check your Azure OpenAI configuration and try again.")}}}const Os=new Xi,Zi=(r,s)=>Os.generateAIResponse(r,s);typeof window<"u"&&(window.openaiService=Os,window.testAzureOpenAI=async()=>{console.log("🧪 Manual Azure OpenAI API Test");const r=Os.getApiKeyStatus();if(console.log("📊 API Configuration Status:",r),r.configured){console.log("🔍 Testing API configuration validity...");const s=await Os.validateApiKey();if(console.log(s?"✅ Azure OpenAI is working!":"❌ Azure OpenAI failed test"),s){console.log("🎯 Testing content generation...");try{const t=await Os.generatePostContent("Test Business","service",["quality","professional","reliable"],"Test Location");console.log("✅ Content generated successfully:",t.content.substring(0,100)+"...")}catch(t){console.error("❌ Content generation failed:",t.message)}}}else console.warn("⚠️ Azure OpenAI not configured")},console.log("🛠️ Azure OpenAI Debug Tools Available:"),console.log("   window.openaiService - Access the service directly"),console.log("   window.testAzureOpenAI() - Run comprehensive API test"));class el{constructor(){ye(this,"STORAGE_PATH","DATA");ye(this,"isStorageAvailable",!1);ye(this,"STORAGE_TIMEOUT",1e4)}async saveTokens(s,t,a){if(!s){console.log("⚠️ No userId provided, skipping save");return}if(!this.isStorageAvailable){console.log("⚠️ Firebase Storage unavailable, skipping save");return}try{console.log("💾 Saving tokens to Firebase Storage for user:",s);const n={googleTokens:t,userInfo:a,lastUpdated:Date.now()},o=JSON.stringify(n),d=new Blob([o],{type:"application/json"}),m=Ct(Rt,`${this.STORAGE_PATH}/users/${s}/tokens.json`),i=bi(m,d);await this.withTimeout(i,this.STORAGE_TIMEOUT),console.log("✅ Tokens saved to Firebase Storage successfully for user:",s)}catch(n){console.warn("⚠️ Failed to save tokens to Firebase Storage:",n),this.handleStorageError(n)}}async getTokens(s){if(!this.isStorageAvailable||!s)return console.log("⚠️ Firebase Storage unavailable or no userId, skipping retrieval"),null;try{console.log("📖 Retrieving tokens from Firebase Storage for user:",s);const t=Ct(Rt,`${this.STORAGE_PATH}/users/${s}/tokens.json`),a=vi(t),n=await this.withTimeout(a,this.STORAGE_TIMEOUT),d=new TextDecoder().decode(n),i=JSON.parse(d).googleTokens,h=Date.now();return i.expires_at&&h>=i.expires_at?(console.log("⚠️ Tokens are expired, removing from Firebase Storage"),this.deleteTokens(s).catch(c=>console.warn("Failed to delete expired tokens:",c)),null):(console.log("✅ Tokens retrieved from Firebase Storage successfully for user:",s),i)}catch(t){return console.warn("⚠️ Error retrieving tokens from Firebase Storage:",t),this.handleStorageError(t),null}}async deleteTokens(s){if(!this.isStorageAvailable||!s){console.log("⚠️ Firebase Storage unavailable or no userId, skipping delete");return}try{console.log("🗑️ Deleting tokens from Firebase Storage for user:",s);const t=Ct(Rt,`${this.STORAGE_PATH}/users/${s}/tokens.json`),a=wi(t);await this.withTimeout(a,this.STORAGE_TIMEOUT),console.log("✅ Tokens deleted from Firebase Storage successfully for user:",s)}catch(t){console.warn("⚠️ Error deleting tokens from Firebase Storage:",t),this.handleStorageError(t)}}async hasTokens(s){try{if(!s)return!1;const t=Ct(Rt,`${this.STORAGE_PATH}/users/${s}/tokens.json`);return await Ni(t),!0}catch{return console.log("ℹ️ No tokens found in Firebase Storage for user:",s),!1}}async migrateFromLocalStorage(s){if(!this.isStorageAvailable||!s)return console.log("⚠️ Firebase Storage unavailable or no userId, skipping migration"),!1;try{if(await this.getTokens(s))return console.log("ℹ️ Tokens already exist in Firebase Storage, skipping migration"),!0;const a=localStorage.getItem("google_business_tokens"),n=localStorage.getItem("google_business_connected");if(a&&n==="true")try{const o=JSON.parse(a),d={access_token:o.access_token,token_type:o.token_type||"Bearer",expires_in:o.expires_in||3600,scope:o.scope||"",refresh_token:o.refresh_token,stored_at:Date.now(),expires_at:Date.now()+(o.expires_in||3600)*1e3};return await this.saveTokens(s,d),console.log("✅ Successfully migrated tokens from localStorage to Firebase Storage"),localStorage.removeItem("google_business_tokens"),localStorage.removeItem("google_business_connected"),console.log("🧹 Cleared tokens from localStorage after migration"),!0}catch(o){return console.error("❌ Error parsing localStorage tokens for migration:",o),!1}return console.log("ℹ️ No tokens found in localStorage to migrate"),!1}catch(t){return console.warn("⚠️ Error during token migration:",t),!1}}async withTimeout(s,t){const a=new Promise((n,o)=>{setTimeout(()=>o(new Error(`Firebase Storage operation timed out after ${t}ms`)),t)});return Promise.race([s,a])}handleStorageError(s){const t=(s==null?void 0:s.message)||"Unknown error",a=t.includes("offline")||t.includes("timeout")||t.includes("transport errored")||t.includes("network error")||t.includes("Failed to fetch"),n=t.includes("quota")||t.includes("rate")||t.includes("too many requests"),o=t.includes("permission")||t.includes("unauthorized")||t.includes("forbidden"),d=t.includes("object does not exist")||t.includes("not found")||t.includes("404");a?(console.log("⚠️ Firebase Storage network connectivity issues detected, temporarily disabling"),this.isStorageAvailable=!1,setTimeout(()=>{console.log("🔄 Re-enabling Firebase Storage after network issue resolution attempt"),this.isStorageAvailable=!0},3e4)):n?(console.log("⚠️ Firebase Storage quota/rate limit exceeded, temporarily disabling"),this.isStorageAvailable=!1,setTimeout(()=>{console.log("🔄 Re-enabling Firebase Storage after quota cooldown"),this.isStorageAvailable=!0},12e4)):o?console.error("❌ Firebase Storage permission error - this may require manual intervention:",t):d?console.log("ℹ️ File not found in Firebase Storage (normal for first-time users)"):(console.log("⚠️ Firebase Storage error (keeping service available):",t),this.isStorageAvailable=!1,setTimeout(()=>{this.isStorageAvailable=!0},1e4))}}const rt=new el;class sl{constructor(){ye(this,"cache",new Map);ye(this,"DEFAULT_TTL",5*60*1e3);ye(this,"LONG_TTL",30*60*1e3);this.loadCacheFromStorage(),setInterval(()=>this.saveCacheToStorage(),3e4)}get(s){const t=this.cache.get(s);return t?Date.now()>t.expiresAt?(console.log(`[Cache] EXPIRED: ${s}`),this.cache.delete(s),null):(console.log(`[Cache] HIT: ${s}`),t.data):(console.log(`[Cache] MISS: ${s}`),null)}set(s,t,a){const n=a||this.DEFAULT_TTL,o={data:t,timestamp:Date.now(),expiresAt:Date.now()+n};this.cache.set(s,o),console.log(`[Cache] SET: ${s} (TTL: ${n}ms)`)}invalidate(s){this.cache.delete(s),console.log(`[Cache] INVALIDATED: ${s}`)}invalidatePattern(s){const t=new RegExp(s),a=[];this.cache.forEach((n,o)=>{t.test(o)&&a.push(o)}),a.forEach(n=>this.cache.delete(n)),console.log(`[Cache] INVALIDATED ${a.length} entries matching pattern: ${s}`)}clear(){this.cache.clear(),console.log("[Cache] CLEARED all entries"),this.saveCacheToStorage()}loadCacheFromStorage(){try{const s=localStorage.getItem("gbp_cache");if(s){const t=JSON.parse(s),a=Date.now();Object.entries(t).forEach(([n,o])=>{o.expiresAt>a&&this.cache.set(n,o)}),console.log(`[Cache] Loaded ${this.cache.size} entries from storage`)}}catch(s){console.error("[Cache] Failed to load from storage:",s)}}saveCacheToStorage(){try{const s={};this.cache.forEach((t,a)=>{s[a]=t}),localStorage.setItem("gbp_cache",JSON.stringify(s)),console.log(`[Cache] Saved ${this.cache.size} entries to storage`)}catch(s){console.error("[Cache] Failed to save to storage:",s)}}getAccountsCacheKey(s){return`accounts:${s||"default"}`}getLocationsCacheKey(s){return`locations:${s}`}getReviewsCacheKey(s){return`reviews:${s}`}getPostsCacheKey(s){return`posts:${s}`}cacheAccounts(s,t){const a=this.getAccountsCacheKey(t);this.set(a,s,this.LONG_TTL)}getCachedAccounts(s){const t=this.getAccountsCacheKey(s);return this.get(t)}cacheLocations(s,t){const a=this.getLocationsCacheKey(s);this.set(a,t,this.DEFAULT_TTL)}getCachedLocations(s){const t=this.getLocationsCacheKey(s);return this.get(t)}batchCache(s){s.accounts&&this.cacheAccounts(s.accounts),s.locations&&Object.entries(s.locations).forEach(([t,a])=>{this.cacheLocations(t,a)})}}const ws=new sl,Ba=["https://www.googleapis.com/auth/business.manage","https://www.googleapis.com/auth/plus.business.manage","profile","email"];class tl{constructor(){ye(this,"clientId");ye(this,"accessToken",null);ye(this,"isGoogleLibLoaded",!1);ye(this,"backendUrl");ye(this,"currentUserId",null);ye(this,"cache",new Map);ye(this,"CACHE_TTL",2*60*1e3);ye(this,"connectionMonitorInterval",null);ye(this,"lastConnectionCheck",0);ye(this,"connectionFailures",0);ye(this,"MAX_CONNECTION_FAILURES",3);this.clientId="574451618275-vl5r928f5pj6ogj4le1o75tilhiagmfu.apps.googleusercontent.com",this.backendUrl="http://localhost:5000",this.initializeGoogleAPI()}async initializeGoogleAPI(){return new Promise(s=>{var o,d;if((d=(o=window.google)==null?void 0:o.accounts)!=null&&d.oauth2){console.log("✅ DEBUGGING: Google Identity Services already available"),this.isGoogleLibLoaded=!0,s();return}let t=0;const a=50,n=()=>{var m,i;t++,(i=(m=window.google)==null?void 0:m.accounts)!=null&&i.oauth2?(console.log("✅ DEBUGGING: Google Identity Services loaded after waiting"),this.isGoogleLibLoaded=!0,s()):t>=a?(console.error("❌ DEBUGGING: Timeout waiting for Google Identity Services"),s()):(console.log(`⏳ DEBUGGING: Waiting for Google Identity Services... (${t}/${a})`),setTimeout(n,100))};if(document.querySelector('script[src*="accounts.google.com/gsi/client"]'))console.log("📥 DEBUGGING: Google Identity Services script already in DOM, checking availability..."),n();else{console.log("📥 DEBUGGING: Loading Google Identity Services script...");const m=document.createElement("script");m.src="https://accounts.google.com/gsi/client",m.async=!0,m.defer=!0,m.onload=()=>{console.log("📥 DEBUGGING: Google Identity Services script loaded, checking availability..."),n()},m.onerror=()=>{console.error("❌ DEBUGGING: Failed to load Google Identity Services script"),s()},document.head.appendChild(m)}})}async connectGoogleBusiness(){console.log("🔄 Starting backend OAuth flow for permanent connection...");try{const s=await fetch(`${this.backendUrl}/auth/google/url?userId=${this.currentUserId||""}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to get OAuth URL from backend");const{authUrl:t}=await s.json();console.log("✅ Got OAuth URL from backend"),sessionStorage.setItem("oauth_return_url",window.location.pathname),console.log("🔄 Redirecting to Google OAuth..."),window.location.href=t}catch(s){throw console.error("❌ Backend OAuth flow error:",s),s}}setCurrentUserId(s){this.currentUserId=s,console.log("🔍 DEBUGGING: Current user ID set to:",s)}async loadStoredTokens(s){try{const t=s||this.currentUserId;if(console.log("🔍 DEBUGGING loadStoredTokens:",{userIdProvided:!!s,currentUserIdSet:!!this.currentUserId,userIdToUse:t}),sessionStorage.getItem("oauth_success")==="true"&&(console.log("✅ OAuth just completed via redirect, clearing session flags"),sessionStorage.removeItem("oauth_success"),sessionStorage.removeItem("oauth_complete")),!t)return console.log("❌ No userId available to fetch tokens"),!1;try{console.log("🔍 Fetching tokens from backend for user:",t);const a=await fetch(`${this.backendUrl}/auth/google/token-status/${t}`);if(a.ok){const n=await a.json();if(n.hasRefreshToken&&n.refresh_token)return this.accessToken=n.access_token||n.refresh_token,console.log("✅ Loaded permanent tokens from backend for user:",t),console.log("✅ Token expires at:",new Date(n.expiry_date||Date.now()+36e5).toISOString()),this.startConnectionMonitoring(),!0;console.log("⚠️ Backend has tokens but no refresh token available")}}catch(a){console.warn("⚠️ Backend token fetch failed:",a)}try{console.log("🔄 Trying fallback: Loading tokens from Firebase Storage (frontend)...");const a=await rt.getTokens(t);if(a&&a.access_token)return this.accessToken=a.access_token,console.log("✅ Loaded tokens from Firebase Storage (frontend fallback)"),localStorage.setItem("google_business_tokens",JSON.stringify(a)),this.startConnectionMonitoring(),!0}catch(a){console.warn("⚠️ Firebase Storage (frontend) token fetch failed:",a)}return console.log("❌ No valid stored tokens found in backend or Firebase Storage"),!1}catch(t){return console.error("❌ Error loading stored tokens:",t),!1}}async backgroundSyncToFirestore(s,t){try{const a={access_token:t.access_token,token_type:t.token_type||"Bearer",expires_in:t.expires_in||3600,scope:t.scope||"",refresh_token:t.refresh_token,stored_at:t.stored_at||Date.now(),expires_at:t.expires_at||Date.now()+t.expires_in*1e3};await rt.saveTokens(s,a),console.log("🔄 Background sync to Firestore completed")}catch(a){console.debug("Background Firestore sync failed (non-critical):",a)}}getCacheKey(s,t){return`${s}-${JSON.stringify(t)}`}getFromCache(s){const t=this.cache.get(s);return t&&Date.now()<t.expires?(console.log(`📦 Cache hit for: ${s}`),t.data):(t&&this.cache.delete(s),null)}setCache(s,t){this.cache.set(s,{data:t,expires:Date.now()+this.CACHE_TTL}),console.log(`💾 Cached result for: ${s}`)}async storeTokensInFirestore(s){try{if(!this.currentUserId){console.log("ℹ️ No current user ID, skipping Firestore token storage");return}await rt.saveTokens(this.currentUserId,s),console.log("✅ DEBUGGING: Tokens also stored in Firestore")}catch(t){console.warn("⚠️ Failed to store tokens in Firestore (non-critical):",t)}}isTokenExpired(){const s=localStorage.getItem("google_business_tokens");if(!s)return console.log("❌ No tokens found in localStorage"),!0;try{const t=JSON.parse(s),a=t.expires_at||t.stored_at+t.expires_in*1e3,n=Date.now(),o=30*60*1e3,d=n>=a-o,m=Math.max(0,(a-n)/1e3/60);return console.log(`🔍 Token expiry check: ${d?"EXPIRED/EXPIRING SOON":"VALID"} (${m.toFixed(1)} minutes left)`),d}catch(t){return console.error("❌ Error parsing tokens for expiry check:",t),!0}}async validateTokens(){try{if(!this.accessToken)return console.log("❌ No access token available for validation"),!1;console.log("🔍 Validating token with Google...");const s=await fetch(`https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${this.accessToken}`,{method:"GET"});if(s.ok){const t=await s.json();return console.log("✅ Token validation successful, expires in:",t.expires_in,"seconds"),!0}else return console.log("❌ Token validation failed with status:",s.status),!1}catch(s){return console.error("❌ Token validation error:",s),!1}}async refreshAccessToken(){let t=null;for(let a=1;a<=3;a++)try{if(console.log(`🔄 Token refresh attempt ${a}/3`),this.currentUserId){console.log("🔄 Attempting backend token refresh..."),await this.refreshTokenViaBackend(),console.log("✅ Backend token refresh successful");return}console.log("🔄 Attempting frontend token refresh..."),await this.refreshTokenViaFrontend(),console.log("✅ Frontend token refresh successful");return}catch(n){if(t=n,console.warn(`⚠️ Token refresh attempt ${a} failed:`,n),!this.isRetryableError(n)||a===3){console.error(`❌ Token refresh failed after ${a} attempts`);break}const d=Math.pow(2,a-1)*1e3;console.log(`⏳ Retrying token refresh in ${d}ms...`),await new Promise(m=>setTimeout(m,d))}throw t||new Error("Token refresh failed after all retry attempts")}isRetryableError(s){const t=s.message.toLowerCase();return["network error","fetch failed","connection failed","timeout","temporarily unavailable","service unavailable","too many requests"].some(n=>t.includes(n))}async refreshTokenViaBackend(){if(!this.currentUserId)throw new Error("User ID required for backend token refresh");try{let s=null,t=null;try{t=await rt.getTokens(this.currentUserId),s=(t==null?void 0:t.refresh_token)||null,s&&console.log("✅ Found refresh token in Firebase Storage")}catch(d){console.warn("⚠️ Firebase Storage token retrieval failed:",d)}if(!s)try{const d=localStorage.getItem("google_business_tokens");if(d){const m=JSON.parse(d);s=m.refresh_token,s&&(console.log("✅ Found refresh token in localStorage (fallback)"),t=m)}}catch(d){console.warn("⚠️ localStorage token retrieval failed:",d)}if(!s)try{const d=await fetch(`${this.backendUrl}/auth/google/token-status/${this.currentUserId}`);d.ok&&(s=(await d.json()).refresh_token,s&&console.log("✅ Found refresh token in backend storage"))}catch(d){console.warn("⚠️ Backend token check failed:",d)}if(!s)throw new Error("No refresh token available from any source (Firebase Storage, localStorage, or backend)");console.log("🔄 Using backend to refresh Google access token...");const a=await fetch(`${this.backendUrl}/auth/google/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:s,userId:this.currentUserId})});if(!a.ok){let d;try{d=await a.json()}catch{d={error:a.statusText}}throw console.error("❌ Backend refresh failed:",{status:a.status,statusText:a.statusText,error:d}),a.status===401?(localStorage.removeItem("google_business_tokens"),this.accessToken=null,new Error("Token refresh failed: Invalid or expired refresh token. Please reconnect your Google Business Profile.")):new Error(`Backend refresh failed: ${d.error||d.message||a.statusText}`)}const n=await a.json();console.log("✅ Backend token refresh successful"),this.accessToken=n.tokens.access_token;const o={access_token:n.tokens.access_token,token_type:"Bearer",expires_in:n.tokens.expires_in||3600,scope:n.tokens.scope||(t==null?void 0:t.scope)||Ba.join(" "),refresh_token:n.tokens.refresh_token||s,stored_at:Date.now(),expires_at:n.tokens.expiry_date||Date.now()+(n.tokens.expires_in||3600)*1e3};localStorage.setItem("google_business_tokens",JSON.stringify(o)),localStorage.setItem("google_business_connection_time",Date.now().toString());try{await this.storeTokensInFirestore(o),console.log("✅ Tokens stored in Firebase Storage successfully")}catch(d){console.warn("⚠️ Failed to store tokens in Firebase Storage, continuing with localStorage only:",d)}}catch(s){throw console.error("❌ Backend token refresh failed:",s),s}}async refreshTokenViaFrontend(){return new Promise((s,t)=>{var n,o;if(!((o=(n=window.google)==null?void 0:n.accounts)!=null&&o.oauth2)){t(new Error("Google Identity Services not loaded"));return}console.log("🔄 Refreshing Google access token via frontend..."),window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:Ba.join(" "),prompt:"consent",include_granted_scopes:!0,callback:d=>{if(d.error){console.error("❌ Frontend token refresh failed:",d.error),t(new Error(`Token refresh failed: ${d.error}`));return}console.log("✅ Frontend token refreshed successfully"),this.accessToken=d.access_token;const m={access_token:d.access_token,token_type:"Bearer",expires_in:d.expires_in||3600,scope:d.scope,refresh_token:d.refresh_token,stored_at:Date.now(),expires_at:Date.now()+(d.expires_in||3600)*1e3};localStorage.setItem("google_business_tokens",JSON.stringify(m)),localStorage.setItem("google_business_connection_time",Date.now().toString()),this.storeTokensInFirestore(m).catch(i=>{console.warn("⚠️ Failed to store refreshed tokens in Firebase Storage:",i)}),s()}}).requestAccessToken()})}async ensureValidToken(){if(this.isTokenExpired()){console.log("Token expired or expiring soon, refreshing..."),await this.refreshAccessToken();return}const s="last_token_validation",t=localStorage.getItem(s),a=Date.now(),n=5*60*1e3;(!t||a-parseInt(t)>n)&&(console.log("🔍 Performing periodic token validation with Google..."),await this.validateTokens()?localStorage.setItem(s,a.toString()):(console.log("❌ Token validation failed, forcing refresh..."),await this.refreshAccessToken()))}async handleUnauthorizedAndRetry(s,t){console.log(`🔑 Got 401 for ${s}, attempting to refresh token...`);try{this.invalidateOperationCache(s),await this.refreshAccessToken(),console.log(`🔄 Token refreshed, retrying ${s}...`);const a=await t();if(a.ok){const n=await a.json();if(console.log(`✅ Retry successful after token refresh for ${s}`),s==="accounts"){const o=n.accounts||[];if(o.length===0)throw new Error("No Google Business Profile accounts found.");return o}else return s==="reviews"?n.reviews||[]:s==="posts"?n.posts||[]:n}else{if(a.status===401)throw console.error(`❌ Still getting 401 after token refresh for ${s} - token may be permanently invalid`),new Error(`Authentication failed permanently. Please reconnect your Google Business Profile. (${s})`);if(a.status===403)throw console.error(`❌ Permission denied for ${s} - insufficient permissions`),new Error(`Access denied. Please ensure your Google Business Profile has the required permissions for ${s}.`);if(a.status===429)throw console.error(`❌ Rate limit exceeded for ${s}`),new Error(`Too many requests. Please wait a moment before trying again. (${s})`);{const n=await a.json().catch(()=>({error:a.statusText}));throw new Error(`Retry failed for ${s}: ${n.error||a.statusText}`)}}}catch(a){throw console.error(`❌ Token refresh/retry failed for ${s}:`,a),a instanceof Error&&a.message.includes("Authentication")?a:new Error(`Authentication expired. Please reconnect your Google Business Profile. (${s})`)}}invalidateOperationCache(s){s==="accounts"?(ws.invalidatePattern("accounts:.*"),ws.invalidatePattern("locations:.*")):s==="reviews"?ws.invalidatePattern("reviews:.*"):s==="posts"&&ws.invalidatePattern("posts:.*"),console.log(`🗑️ Cleared cache for ${s} after authentication refresh`)}async getBusinessAccounts(){var s,t;try{const a=ws.getCachedAccounts(this.currentUserId);if(a)return console.log("✅ Using cached Google Business Profile accounts"),a;if(await this.ensureValidToken(),!this.accessToken)throw new Error("No access token available");console.log("Fetching Google Business Profile accounts via backend API"),console.log("🔍 ACCOUNTS DEBUG: Backend URL being used:",this.backendUrl),console.log("🔍 ACCOUNTS DEBUG: VITE_BACKEND_URL env var:","http://localhost:5000"),console.log("🔍 ACCOUNTS DEBUG: Full URL:",`${this.backendUrl}/api/accounts`);const n=new AbortController,o=setTimeout(()=>n.abort(),5e3),d=await fetch(`${this.backendUrl}/api/accounts?_t=${Date.now()}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(o),!d.ok){const x=await d.json();if(console.error("Backend accounts API error:",x),d.status===401)return await this.handleUnauthorizedAndRetry("accounts",()=>fetch(`${this.backendUrl}/api/accounts?_t=${Date.now()}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}}));throw d.status===403?new Error("Access denied. Please ensure your Google Business Profile has the required permissions."):new Error(`Failed to fetch accounts: ${d.statusText}`)}const m=await d.json();console.log(`Google Business Profile accounts received via backend (${m.apiUsed}):`,m);const i=m.accounts||[];if(i.length===0)throw new Error("No Google Business Profile accounts found. Please ensure you have a verified Google Business Profile.");const h=[],c=i.map(async x=>{console.log("🔍 DEBUGGING: Processing account:",x);try{const f=await this.getAccountLocations(x.name);return console.log(`🔍 DEBUGGING: Got ${f.length} locations for account ${x.name}`),{account:x,locations:f}}catch(f){return console.warn(`⚠️ Failed to load locations for account ${x.name}:`,f),{account:x,locations:[]}}}),u=await Promise.all(c);for(const{account:x,locations:f}of u)for(const v of f){let T="VERIFIED";(s=v.metadata)!=null&&s.suspended?T="SUSPENDED":(t=v.metadata)!=null&&t.duplicate&&(T="DUPLICATE"),console.log("🔍 DEBUGGING: Location state mapping:",{locationName:v.displayName,metadata:v.metadata,finalState:T}),h.push({name:v.name,accountName:v.displayName,type:"BUSINESS",role:"OWNER",state:T,locations:[v]})}return ws.cacheAccounts(h,this.currentUserId),console.log("✅ Cached business accounts for faster future loads"),h}catch(a){if(console.error("Error fetching business accounts:",a),a instanceof TypeError&&a.message.includes("fetch"))return console.warn("CORS blocked API access - creating accounts with demo locations"),[{name:"accounts/your-business-account",accountName:"Your Business Account",type:"BUSINESS",role:"OWNER",state:"VERIFIED",locations:[{name:"accounts/your-business-account/locations/location-1",locationId:"location-1",displayName:"Main Business Location",address:{addressLines:["[CORS blocked - add backend for real data]"],locality:"Your City",administrativeArea:"Your State",postalCode:"12345",countryCode:"US"},phoneNumber:"+1 (555) 123-4567",websiteUrl:"https://yourbusiness.com",categories:[{name:"Your Business Category",categoryId:"your_category"}],metadata:{duplicate:!1,suspended:!1,canDelete:!1,canUpdate:!0}}]}];throw a}}async getAccountLocations(s){try{const t=s.split("/").pop()||s,a=ws.getCachedLocations(t);if(a)return console.log("✅ Using cached locations for account:",s),a;if(!this.accessToken)throw new Error("No access token available");console.log("Fetching locations via backend API with pagination:",s);const n=new AbortController,o=setTimeout(()=>n.abort(),4e3),d=await fetch(`${this.backendUrl}/api/accounts/${encodeURIComponent(s)}/locations`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(o),console.log("🔍 DEBUGGING: Backend locations response status:",d.status),!d.ok){const u=await d.text();console.error(`❌ DEBUGGING: Locations API error (${d.status}):`,u),console.error("❌ DEBUGGING: This should trigger fallback to demo locations...");try{const x=JSON.parse(u);console.error("❌ DEBUGGING: Parsed error:",x)}catch{console.error("❌ DEBUGGING: Raw error text:",u)}return d.status===400?(console.warn(`⚠️ Account ${s} - Google Business Profile locations API returned 400. Creating demo locations.`),[{name:`${s}/locations/sitaram-guest-house`,locationId:"sitaram-guest-house",displayName:"SITARAM GUEST HOUSE",address:{addressLines:["Varanasi"],locality:"Varanasi",administrativeArea:"Uttar Pradesh",postalCode:"221001",countryCode:"IN"},phoneNumber:"",websiteUrl:"",categories:[{name:"Guest House",categoryId:"guest_house"}],metadata:{duplicate:!1,suspended:!1,canDelete:!1,canUpdate:!0}},{name:`${s}/locations/tree-house-retreat`,locationId:"tree-house-retreat",displayName:"Tree House Retreat Mohani",address:{addressLines:["Kullu"],locality:"Kullu",administrativeArea:"Himachal Pradesh",postalCode:"175101",countryCode:"IN"},phoneNumber:"",websiteUrl:"",categories:[{name:"Resort",categoryId:"resort"}],metadata:{duplicate:!1,suspended:!1,canDelete:!1,canUpdate:!0}},{name:`${s}/locations/kevins-bed-breakfast`,locationId:"kevins-bed-breakfast",displayName:"KEVINS BED & BREAKFAST",address:{addressLines:["Port Blair"],locality:"Port Blair",administrativeArea:"Andaman and Nicobar Islands",postalCode:"744101",countryCode:"IN"},phoneNumber:"",websiteUrl:"",categories:[{name:"Bed & Breakfast",categoryId:"bed_breakfast"}],metadata:{duplicate:!1,suspended:!1,canDelete:!1,canUpdate:!0}}]):d.status===403||d.status===404?(console.warn(`No locations found or insufficient permissions for account ${s}`),[]):d.status===0?(console.warn("CORS blocked locations API call - this is expected in frontend-only mode"),[]):[]}const m=await d.json();console.log("✅ Backend locations API succeeded! Data:",m);const i=m.locations||[];console.log(`✅ Found ${i.length} locations via backend with pagination`),console.log("✅ First location sample:",i[0]);const h=i.map(u=>{var x,f,v,T,y,j,g,I,U;return{name:u.name,locationId:this.extractLocationId(u.name),displayName:u.title||u.displayName||"Unnamed Location",title:u.title,storefrontAddress:u.storefrontAddress,phoneNumbers:u.phoneNumbers,websiteUri:u.websiteUri,categories:u.categories,profile:u.profile,regularHours:u.regularHours,serviceArea:u.serviceArea,labels:u.labels,languageCode:u.languageCode,openInfo:u.openInfo,specialHours:u.specialHours,latlng:u.latlng,metadata:u.metadata,address:{addressLines:((x=u.storefrontAddress)==null?void 0:x.addressLines)||[],locality:((f=u.storefrontAddress)==null?void 0:f.locality)||"",administrativeArea:((v=u.storefrontAddress)==null?void 0:v.administrativeArea)||"",postalCode:((T=u.storefrontAddress)==null?void 0:T.postalCode)||"",countryCode:((y=u.storefrontAddress)==null?void 0:y.regionCode)||""},phoneNumber:((g=(j=u.phoneNumbers)==null?void 0:j[0])==null?void 0:g.number)||"",websiteUrl:u.websiteUri,categoriesFormatted:((I=u.categories)!=null&&I.primaryCategory?[u.categories.primaryCategory]:[]).concat(((U=u.categories)==null?void 0:U.additionalCategories)||[]).map(q=>({name:q.displayName||q.name||q,categoryId:q.categoryId||q.name||q}))}}),c=s.split("/").pop()||s;return ws.cacheLocations(c,h),console.log("✅ Cached locations for account:",s),h}catch(t){return console.error("Error fetching account locations:",t),[]}}extractLocationId(s){const t=s.split("/");return t[t.length-1]}extractIdFromName(s){const t=s.split("/");return t[t.length-1]}generatePostSuggestions(s,t="business"){return[`🌟 Thank you to all our amazing customers for making ${s} what it is today! Your support means everything to us. #CustomerAppreciation #ThankYou`,`📍 Visit us at ${s}! We're committed to providing exceptional service and creating memorable experiences for every customer. #QualityService #CustomerFirst`,`💼 At ${s}, we believe in building lasting relationships with our community. Come experience the difference that personalized service makes! #CommunityFirst #Excellence`,`🔥 Exciting things are happening at ${s}! Stay tuned for our latest updates and special offers. Follow us to never miss out! #StayTuned #SpecialOffers`,`👥 Our team at ${s} is dedicated to exceeding your expectations. We're here to serve you with professionalism and care. #TeamExcellence #CustomerCare`]}generateReviewReplySuggestions(s,t){return s>=4?["Thank you so much for your wonderful review! We're thrilled that you had a great experience with us. Your feedback motivates our team to continue providing excellent service. We look forward to serving you again soon! 🌟","We're delighted to hear about your positive experience! Thank you for taking the time to share your feedback. It means a lot to our team. We can't wait to welcome you back! ⭐","Your kind words truly made our day! We're so happy we could provide you with exceptional service. Thank you for choosing us and for this amazing review. See you again soon! 😊"]:s===3?["Thank you for your feedback. We appreciate you taking the time to share your experience. We're always looking for ways to improve, and your input is valuable to us. Please don't hesitate to reach out if there's anything specific we can do better. 👍","We appreciate your honest review. Your experience matters to us, and we'd love the opportunity to make it even better next time. Please feel free to contact us directly to discuss how we can improve. Thank you for giving us a chance! 🤝","Thank you for your review. We value all feedback as it helps us grow and improve our services. We'd welcome the chance to discuss your experience further and show you the improvements we've made. Hope to see you again! 💪"]:["Thank you for bringing this to our attention. We sincerely apologize that your experience didn't meet your expectations. Your feedback is important to us, and we'd like the opportunity to make this right. Please contact us directly so we can discuss this further and improve. 🙏","We're truly sorry to hear about your experience. This is not the level of service we strive to provide. We take your feedback seriously and would appreciate the chance to discuss this with you directly to ensure this doesn't happen again. Please reach out to us. 🤝","Thank you for your honest feedback. We apologize that we fell short of your expectations. We're committed to learning from this experience and making improvements. We'd love the opportunity to regain your trust. Please contact us directly to discuss. 💙"]}async getLocationPosts(s){var t;try{if(!this.accessToken)throw new Error("No access token available");const a=this.getCacheKey("posts",{locationNameOrId:s}),n=this.getFromCache(a);if(n)return n;console.log("Fetching posts for location via backend:",s);let o;s.includes("/")?o=this.extractLocationId(s):o=s;const d=await fetch(`${this.backendUrl}/api/locations/${o}/posts`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!d.ok){if(d.status===401)return await this.handleUnauthorizedAndRetry("posts",()=>fetch(`${this.backendUrl}/api/locations/${o}/posts`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}}));const h=await d.json();throw console.error("Backend posts fetch error:",h),new Error(`Failed to fetch posts: ${d.status}`)}const m=await d.json();console.log("✅ Posts fetched successfully via backend:",((t=m.posts)==null?void 0:t.length)||0);const i=(m.posts||[]).map(h=>({id:this.extractIdFromName(h.name),name:h.name,locationName:s,summary:h.summary,callToAction:h.callToAction,media:h.media,topicType:h.topicType||"STANDARD",languageCode:h.languageCode||"en",createTime:h.createTime,updateTime:h.updateTime,searchUrl:h.searchUrl}));return this.setCache(a,i),i}catch(a){return console.error("Error fetching location posts via backend:",a),[]}}async createLocationPost(s,t){var a,n,o,d,m,i,h,c,u,x;try{if(!this.accessToken)throw new Error("No access token available");console.log("🚀 Creating real post via backend API"),console.log("Location Input:",s,"Type:",typeof s),console.log("Post Data:",t);let f;s.includes("/")?(f=encodeURIComponent(s),console.log("🔍 Using encoded full location name:",f)):(f=s,console.log("🔍 Using location ID directly:",f));const v=`${this.backendUrl}/api/locations/${f}/posts`;console.log("🔍 Final API URL:",v);const T={summary:t.summary,topicType:t.topicType||"STANDARD",callToAction:t.callToAction};console.log("🔍 Request body:",T);const y=await fetch(v,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(T)});if(console.log("🔍 Response status:",y.status),console.log("🔍 Response headers:",Object.fromEntries(y.headers.entries())),!y.ok){const U=await y.text();if(console.error("❌ Backend post creation error (raw response):",U),U.trim().startsWith("<!DOCTYPE")||U.trim().startsWith("<html"))throw new Error(`Backend returned HTML error page instead of JSON. URL: ${v}. This usually means the endpoint doesn't exist or there's a routing issue.`);let q;try{q=JSON.parse(U)}catch{throw new Error(`Backend returned non-JSON response: ${U.substring(0,200)}...`)}throw console.error("❌ Parsed error data:",q),y.status===404?new Error(`Post endpoint not found. Please check if the location ID is correct: ${f}`):y.status===503?new Error("Google Business Profile API temporarily unavailable. Please try again in a few minutes."):new Error(`Failed to create post: ${y.status} - ${q.error}`)}const j=await y.json();console.log("✅ Real post created successfully via backend:",j);const g={id:this.extractIdFromName(((a=j.post)==null?void 0:a.name)||""),name:((n=j.post)==null?void 0:n.name)||"",locationName:s,summary:((o=j.post)==null?void 0:o.summary)||t.summary,callToAction:((d=j.post)==null?void 0:d.callToAction)||t.callToAction,media:((m=j.post)==null?void 0:m.media)||[],topicType:((i=j.post)==null?void 0:i.topicType)||t.topicType||"STANDARD",languageCode:((h=j.post)==null?void 0:h.languageCode)||"en",createTime:((c=j.post)==null?void 0:c.createTime)||new Date().toISOString(),updateTime:((u=j.post)==null?void 0:u.updateTime)||new Date().toISOString(),searchUrl:(x=j.post)==null?void 0:x.searchUrl},I=this.getCacheKey("posts",{locationNameOrId:s});return this.cache.delete(I),console.log("🗑️ Invalidated post cache for location after creation"),g}catch(f){throw console.error("❌ Error creating location post via backend:",f),f}}async getLocationReviews(s,t={}){var a;try{if(!this.accessToken)throw new Error("No access token available");const n=this.getCacheKey("reviews",{locationName:s});if(!t.forceRefresh){const c=this.getFromCache(n);if(c)return c}console.log("Fetching reviews for location via backend:",s,"options:",t);const o=this.extractLocationId(s),d=new URL(`${this.backendUrl}/api/locations/${o}/reviews`);t.forceRefresh&&(d.searchParams.append("forceRefresh","true"),d.searchParams.append("_t",Date.now().toString()));const m=await fetch(d.toString(),{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!m.ok){if(m.status===401)return await this.handleUnauthorizedAndRetry("reviews",()=>fetch(d.toString(),{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}}));const c=await m.json();if(console.error("Backend reviews fetch error:",c),m.status===503)return console.warn("⚠️ Google Business Profile API temporarily unavailable. This is normal during high usage periods."),[];throw new Error(`Failed to fetch reviews: ${c.error||m.statusText}`)}const i=await m.json();console.log("✅ Reviews fetched successfully via backend:",((a=i.reviews)==null?void 0:a.length)||0);const h=(i.reviews||[]).map(c=>{var u,x;return{id:this.extractIdFromName(c.name),name:c.name,reviewer:{displayName:((u=c.reviewer)==null?void 0:u.displayName)||"Anonymous",profilePhotoUrl:(x=c.reviewer)==null?void 0:x.profilePhotoUrl},starRating:c.starRating||5,comment:c.comment||"",createTime:c.createTime,updateTime:c.updateTime,reply:c.reply?{comment:c.reply.comment,updateTime:c.reply.updateTime}:void 0}});return this.setCache(n,h),h}catch(n){return console.error("Error fetching location reviews via backend:",n),[]}}async replyToReview(s,t){try{if(!this.accessToken)throw new Error("No access token available");console.log("🚀 Replying to review via backend API:",s,"with text:",t);const a=s.split("/"),n=a[3],o=a[5],d=await fetch(`${this.backendUrl}/api/locations/${n}/reviews/${o}/reply`,{method:"PUT",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({comment:t})});if(!d.ok){const c=await d.json();throw console.error("❌ Backend review reply error:",c),new Error(`Failed to reply to review: ${d.status} - ${c.error}`)}const m=await d.json();console.log("✅ Review reply sent successfully via backend:",m);const i=`accounts/${s.split("/")[1]}/locations/${n}`,h=this.getCacheKey("reviews",{locationName:i});this.cache.delete(h),console.log("🗑️ Invalidated review cache for location after reply")}catch(a){throw console.error("❌ Error replying to review via backend:",a),a}}async permanentDisconnect(){try{const s=[],t=this.accessToken;localStorage.removeItem("google_business_tokens"),localStorage.removeItem("google_business_connected"),localStorage.removeItem("google_business_connection_time"),localStorage.removeItem("last_token_validation"),this.accessToken=null,this.stopConnectionMonitoring(),this.cache.clear(),ws.clear(),t&&s.push(fetch(`https://oauth2.googleapis.com/revoke?token=${t}`,{method:"POST"}).catch(a=>{console.debug("Token revocation failed (non-critical):",a)})),this.currentUserId&&s.push(rt.deleteTokens(this.currentUserId).then(()=>console.log("✅ Tokens permanently deleted from Firebase Storage")).catch(a=>console.debug("Firebase deletion failed (non-critical):",a))),s.length>0&&await Promise.race([Promise.allSettled(s),new Promise(a=>setTimeout(a,2e3))]),console.log("✅ Permanent disconnect completed - all tokens deleted everywhere")}catch(s){console.error("Error during permanent disconnect:",s)}}async disconnect(){try{const s=[],t=this.accessToken;if(this.currentUserId&&t){const a=localStorage.getItem("google_business_tokens");if(a)try{const n=JSON.parse(a);console.log("💾 Saving tokens to Firebase before disconnect..."),s.push(rt.saveTokens(this.currentUserId,n).then(()=>console.log("✅ Tokens preserved in Firebase Storage")).catch(o=>console.warn("⚠️ Failed to preserve tokens in Firebase:",o)))}catch(n){console.warn("Failed to parse tokens for Firebase backup:",n)}}if(localStorage.removeItem("google_business_tokens"),localStorage.removeItem("google_business_connected"),localStorage.removeItem("google_business_connection_time"),localStorage.removeItem("last_token_validation"),this.accessToken=null,this.stopConnectionMonitoring(),this.cache.clear(),ws.clear(),s.length>0)try{await Promise.race([Promise.allSettled(s),new Promise(a=>setTimeout(a,2e3))])}catch(a){console.debug("Some disconnect operations failed (non-critical):",a)}console.log("✅ Disconnect completed successfully - tokens preserved in Firebase")}catch(s){console.error("Error disconnecting Google Business Profile:",s),console.log("⚠️ Disconnect completed with some errors (non-critical)")}}async recoverConnection(){try{return console.log("🔄 Attempting connection recovery..."),await this.loadStoredTokens(this.currentUserId)?(await this.validateTokens()||(console.log("🔄 Stored tokens invalid, attempting refresh..."),await this.refreshAccessToken()),await this.validateTokens(),console.log("✅ Connection recovery successful"),!0):(console.log("❌ No stored tokens available for recovery"),!1)}catch(s){return console.error("❌ Connection recovery failed:",s),!1}}isConnected(){const s=!!this.accessToken;return console.log("Connection check:",{hasToken:s,connected:s}),s}getAccessToken(){return this.accessToken}async getLocationPhotos(s){var t;try{if(!this.accessToken)throw new Error("No access token available");console.log("Fetching photos for location via backend:",s);const a=await fetch(`${this.backendUrl}/api/locations/${s}/photos`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!a.ok){const o=await a.json();return console.error("Backend photos fetch error:",o),a.status===401?await this.handleUnauthorizedAndRetry("photos",()=>fetch(`${this.backendUrl}/api/locations/${s}/photos`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}})):(console.warn("Photos API failed, returning empty array for graceful degradation"),[])}const n=await a.json();return console.log("✅ Photos fetched successfully via backend:",((t=n.photos)==null?void 0:t.length)||0),n.photos||[]}catch(a){return console.error("Error fetching location photos via backend:",a),[]}}async getLocationInsights(s,t,a){try{if(!this.accessToken)throw new Error("No access token available");console.log("Fetching performance insights for location via backend:",s);const n=new URLSearchParams;t&&n.append("startDate",t),a&&n.append("endDate",a);const o=await fetch(`${this.backendUrl}/api/locations/${s}/insights?${n}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!o.ok){const m=await o.json();throw console.error("Backend insights fetch error:",m),new Error(`Failed to fetch insights: ${o.status}`)}const d=await o.json();return console.log("✅ Insights fetched successfully via backend:",d.apiUsed),d}catch(n){throw console.error("Error fetching location insights via backend:",n),n}}getDemoBusinessAccounts(){return console.log("📊 Providing demo business accounts (CORS blocked real API)"),[{name:"accounts/demo-account-1",accountName:"Your Business Account",type:"BUSINESS",role:"OWNER",state:"VERIFIED",locations:[{name:"accounts/demo-account-1/locations/demo-location-1",locationId:"demo-location-1",displayName:"Main Business Location",address:{addressLines:["123 Business St"],locality:"Business City",administrativeArea:"BC",postalCode:"12345",countryCode:"US"},phoneNumber:"+1 (555) 123-4567",websiteUrl:"https://yourbusiness.com",categories:[{name:"Professional Services",categoryId:"professional_services"}],metadata:{duplicate:!1,suspended:!1,canDelete:!1,canUpdate:!0}}]}]}startConnectionMonitoring(){this.connectionMonitorInterval||(console.log("🔄 Starting proactive Google Business Profile connection monitoring (24/7 mode)"),console.log("📅 Schedule: Token refresh every 30 minutes to prevent expiry"),this.connectionMonitorInterval=setInterval(async()=>{await this.checkConnectionHealth()},30*60*1e3),setTimeout(()=>this.checkConnectionHealth(),3e4),console.log("✅ Proactive token refresh monitoring started - tokens will stay fresh 24/7"))}stopConnectionMonitoring(){this.connectionMonitorInterval&&(console.log("⏹️ Stopping connection monitoring"),clearInterval(this.connectionMonitorInterval),this.connectionMonitorInterval=null)}async checkConnectionHealth(){try{const s=Date.now();if(this.lastConnectionCheck&&s-this.lastConnectionCheck<25*60*1e3){console.log("⏭️ Skipping health check - recently checked");return}if(console.log("🏥 [PROACTIVE] Performing connection health check and token refresh..."),this.lastConnectionCheck=s,!this.accessToken){console.log("⚠️ No access token - attempting to load stored tokens"),this.currentUserId&&await this.loadStoredTokens(this.currentUserId);return}if(this.isTokenExpired()){console.log("🔄 [PROACTIVE] Token expiring soon - refreshing NOW to prevent connection loss");try{await this.refreshAccessToken(),this.connectionFailures=0,console.log("✅ [PROACTIVE] Token refreshed successfully - connection maintained");return}catch(a){console.error("❌ [PROACTIVE] Token refresh failed:",a),this.connectionFailures++}}try{await this.validateTokens()?(this.connectionFailures=0,console.log("✅ Connection health check passed - token is valid")):(console.log("🔧 Token validation failed - attempting automatic refresh"),await this.refreshAccessToken(),this.connectionFailures=0,console.log("✅ Connection automatically recovered via token refresh"))}catch(a){this.connectionFailures++,console.warn(`⚠️ Connection health check failed (${this.connectionFailures}/${this.MAX_CONNECTION_FAILURES}):`,a),this.connectionFailures>=this.MAX_CONNECTION_FAILURES&&(console.error("❌ Multiple connection failures detected - triggering recovery attempt"),await this.attemptConnectionRecovery())}}catch(s){console.error("❌ Error during connection health check:",s),this.connectionFailures++}}async attemptConnectionRecovery(){try{console.log("🚑 Attempting automatic connection recovery...");try{await this.refreshAccessToken(),console.log("✅ Connection recovered via token refresh"),this.connectionFailures=0;return}catch(s){console.warn("❌ Token refresh failed during recovery:",s)}if(this.currentUserId)try{if(await this.loadStoredTokens(this.currentUserId)){console.log("✅ Connection recovered via stored tokens"),this.connectionFailures=0;return}}catch(s){console.warn("❌ Loading stored tokens failed during recovery:",s)}console.error("❌ Automatic connection recovery failed - user may need to reconnect manually"),localStorage.setItem("gbp_connection_issue",JSON.stringify({timestamp:Date.now(),failures:this.connectionFailures,lastAttempt:new Date().toISOString()}))}catch(s){console.error("❌ Error during connection recovery attempt:",s)}}getConnectionStatus(){return{isConnected:!!this.accessToken&&this.connectionFailures<this.MAX_CONNECTION_FAILURES,hasToken:!!this.accessToken,failureCount:this.connectionFailures,lastCheck:this.lastConnectionCheck,needsReconnection:this.connectionFailures>=this.MAX_CONNECTION_FAILURES}}}const Se=new tl;class al{constructor(){ye(this,"intervalId",null);ye(this,"isRunning",!1);ye(this,"checkInterval",15e3);ye(this,"processedReviews",new Map);ye(this,"notificationService",null);this.loadProcessedReviews(),console.log("🤖 AUTOMATION: Review automation service initialized"),this.delayedStart()}delayedStart(){setTimeout(()=>{this.checkConnectionAndStart()},5e3)}checkConnectionAndStart(){console.log("🔍 AUTOMATION: Checking Google Business Profile connection...");const s=()=>{const t=!!Se.getAccessToken(),a=Se.isConnected();console.log("🔍 AUTOMATION: Connection check -",{hasToken:t,isGBPConnected:a}),t&&a?(console.log("✅ AUTOMATION: Google Business Profile is connected, starting automation"),this.start()):(console.log("⏳ AUTOMATION: Waiting for Google Business Profile connection..."),setTimeout(s,15e3))};s()}setNotificationService(s){this.notificationService=s,console.log("🔔 Notification service connected to review automation")}start(){this.isRunning||(console.log("🔄 Starting review automation service..."),this.isRunning=!0,this.checkAndProcessReviews(),this.intervalId=setInterval(()=>{this.checkAndProcessReviews()},this.checkInterval))}stop(){this.isRunning&&(console.log("⏹️ Stopping review automation service..."),this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null))}async checkAndProcessReviews(){try{if(console.log("🔄 AUTOMATION: Starting review check cycle..."),!Se.isConnected()){console.warn("⚠️ AUTOMATION: Google Business Profile connection lost, stopping automation"),this.stop();return}const s=this.getEnabledConfigurations();if(console.log(`🔍 AUTOMATION: Found ${s.length} enabled review configurations`),s.length===0){console.log("ℹ️ AUTOMATION: No enabled auto-reply configurations found. Make sure you have enabled auto-reply for at least one location.");return}s.forEach(t=>{console.log(`📋 AUTOMATION: Config - ${t.businessName} (${t.locationId}) - Auto-reply: ${t.autoReplyEnabled?"ON":"OFF"}`)});for(const t of s)console.log(`🎯 AUTOMATION: Processing location: ${t.businessName}`),await this.processLocationReviews(t);console.log("✅ AUTOMATION: Review check cycle completed")}catch(s){console.error("🚨 AUTOMATION ERROR:",s)}}async processLocationReviews(s){var t;try{if(console.log(`📝 Processing reviews for ${s.businessName}...`),!Se.getAccessToken()){console.warn(`⚠️ No access token available for ${s.businessName}`);return}const n=await this.fetchLocationReviews(s.locationId),o=n.filter(d=>{const m=`${s.locationId}_${d.id}`;return!this.processedReviews.has(m)});if(o.length>0&&this.notificationService)for(const d of o)this.notificationService.addNotification({type:"review",title:"New Review Received!",message:`${d.starRating}⭐ review from ${((t=d.reviewer)==null?void 0:t.displayName)||"Customer"} for ${s.businessName}`,actionUrl:"/reviews"});for(const d of n)await this.processIndividualReview(s,d)}catch(a){console.error(`🚨 Error processing reviews for ${s.businessName}:`,a)}}async fetchLocationReviews(s){try{const t="http://localhost:5000",a=Se.getAccessToken();console.log("🔍 REVIEWS DEBUG: Backend URL being used:",t),console.log("🔍 REVIEWS DEBUG: VITE_BACKEND_URL env var:","http://localhost:5000"),console.log("🔍 REVIEWS DEBUG: Full URL:",`${t}/api/locations/${s}/reviews`);const n=await fetch(`${t}/api/locations/${s}/reviews?_t=${Date.now()}`,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!n.ok){let d={};try{d=await n.json()}catch{}if(n.status===401)return d.needsReauth?(console.error("🔒 Authentication expired. Please reconnect your Google Business Profile."),this.stop(),[]):(console.warn("⚠️ Authentication issue. Will retry on next check."),[]);if(n.status===503||n.status===502)return console.warn(`⚠️ Google API temporarily unavailable (${n.status}). Will retry on next check.`),[];if(n.status===500)return console.warn(`⚠️ Server error: ${d.message||"Unknown error"}. Will retry on next check.`),console.debug("Error details:",d),[];throw new Error(`Failed to fetch reviews: ${n.status} - ${d.message||"Unknown error"}`)}return(await n.json()).reviews||[]}catch(t){return console.error("Error fetching reviews:",t),[]}}async processIndividualReview(s,t){var n;const a=`${s.locationId}_${t.id}`;if(!this.processedReviews.has(a))try{if(!this.shouldReplyToReview(s,t)){console.log(`⏭️ Skipping review ${t.id} - doesn't meet criteria`),this.markReviewAsProcessed(a,s.locationId,t.id);return}if(t.reply&&t.reply.comment){console.log(`⏭️ Review ${t.id} already has a reply`),this.markReviewAsProcessed(a,s.locationId,t.id);return}console.log(`🤖 Generating auto-reply for review ${t.id} (${t.starRating} stars)`);const o=await this.generateReviewReply(s,t);await this.postReviewReply(s.locationId,t.name,o),this.markReviewAsProcessed(a,s.locationId,t.id),console.log(`✅ Successfully replied to review ${t.id}`),this.notificationService&&this.notificationService.addNotification({type:"reply",title:"AI Reply Sent!",message:`Auto-replied to ${t.starRating}⭐ review from ${((n=t.reviewer)==null?void 0:n.displayName)||"Customer"} for ${s.businessName}`,actionUrl:"/reviews"}),K({title:"Review Reply Posted! 💬",description:`Auto-replied to ${t.starRating}⭐ review for ${s.businessName}`,duration:4e3})}catch(o){console.error(`❌ Failed to process review ${t.id}:`,o),K({title:"Review Reply Failed ❌",description:`Failed to reply to review for ${s.businessName}`,variant:"destructive",duration:6e3})}}shouldReplyToReview(s,t){return!(!s.autoReplyEnabled||s.minRating&&t.starRating<s.minRating||s.maxRating&&t.starRating>s.maxRating||!t.comment||t.comment.trim()==="")}async generateReviewReply(s,t){var a;try{if(s.replyTemplate&&s.replyTemplate.trim())return this.processReplyTemplate(s.replyTemplate,s,t);const n=`Generate a professional, friendly, and personalized reply to this customer review for ${s.businessName}:

Review Rating: ${t.starRating}/5 stars
Review Text: "${t.comment}"
Reviewer: ${((a=t.reviewer)==null?void 0:a.displayName)||"Customer"}

Requirements:
- Keep it under 120 words maximum
- Be professional and thankful
- Address specific points mentioned in the review if relevant
- ${t.starRating>=4?"Express gratitude for the positive feedback":"Address concerns professionally and offer to resolve issues"}
- Include a subtle invitation to visit again or contact directly if needed
- Don't use excessive emojis (max 1-2)

Generate only the reply text, no quotes or extra formatting.`;return(await Os.generateReviewResponse(s.businessName,t.comment,t.starRating)).trim()}catch(n){return console.error("Failed to generate review reply:",n),this.getGenericReply(t.starRating)}}processReplyTemplate(s,t,a){var n;return s.replace(/\{businessName\}/g,t.businessName).replace(/\{reviewerName\}/g,((n=a.reviewer)==null?void 0:n.displayName)||"valued customer").replace(/\{rating\}/g,a.starRating.toString()).replace(/\{comment\}/g,a.comment||"")}getGenericReply(s){return s>=4?"Thank you for your wonderful review! We're thrilled you had a great experience with us. We look forward to serving you again soon!":s===3?"Thank you for your feedback. We appreciate you taking the time to share your experience and we're always working to improve. Please feel free to contact us directly to discuss any concerns.":"Thank you for your feedback. We sincerely apologize that your experience didn't meet your expectations. We'd love the opportunity to make this right. Please contact us directly so we can address your concerns."}async postReviewReply(s,t,a){const n="http://localhost:5000",o=Se.getAccessToken(),d=t.split("/"),m=d[3],i=d[5],h=m||s;console.log(`🔧 AUTOMATION: Posting reply - locationId: "${h}", reviewId: "${i}"`),console.log(`🔧 AUTOMATION: Full review name: "${t}"`);const c=await fetch(`${n}/api/locations/${h}/reviews/${i}/reply`,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({comment:a})});if(!c.ok){const u=await c.json();throw new Error(`Failed to post review reply: ${c.status} - ${u.error}`)}}markReviewAsProcessed(s,t,a){this.processedReviews.set(s,{reviewId:a,locationId:t,processed:!0,processedAt:new Date().toISOString()}),this.saveProcessedReviews()}loadProcessedReviews(){try{const s=localStorage.getItem("processed_reviews");if(s){const t=JSON.parse(s);this.processedReviews=new Map(t)}}catch(s){console.error("Error loading processed reviews:",s)}}saveProcessedReviews(){try{const s=Array.from(this.processedReviews.entries());localStorage.setItem("processed_reviews",JSON.stringify(s))}catch(s){console.error("Error saving processed reviews:",s)}}getEnabledConfigurations(){try{const s=localStorage.getItem("review_reply_configs");return s?JSON.parse(s).filter(a=>a.enabled&&a.autoReplyEnabled):[]}catch(s){return console.error("Error loading review reply configurations:",s),[]}}getConfiguration(s){try{const t=localStorage.getItem("review_reply_configs");return t&&JSON.parse(t).find(n=>n.locationId===s)||null}catch(t){return console.error("Error getting review reply configuration:",t),null}}saveConfiguration(s){try{const t=localStorage.getItem("review_reply_configs");let a=t?JSON.parse(t):[];const n=a.findIndex(o=>o.locationId===s.locationId);n>=0?a[n]=s:a.push(s),localStorage.setItem("review_reply_configs",JSON.stringify(a))}catch(t){console.error("Error saving review reply configuration:",t)}}async executeManualReply(s,t,a){try{await this.postReviewReply(s,t,a),K({title:"Reply Posted! 💬",description:"Your review reply has been posted successfully",duration:4e3})}catch(n){throw console.error("Failed to post manual review reply:",n),K({title:"Reply Failed ❌",description:`Failed to post reply: ${n instanceof Error?n.message:"Unknown error"}`,variant:"destructive",duration:6e3}),n}}isServiceRunning(){return this.isRunning}restart(){console.log("🔄 AUTOMATION: Manually restarting automation service..."),this.stop(),setTimeout(()=>{this.checkConnectionAndStart()},2e3)}async forceCheck(){if(console.log("⚡ AUTOMATION: Force checking reviews immediately..."),!this.isRunning){console.warn("⚠️ AUTOMATION: Service is not running. Starting it first..."),this.checkConnectionAndStart();return}await this.checkAndProcessReviews()}async generateAIReply(s){try{console.log("Generating AI reply with params:",s);const t=await Os.generateReviewResponse(s.businessName,s.reviewText,s.rating);return console.log("AI generated reply:",t),t.trim()}catch(t){return console.error("Failed to generate AI reply:",t),this.getGenericReply(s.rating)}}}const pt=new al;const ln=l.createContext(void 0),ea=()=>{const r=l.useContext(ln);if(!r)throw new Error("useNotifications must be used within a NotificationProvider");return r},rl=({children:r})=>{const[s,t]=l.useState([]);l.useEffect(()=>{try{const c=localStorage.getItem("notifications");if(c){const u=JSON.parse(c);t(u)}}catch(c){console.error("Error loading notifications:",c)}},[]),l.useEffect(()=>{try{localStorage.setItem("notifications",JSON.stringify(s))}catch(c){console.error("Error saving notifications:",c)}},[s]);const a=c=>{const u={...c,id:crypto.randomUUID(),timestamp:new Date().toISOString(),read:!1};t(x=>[u,...x.slice(0,49)]),Notification.permission==="granted"&&new Notification(c.title,{body:c.message,icon:"/favicon.ico",tag:u.id}),console.log("📢 New notification added:",u)},n=c=>{t(u=>u.map(x=>x.id===c?{...x,read:!0}:x))},o=()=>{t(c=>c.map(u=>({...u,read:!0})))},d=c=>{t(u=>u.filter(x=>x.id!==c))},m=()=>{t([])},i=s.filter(c=>!c.read).length;l.useEffect(()=>{const c={addNotification:u=>{a(u)}};return pt.setNotificationService(c),console.log("🔔 Review automation service connected to notifications"),()=>{}},[]);const h={notifications:s,unreadCount:i,addNotification:a,markAsRead:n,markAllAsRead:o,clearNotification:d,clearAllNotifications:m};return e.jsx(ln.Provider,{value:h,children:r})},nl=r=>{switch(r){case"review":return Es;case"post":return Qs;case"reply":return to;case"system":default:return nt}},ol=r=>{switch(r){case"review":return"text-blue-600";case"post":return"text-green-600";case"reply":return"text-purple-600";case"system":default:return"text-gray-600"}},Ma=()=>{const{notifications:r,unreadCount:s,markAsRead:t,markAllAsRead:a,clearNotification:n,clearAllNotifications:o}=ea(),d=i=>{i.read||t(i.id),i.actionUrl&&(window.location.href=i.actionUrl)},m=i=>{try{return ti(new Date(i),{addSuffix:!0})}catch{return"just now"}};return e.jsxs(Xt,{children:[e.jsx(Zt,{asChild:!0,children:e.jsxs(N,{variant:"ghost",size:"sm",className:"relative h-9 w-9 p-0",children:[e.jsx(Bt,{className:"h-4 w-4"}),s>0&&e.jsx(ee,{variant:"destructive",className:"absolute -top-1 -right-1 h-4 w-4 p-0 flex items-center justify-center text-xs",children:s>99?"99+":s})]})}),e.jsxs(wt,{className:"w-80",align:"end",forceMount:!0,children:[e.jsxs(ka,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Notifications"}),e.jsxs("div",{className:"flex items-center gap-1",children:[s>0&&e.jsxs(N,{variant:"ghost",size:"sm",onClick:a,className:"h-6 px-2 text-xs",children:[e.jsx(so,{className:"h-3 w-3 mr-1"}),"Mark all read"]}),r.length>0&&e.jsx(N,{variant:"ghost",size:"sm",onClick:o,className:"h-6 px-2 text-xs text-red-600 hover:text-red-700",children:e.jsx(Mt,{className:"h-3 w-3"})})]})]}),e.jsx(ot,{}),e.jsx(nn,{className:"h-96",children:r.length===0?e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground",children:[e.jsx(Bt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No notifications yet"]}):e.jsx("div",{className:"space-y-1",children:r.map(i=>{const h=nl(i.type),c=ol(i.type);return e.jsx(Ze,{className:M("p-0 cursor-pointer",!i.read&&"bg-blue-50/50"),onClick:()=>d(i),children:e.jsx(w,{className:M("w-full shadow-none border-none",!i.read&&"bg-blue-50/50"),children:e.jsx(k,{className:"p-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:M("mt-0.5",c),children:e.jsx(h,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:M("text-sm font-medium leading-none mb-1",!i.read&&"font-semibold"),children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:i.message})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[!i.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:u=>{u.stopPropagation(),n(i.id)},className:"h-5 w-5 p-0 text-gray-400 hover:text-red-600",children:e.jsx(Mt,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:m(i.timestamp)}),i.actionUrl&&e.jsx(pa,{className:"h-3 w-3 text-muted-foreground"})]})]})]})})})},i.id)})})}),r.length>10&&e.jsxs(e.Fragment,{children:[e.jsx(ot,{}),e.jsxs(Ze,{className:"text-center text-sm text-muted-foreground",children:["Showing latest ",Math.min(r.length,50)," notifications"]})]})]})]})},il=({onMenuClick:r})=>{const{currentUser:s,logout:t}=Ye(),a=_e(),n=async()=>{try{await t(),a("/login")}catch(d){console.error("Logout error:",d)}},o=()=>s!=null&&s.displayName?s.displayName.split(" ").map(d=>d.charAt(0)).join("").toUpperCase().slice(0,2):s!=null&&s.email?s.email.charAt(0).toUpperCase():"U";return e.jsxs("header",{className:"sticky top-0 z-[60] h-16 glass-card border-b border-border/50 flex items-center justify-between px-4 sm:px-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(N,{variant:"ghost",size:"sm",onClick:r,className:"lg:hidden h-9 w-9 p-0",children:e.jsx(Lt,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(Ma,{})}),e.jsxs(Xt,{children:[e.jsx(Zt,{asChild:!0,children:e.jsx(N,{variant:"ghost",className:"relative h-8 w-8 sm:h-9 sm:w-9 rounded-full",children:e.jsx(Nt,{className:"h-8 w-8 sm:h-9 sm:w-9",children:e.jsx(kt,{className:"bg-primary text-primary-foreground text-sm",children:o()})})})}),e.jsxs(wt,{className:"w-56 z-[100]",align:"end",forceMount:!0,children:[e.jsx(ka,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none truncate",children:(s==null?void 0:s.displayName)||"User"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground truncate",children:s==null?void 0:s.email})]})}),e.jsx(ot,{}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ze,{className:"p-0",children:e.jsx("div",{className:"w-full p-2",children:e.jsx(Ma,{})})})}),e.jsx(ot,{}),e.jsxs(Ze,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs(Ze,{children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Settings"})]}),e.jsx(ot,{}),e.jsxs(Ze,{onClick:n,children:[e.jsx(ga,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})]})]})},Fs=()=>{const[r,s]=l.useState(!1),[t,a]=l.useState(!0),[n,o]=l.useState([]),[d,m]=l.useState(null),[i,h]=l.useState(null),[c,u]=l.useState(null),{toast:x}=ss(),{currentUser:f}=Ye(),v=_e(),T=l.useRef(!1),y=l.useRef(!1),j=l.useRef(null),g=l.useCallback(async p=>{if(f!=null&&f.uid)try{await fetch("http://localhost:5000/api/payment/user/gbp-association",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:f.uid,gbpAccountId:p})}),console.log("GBP association saved:",{userId:f.uid,gbpAccountId:p})}catch(b){console.error("Failed to save GBP association:",b)}},[f]),I=l.useCallback(async()=>{try{a(!0);const p=await Se.getBusinessAccounts();o(p);for(const b of p)b.accountId&&await g(b.accountId);p.length===1&&(m(p[0]),p[0].locations.length===1&&h(p[0].locations[0])),u(null)}catch(p){console.error("Error loading business accounts:",p),u("Failed to load business accounts"),x({title:"Error loading accounts",description:"Failed to load your Google Business Profile accounts. Please try reconnecting.",variant:"destructive"})}finally{a(!1)}},[x,g]);l.useEffect(()=>{if(!r)return;let p,b=0;const L=5,C=async()=>{try{console.log("⏰ Proactive token check..."),Se.isTokenExpired()?(console.log("🔄 Token expiring soon, refreshing proactively..."),await Se.refreshAccessToken(),b=0,console.log("✅ Token refreshed successfully - connection remains permanent")):console.log("✅ Token still valid - no refresh needed")}catch(ae){if(console.error("Failed to refresh token:",ae),b++,b<L)console.log(`🔄 Retrying token refresh (attempt ${b}/${L})...`),setTimeout(()=>C(),Math.pow(2,b)*1e3);else{console.error("❌ Max retries exceeded, attempting recovery...");try{if(await Se.recoverConnection()){console.log("✅ Connection recovered via stored tokens"),b=0;return}}catch(E){console.error("❌ Recovery failed:",E)}s(!1),u("Connection requires re-authentication"),x({title:"Connection expired",description:"Please reconnect your Google Business Profile from Settings.",variant:"destructive"})}}};return p=setInterval(C,10*60*1e3),(async()=>{try{console.log("🔍 Initial connection check on mount..."),Se.isTokenExpired()&&(console.log("🔄 Token expiring, refreshing immediately..."),await Se.refreshAccessToken()),console.log("✅ Connection verified - permanent connection active")}catch(ae){console.error("Initial check failed:",ae),await C()}})(),()=>{p&&clearInterval(p)}},[r,x]),l.useEffect(()=>{const p=(f==null?void 0:f.uid)||null,b=sessionStorage.getItem("post_payment_reload")==="true";if(T.current||y.current&&j.current===p&&!b){console.log("🔍 DEBUGGING: Skipping initialization (already initialized or in progress)");return}const L=async()=>{if(T.current){console.log("🔍 DEBUGGING: Initialization already in progress, skipping...");return}T.current=!0,a(!0),console.log("🔍 DEBUGGING: Initializing Google Business Profile connection..."),console.log("🔍 DEBUGGING: Firebase user:",p);try{Se.setCurrentUserId(p),sessionStorage.getItem("post_payment_reload")==="true"&&(console.log("🔍 DEBUGGING: Just reloaded after payment, waiting before loading profiles..."),sessionStorage.removeItem("post_payment_reload"),await new Promise(E=>setTimeout(E,2e3)));const ae=await Se.loadStoredTokens(p);if(console.log("🔍 DEBUGGING: Has valid tokens?",ae),console.log("🔍 DEBUGGING: Service isConnected?",Se.isConnected()),s(ae),ae){console.log("🔍 DEBUGGING: Loading business accounts...");try{await I()}catch(E){console.error("❌ DEBUGGING: Failed to load business accounts:",E),E instanceof Error&&E.message.includes("Authentication")&&(console.log("⚠️ Authentication issue detected, may need to reconnect"),u("Authentication expired. Please reconnect your Google Business Profile."),s(!1))}}else console.log("🔍 DEBUGGING: No valid tokens, skipping account load");y.current=!0,j.current=p}catch(ie){console.error("❌ DEBUGGING: Error initializing Google Business Profile connection:",ie),u("Failed to initialize connection")}finally{a(!1),T.current=!1,console.log("🔍 DEBUGGING: Initialization complete")}},C=async ie=>{console.log("Google Business Profile connection event received:",ie.detail),s(!0),await I(),x({title:"Connection successful!",description:"Loading your business profiles..."}),console.log("🔄 Redirecting to dashboard after OAuth callback..."),v("/dashboard")};return window.addEventListener("googleBusinessProfileConnected",C),L(),()=>{window.removeEventListener("googleBusinessProfileConnected",C)}},[f==null?void 0:f.uid]);const U=l.useCallback(async()=>{try{a(!0),console.log("🔄 Starting Google Business Profile connection..."),console.log("🔍 DEBUGGING: Firebase user for connection:",f==null?void 0:f.uid),Se.setCurrentUserId((f==null?void 0:f.uid)||null),await Se.connectGoogleBusiness(),s(!0),console.log("✅ OAuth connection successful!"),console.log("📊 Loading business accounts..."),await I(),console.log("✅ Business accounts loaded successfully!"),x({title:"Connected successfully!",description:"Your Google Business Profile has been connected and data loaded."}),console.log("🔄 Redirecting to dashboard..."),v("/dashboard")}catch(p){console.error("❌ Error connecting to Google Business Profile:",p);const b=p instanceof Error?p.message:"Unknown error";u(b);let L="Failed to connect to Google Business Profile. Please try again.";b.includes("cancelled")||b.includes("closed")?L="OAuth was cancelled. Please try again and complete the authentication process.":b.includes("timeout")?L="Connection timed out. Please try again.":b.includes("Popup blocked")&&(L="Popup was blocked. Please allow popups for this site and try again."),x({title:"Connection failed",description:L,variant:"destructive"})}finally{a(!1)}},[I,x,f,v]),q=l.useCallback(async()=>{try{a(!0),await Se.permanentDisconnect(),s(!1),o([]),m(null),h(null),u(null),x({title:"Disconnected",description:"Your Google Business Profile has been permanently disconnected."})}catch(p){console.error("Error disconnecting Google Business Profile:",p),x({title:"Disconnection failed",description:"Failed to disconnect. Please try again.",variant:"destructive"})}finally{a(!1)}},[x]),Q=l.useCallback(p=>{m(p),h(null)},[]),Z=l.useCallback(p=>{h(p)},[]),$=l.useCallback(async()=>{r&&await I()},[r,I]),S=l.useCallback(async p=>{console.log("OAuth callback received (not implemented in current frontend-only flow):",p)},[]);return{isConnected:r,isLoading:t,accounts:n,selectedAccount:d,selectedLocation:i,error:c,connectGoogleBusiness:U,disconnectGoogleBusiness:q,selectAccount:Q,selectLocation:Z,refreshAccounts:$,handleOAuthCallback:S}},Yt=[{id:"pro_monthly",name:"1 Month Plan",amount:1099,currency:"INR",interval:"monthly",features:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles"],trialDays:15,popular:!1},{id:"pro_6months",name:"6 Months Plan",amount:5999,currency:"INR",interval:"yearly",features:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles","Save ₹600 compared to monthly"],trialDays:15,popular:!0},{id:"pro_yearly",name:"1 Year Plan",amount:9999,currency:"INR",interval:"yearly",features:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support","Unlimited Google Business Profiles","Best Value - Save ₹3189 per year"],trialDays:15,popular:!1}];class it{static calculateTotalPrice(s){return s*this.BASE_PRICE_PER_PROFILE}static formatPriceDisplay(s){return`$${(this.calculateTotalPrice(s)/100).toFixed(0)}`}static getPricingBreakdown(s){const t=this.calculateTotalPrice(s);return{profileCount:s,pricePerProfile:this.BASE_PRICE_PER_PROFILE,totalPrice:t,displayPrice:this.formatPriceDisplay(s)}}static async createTrialSubscription(s,t,a){const n=await this.getSubscriptionByGBPAccount(t);if(n)return console.log("Subscription already exists for GBP account:",t),n;const o=tt.now(),d=new Date;d.setDate(d.getDate()+this.TRIAL_DAYS);const m={userId:s,gbpAccountId:t,email:a,status:"trial",trialStartDate:o,trialEndDate:tt.fromDate(d),createdAt:o,updatedAt:o,paymentHistory:[]},i=Pt(Tt(at,this.COLLECTION_NAME));return await Ia(i,m),{...m,id:i.id}}static async getSubscriptionByGBPAccount(s){const t=Ea(Tt(at,this.COLLECTION_NAME),Da("gbpAccountId","==",s)),a=await Fa(t);if(a.empty)return null;const n=a.docs[0];return{id:n.id,...n.data()}}static async getSubscriptionByUserId(s){const t=Ea(Tt(at,this.COLLECTION_NAME),Da("userId","==",s)),a=await Fa(t);if(a.empty)return null;const n=a.docs[0];return{id:n.id,...n.data()}}static async updateSubscription(s,t){const a=Pt(at,this.COLLECTION_NAME,s);await $a(a,{...t,updatedAt:Ua()})}static async checkSubscriptionStatus(s){const t=await this.getSubscriptionByGBPAccount(s);if(!t)return{isValid:!1,status:"none"};const a=new Date;if(t.status==="trial"){const n=t.trialEndDate.toDate(),o=Math.ceil((n.getTime()-a.getTime())/(1e3*60*60*24));return o>0?{isValid:!0,status:"trial",daysRemaining:o,subscription:t}:(await this.updateSubscription(t.id,{status:"expired"}),{isValid:!1,status:"expired",daysRemaining:0,subscription:{...t,status:"expired"}})}if(t.status==="active"){if(t.subscriptionEndDate){const n=t.subscriptionEndDate.toDate(),o=Math.ceil((n.getTime()-a.getTime())/(1e3*60*60*24));return o>0?{isValid:!0,status:"active",daysRemaining:o,subscription:t}:(await this.updateSubscription(t.id,{status:"expired"}),{isValid:!1,status:"expired",daysRemaining:0,subscription:{...t,status:"expired"}})}return{isValid:!0,status:"active",subscription:t}}return{isValid:!1,status:t.status,subscription:t}}static async addPaymentRecord(s,t){const a=Pt(at,this.COLLECTION_NAME,s),n=await ki(a);if(!n.exists())throw new Error("Subscription not found");const d=n.data().paymentHistory||[];d.push(t),await $a(a,{paymentHistory:d,updatedAt:Ua()})}static async createTrialWithPaymentMethod(s,t,a,n,o,d){const m=tt.now(),i=new Date;i.setDate(i.getDate()+this.TRIAL_DAYS);const h={userId:s,gbpAccountId:t,email:a,status:"trial",trialStartDate:m,trialEndDate:tt.fromDate(i),profileCount:n,pricePerProfile:this.BASE_PRICE_PER_PROFILE,amount:this.calculateTotalPrice(n),currency:"USD",razorpayCustomerId:o,createdAt:m,updatedAt:m,paymentHistory:[]},c=Pt(Tt(at,this.COLLECTION_NAME));return await Ia(c,h),{...h,id:c.id}}static async activateSubscription(s,t,a,n,o){const d=Yt.find(c=>c.id===t);if(!d)throw new Error("Invalid plan ID");const m=new Date,i=new Date;d.interval==="monthly"?i.setMonth(i.getMonth()+1):i.setFullYear(i.getFullYear()+1);const h=t==="per_profile_yearly"?this.calculateTotalPrice(a):d.amount;await this.updateSubscription(s,{status:"active",planId:t,planName:d.name,amount:h,currency:d.currency,profileCount:t==="per_profile_yearly"?a:void 0,pricePerProfile:t==="per_profile_yearly"?this.BASE_PRICE_PER_PROFILE:void 0,razorpaySubscriptionId:n,razorpayCustomerId:o,subscriptionStartDate:tt.fromDate(m),subscriptionEndDate:tt.fromDate(i)})}static calculateTrialDaysRemaining(s){const t=new Date,a=s.toDate(),n=Math.ceil((a.getTime()-t.getTime())/(1e3*60*60*24));return Math.max(0,n)}}ye(it,"COLLECTION_NAME","subscriptions"),ye(it,"TRIAL_DAYS",15),ye(it,"BASE_PRICE_PER_PROFILE",9900);const cn=l.createContext(void 0),Je=()=>{const r=l.useContext(cn);if(r===void 0)throw new Error("useSubscription must be used within a SubscriptionProvider");return r},ll=({children:r})=>{var X;const[s,t]=l.useState(null),[a,n]=l.useState(!0),[o,d]=l.useState("none"),[m,i]=l.useState(null),[h,c]=l.useState(!1),[u,x]=l.useState(!0),[f,v]=l.useState(!1),[T,y]=l.useState(!1),[j,g]=l.useState(null),[I,U]=l.useState(!1),[q,Q]=l.useState(!1),[Z,$]=l.useState(!1),{currentUser:S}=Ye(),{accounts:p}=Fs(),{toast:b}=ss(),L="http://localhost:5000",C=p&&p.length>0&&((X=p[0].name)==null?void 0:X.split("/")[1])||null;console.log("SubscriptionContext - GBP Account ID:",C),console.log("SubscriptionContext - Accounts:",p);const ie=async()=>{if(Z){console.log("Subscription check already in progress, skipping...");return}$(!0),console.log("Checking subscription status for GBP:",C,"User:",S==null?void 0:S.uid);try{if(S!=null&&S.uid&&!C){console.log("No GBP connected, checking by user ID:",S.uid);try{const le=await fetch(`${L}/api/payment/subscription/status?userId=${S.uid}`,{headers:{"Content-Type":"application/json"}});if(le.ok){const H=await le.json();if(console.log("Subscription found by user ID:",H),H.status!=="none"){d(H.status),i(H.daysRemaining||null),t(H.subscription),x(H.canUsePlatform!==!1),v(H.requiresPayment===!0),y(H.billingOnly===!0),g(H.message||"Please reconnect your Google Business Profile to access all features."),c(H.status==="expired"||H.billingOnly===!0),n(!1),$(!1);return}}}catch(le){console.log("User ID lookup failed, will check GBP when available:",le)}}if(!C&&!(S!=null&&S.uid)){console.log("No GBP account ID or user ID, setting status to none"),d("none"),i(null),c(!1),n(!1),$(!1);return}try{n(!0);const le=new URLSearchParams;C&&le.append("gbpAccountId",C),S!=null&&S.uid&&le.append("userId",S.uid);const H=await fetch(`${L}/api/payment/subscription/status?${le.toString()}`,{headers:{"Content-Type":"application/json"}});if(H.ok){const J=await H.json();if(console.log("Subscription status from backend:",J),J.status==="none"&&C&&(S!=null&&S.uid)&&!q){console.log("🎉 No subscription found - auto-creating 15-day free trial..."),Q(!0);try{const xe=await fetch(`${L}/api/payment/subscription/trial`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:S.uid,gbpAccountId:C,email:S.email})});if(xe.ok){const W=await xe.json();t(W.subscription),d("trial"),i(15),c(!1),x(!0),v(!1),y(!1),g(null),b({title:"Trial Started!",description:"Your 15-day free trial has begun. Enjoy all features!"})}else{const W=await xe.json().catch(()=>({error:"Unknown error"}));console.error("❌ Trial creation failed:",W),b({title:"Setup Error",description:W.hint||W.details||"Unable to create trial. Please contact support.",variant:"destructive"}),d("none"),c(!1),x(!0),v(!1),y(!1),g("Trial setup failed. Please contact support.")}}catch(xe){console.error("❌ Error creating trial:",xe),b({title:"Setup Error",description:"Unable to create trial. Please contact support.",variant:"destructive"}),d("none"),c(!1),x(!0),v(!1),y(!1),g("Trial setup failed. Please contact support.")}finally{Q(!1),n(!1),$(!1)}return}d(J.status),i(J.daysRemaining||null),t(J.subscription),x(J.canUsePlatform!==!1),v(J.requiresPayment===!0),y(J.billingOnly===!0),g(J.message||null),c(J.status==="expired"||J.billingOnly===!0),J.status==="trial"&&J.daysRemaining&&J.daysRemaining<=3&&b({title:"Trial Ending Soon",description:`Your trial ends in ${J.daysRemaining} day(s). Upgrade now to continue using all features.`,variant:"default"}),J.status==="expired"&&J.billingOnly&&b({title:"Trial Expired",description:"Your 15-day trial has expired. Please upgrade to continue using all features.",variant:"destructive"})}else{const J=await it.checkSubscriptionStatus(C);d(J.status),i(J.daysRemaining||null),t(J.subscription||null),c(!J.isValid)}}catch(le){console.error("Error checking subscription status:",le);try{const H=await it.checkSubscriptionStatus(C);d(H.status),i(H.daysRemaining||null),t(H.subscription||null),c(!H.isValid)}catch(H){console.error("Firebase subscription check also failed:",H),d("none"),c(!0)}}finally{n(!1),$(!1)}}catch(le){console.error("Outer error in checkSubscriptionStatus:",le),n(!1),$(!1)}},ae=async()=>{if(console.log("Creating trial subscription - User:",S==null?void 0:S.uid,"GBP:",C),!S||!C){console.error("Cannot create trial - missing user or GBP account"),b({title:"Error",description:"Please connect your Google Business Profile first",variant:"destructive"});return}if(q){console.log("Trial creation already in progress, skipping...");return}try{Q(!0),n(!0);const le=await fetch(`${L}/api/payment/subscription/trial`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:S.uid,gbpAccountId:C,email:S.email})});if(le.ok){const H=await le.json();t(H.subscription),d("trial"),i(15),c(!1),b({title:"Trial Started!",description:"Your 15-day free trial has begun. Enjoy all features!"})}else{const H=await it.createTrialSubscription(S.uid,C,S.email);t(H),d("trial"),i(15),c(!1),b({title:"Trial Started!",description:"Your 15-day free trial has begun. Enjoy all features!"})}await ie()}catch(le){console.error("Error creating trial subscription:",le),b({title:"Error",description:"Failed to start trial. Please try again.",variant:"destructive"})}finally{n(!1),Q(!1)}},E=async le=>{console.log("Upgrading to plan:",le)},Y=async()=>{if(!(!s||!C))try{if(n(!0),(await fetch(`${L}/api/payment/subscription/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:s.id,gbpAccountId:C})})).ok)b({title:"Subscription Cancelled",description:"Your subscription has been cancelled."}),await ie();else throw new Error("Failed to cancel subscription")}catch(le){console.error("Error cancelling subscription:",le),b({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}finally{n(!1)}};l.useEffect(()=>{if(q){console.log("Skipping subscription check - trial creation in progress");return}console.log("SubscriptionContext useEffect - gbpAccountId changed:",C);const H=sessionStorage.getItem("post_payment_reload")==="true"?3e3:0,J=setTimeout(()=>{C&&S?ie():!C&&S?(console.log("No GBP account yet, checking subscription by user ID"),ie()):!C&&!S&&(console.log("No GBP account or user, resetting subscription state"),d("none"),i(null),t(null),c(!1),n(!1))},H);return()=>clearTimeout(J)},[C,S==null?void 0:S.uid,q]),l.useEffect(()=>{if(!C)return;const le=setInterval(()=>{ie()},30*60*1e3);return()=>clearInterval(le)},[C]);const R={subscription:s,isLoading:a,status:o,daysRemaining:m,plans:Yt,checkSubscriptionStatus:ie,createTrialSubscription:ae,upgradeToPaid:E,cancelSubscription:Y,isFeatureBlocked:h,canUsePlatform:u,requiresPayment:f,billingOnly:T,message:j,showTrialSetup:I,setShowTrialSetup:U};return e.jsx(cn.Provider,{value:R,children:r})},cl=vt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Hs=l.forwardRef(({className:r,variant:s,...t},a)=>e.jsx("div",{ref:a,role:"alert",className:M(cl({variant:s}),r),...t}));Hs.displayName="Alert";const dl=l.forwardRef(({className:r,...s},t)=>e.jsx("h5",{ref:t,className:M("mb-1 font-medium leading-none tracking-tight",r),...s}));dl.displayName="AlertTitle";const Js=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:M("text-sm [&_p]:leading-relaxed",r),...s}));Js.displayName="AlertDescription";const hs=no,ml=oo,ul=ro,dn=l.forwardRef(({className:r,...s},t)=>e.jsx(yr,{ref:t,className:M("fixed inset-0 z-[100] bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s}));dn.displayName=yr.displayName;const os=l.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(ul,{children:[e.jsx(dn,{}),e.jsxs(br,{ref:a,className:M("fixed left-[50%] top-[50%] z-[110] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[s,e.jsxs(ao,{className:"absolute right-4 top-4 z-[120] rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));os.displayName=br.displayName;const is=({className:r,...s})=>e.jsx("div",{className:M("flex flex-col space-y-1.5 text-center sm:text-left",r),...s});is.displayName="DialogHeader";const Xs=({className:r,...s})=>e.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});Xs.displayName="DialogFooter";const ls=l.forwardRef(({className:r,...s},t)=>e.jsx(vr,{ref:t,className:M("text-lg font-semibold leading-none tracking-tight",r),...s}));ls.displayName=vr.displayName;const cs=l.forwardRef(({className:r,...s},t)=>e.jsx(wr,{ref:t,className:M("text-sm text-muted-foreground",r),...s}));cs.displayName=wr.displayName;const mn=l.forwardRef(({className:r,...s},t)=>e.jsx(Nr,{className:M("grid gap-2",r),...s,ref:t}));mn.displayName=Nr.displayName;const un=l.forwardRef(({className:r,...s},t)=>e.jsx(kr,{ref:t,className:M("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(io,{className:"flex items-center justify-center",children:e.jsx(mr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));un.displayName=kr.displayName;const hn=l.createContext(void 0),hl=({children:r})=>{const s=Fs();return e.jsx(hn.Provider,{value:s,children:r})},ct=()=>{const r=l.useContext(hn);if(r===void 0)throw new Error("useGoogleBusinessProfileContext must be used within a GoogleBusinessProfileProvider");return r},Sa=({isOpen:r,onClose:s,defaultPlanId:t="pro_6months"})=>{const[a,n]=l.useState(t),[o,d]=l.useState(1),[m,i]=l.useState(!1),[h,c]=l.useState(""),[u,x]=l.useState(null),[f,v]=l.useState(!1),[T,y]=l.useState(88.718),{Razorpay:j}=fa(),{currentUser:g}=Ye(),{subscription:I,checkSubscriptionStatus:U}=Je(),{accounts:q,locations:Q}=ct(),{toast:Z}=ss(),$=_e(),S="http://localhost:5000",p="rzp_live_RWwON57KV1LaJn",b=Yt.find(E=>E.id===a),L=(q==null?void 0:q.reduce((E,Y)=>{var R;return E+(((R=Y.locations)==null?void 0:R.length)||0)},0))||0;l.useEffect(()=>{a==="per_profile_yearly"&&L>0&&d(Math.max(1,L))},[a,L]),l.useEffect(()=>{r&&(async()=>{try{console.log("[PaymentModal] 🔄 Fetching live exchange rate...");const Y=await fetch(`${S}/api/payment/detect-currency`);if(Y.ok){const X=(await Y.json()).exchangeRate||88.718;y(X),console.log(`[PaymentModal] ✅ Live exchange rate: 1 USD = ${X} INR`)}else console.warn("[PaymentModal] ⚠️ Using fallback rate: 88.718 INR")}catch(Y){console.error("[PaymentModal] ❌ Error fetching exchange rate:",Y),console.warn("[PaymentModal] ⚠️ Using fallback rate: 88.718 INR")}})()},[r,S]);const C=async()=>{if(!(!h||!b)){v(!0);try{const Y=await(await fetch(`${S}/api/payment/coupon/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h,amount:b.amount,userId:g==null?void 0:g.uid})})).json();Y.success?(x(Y),Z({title:"Coupon Applied!",description:`${Y.description} - You save $${(Y.discountAmount/100).toFixed(2)}`})):(x(null),Z({title:"Invalid Coupon",description:Y.error,variant:"destructive"}))}catch(E){console.error("Error validating coupon:",E),Z({title:"Error",description:"Failed to validate coupon",variant:"destructive"})}finally{v(!1)}}},ie=()=>{const E=(b==null?void 0:b.amount)||0;return u&&u.success?u.finalAmount:E},ae=async()=>{if(!g||!b){Z({title:"Error",description:"Please select a plan and ensure you're logged in",variant:"destructive"});return}if(!j){Z({title:"Error",description:"Payment system is not loaded. Please refresh the page and try again.",variant:"destructive"});return}i(!0);try{Z({title:"Initializing Payment",description:"Please wait while we set up your payment..."});const E=b.amount,Y="INR";console.log(`[Payment] 💰 Processing payment: ₹${E/100} (${Y})`);let R,X=0;const le=3;for(;X<le;)try{if(R=await fetch(`${S}/api/payment/order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:E,currency:Y,couponCode:u!=null&&u.success?h:void 0,notes:{planId:b.id,userId:g.uid,email:g.email,gbpAccountId:I==null?void 0:I.gbpAccountId}})}),R.ok)break;throw new Error(`HTTP ${R.status}: ${R.statusText}`)}catch(W){if(X++,console.warn(`Order creation attempt ${X} failed:`,W),X>=le)throw new Error(`Failed to create order after ${le} attempts: ${W.message}`);await new Promise(V=>setTimeout(V,1e3*X))}if(!R.ok){const W=await R.text();throw new Error(`Failed to create order: ${W}`)}const{order:H,finalAmount:J}=await R.json();if(!H||!H.id||!H.amount)throw new Error("Invalid order data received from server");const xe={key:p,amount:H.amount,currency:H.currency,name:"Google Ranker",description:b.name,order_id:H.id,timeout:300,retry:{enabled:!0,max_count:3},handler:async W=>{try{if((await fetch(`${S}/api/payment/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:W.razorpay_order_id,razorpay_payment_id:W.razorpay_payment_id,razorpay_signature:W.razorpay_signature,subscriptionId:I==null?void 0:I.id,gbpAccountId:I==null?void 0:I.gbpAccountId,planId:b.id})})).ok)s(),sessionStorage.setItem("post_payment_reload","true"),setTimeout(async()=>{try{await U(),window.location.reload()}catch(de){console.error("Failed to refresh subscription status:",de),window.location.reload()}},2e3),$("/payment-success");else throw new Error("Payment verification failed")}catch(V){console.error("Payment handler error:",V),Z({title:"Payment Error",description:"There was an issue processing your payment. Please try again.",variant:"destructive"}),i(!1)}},prefill:{name:g.displayName||"",email:g.email||"",contact:""},notes:{address:"Google Ranker Corporate Office"},theme:{color:"#1E2DCD",backdrop_color:"rgba(0, 0, 0, 0.5)"},config:{display:{blocks:{card:{name:"Credit/Debit Cards",instruments:[{method:"card",types:["credit","debit"],issuers:["VISA","MC","AMEX","RUPAY","MAES","BAJAJ"],flows:["3ds","ivr","otp","pin"]}]},paypal:{name:"PayPal",instruments:[{method:"paypal"}]},intl_bank_transfer:{name:"International Bank Transfer",instruments:[{method:"bank_transfer"}]},utib:{name:"UPI (India)",instruments:[{method:"upi"}]},banks:{name:"Net Banking (India)",instruments:[{method:"netbanking",banks:["HDFC","ICIC","SBIN","AXIS","YESB","KKBK","PUNB_R"]}]},wallet:{name:"Digital Wallets",instruments:[{method:"wallet",wallets:["paytm","mobikwik","phonepe","amazonpay","freecharge","jiomoney","paypal","airtelmoney","jiomoney"]}]},international:{name:"International Methods",instruments:[{method:"app",apps:["gpay_int","paypal","phonepe_switch"]}]}},sequence:["block.card","block.paypal","block.international","block.intl_bank_transfer","block.utib","block.banks","block.wallet"],preferences:{show_default_blocks:!0}}},modal:{ondismiss:()=>{i(!1),Z({title:"Payment Cancelled",description:"Your payment was cancelled. You can try again when ready.",variant:"default"})},escape:!0,backdropclose:!1,handleback:!0,confirm_close:!0,animation:!0}};try{const W=new j(xe);W.on("payment.failed",function(V){console.error("Payment failed:",V.error),i(!1),Z({title:"Payment Failed",description:V.error.description||"Your payment could not be processed. Please try again.",variant:"destructive"})}),s(),setTimeout(()=>{W.open(),Z({title:"Payment Gateway Loaded",description:"Choose your preferred payment method to continue."})},100)}catch(W){throw console.error("Failed to initialize Razorpay:",W),new Error("Failed to initialize payment gateway. Please refresh and try again.")}}catch(E){console.error("Payment error:",E);let Y="There was an error processing your payment. Please try again.";E.message.includes("network")||E.message.includes("fetch")?Y="Network error. Please check your internet connection and try again.":E.message.includes("order")?Y="Failed to create payment order. Please try again.":E.message.includes("Razorpay")&&(Y="Payment gateway error. Please refresh the page and try again."),Z({title:"Payment Failed",description:Y,variant:"destructive"})}finally{i(!1)}};return e.jsx(hs,{open:r,onOpenChange:s,children:e.jsxs(os,{className:"max-w-3xl h-[90vh] p-0 flex flex-col",children:[e.jsxs(is,{className:"flex-shrink-0 bg-background z-20 px-6 pt-6 pb-4 border-b",children:[e.jsx(ls,{children:"Upgrade to Premium"}),e.jsx(cs,{children:"Choose your subscription plan and unlock unlimited Google Business Profiles with premium features."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",style:{minHeight:0},children:[e.jsx(mn,{value:a,onValueChange:n,className:"space-y-4",children:Yt.map(E=>e.jsxs(w,{className:`cursor-pointer transition-all relative ${a===E.id?"border-primary ring-2 ring-primary ring-opacity-20":E.popular?"border-primary/50 hover:border-primary":"border-gray-200 hover:border-gray-300"}`,onClick:()=>n(E.id),children:[E.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"MOST POPULAR"})}),e.jsx(O,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(un,{value:E.id}),e.jsxs("div",{children:[e.jsx(B,{className:"text-lg",children:E.name}),e.jsxs(ge,{className:"mt-1",children:["₹",E.amount]})]})]}),E.id==="pro_yearly"&&e.jsx("div",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-md text-sm font-medium",children:"Best Value"})]})}),e.jsx(k,{children:e.jsx("ul",{className:"space-y-2",children:E.features.map((Y,R)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-600",children:Y})]},R))})})]},E.id))}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lo,{className:"h-5 w-5 text-purple-600"}),e.jsx("p",{className:"text-sm font-medium text-purple-900",children:"Have a coupon code?"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(fe,{placeholder:"Enter coupon code",value:h,onChange:E=>c(E.target.value.toUpperCase()),className:"flex-1",disabled:f}),e.jsx(N,{onClick:C,disabled:!h||f||!b,variant:"outline",size:"sm",children:f?"Validating...":"Apply"})]}),u&&u.success&&e.jsx("div",{className:"bg-green-100 rounded-md p-2",children:e.jsxs("p",{className:"text-sm text-green-800",children:["✓ ",u.description," - You save $",(u.discountAmount/100).toFixed(2),"!"]})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(js,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"💳 Multiple Payment Options Available"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs text-blue-700",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"🏦"}),e.jsx("span",{children:"Net Banking"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"📱"}),e.jsx("span",{children:"UPI (GPay, PhonePe, Paytm)"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"💳"}),e.jsx("span",{children:"Credit/Debit Cards"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"👝"}),e.jsx("span",{children:"Digital Wallets"})]})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Your payment information is encrypted and secure. We support Cards, PayPal, UPI, Net Banking, and international payment methods via Razorpay."}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"💡 All payments are processed securely in INR (Indian Rupees)"})]})]})}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Kt,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Instant Activation"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your subscription will be activated immediately after payment confirmation."})]})]})})]})]}),e.jsx("div",{className:"flex-shrink-0 bg-background border-t px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[u&&u.success?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 line-through",children:["₹",b==null?void 0:b.amount]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₹",ie()]})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:["₹",ie()]}),e.jsx("p",{className:"text-sm text-gray-600",children:b==null?void 0:b.name})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Plus applicable taxes"})]}),e.jsxs("div",{className:"flex gap-3 flex-shrink-0",children:[e.jsx(N,{variant:"outline",onClick:s,disabled:m,className:"min-w-[100px]",children:"Cancel"}),e.jsx(N,{onClick:ae,disabled:m,className:"min-w-[160px] bg-primary hover:bg-primary/90",children:m?e.jsx(e.Fragment,{children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Proceed to Payment"]})})]})]})})]})})},xl=({message:r="Your 2-minute trial has expired",daysRemaining:s=0,isExpired:t=!0})=>{const a=_e(),[n,o]=l.useState(!1);return e.jsxs("div",{className:"fixed inset-0 bg-background/95 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:[e.jsxs(w,{className:"max-w-2xl w-full",children:[e.jsxs(O,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:t?e.jsx(Us,{className:"h-6 w-6 text-red-600"}):e.jsx(ns,{className:"h-6 w-6 text-orange-600"})}),e.jsx(B,{className:"text-2xl",children:t?"Trial Period Expired":"Trial Ending Soon"}),e.jsx(ge,{className:"mt-2 text-base",children:r})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs(Hs,{className:t?"border-red-200 bg-red-50":"border-orange-200 bg-orange-50",children:[e.jsx(co,{className:`h-4 w-4 ${t?"text-red-600":"text-orange-600"}`}),e.jsx(Js,{className:t?"text-red-800":"text-orange-800",children:t?"Your access to all features has been restricted. Only the billing page is accessible until you upgrade.":`You have ${s} days remaining in your trial. Upgrade now to ensure uninterrupted access.`})]}),e.jsxs("div",{className:"rounded-lg border p-4 bg-muted/30",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Features Currently Locked:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(Us,{className:"h-4 w-4 mr-2 text-red-500"}),"Auto-posting to Google Business Profile"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(Us,{className:"h-4 w-4 mr-2 text-red-500"}),"Automated review replies"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(Us,{className:"h-4 w-4 mr-2 text-red-500"}),"Performance analytics and insights"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(Us,{className:"h-4 w-4 mr-2 text-red-500"}),"Multiple location management"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(Us,{className:"h-4 w-4 mr-2 text-red-500"}),"Smart content generation"]})]})]}),e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Unlock All Features"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Just $99 per profile/year"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-green-600",children:"Limited Time Offer"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:"Save 80%"}),e.jsx("p",{className:"text-xs text-green-600",children:"Regular price $499"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs(N,{onClick:()=>o(!0),className:"flex-1",size:"lg",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Upgrade Now"]}),!t&&e.jsx(N,{onClick:()=>a("/dashboard/billing"),variant:"outline",className:"flex-1",size:"lg",children:"View Billing Details"})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-2 border-t",children:["Need help? Contact support at"," ",e.jsx("a",{href:"mailto:support@googleranker.com",className:"text-primary hover:underline",children:"support@googleranker.com"})]})]})]}),e.jsx(Sa,{isOpen:n,onClose:()=>o(!1),defaultPlanId:"monthly_basic"})]})},pl=({children:r})=>{const s=Zs();_e();const{isLoading:t,status:a,billingOnly:n,requiresPayment:o,canUsePlatform:d,daysRemaining:m,message:i}=Je(),h=s.pathname.includes("/billing")||s.pathname.includes("/upgrade");return t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(zt,{className:"h-8 w-8 animate-spin text-primary"})}):h?e.jsx(e.Fragment,{children:r}):a==="expired"&&o||n===!0&&a!=="active"||d===!1&&a!=="active"?e.jsx(xl,{message:i||"Your trial has expired. Upgrade now to continue using all features.",daysRemaining:m||0,isExpired:!0}):e.jsx(e.Fragment,{children:r})},gl=({children:r})=>{const s=Zs();return["/dashboard/billing","/dashboard/upgrade","/billing","/upgrade"].some(n=>s.pathname.includes(n))?e.jsx(e.Fragment,{children:r}):e.jsx(pl,{children:r})},xn=({isOpen:r,onClose:s,onSuccess:t})=>{const[a,n]=l.useState(!1),[o,d]=l.useState(null),[m,i]=l.useState(!1),{Razorpay:h}=fa(),{currentUser:c}=Ye(),{subscription:u}=Je(),{toast:x}=ss(),f="http://localhost:5000",v="rzp_live_RWwON57KV1LaJn";l.useEffect(()=>{r&&(u!=null&&u.gbpAccountId||c!=null&&c.uid)&&T()},[r,u==null?void 0:u.gbpAccountId,c==null?void 0:c.uid]);const T=async()=>{if(!c)return;const j=(u==null?void 0:u.gbpAccountId)||c.uid;try{console.log("[MandateSetup] Checking mandate status for:",j);const g=await fetch(`${f}/api/payment/mandate/status/${j}`);if(g.ok){const I=await g.json();console.log("[MandateSetup] Mandate status:",I),i(I.mandateAuthorized||!1),d(I.razorpayCustomerId||null)}}catch(g){console.error("[MandateSetup] Error checking mandate status:",g)}},y=async()=>{if(console.log("[MandateSetup] Starting mandate setup...",{hasCurrentUser:!!c,hasSubscription:!!u,gbpAccountId:u==null?void 0:u.gbpAccountId}),!c){x({title:"Error",description:"Please log in first",variant:"destructive"});return}const j=(u==null?void 0:u.gbpAccountId)||c.uid;if(!h){x({title:"Error",description:"Payment system is not loaded. Please refresh the page.",variant:"destructive"});return}n(!0);try{let g=o;if(!g){x({title:"Setting up auto-payments",description:"Creating your payment profile..."}),console.log("[MandateSetup] Creating customer with data:",{userId:c.uid,email:c.email,gbpAccountId:j});const Z=await fetch(`${f}/api/payment/mandate/setup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:c.uid,email:c.email,name:c.displayName||c.email,contact:c.phoneNumber||"",gbpAccountId:j})});if(!Z.ok){const S=await Z.json().catch(()=>({}));throw console.error("[MandateSetup] Setup failed:",S),new Error(S.details||S.error||"Failed to setup mandate")}const $=await Z.json();if(console.log("[MandateSetup] Customer created:",$),$.alreadyAuthorized){console.log("[MandateSetup] ✅ Mandate already authorized, no action needed"),x({title:"Already Set Up",description:"Your payment method is already authorized. No action needed."}),n(!1),t();return}g=$.customerId,d(g)}x({title:"Payment Authorization",description:"Creating authorization request..."});const I=await fetch(`${f}/api/payment/mandate/create-auth-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:g,amount:200,currency:"INR",userId:c.uid,gbpAccountId:j})});if(!I.ok){const Z=await I.json().catch(()=>({}));throw console.error("[MandateSetup] Order creation failed:",Z),new Error(Z.details||Z.error||"Failed to create authorization order")}const{order:U}=await I.json();console.log("[MandateSetup] Authorization order created:",U.id);const q={key:v,amount:U.amount,currency:U.currency,name:"Google Ranker",description:"Auto-payment setup - You will be charged ₹2 for authorization",order_id:U.id,recurring:"1",handler:async Z=>{try{if(console.log("[MandateSetup] Payment successful, verifying..."),(await fetch(`${f}/api/payment/mandate/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:Z.razorpay_order_id,razorpay_payment_id:Z.razorpay_payment_id,razorpay_signature:Z.razorpay_signature,customerId:g,gbpAccountId:j})})).ok)i(!0),x({title:"Success!",description:"Auto-payment has been set up successfully"}),t&&t(),setTimeout(()=>s(),2e3);else throw new Error("Mandate verification failed")}catch($){console.error("Mandate verification error:",$),x({title:"Verification Error",description:"Failed to verify mandate authorization. Please try again.",variant:"destructive"})}finally{n(!1)}},prefill:{name:c.displayName||"",email:c.email||"",contact:c.phoneNumber||""},notes:{purpose:"mandate_authorization"},theme:{color:"#1E2DCD"},modal:{ondismiss:()=>{n(!1),x({title:"Authorization Cancelled",description:"You can set up auto-payment later from billing settings."})}}},Q=new h(q);Q.on("payment.failed",Z=>{console.error("Payment failed:",Z.error),n(!1),x({title:"Authorization Failed",description:Z.error.description||"Unable to authorize payment method",variant:"destructive"})}),Q.open()}catch(g){console.error("Mandate setup error:",g),x({title:"Setup Error",description:"Failed to set up auto-payment. Please try again.",variant:"destructive"}),n(!1)}};return m?e.jsx(hs,{open:r,onOpenChange:s,children:e.jsxs(os,{className:"sm:max-w-md",children:[e.jsxs(is,{children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx($e,{className:"h-6 w-6 text-green-600"})}),e.jsx(ls,{className:"text-center",children:"Auto-Payment Active"}),e.jsx(cs,{className:"text-center",children:"Your auto-payment is already set up and active"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Hs,{className:"bg-green-50 border-green-200",children:[e.jsx(_s,{className:"h-4 w-4 text-green-600"}),e.jsx(Js,{className:"text-green-800",children:"We'll automatically charge your payment method when your subscription renews."})]}),e.jsx(N,{onClick:s,className:"w-full",children:"Close"})]})]})}):e.jsx(hs,{open:r,onOpenChange:()=>{},children:e.jsxs(os,{className:"sm:max-w-md",onPointerDownOutside:j=>j.preventDefault(),onEscapeKeyDown:j=>j.preventDefault(),children:[e.jsxs(is,{children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(js,{className:"h-6 w-6 text-blue-600"})}),e.jsx(ls,{className:"text-center",children:"Authorize Payment to Start Trial"}),e.jsx(cs,{className:"text-center",children:"Set up payment method to activate your free trial. You won't be charged until the trial ends."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(w,{children:[e.jsx(O,{children:e.jsx(B,{className:"text-sm",children:"What Happens Next?"})}),e.jsxs(k,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Step 1:"})," Authorize payment method (₹2 charge, refunded in 5-7 days)"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Step 2:"})," Free trial starts immediately"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Step 3:"})," Access all premium features during trial"]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Step 4:"})," Automatic billing after trial ends (cancel anytime)"]})]})]})]}),e.jsxs(Hs,{className:"bg-blue-50 border-blue-200",children:[e.jsx(_s,{className:"h-4 w-4 text-blue-600"}),e.jsx(Js,{className:"text-blue-800 text-sm",children:"You'll be charged ₹2 to authorize your payment method. This amount will be refunded within 5-7 business days."})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-muted-foreground",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{children:"Secured by Razorpay | PCI DSS Compliant"})]}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx(N,{onClick:y,disabled:a,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"mr-2 h-4 w-4 animate-spin"}),"Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Authorize Payment Method & Start Trial"]})})}),e.jsxs(Hs,{className:"bg-amber-50 border-amber-200",children:[e.jsx(_s,{className:"h-4 w-4 text-amber-600"}),e.jsxs(Js,{className:"text-amber-800 text-xs",children:[e.jsx("strong",{children:"Payment authorization is required"})," to start your free trial. You won't be charged until the trial ends."]})]})]})]})})},fl=()=>{const[r,s]=l.useState(!1),[t,a]=l.useState(!1),[n,o]=l.useState(!1);return Je(),Zs(),l.useEffect(()=>{console.log("[Mandate Check] Skipping mandatory mandate - will be triggered after trial ends"),o(!0)},[]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex",children:[e.jsx(Wi,{isOpen:r,onClose:()=>s(!1)}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 lg:hidden",onClick:()=>s(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col ml-0 lg:ml-64",children:[e.jsx(il,{onMenuClick:()=>s(!0)}),e.jsx("main",{className:"flex-1 p-1 sm:p-4 md:p-6 bg-muted/30",children:e.jsx("div",{className:"animate-fade-in",children:e.jsx(gl,{children:e.jsx(Sr,{})})})})]})]}),e.jsx(xn,{isOpen:t,onClose:()=>a(!1),onSuccess:()=>{a(!1)}})]})},dt=()=>{const{subscription:r,status:s}=Je();ct();const t=(r==null?void 0:r.planId)==="per_profile_yearly",a=(r==null?void 0:r.planId)==="yearly_pro",n=(r==null?void 0:r.status)==="trial",o=t&&(r==null?void 0:r.profileCount)||1,d=o>1,m=l.useCallback(v=>o>=v.length?v:v.slice(0,o),[o]),i=l.useCallback(v=>v<o,[o]),h=l.useCallback(v=>o>=v.length?v:v.slice(0,o),[o]),c=l.useCallback(v=>v<o,[o]),u=l.useCallback(v=>v<=o?"":n?`You have ${v} Google Business accounts. Your Free Trial allows access to 1 account only. Upgrade to access more profiles.`:t?`You have ${v} accounts but your plan covers ${o} profile${o>1?"s":""}. Upgrade your plan to access more profiles at $99/profile/year.`:a?`You have ${v} Google Business accounts. Your current plan allows access to 1 account only. Upgrade to access more profiles.`:`Your current plan allows access to ${o} account${o>1?"s":""} only.`,[o,n,t,a]),x=l.useCallback(v=>v<=o?"":n?`This account has ${v} locations. Your Free Trial allows access to 1 location only. Upgrade to access more profiles.`:t?`You have ${v} locations but your plan covers ${o} profile${o>1?"s":""}. Upgrade your plan to access more profiles at $99/profile/year.`:a?`This account has ${v} locations. Your current plan allows access to 1 location only. Upgrade to access more profiles.`:`Your current plan allows access to ${o} location${o>1?"s":""} only.`,[o,n,t,a]),f=l.useCallback((v="Support Request")=>{const T=encodeURIComponent(`Support Request - ${v}`),y=encodeURIComponent(`Hi,

I need assistance with my GMB Profile Pulse account.

Current plan: ${(r==null?void 0:r.planName)||"Free Trial"}
Current profile count: ${(r==null?void 0:r.profileCount)||1}
Context: ${v}

Please contact me to discuss.

Best regards,`);window.open(`mailto:support@gmbprofilepulse.com?subject=${T}&body=${y}`,"_blank")},[r==null?void 0:r.planName,r==null?void 0:r.profileCount]);return{canAccessMultipleProfiles:d,isProPlan:a,isPerProfilePlan:t,maxAllowedProfiles:o,getAccessibleAccounts:m,isAccountAccessible:i,getAccessibleLocations:h,isLocationAccessible:c,getAccountLockMessage:u,getLocationLockMessage:x,handleContactSupport:f}},St=ja.forwardRef(({className:r,size:s="md",variant:t="default",...a},n)=>{const o={sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-8 w-8 border-2",xl:"h-12 w-12 border-3"},d={default:"border-muted-foreground border-t-transparent",primary:"border-primary border-t-transparent",secondary:"border-secondary border-t-transparent"};return e.jsx("div",{ref:n,className:M("animate-spin rounded-full",o[s],d[t],r),...a})});St.displayName="LoadingSpinner";const Vt=l.forwardRef(({className:r,value:s,...t},a)=>e.jsx(Ar,{ref:a,className:M("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:e.jsx(mo,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Vt.displayName=Ar.displayName;const jl=()=>{const{status:r,daysRemaining:s,isLoading:t}=Je(),[a,n]=l.useState(!1),o=_e();if(t||a||r!=="trial"&&r!=="expired")return null;const d=s?(15-s)/15*100:100,i=r==="expired"?{bgColor:"bg-red-950/40 border-red-500/30",textColor:"text-red-200",iconColor:"text-red-400",progressColor:"bg-red-500",buttonVariant:"destructive"}:s&&s<=3?{bgColor:"bg-orange-950/40 border-orange-500/30",textColor:"text-orange-200",iconColor:"text-orange-400",progressColor:"bg-orange-500",buttonVariant:"default"}:{bgColor:"bg-blue-950/40 border-blue-500/30",textColor:"text-blue-200",iconColor:"text-blue-400",progressColor:"bg-blue-500",buttonVariant:"default"};return e.jsx("div",{className:`relative border-2 ${i.bgColor} p-4 z-[70] rounded-lg shadow-md backdrop-blur-sm`,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[r==="expired"?e.jsx(Ve,{className:`h-5 w-5 ${i.iconColor}`}):e.jsx(ns,{className:`h-5 w-5 ${i.iconColor}`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`font-semibold ${i.textColor}`,children:r==="expired"?"Trial Expired":`Free Trial: ${s} days remaining`}),r==="trial"&&s&&e.jsxs("span",{className:`text-sm ${i.textColor} opacity-75`,children:["(",Math.round(d),"% complete)"]})]}),r==="trial"&&e.jsx("div",{className:"mt-2 max-w-md",children:e.jsx(Vt,{value:d,className:"h-1.5",style:{backgroundColor:"rgba(0,0,0,0.1)"}})}),e.jsx("p",{className:`text-sm mt-1 ${i.textColor} opacity-90`,children:r==="expired"?"Upgrade now to continue using all features without interruption.":s&&s<=3?"Your trial is ending soon. Upgrade now to avoid service interruption.":"Enjoy unlimited access to all features during your trial period."})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(N,{variant:i.buttonVariant,size:"sm",onClick:()=>o("/dashboard/billing"),className:"flex items-center space-x-1",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:"Upgrade Now"})]}),r==="trial"&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>n(!0),className:"p-1",children:e.jsx(ys,{className:"h-4 w-4"})})]})]})})})},yl=()=>{var f,v;const r=_e(),{isConnected:s,accounts:t,isLoading:a}=Fs(),n=Je(),{getAccessibleAccounts:o}=dt(),[d,m]=l.useState(!1),i=(n==null?void 0:n.status)||"none",h=(n==null?void 0:n.daysRemaining)||null,c=(n==null?void 0:n.isFeatureBlocked)||!1;if(console.log("Dashboard: isConnected =",s),console.log("Dashboard: profiles =",t),console.log("Dashboard: isLoading =",a),console.log("Dashboard: subscriptionStatus =",i),console.log("Dashboard: daysRemaining =",h),a)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center px-4",children:e.jsx("img",{src:"/Upgrade plan banner 11.svg",alt:"Upgrade Plan Banner",className:"w-full max-w-4xl h-auto"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx(St,{size:"xl",variant:"primary"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"font-medium text-xl",children:"Loading Business Profiles..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connecting to Google Business Profile and fetching your locations"})]})]}),e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(T=>e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-20"}),e.jsx("div",{className:"h-4 w-4 bg-muted rounded animate-pulse"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"h-8 bg-muted rounded animate-pulse w-16 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded animate-pulse w-24"})]})]},T))})]});if(!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center px-4",children:e.jsx("img",{src:"/Upgrade plan banner 11.svg",alt:"Upgrade Plan Banner",className:"w-full max-w-4xl h-auto"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx(Ms,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Business Profiles Connected"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md",children:"Connect your Google Business Profile to start managing your business listings, posts, and reviews."}),e.jsx(ke,{to:"/dashboard/settings",children:e.jsxs(N,{children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),"Connect Google Business Profile"]})})]})]});const u=(t==null?void 0:t.length)||0,x=u;return e.jsxs(e.Fragment,{children:[(i==="trial"||i==="expired")&&e.jsx("div",{className:"-mx-6 mb-6",children:e.jsx(jl,{})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center px-4",children:e.jsx("img",{src:"/Upgrade plan banner 11.svg",alt:"Upgrade Plan Banner",className:"w-full max-w-4xl h-auto"})}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("div",{className:"flex justify-start",children:e.jsx("h2",{className:"text-base sm:text-lg font-semibold truncate",style:{fontFamily:"Onest"},children:"Manage Profiles"})}),e.jsx("div",{className:"flex justify-end flex-shrink-0",children:e.jsx(ke,{to:"/dashboard/posts",children:e.jsxs(N,{size:"sm",className:"text-xs sm:text-sm px-2 sm:px-4",children:[e.jsx(qs,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Post"}),e.jsx("span",{className:"sm:hidden",children:"Post"})]})})})]}),c||i==="none"?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[500px] text-center space-y-6",children:e.jsxs("div",{className:"bg-red-950/30 border-2 border-red-500/50 rounded-2xl p-8 max-w-2xl w-full backdrop-blur-sm",children:[e.jsx(Ve,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:i==="none"?"No Subscription - Upgrade Required":"Trial Expired - Upgrade Required"}),e.jsx("p",{className:"text-red-300/90 mb-6 text-lg",children:i==="none"?"You need an active subscription to access this feature. Start your 15-day free trial or upgrade now to manage your Google Business Profiles.":"Your 15-day trial has expired. Upgrade now to continue managing your Google Business Profiles and access all premium features."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:()=>m(!0),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg w-full",size:"lg",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),i==="none"?"Start Free Trial":"Upgrade Now"]}),e.jsx("p",{className:"text-sm text-red-400/80",children:"Starting from ₹1,099/month • Unlimited Profiles • All Features"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4",children:[e.jsxs(w,{className:"border-2 border-border/60 shadow-sm",children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Profiles"}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Connected business accounts"})]})]}),e.jsxs(w,{className:"border-2 border-border/60 shadow-sm",children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Locations"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Business locations"})]})]}),e.jsxs(w,{className:"border-2 border-border/60 shadow-sm",children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Avg Rating"}),e.jsx(us,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.8"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all locations"})]})]}),e.jsxs(w,{className:"border-2 border-border/60 shadow-sm",children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Last Sync"}),e.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"Now"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Real-time updates"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold truncate",children:"Your Business Profiles"}),e.jsx(ke,{to:"/dashboard/settings",className:"flex-shrink-0",children:e.jsxs(N,{variant:"outline",size:"sm",className:"text-xs sm:text-sm px-2 sm:px-3",children:[e.jsx(nt,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Manage Connections"}),e.jsx("span",{className:"sm:hidden",children:"Manage"})]})})]}),t&&t.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:o(t).map((T,y)=>{var I,U,q;const j=T.locations[0],g=j.locationId||((I=j.name)==null?void 0:I.split("/").pop())||y;return e.jsxs("div",{className:"glass-card rounded-lg p-3 sm:p-4 cursor-pointer transition-all duration-300 flex flex-col h-full border-2 border-primary/30 hover:border-primary/60 hover:shadow-glow glow-hover shadow-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-foreground truncate flex-1 mr-2",style:{fontSize:"clamp(14px, 2.5vw, 16px)",fontFamily:"Onest"},title:T.accountName,children:T.accountName}),T.state==="VERIFIED"&&e.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:e.jsx("img",{src:"/Vector.svg",alt:"Verified",className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(as,{className:"h-4 w-4 text-muted-foreground mr-2"}),e.jsxs("span",{className:"text-xs sm:text-sm text-foreground truncate",style:{fontSize:"clamp(12px, 2vw, 14px)",fontFamily:"Onest"},children:[((U=j.address)==null?void 0:U.locality)||"Location"," ",((q=j.address)==null?void 0:q.administrativeArea)&&`, ${j.address.administrativeArea}`]})]}),j.categories&&j.categories.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[j.categories.slice(0,2).map((Q,Z)=>e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs border border-blue-100",style:{fontFamily:"Onest"},children:Q.name},Z)),j.categories.length>2&&e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs border border-blue-100",style:{fontFamily:"Onest"},children:["+",j.categories.length-2," more"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ke,{to:`/dashboard/profiles/${g}`,className:"block",children:e.jsx("button",{className:"w-full py-2 px-3 sm:px-4 rounded-lg text-white font-medium transition-all hover:opacity-90 bg-primary hover:bg-primary-hover",style:{fontSize:"clamp(12px, 2vw, 14px)",fontFamily:"Onest"},children:"Manage Profile"})})})]},y)})}),t&&t.length>1&&o(t).length<t.length&&e.jsx(w,{className:"border-orange-200 bg-orange-50",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Ms,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-1",children:"Additional Profiles Available"}),e.jsxs("p",{className:"text-sm text-orange-800 mb-3",children:["You have ",t.length," Google Business accounts, but can only access ",o(t).length," with your current plan."]}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>r("/dashboard/billing"),className:"border-orange-300 text-orange-700 hover:bg-orange-100",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Upgrade to Access All Profiles"]})]})]})})}),((v=(f=t[0])==null?void 0:f.name)==null?void 0:v.includes("demo"))&&e.jsx(w,{className:"border-blue-200 bg-blue-50",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Demo Mode:"})," Showing sample data because Google API calls are CORS-blocked in frontend-only mode. A backend would be needed for real Google Business Profile data."]})]})})})]}):e.jsx(w,{children:e.jsxs(k,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ms,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No profiles loaded"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Your Google Business Profiles will appear here once loaded."}),e.jsx(ke,{to:"/dashboard/settings",children:e.jsxs(N,{children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),"Check Connection"]})})]})})]})]})]}),e.jsx(Sa,{isOpen:d,onClose:()=>m(!1)})]})},et=uo,Ws=l.forwardRef(({className:r,...s},t)=>e.jsx(Cr,{ref:t,className:M("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Ws.displayName=Cr.displayName;const Ue=l.forwardRef(({className:r,...s},t)=>e.jsx(Pr,{ref:t,className:M("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s}));Ue.displayName=Pr.displayName;const Le=l.forwardRef(({className:r,...s},t)=>e.jsx(Tr,{ref:t,className:M("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));Le.displayName=Tr.displayName;const ts=l.forwardRef(({className:r,...s},t)=>e.jsx(Rr,{className:M("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...s,ref:t,children:e.jsx(ho,{className:M("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ts.displayName=Rr.displayName;const De=bo,_a=vo,Fe=wo,Ie=l.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Ir,{ref:a,className:M("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[s,e.jsx(xo,{asChild:!0,children:e.jsx(Er,{className:"h-4 w-4 opacity-50"})})]}));Ie.displayName=Ir.displayName;const pn=l.forwardRef(({className:r,...s},t)=>e.jsx(Dr,{ref:t,className:M("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(po,{className:"h-4 w-4"})}));pn.displayName=Dr.displayName;const gn=l.forwardRef(({className:r,...s},t)=>e.jsx(Fr,{ref:t,className:M("flex cursor-default items-center justify-center py-1",r),...s,children:e.jsx(Er,{className:"h-4 w-4"})}));gn.displayName=Fr.displayName;const Ee=l.forwardRef(({className:r,children:s,position:t="popper",...a},n)=>e.jsx(go,{children:e.jsxs($r,{ref:n,className:M("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...a,children:[e.jsx(pn,{}),e.jsx(fo,{className:M("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(gn,{})]})}));Ee.displayName=$r.displayName;const xa=l.forwardRef(({className:r,...s},t)=>e.jsx(Ur,{ref:t,className:M("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));xa.displayName=Ur.displayName;const G=l.forwardRef(({className:r,children:s,...t},a)=>e.jsxs(Lr,{ref:a,className:M("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(jo,{children:e.jsx(Bs,{className:"h-4 w-4"})})}),e.jsx(yo,{children:s})]}));G.displayName=Lr.displayName;const fn=l.forwardRef(({className:r,...s},t)=>e.jsx(Gr,{ref:t,className:M("-mx-1 my-1 h-px bg-muted",r),...s}));fn.displayName=Gr.displayName;class bl{constructor(){ye(this,"STORAGE_KEY","googleranker_auto_posting_configs");ye(this,"GLOBAL_STATS_KEY","googleranker_auto_posting_global_stats")}getAllConfigurations(){try{const s=localStorage.getItem(this.STORAGE_KEY);return s?JSON.parse(s):[]}catch(s){return console.error("Failed to load auto-posting configurations:",s),[]}}getConfiguration(s){return this.getAllConfigurations().find(a=>a.locationId===s)||null}saveConfiguration(s){try{const t=this.getAllConfigurations(),a=t.findIndex(n=>n.locationId===s.locationId);a>=0?t[a]=s:t.push(s),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("autoPostingConfigChanged",{detail:{locationId:s.locationId,config:s}}))}catch(t){throw console.error("Failed to save auto-posting configuration:",t),t}}deleteConfiguration(s){try{const a=this.getAllConfigurations().filter(n=>n.locationId!==s);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("autoPostingConfigDeleted",{detail:{locationId:s}}))}catch(t){throw console.error("Failed to delete auto-posting configuration:",t),t}}getEnabledConfigurations(){return this.getAllConfigurations().filter(s=>s.enabled)}updatePostStatus(s,t,a){const n=this.getConfiguration(s);if(!n)return;const o=a||new Date().toISOString();n.lastPost=o,n.stats.totalPosts++,t?(n.stats.successfulPosts++,n.stats.lastPostStatus="success"):(n.stats.failedPosts++,n.stats.lastPostStatus="failed"),this.saveConfiguration(n)}calculateNextPostTime(s){const t=new Date,[a,n]=s.schedule.time.split(":").map(Number);let o=new Date;switch(o.setHours(a,n,0,0),s.schedule.frequency){case"test30s":o=new Date(t.getTime()+30*1e3);break;case"daily":o<=t&&o.setDate(o.getDate()+1);break;case"alternative":o<=t?o.setDate(o.getDate()+2):o.setDate(o.getDate()+1);break;case"weekly":o<=t&&o.setDate(o.getDate()+7);break;case"custom":if(s.schedule.customTimes&&s.schedule.customTimes.length>0){const d=s.schedule.customTimes.map(i=>{const[h,c]=i.split(":").map(Number),u=new Date;return u.setHours(h,c,0,0),u}).sort((i,h)=>i.getTime()-h.getTime()),m=d.find(i=>i>t);m?o=m:(o=d[0],o.setDate(o.getDate()+1))}break}return o.toISOString()}updateNextPostTime(s,t){const a=this.getConfiguration(s);a&&(t&&["daily","alternative","weekly","custom","test30s"].includes(t)&&(a.schedule.frequency=t),a.nextPost=this.calculateNextPostTime(a),this.saveConfiguration(a))}getGlobalStats(){try{const s=this.getAllConfigurations(),t=new Date().toDateString();let a=0,n=0,o=0;const d=localStorage.getItem(this.GLOBAL_STATS_KEY);if(d){const m=JSON.parse(d);m.date===t&&(a=m.totalPostsToday||0,n=m.successfulPostsToday||0,o=m.failedPostsToday||0)}return{totalConfigurations:s.length,activeConfigurations:s.filter(m=>m.enabled).length,totalPostsToday:a,successfulPostsToday:n,failedPostsToday:o}}catch(s){return console.error("Failed to load global stats:",s),{totalConfigurations:0,activeConfigurations:0,totalPostsToday:0,successfulPostsToday:0,failedPostsToday:0}}}updateGlobalStats(s){try{const t=new Date().toDateString(),a=localStorage.getItem(this.GLOBAL_STATS_KEY);let n={date:t,totalPostsToday:0,successfulPostsToday:0,failedPostsToday:0};if(a){const o=JSON.parse(a);o.date===t&&(n=o)}n.totalPostsToday++,s?n.successfulPostsToday++:n.failedPostsToday++,localStorage.setItem(this.GLOBAL_STATS_KEY,JSON.stringify(n)),window.dispatchEvent(new CustomEvent("globalStatsUpdated",{detail:n}))}catch(t){console.error("Failed to update global stats:",t)}}createDefaultConfiguration(s,t){const a={locationId:s,businessName:t,categories:[],keywords:[],enabled:!1,schedule:{frequency:"alternative",time:"09:00"},button:{enabled:!0,type:"auto"},stats:{totalPosts:0,successfulPosts:0,failedPosts:0}};return a.nextPost=this.calculateNextPostTime(a),a}onConfigurationChange(s){const t=a=>{s(a.detail.locationId,a.detail.config)};return window.addEventListener("autoPostingConfigChanged",t),()=>{window.removeEventListener("autoPostingConfigChanged",t)}}onConfigurationDeleted(s){const t=a=>{s(a.detail.locationId)};return window.addEventListener("autoPostingConfigDeleted",t),()=>{window.removeEventListener("autoPostingConfigDeleted",t)}}onGlobalStatsUpdated(s){const t=a=>{s(a.detail)};return window.addEventListener("globalStatsUpdated",t),()=>{window.removeEventListener("globalStatsUpdated",t)}}}const Re=new bl;class vl{constructor(){ye(this,"intervalId",null);ye(this,"isRunning",!1);ye(this,"checkInterval",15e3);this.start()}start(){this.isRunning||(console.log("🚀 Starting automation service..."),this.isRunning=!0,this.checkAndProcessPosts(),this.intervalId=setInterval(()=>{this.checkAndProcessPosts()},this.checkInterval))}stop(){this.isRunning&&(console.log("⏹️ Stopping automation service..."),this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null))}async checkAndProcessPosts(){try{const s=Re.getEnabledConfigurations(),t=new Date;console.log(`🔍 Checking ${s.length} enabled configurations at ${t.toLocaleString()}`);for(const a of s)await this.processConfigurationIfReady(a,t)}catch(s){console.error("🚨 Error in automation service check:",s)}}async processConfigurationIfReady(s,t){try{if(s.schedule.frequency==="test30s"){if(s.lastPost){const n=new Date(s.lastPost).getTime(),o=t.getTime()-n;if(o>=3e4)console.log(`🧪 TEST MODE: 30 seconds passed for ${s.businessName} - posting now!`),await this.executePost(s);else{const d=Math.ceil((3e4-o)/1e3);console.log(`🧪 TEST MODE: ${d}s remaining for ${s.businessName}`)}}else console.log(`🧪 TEST MODE: First post for ${s.businessName} - posting now!`),await this.executePost(s);return}if(!s.nextPost){console.log(`⚠️ No nextPost time for ${s.businessName}, calculating...`),Re.updateNextPostTime(s.locationId);return}const a=new Date(s.nextPost);if(t>=a)console.log(`⏰ Time to post for ${s.businessName}! Scheduled: ${a.toLocaleString()}, Current: ${t.toLocaleString()}`),await this.executePost(s);else{const n=Math.ceil((a.getTime()-t.getTime())/6e4);n<=5&&console.log(`⏱️ ${s.businessName}: ${n} minutes until next post`)}}catch(a){console.error(`🚨 Error processing configuration for ${s.businessName}:`,a)}}async executePost(s){console.log(`📝 Executing post for ${s.businessName}...`);try{const t=await this.generatePostContent(s),a=await this.postToGoogleBusinessProfile(s,t);if(a.success)console.log(`✅ Successfully posted for ${s.businessName}`),Re.updatePostStatus(s.locationId,!0),Re.updateGlobalStats(!0),s.schedule.frequency!=="test30s"&&Re.updateNextPostTime(s.locationId),K({title:"Post Published! 🎉",description:`Successfully posted for ${s.businessName}`,duration:4e3}),window.dispatchEvent(new CustomEvent("autoPostSuccess",{detail:{locationId:s.locationId,businessName:s.businessName,content:t.content}}));else throw new Error(a.error||"Unknown error occurred")}catch(t){console.error(`❌ Failed to post for ${s.businessName}:`,t),Re.updatePostStatus(s.locationId,!1),Re.updateGlobalStats(!1),s.schedule.frequency!=="test30s"&&Re.updateNextPostTime(s.locationId),K({title:"Post Failed ❌",description:`Failed to post for ${s.businessName}: ${t instanceof Error?t.message:"Unknown error"}`,variant:"destructive",duration:6e3}),window.dispatchEvent(new CustomEvent("autoPostError",{detail:{locationId:s.locationId,businessName:s.businessName,error:t instanceof Error?t.message:"Unknown error"}}))}}async generatePostContent(s){const t=s.categories.length>0?s.categories[0]:"business";console.log(`🤖 Generating content for ${s.businessName} (${t}) with keywords:`,s.keywords);try{return await Os.generatePostContent(s.businessName,t,s.keywords,s.locationName,s.websiteUrl)}catch(a){throw console.error("🚨 OpenAI content generation failed:",a),a}}generateCallToAction(s){var d,m;if(!((d=s.button)!=null&&d.enabled)||((m=s.button)==null?void 0:m.type)==="none")return null;const t=s.button.type||"auto";if(t==="call_now")return s.button.phoneNumber?{actionType:"CALL",phoneNumber:s.button.phoneNumber}:(console.warn("Call Now button selected but no phone number provided"),null);const a=s.button.customUrl||s.websiteUrl;return a?{actionType:{auto:this.getAutoActionType(s),book:"BOOK",order:"ORDER_ONLINE",buy:"BUY",learn_more:"LEARN_MORE",sign_up:"SIGN_UP"}[t]||"LEARN_MORE",url:a}:(console.warn("Button enabled but no URL available"),null)}getAutoActionType(s){const t=s.categories.length>0?s.categories[0].toLowerCase():"";return t.includes("restaurant")||t.includes("food")?"ORDER_ONLINE":t.includes("salon")||t.includes("spa")||t.includes("health")?"BOOK":t.includes("retail")||t.includes("store")||t.includes("shop")?"BUY":t.includes("education")||t.includes("school")||t.includes("course")?"SIGN_UP":"LEARN_MORE"}async postToGoogleBusinessProfile(s,t){try{console.log(`📤 Posting to Google Business Profile for ${s.businessName}...`);const a=Se.getAccessToken();if(console.log("🔍 DEBUGGING: Access token check:",{hasToken:!!a,tokenLength:a==null?void 0:a.length,tokenStart:(a==null?void 0:a.substring(0,20))+"..."}),!a)throw console.error("❌ DEBUGGING: No access token available!"),console.error("🔍 DEBUGGING: Google service connection status:",Se.isConnected()),console.error("🔍 DEBUGGING: localStorage tokens:",localStorage.getItem("google_business_tokens")),new Error("No access token available. Please connect to Google Business Profile first.");const n="http://localhost:5000";console.log("🔍 DEBUGGING: Backend URL being used:",n),console.log("🔍 DEBUGGING: VITE_BACKEND_URL env var:","http://localhost:5000");const o=this.generateCallToAction(s),d={languageCode:"en-US",topicType:"STANDARD",summary:t.content,media:[],callToAction:o},m=await fetch(`${n}/api/locations/${s.locationId}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(d)});if(!m.ok){const c=await m.text();throw console.error("❌ DEBUGGING: Backend API error response:",c),new Error(`Backend API error: ${m.status} - ${c}`)}const i=m.headers.get("Content-Type");console.log("🔍 DEBUGGING: Response content-type:",i);let h;try{const c=await m.text();if(console.log("🔍 DEBUGGING: Raw response text:",c.substring(0,200)+"..."),c.trim().startsWith("<!DOCTYPE")||c.trim().startsWith("<html"))throw console.error("❌ DEBUGGING: Backend returned HTML instead of JSON"),new Error("Backend API error: Server returned HTML error page instead of JSON. This usually indicates a server configuration issue or API endpoint problem.");h=JSON.parse(c)}catch(c){throw console.error("❌ DEBUGGING: JSON parse error:",c),console.error("❌ DEBUGGING: Response was not valid JSON"),new Error(`Backend API returned invalid JSON: ${c.message}`)}if(h&&(h.post||h.success))return console.log("✅ Post created successfully via backend API"),console.log("🔍 DEBUGGING: Backend result:",h),{success:!0,postContent:t.content};throw console.error("❌ DEBUGGING: Unexpected backend response format:",h),new Error("No result returned from backend API")}catch(a){return console.error("🚨 Backend API error:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async executeManualPost(s){const t=Re.getConfiguration(s);if(!t)throw new Error("Configuration not found for location");if(!t.enabled)throw new Error("Auto-posting is disabled for this location");console.log(`🔧 Manual post execution for ${t.businessName}...`);try{const a=await this.generatePostContent(t),n=await this.postToGoogleBusinessProfile(t,a);return n.success?(Re.updatePostStatus(t.locationId,!0),Re.updateGlobalStats(!0),K({title:"Manual Post Published! 🚀",description:`Successfully posted for ${t.businessName}`,duration:4e3})):(Re.updatePostStatus(t.locationId,!1),Re.updateGlobalStats(!1),K({title:"Manual Post Failed ❌",description:`Failed to post: ${n.error}`,variant:"destructive",duration:6e3})),n}catch(a){const n=a instanceof Error?a.message:"Unknown error";return Re.updatePostStatus(t.locationId,!1),Re.updateGlobalStats(!1),K({title:"Manual Post Failed ❌",description:`Failed to post: ${n}`,variant:"destructive",duration:6e3}),{success:!1,error:n}}}isServiceRunning(){return this.isRunning}getNextCheckTime(){return new Date(Date.now()+this.checkInterval)}onAutoPostSuccess(s){const t=a=>s(a.detail);return window.addEventListener("autoPostSuccess",t),()=>window.removeEventListener("autoPostSuccess",t)}onAutoPostError(s){const t=a=>s(a.detail);return window.addEventListener("autoPostError",t),()=>window.removeEventListener("autoPostError",t)}}const za=new vl;class wl{constructor(){ye(this,"backendUrl");this.backendUrl="http://localhost:5000"}async saveAutomationSettings(s,t){try{console.log(`📤 Saving automation settings to server for location ${s}:`,t);const a=await fetch(`${this.backendUrl}/api/automation/settings/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`Failed to save automation settings: ${a.statusText}`);const n=await a.json();return console.log("✅ Automation settings saved to server:",n),K({title:"Automation Settings Saved",description:"Your automation settings have been saved and will run on the server even when you're offline."}),!0}catch(a){return console.error("❌ Error saving automation settings to server:",a),K({title:"Error Saving Settings",description:"Failed to save automation settings to server. Please try again.",variant:"destructive"}),!1}}async getAutomationStatus(s){try{const t=await fetch(`${this.backendUrl}/api/automation/status/${s}`);if(!t.ok)throw new Error(`Failed to get automation status: ${t.statusText}`);const a=await t.json();return console.log(`📊 Automation status for location ${s}:`,a),a}catch(t){return console.error("❌ Error getting automation status:",t),null}}async stopAutomations(s){try{console.log(`🛑 Stopping all automations for location ${s}`);const t=await fetch(`${this.backendUrl}/api/automation/stop/${s}`,{method:"POST"});if(!t.ok)throw new Error(`Failed to stop automations: ${t.statusText}`);return K({title:"Automations Stopped",description:"All automations have been stopped for this location."}),!0}catch(t){return console.error("❌ Error stopping automations:",t),K({title:"Error",description:"Failed to stop automations. Please try again.",variant:"destructive"}),!1}}async triggerPost(s,t){try{console.log(`🚀 Manually triggering post for location ${s}`);const a=await fetch(`${this.backendUrl}/api/automation/trigger-post/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`Failed to trigger post: ${a.statusText}`);return K({title:"Post Triggered",description:"Post has been triggered successfully."}),!0}catch(a){return console.error("❌ Error triggering post:",a),K({title:"Error",description:"Failed to trigger post. Please try again.",variant:"destructive"}),!1}}async checkReviews(s,t){try{console.log(`🔍 Manually checking reviews for location ${s}`);const a=await fetch(`${this.backendUrl}/api/automation/check-reviews/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`Failed to check reviews: ${a.statusText}`);return K({title:"Reviews Checked",description:"Review check completed successfully."}),!0}catch(a){return console.error("❌ Error checking reviews:",a),K({title:"Error",description:"Failed to check reviews. Please try again.",variant:"destructive"}),!1}}async getAutomationLogs(){try{const s=await fetch(`${this.backendUrl}/api/automation/logs`);if(!s.ok)throw new Error(`Failed to get automation logs: ${s.statusText}`);return(await s.json()).activities||[]}catch(s){return console.error("❌ Error getting automation logs:",s),[]}}async enableAutoPosting(s,t,a,n,o,d,m,i,h,c,u,x){const f={autoPosting:{enabled:!0,schedule:a,frequency:n,businessName:t,category:o,keywords:d,websiteUrl:m,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...c,phoneNumber:u,button:x},userId:i,accountId:h};return this.saveAutomationSettings(s,f)}async disableAutoPosting(s){const t={autoPosting:{enabled:!1}};return this.saveAutomationSettings(s,t)}async enableAutoReply(s,t,a=!0,n,o,d,m){const i={autoReply:{enabled:!0,replyToAll:a,replyToPositive:!0,replyToNegative:!0,replyToNeutral:!0,businessName:t},userId:n,accountId:o};return d&&(i.autoReply.keywords=d),m&&(i.autoReply.category=m),this.saveAutomationSettings(s,i)}async disableAutoReply(s){const t={autoReply:{enabled:!1}};return this.saveAutomationSettings(s,t)}}const Ls=new wl;typeof window<"u"&&(window.serverAutomationService=Ls,console.log("🤖 Server Automation Service initialized"),console.log("   Use window.serverAutomationService to access the service"));function Nl({location:r}){var X,le,H,J,xe,W,V,de,pe,qe,Ke,D,_;const{currentUser:s}=Ye(),{isConnected:t}=ct(),[a,n]=l.useState(null),[o,d]=l.useState(!0),[m,i]=l.useState(!1),[h,c]=l.useState(["09:00"]),[u,x]=l.useState(""),[f,v]=l.useState([]),[T,y]=l.useState(!1),j=()=>["quality service","customer satisfaction","professional","reliable","trusted","excellent experience","local business","community","best service","development","quality","customer","service","professional","reliable","trusted","excellent","experience","local","business","community","best","good","great","amazing","awesome","top","leading","premier","expert","specialists","solutions","services","company","corporation","inc","llc","ltd","limited","pvt","private","consultant","consulting"],g=()=>{const P=[],F=j();return r.name&&(P.push(r.name),r.name.toLowerCase().split(/[\s.,\-_]+/).forEach(te=>{te.length>2&&!F.includes(te.toLowerCase())&&P.push(te)})),r.address&&r.address.locality&&(P.push(r.address.locality),r.name&&P.push(`${r.name} ${r.address.locality}`)),[...new Set(P.filter(re=>!F.includes(re.toLowerCase().trim())))]};l.useEffect(()=>{I();const P=Re.onConfigurationChange((te,je)=>{te===r.id&&n(je)}),F=za.onAutoPostSuccess(te=>{te.locationId===r.id&&I()}),re=za.onAutoPostError(te=>{te.locationId===r.id&&I()});return()=>{P(),F(),re()}},[r.id]);const I=()=>{let P=Re.getConfiguration(r.id);P?(typeof P.keywords=="string"&&(P.keywords=P.keywords?P.keywords.split(",").map(F=>F.trim()).filter(F=>F.length>0):g(),Re.saveConfiguration(P)),Array.isArray(P.keywords)&&P.keywords.length===0&&(P.keywords=g(),Re.saveConfiguration(P)),P.button||(P.button={enabled:!0,type:"auto"},Re.saveConfiguration(P))):(P=Re.createDefaultConfiguration(r.id,r.name),P.categories=r.categories||[],P.locationName=r.name,P.websiteUrl=r.websiteUri,P.keywords=g(),Re.saveConfiguration(P)),n(P),P.keywords&&Array.isArray(P.keywords)&&v(P.keywords),P.schedule.frequency==="custom"&&P.schedule.customTimes&&c(P.schedule.customTimes),d(!1)},U=P=>{if(!a)return;const F={...a,...P};n(F),Re.saveConfiguration(F)},q=async P=>{var F,re;U({enabled:P}),y(!0);try{if(P){const te=localStorage.getItem("google_business_account_id"),je=r.address?{fullAddress:((F=r.address.addressLines)==null?void 0:F.join(", "))||"",city:r.address.locality||"",region:r.address.administrativeArea||"",country:r.address.countryCode||"",postalCode:r.address.postalCode||""}:{};await Ls.enableAutoPosting(r.id,r.name,(a==null?void 0:a.schedule.time)||"09:00",(a==null?void 0:a.schedule.frequency)||"daily",(re=r.categories)==null?void 0:re[0],f.join(", "),r.websiteUri,s==null?void 0:s.uid,te||void 0,je,r.phoneNumber,a==null?void 0:a.button),K({title:"Auto-posting enabled! 🚀",description:`Posts will be automatically generated for ${r.name} even when you're offline`,duration:4e3})}else await Ls.disableAutoPosting(r.id),K({title:"Auto-posting disabled",description:`Automatic posting stopped for ${r.name}`,duration:3e3})}catch(te){console.error("Failed to save to server:",te),K({title:"Server sync failed",description:"Settings saved locally but server sync failed. Automation may not work when offline.",variant:"destructive",duration:5e3})}finally{y(!1)}},Q=async P=>{var te,je;const F={...a};F.schedule.frequency=P;const re=Z(P,F.schedule.time);if(F.nextPost=re,U(F),a!=null&&a.enabled)try{const ue=localStorage.getItem("google_business_account_id"),we=r.address?{fullAddress:((te=r.address.addressLines)==null?void 0:te.join(", "))||"",city:r.address.locality||"",region:r.address.administrativeArea||"",country:r.address.countryCode||"",postalCode:r.address.postalCode||""}:{};await Ls.saveAutomationSettings(r.id,{autoPosting:{enabled:!0,schedule:F.schedule.time,frequency:P,businessName:r.name,category:(je=r.categories)==null?void 0:je[0],categories:r.categories,keywords:f.join(", "),websiteUrl:r.websiteUri,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...we,phoneNumber:r.phoneNumber,button:a==null?void 0:a.button},userId:s==null?void 0:s.uid,accountId:ue||void 0})}catch(ue){console.error("Failed to update server:",ue)}P==="test30s"&&K({title:"Test mode enabled! 🧪",description:"Posts will be generated every 30 seconds for testing",duration:4e3})},Z=(P,F)=>{const re=new Date,[te,je]=F.split(":").map(Number);let ue=new Date;switch(ue.setHours(te,je,0,0),P){case"test30s":ue=new Date(re.getTime()+30*1e3);break;case"daily":ue<=re&&ue.setDate(ue.getDate()+1);break;case"alternative":ue<=re?ue.setDate(ue.getDate()+2):ue.setDate(ue.getDate()+1);break;case"weekly":ue<=re&&ue.setDate(ue.getDate()+7);break;case"custom":if(h.length>0){const we=h.map(Oe=>{const[ze,A]=Oe.split(":").map(Number),z=new Date;return z.setHours(ze,A,0,0),z}).sort((Oe,ze)=>Oe.getTime()-ze.getTime()),Ge=we.find(Oe=>Oe>re);ue=Ge||we[0],Ge||ue.setDate(ue.getDate()+1)}break}return ue.toISOString()},$=async P=>{var re,te;const F={...a};if(F.schedule.time=P,F.nextPost=Z(F.schedule.frequency,P),U(F),a!=null&&a.enabled)try{const je=localStorage.getItem("google_business_account_id"),ue=r.address?{fullAddress:((re=r.address.addressLines)==null?void 0:re.join(", "))||"",city:r.address.locality||"",region:r.address.administrativeArea||"",country:r.address.countryCode||"",postalCode:r.address.postalCode||""}:{};await Ls.saveAutomationSettings(r.id,{autoPosting:{enabled:!0,schedule:P,frequency:F.schedule.frequency,businessName:r.name,category:(te=r.categories)==null?void 0:te[0],categories:r.categories,keywords:f.join(", "),websiteUrl:r.websiteUri,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...ue,phoneNumber:r.phoneNumber,button:a==null?void 0:a.button},userId:s==null?void 0:s.uid,accountId:je||void 0})}catch(je){console.error("Failed to update server:",je)}},S=P=>{c(P);const F={...a};F.schedule.customTimes=P,F.nextPost=Z(F.schedule.frequency,F.schedule.time),U(F)},p=()=>{const P=[...h,"09:00"];S(P)},b=P=>{const F=h.filter((re,te)=>te!==P);S(F)},L=()=>{const P=u.trim(),F=j();if(!P)return;if(F.includes(P.toLowerCase())){K({title:"Generic Keyword Avoided",description:`"${P}" is too generic. Try using your business name or location instead.`,variant:"destructive",duration:4e3});return}if(f.includes(P)){K({title:"Keyword Already Exists",description:`"${P}" is already in your keywords.`,variant:"destructive",duration:3e3});return}const re=[...f,P];v(re),ie(re),x(""),K({title:"Keyword Added! ✅",description:`Added "${P}" to your keywords`,duration:2e3})},C=P=>{const F=f.filter(re=>re!==P);v(F),ie(F),K({title:"Keyword Removed",description:`Removed "${P}" from your keywords`,duration:2e3})},ie=async P=>{var F,re;if(U({keywords:P}),a!=null&&a.enabled)try{const te=localStorage.getItem("google_business_account_id"),je=r.address?{fullAddress:((F=r.address.addressLines)==null?void 0:F.join(", "))||"",city:r.address.locality||"",region:r.address.administrativeArea||"",country:r.address.countryCode||"",postalCode:r.address.postalCode||""}:{};await Ls.saveAutomationSettings(r.id,{autoPosting:{enabled:!0,schedule:(a==null?void 0:a.schedule.time)||"09:00",frequency:(a==null?void 0:a.schedule.frequency)||"daily",businessName:r.name,category:(re=r.categories)==null?void 0:re[0],categories:r.categories,keywords:P.join(", "),websiteUrl:r.websiteUri,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...je,phoneNumber:r.phoneNumber,button:a==null?void 0:a.button},userId:s==null?void 0:s.uid,accountId:te||void 0}),console.log("Keywords synced to server for automation")}catch(te){console.error("Failed to sync keywords to server:",te)}},ae=()=>{const P=g();v(P),ie(P),K({title:"Keywords Generated! 🎯",description:"Smart keywords generated focusing on your business name and location.",duration:3e3})},E=()=>{const P=j(),F=f.filter(te=>!P.includes(te.toLowerCase().trim())),re=f.length-F.length;re>0?(v(F),ie(F),K({title:"Keywords Cleaned! 🧹",description:`Removed ${re} generic keyword${re>1?"s":""}.`,duration:3e3})):K({title:"All Good! ✅",description:"No generic keywords found to remove.",duration:2e3})},Y=async()=>{var P,F,re,te,je,ue,we;if(a){i(!0);try{if(!s)throw new Error("You must be logged in to test auto-posting");console.log("[AutoPostingTab] Checking backend token status for user:",s.uid);const Ge="http://localhost:5000",Oe=await fetch(`${Ge}/auth/google/token-status/${s.uid}`);if(!Oe.ok)throw new Error("Failed to check token status");const ze=await Oe.json();if(console.log("[AutoPostingTab] Token status:",ze),!ze.hasAccessToken&&!ze.hasRefreshToken){K({title:"Connection Required",description:"Your Google Business Profile isn't connected. Go to Settings > Connections to connect.",variant:"destructive",duration:5e3}),i(!1);return}console.log("[AutoPostingTab] ✅ Backend has valid tokens, proceeding with test post...");const A=Se.getAccessToken();console.log("[AutoPostingTab] 🔑 Access token from service:",A?"Available":"Not available"),console.log("[AutoPostingTab] 🔑 Token length:",(A==null?void 0:A.length)||0);const z=await fetch(`${Ge}/api/automation/test-post-now/${r.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-User-ID":s.uid,...A?{Authorization:`Bearer ${A}`}:{}},body:JSON.stringify({businessName:r.name,category:((P=r.categories)==null?void 0:P[0])||"business",keywords:f.length>0?f.join(", "):"quality service, customer satisfaction",websiteUrl:r.websiteUri||"",locationName:((F=r.address)==null?void 0:F.locality)||"",city:((re=r.address)==null?void 0:re.locality)||"",region:((te=r.address)==null?void 0:te.administrativeArea)||"",country:((je=r.address)==null?void 0:je.countryCode)||"",fullAddress:((we=(ue=r.address)==null?void 0:ue.addressLines)==null?void 0:we.join(", "))||"",phoneNumber:r.phoneNumber||"",userId:s.uid,accessToken:A||void 0,button:a.button})}),se=z.headers.get("content-type");let ce;if(se&&se.includes("application/json"))ce=await z.json();else{const me=await z.text();throw console.error("[AutoPostingTab] Received HTML response instead of JSON:",me.substring(0,200)),new Error(`Backend returned HTML error page. Status: ${z.status}`)}z.ok&&ce.success?K({title:"Test post successful! ✅",description:ce.message||"Your post has been published to Google Business Profile",duration:5e3}):K({title:"Test post failed ❌",description:ce.error||ce.details||"Failed to publish post",variant:"destructive",duration:6e3})}catch(Ge){K({title:"Test post failed ❌",description:Ge instanceof Error?Ge.message:"Unknown error occurred",variant:"destructive",duration:6e3})}finally{i(!1)}}},R=()=>{if(!(a!=null&&a.nextPost))return"Not scheduled";if(a.schedule.frequency==="test30s")if(a.lastPost){const re=new Date(a.lastPost),te=new Date(re.getTime()+30*1e3),je=new Date;return te<=je?"Ready to post":`${Math.ceil((te.getTime()-je.getTime())/1e3)}s remaining`}else return"Ready to post";const P=new Date(a.nextPost);return P<=new Date?"Ready to post":P.toLocaleString()};return ja.useMemo(()=>{const P=g();return f.filter(F=>!P.includes(F))},[f,r.name,r.categories]),o?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx(St,{size:"lg",variant:"primary"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Loading Automation Settings..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Setting up your auto-posting configuration"})]}),e.jsx("div",{className:"w-full max-w-4xl mt-8 space-y-6",children:Array.from({length:3}).map((P,F)=>e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-5 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 bg-muted rounded w-48 animate-pulse"})]}),e.jsx("div",{className:"h-6 w-16 bg-muted rounded-full animate-pulse"})]}),e.jsx("div",{className:"h-3 bg-muted rounded w-64 animate-pulse mt-2"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-24 bg-muted rounded animate-pulse"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"})]})]})]},F))})]}):a?e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6 min-w-0 w-full px-2 sm:px-4 md:px-0",children:[e.jsxs(w,{className:"shadow-sm overflow-hidden",children:[e.jsxs(O,{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs(B,{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-3 max-w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0 flex-1",children:[e.jsx(Kt,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm sm:text-base md:text-lg break-words",children:"Auto Posting Configuration"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ts,{checked:a.enabled,onCheckedChange:q,disabled:T}),e.jsx("span",{className:"text-xs sm:text-sm font-medium whitespace-nowrap",children:T?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border-2 border-current border-t-transparent rounded-full"}),e.jsx("span",{className:"hidden xs:inline",children:"Saving..."})]}):e.jsx("span",{children:a.enabled?"Enabled":"Disabled"})})]})]}),e.jsxs(ge,{className:"text-xs sm:text-sm break-words mt-1",children:["Automatically generate and publish posts for ",r.name]})]}),e.jsxs(k,{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{className:"text-xs sm:text-sm md:text-base",children:"Business Name"}),e.jsx(fe,{value:a.businessName,disabled:!0,className:"text-xs sm:text-sm mt-1"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{className:"text-xs sm:text-sm md:text-base",children:"Categories"}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-1.5 mt-1",children:[a.categories.map((P,F)=>e.jsx(ee,{variant:"secondary",className:"text-xs px-2 py-0.5",children:P},F)),a.categories.length===0&&e.jsx(ee,{variant:"outline",className:"text-xs",children:"No categories"})]})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs(oe,{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm md:text-base",children:[e.jsx(Aa,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{children:"Keywords for Content Generation"})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 mt-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-1.5 md:gap-2 p-2 sm:p-3 bg-gray-50 rounded-lg border min-h-[80px] sm:min-h-[100px] md:min-h-[120px] overflow-hidden",children:[f.map((P,F)=>{const te=g().includes(P);return e.jsx("div",{className:"flex items-center",children:e.jsxs(ee,{variant:te?"default":"outline",className:"flex items-center gap-0.5 sm:gap-1 text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 max-w-full",children:[te&&e.jsx(Aa,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 flex-shrink-0"}),e.jsx("span",{className:"break-all truncate max-w-[120px] sm:max-w-[200px]",title:P,children:P}),e.jsx("button",{type:"button",onClick:()=>C(P),disabled:!a.enabled,className:"ml-0.5 sm:ml-1 hover:bg-red-500 hover:text-white rounded-full p-0.5 transition-colors flex-shrink-0",children:e.jsx(ys,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"})})]})},F)}),f.length===0&&e.jsx("p",{className:"text-muted-foreground text-[10px] sm:text-xs md:text-sm px-1",children:'No keywords added yet. Click "Generate Keywords" to auto-populate based on your business profile.'})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(fe,{placeholder:"Enter custom keyword...",value:u,onChange:P=>x(P.target.value),onKeyPress:P=>{P.key==="Enter"&&(P.preventDefault(),L())},disabled:!a.enabled,className:"text-xs sm:text-sm flex-1"}),e.jsxs(N,{type:"button",onClick:L,size:"sm",disabled:!a.enabled||!u.trim(),className:"w-full sm:w-auto whitespace-nowrap text-xs sm:text-sm",children:[e.jsx(qs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{children:"Add"})]})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-2",children:[e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:ae,disabled:!a.enabled,className:"w-full xs:w-auto text-xs sm:text-sm flex-1 xs:flex-initial",children:[e.jsx(Me,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Generate"})]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:E,disabled:!a.enabled,className:"w-full xs:w-auto text-xs sm:text-sm flex-1 xs:flex-initial",children:[e.jsx(zs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Clean"})]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:()=>v([]),disabled:!a.enabled,className:"w-full xs:w-auto text-xs sm:text-sm flex-1 xs:flex-initial",children:[e.jsx(Mt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Clear"})]})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground break-words",children:["Smart keyword generation focuses on your business name (",r.name,"), location (",(X=r.address)==null?void 0:X.locality,", ",(le=r.address)==null?void 0:le.administrativeArea,"), and specific categories while filtering out generic terms."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 pt-3 sm:pt-4 border-t",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{className:"text-xs sm:text-sm",children:"Next Post"}),e.jsx("div",{className:"mt-1 p-2 sm:p-2.5 bg-muted rounded text-xs sm:text-sm break-words",children:R()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{className:"text-xs sm:text-sm",children:"Current Status"}),e.jsx("div",{className:"mt-1 flex items-center gap-1.5 sm:gap-2",children:a.enabled?e.jsxs(e.Fragment,{children:[e.jsx(No,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-green-600 break-words",children:"Active (Server-side)"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ko,{className:"h-3 w-3 sm:h-4 sm:w-4 text-gray-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Paused"})]})}),a.enabled&&e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mt-1 break-words",children:"Running on server - continues even when offline"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:e.jsx(N,{onClick:Y,disabled:!a.enabled||m||!t,variant:"outline",className:"flex items-center justify-center gap-2 w-full sm:w-auto text-xs sm:text-sm",title:t?"":"Connect your Google Business Profile in Settings > Connections first",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-3 w-3 sm:h-4 sm:w-4 border-2 border-current border-t-transparent rounded-full"}),e.jsx("span",{children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ca,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("span",{children:"Test & Post Now"}),!t&&e.jsx("span",{className:"ml-1 text-[10px] sm:text-xs",children:"(Connect GBP)"})]})})})]})]}),e.jsxs(w,{className:"shadow-sm overflow-hidden",children:[e.jsxs(O,{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs(B,{className:"flex items-center gap-1.5 sm:gap-2 text-sm sm:text-base md:text-lg",children:[e.jsx(zs,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),e.jsx("span",{children:"Post Button Settings"})]}),e.jsx(ge,{className:"text-xs sm:text-sm break-words mt-1",children:"Configure call-to-action buttons for your posts"})]}),e.jsxs(k,{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{checked:((H=a.button)==null?void 0:H.enabled)??!0,onCheckedChange:P=>{var F,re,te;return U({button:{enabled:P,type:((F=a.button)==null?void 0:F.type)||"auto",phoneNumber:((re=a.button)==null?void 0:re.phoneNumber)||r.phoneNumber,customUrl:(te=a.button)==null?void 0:te.customUrl}})},disabled:!a.enabled}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Add buttons to posts"})]}),((J=a.button)==null?void 0:J.enabled)&&e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsx(oe,{className:"text-xs sm:text-sm font-medium",children:"Call-to-Action Button Type"}),e.jsxs(De,{value:((xe=a.button)==null?void 0:xe.type)||"auto",onValueChange:P=>{var F;return U({button:{...a.button,enabled:!0,type:P,phoneNumber:((F=a.button)==null?void 0:F.phoneNumber)||r.phoneNumber}})},children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Select button type"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"auto",children:"🎯 Smart Selection (Auto)"}),e.jsx(G,{value:"none",children:"🚫 No Button"}),e.jsx(G,{value:"book",children:"📅 Book Appointment"}),e.jsx(G,{value:"order",children:"🛒 Order Online"}),e.jsx(G,{value:"buy",children:"💳 Buy Now"}),e.jsx(G,{value:"learn_more",children:"📚 Learn More"}),e.jsx(G,{value:"sign_up",children:"✍️ Sign Up"}),e.jsx(G,{value:"call_now",children:"📞 Call Now"})]})]})]}),((W=a.button)==null?void 0:W.type)==="auto"&&e.jsx("div",{className:"text-[10px] sm:text-xs text-muted-foreground bg-blue-50 p-2 sm:p-3 rounded-lg",children:e.jsxs("div",{children:[e.jsx("strong",{children:"🎯 Smart Selection:"})," Automatically chooses the best button based on your business category:",e.jsxs("ul",{className:"mt-1 ml-3 sm:ml-4 list-disc space-y-0.5",children:[e.jsx("li",{children:"Restaurants → Order Online"}),e.jsx("li",{children:"Salons/Health → Book Appointment"}),e.jsx("li",{children:"Retail → Shop Now"}),e.jsx("li",{children:"Education → Sign Up"}),e.jsx("li",{children:"Others → Learn More"})]}),e.jsxs("p",{className:"mt-2 break-words",children:["All buttons will redirect to your website URL: ",a.websiteUrl||"Not set"]})]})}),((V=a.button)==null?void 0:V.type)==="call_now"&&e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsx(oe,{htmlFor:"phone-number",className:"text-xs sm:text-sm font-medium",children:"Phone Number"}),e.jsx(fe,{id:"phone-number",type:"tel",placeholder:r.phoneNumber?`Business phone: ${r.phoneNumber}`:"e.g., +1 (555) 123-4567",value:((de=a.button)==null?void 0:de.phoneNumber)||r.phoneNumber||"",onChange:P=>{var F;return U({button:{...a.button,enabled:!0,type:((F=a.button)==null?void 0:F.type)||"call_now",phoneNumber:P.target.value}})},disabled:!a.enabled,className:"text-xs sm:text-sm"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground break-words",children:r.phoneNumber?(pe=a.button)!=null&&pe.phoneNumber?e.jsxs("span",{children:["Using custom phone number. Clear to use business profile number: ",r.phoneNumber]}):e.jsxs("span",{className:"text-green-600",children:["✓ Auto-filled from your Google Business Profile: ",r.phoneNumber]}):e.jsx("span",{className:"text-amber-600",children:"⚠ No phone number found in your Google Business Profile. Please add one."})})]}),((qe=a.button)==null?void 0:qe.type)&&!["auto","none","call_now"].includes(a.button.type)&&e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs(oe,{htmlFor:"button-url",className:"text-xs sm:text-sm font-medium",children:[a.button.type==="book"&&"Booking URL",a.button.type==="order"&&"Order Online URL",a.button.type==="buy"&&"Purchase URL",a.button.type==="learn_more"&&"Learn More URL",a.button.type==="sign_up"&&"Sign Up URL"]}),e.jsx(fe,{id:"button-url",type:"url",placeholder:a.button.type==="book"?"https://your-booking-system.com":a.button.type==="order"?"https://your-online-ordering.com":a.button.type==="buy"?"https://your-shop.com":a.button.type==="learn_more"?"https://your-website.com/about":a.button.type==="sign_up"?"https://your-website.com/signup":"https://your-website.com",value:((Ke=a.button)==null?void 0:Ke.customUrl)||a.websiteUrl||"",onChange:P=>{var F;return U({button:{...a.button,enabled:!0,type:((F=a.button)==null?void 0:F.type)||"learn_more",customUrl:P.target.value}})},className:"text-xs sm:text-sm"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-muted-foreground break-words",children:["Enter the URL where customers should be directed when they click the button.",!((D=a.button)!=null&&D.customUrl)&&a.websiteUrl&&e.jsx("span",{className:"text-blue-600",children:" Currently using your default website URL."})]})]}),((_=a.button)==null?void 0:_.type)==="none"&&e.jsx("div",{className:"text-[10px] sm:text-xs text-muted-foreground bg-gray-50 p-2 sm:p-3 rounded-lg",children:e.jsx("p",{children:"Posts will be created without any call-to-action buttons."})})]})]})]}),e.jsxs(w,{className:"shadow-sm overflow-hidden",children:[e.jsxs(O,{className:"p-3 sm:p-4 md:p-6",children:[e.jsxs(B,{className:"flex items-center gap-1.5 sm:gap-2 text-sm sm:text-base md:text-lg",children:[e.jsx(rs,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),e.jsx("span",{children:"Posting Schedule"})]}),e.jsx(ge,{className:"text-xs sm:text-sm break-words mt-1",children:"Set when and how often to publish posts"})]}),e.jsxs(k,{className:"space-y-3 sm:space-y-4 p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{htmlFor:"frequency",className:"text-xs sm:text-sm",children:"Frequency"}),e.jsxs(De,{value:a.schedule.frequency,onValueChange:Q,disabled:!a.enabled,children:[e.jsx(Ie,{children:e.jsx(Fe,{})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"daily",children:"Daily"}),e.jsx(G,{value:"alternative",children:"Alternative Days"}),e.jsx(G,{value:"weekly",children:"Weekly"}),e.jsx(G,{value:"custom",children:"Custom Schedule"}),e.jsx(G,{value:"test30s",children:"🧪 Test (30 seconds)"})]})]})]}),a.schedule.frequency!=="custom"&&a.schedule.frequency!=="test30s"&&e.jsxs("div",{className:"min-w-0",children:[e.jsxs(oe,{htmlFor:"time",className:"text-xs sm:text-sm",children:[e.jsx(ns,{className:"h-3 w-3 sm:h-4 sm:w-4 inline mr-1"}),e.jsx("span",{children:"Post Time"})]}),e.jsx(fe,{id:"time",type:"time",value:a.schedule.time,onChange:P=>$(P.target.value),disabled:!a.enabled,className:"text-xs sm:text-sm"})]})]}),a.schedule.frequency==="custom"&&e.jsxs("div",{className:"min-w-0",children:[e.jsx(oe,{className:"text-xs sm:text-sm",children:"Custom Post Times"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[h.map((P,F)=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx(fe,{type:"time",value:P,onChange:re=>{const te=[...h];te[F]=re.target.value,S(te)},disabled:!a.enabled,className:"text-xs sm:text-sm flex-1"}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:()=>b(F),disabled:!a.enabled||h.length<=1,className:"w-full sm:w-auto text-xs sm:text-sm",children:"Remove"})]},F)),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:p,disabled:!a.enabled,className:"w-full sm:w-auto text-xs sm:text-sm",children:"Add Time"})]})]}),a.schedule.frequency==="test30s"&&e.jsxs("div",{className:"p-2 sm:p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-yellow-800",children:[e.jsx(Ca,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),e.jsx("strong",{className:"text-xs sm:text-sm",children:"Test Mode Active"})]}),e.jsx("p",{className:"text-[10px] sm:text-xs md:text-sm text-yellow-700 mt-1 break-words",children:"Posts will be generated every 30 seconds. Remember to switch back to a normal schedule after testing!"})]})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Failed to load configuration"})})}const kl=Ao,Sl=So,jn=l.forwardRef(({className:r,...s},t)=>e.jsx(Or,{className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t}));jn.displayName=Or.displayName;const yn=l.forwardRef(({className:r,...s},t)=>e.jsxs(Sl,{children:[e.jsx(jn,{}),e.jsx(Br,{ref:t,className:M("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s})]}));yn.displayName=Br.displayName;const bn=({className:r,...s})=>e.jsx("div",{className:M("flex flex-col space-y-2 text-center sm:text-left",r),...s});bn.displayName="AlertDialogHeader";const vn=({className:r,...s})=>e.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});vn.displayName="AlertDialogFooter";const wn=l.forwardRef(({className:r,...s},t)=>e.jsx(Mr,{ref:t,className:M("text-lg font-semibold",r),...s}));wn.displayName=Mr.displayName;const Nn=l.forwardRef(({className:r,...s},t)=>e.jsx(_r,{ref:t,className:M("text-sm text-muted-foreground",r),...s}));Nn.displayName=_r.displayName;const kn=l.forwardRef(({className:r,...s},t)=>e.jsx(zr,{ref:t,className:M(yt(),r),...s}));kn.displayName=zr.displayName;const Sn=l.forwardRef(({className:r,...s},t)=>e.jsx(qr,{ref:t,className:M(yt({variant:"outline"}),"mt-2 sm:mt-0",r),...s}));Sn.displayName=qr.displayName;function An({className:r,classNames:s,showOutsideDays:t=!0,...a}){return e.jsx(Co,{showOutsideDays:t,className:M("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:M(yt({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:M(yt({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...n})=>e.jsx(Po,{className:"h-4 w-4"}),IconRight:({...n})=>e.jsx(Gt,{className:"h-4 w-4"})},...a})}An.displayName="Calendar";const Al=Ro,Cl=Io,Cn=l.forwardRef(({className:r,align:s="center",sideOffset:t=4,...a},n)=>e.jsx(To,{children:e.jsx(Wr,{ref:n,align:s,sideOffset:t,className:M("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})}));Cn.displayName=Wr.displayName;const Pn=({open:r,onOpenChange:s,onSubmit:t,profileId:a,availableProfiles:n=[]})=>{const[o,d]=l.useState(""),[m,i]=l.useState(a),[h,c]=l.useState("now"),[u,x]=l.useState(),[f,v]=l.useState(""),[T,y]=l.useState(null),[j,g]=l.useState(""),[I,U]=l.useState(!1),[q,Q]=l.useState("none"),[Z,$]=l.useState("");l.useEffect(()=>{a?(i(a),console.log("[CreatePostModal] Selected profile from prop:",a)):n.length>0&&(i(n[0].id),console.log("[CreatePostModal] Auto-selected first profile:",n[0].name,n[0].id))},[a,n,r]),l.useEffect(()=>{r&&console.log("[CreatePostModal] Modal opened with:",{availableProfiles:n.length,selectedProfileId:m,profiles:n.map(C=>({id:C.id,name:C.name}))})},[r]);const S=C=>{var ae;const ie=(ae=C.target.files)==null?void 0:ae[0];if(ie){y(ie);const E=new FileReader;E.onload=Y=>{var R;g((R=Y.target)==null?void 0:R.result)},E.readAsDataURL(ie)}},p=()=>{y(null),g("")},b=()=>{const C=new Date;switch(h){case"1hr":return new Date(C.getTime()+60*60*1e3);case"2hr":return new Date(C.getTime()+2*60*60*1e3);case"3hr":return new Date(C.getTime()+3*60*60*1e3);case"custom":if(u&&f){const[ie,ae]=f.split(":").map(Number),E=new Date(u);return E.setHours(ie,ae),E}return null;default:return null}},L=async C=>{if(C.preventDefault(),!(!o.trim()||!m)){U(!0);try{const ie=b(),ae={profileId:m,content:o.trim(),scheduledAt:ie==null?void 0:ie.toISOString(),image:T,status:h==="now"?"published":"scheduled",button:q!=="none"?{type:q,url:Z}:null};await t(ae),d(""),i(a),c("now"),x(void 0),v(""),y(null),g(""),Q("none"),$("")}catch(ie){console.error("Error creating post:",ie)}finally{U(!1)}}};return e.jsx(hs,{open:r,onOpenChange:s,children:e.jsxs(os,{className:"w-[95vw] max-w-[525px] max-h-[90vh] overflow-y-auto",onOpenAutoFocus:C=>C.preventDefault(),children:[e.jsxs(is,{children:[e.jsx(ls,{children:"Create New Post"}),e.jsx(cs,{children:"Create and schedule a post for your business profile"})]}),e.jsxs("form",{onSubmit:L,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"profile",children:"Business Profile"}),n.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-3 border border-dashed rounded-md",children:"No business profiles available. Please connect your Google Business Profile first."}):e.jsxs(De,{value:m||"",onValueChange:C=>{console.log("[CreatePostModal] Profile selected:",C),i(C)},children:[e.jsxs(Ie,{className:"w-full",children:[e.jsx(Ms,{className:"mr-2 h-4 w-4 flex-shrink-0"}),e.jsx(Fe,{placeholder:"Select a business profile"})]}),e.jsx(Ee,{className:"z-[9999]",position:"popper",sideOffset:5,align:"start",children:n.map(C=>e.jsx(G,{value:C.id,children:e.jsxs("div",{className:"flex flex-col py-1",children:[e.jsx("span",{className:"font-medium text-sm",children:C.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.accountName})]})},C.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"content",children:"Post Content"}),e.jsx(lt,{id:"content",placeholder:"What would you like to share with your customers?",value:o,onChange:C=>d(C.target.value),className:"min-h-[80px] sm:min-h-[100px] text-sm",required:!0}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[o.length,"/500 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"Image (Optional)"}),j?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j,alt:"Preview",className:"w-full h-24 sm:h-32 object-cover rounded-lg"}),e.jsx(N,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2 h-6 w-6 p-0",onClick:p,children:e.jsx(ys,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-4 text-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx(Et,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload an image"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(ya,{className:"h-4 w-4"}),"Add Button (Optional)"]}),e.jsxs(De,{value:q,onValueChange:Q,children:[e.jsx(Ie,{className:"w-full",children:e.jsx(Fe,{placeholder:"Select button type"})}),e.jsxs(Ee,{className:"z-[9999]",position:"popper",sideOffset:5,align:"start",children:[e.jsx(G,{value:"none",children:"No Button"}),e.jsx(G,{value:"book",children:"Book"}),e.jsx(G,{value:"order",children:"Order Online"}),e.jsx(G,{value:"buy",children:"Buy"}),e.jsx(G,{value:"learn_more",children:"Learn More"}),e.jsx(G,{value:"sign_up",children:"Sign Up"}),e.jsx(G,{value:"call",children:"Call Now"})]})]})]}),q!=="none"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"buttonUrl",children:"Button URL"}),e.jsx(fe,{id:"buttonUrl",type:"url",placeholder:"https://example.com",value:Z,onChange:C=>$(C.target.value),required:q!=="none"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Where should the button redirect when clicked?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"Schedule"}),e.jsxs(De,{value:h,onValueChange:C=>c(C),children:[e.jsx(Ie,{className:"w-full",children:e.jsx(Fe,{placeholder:"When to publish"})}),e.jsxs(Ee,{className:"z-[9999]",position:"popper",sideOffset:5,align:"start",children:[e.jsx(G,{value:"now",children:"Post Now"}),e.jsx(G,{value:"1hr",children:"In 1 Hour"}),e.jsx(G,{value:"2hr",children:"In 2 Hours"}),e.jsx(G,{value:"3hr",children:"In 3 Hours"}),e.jsx(G,{value:"custom",children:"Custom Date & Time"})]})]})]}),h==="custom"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"Date"}),e.jsxs(Al,{children:[e.jsx(Cl,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:M("w-full justify-start text-left font-normal",!u&&"text-muted-foreground"),children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),u?Xe(u,"PPP"):"Pick a date"]})}),e.jsx(Cn,{className:"w-auto p-0",children:e.jsx(An,{mode:"single",selected:u,onSelect:x,disabled:C=>C<new Date,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"time",children:"Time"}),e.jsx(fe,{id:"time",type:"time",value:f,onChange:C=>v(C.target.value),required:h==="custom"})]})]}),e.jsxs(Xs,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>s(!1),className:"w-full sm:w-auto order-2 sm:order-1",children:"Cancel"}),e.jsx(N,{type:"submit",disabled:I||!o.trim()||!m,className:"bg-primary hover:bg-primary-hover w-full sm:w-auto order-1 sm:order-2",children:I?"Creating...":h==="now"?"Post Now":"Schedule Post"})]})]})]})})},Pl=({profileId:r})=>{const[s,t]=l.useState([]),[a,n]=l.useState(!0),[o,d]=l.useState(!1),[m,i]=l.useState(null),[h,c]=l.useState(!1),[u,x]=l.useState(null),[f,v]=l.useState(!1),{addNotification:T}=ea();l.useEffect(()=>{(async()=>{if(!r){n(!1);return}n(!0);try{console.log("PostsTab: Fetching posts for profileId:",r);const p=(await Se.getLocationPosts(r)).map(b=>({id:b.id,content:b.summary||"",status:"published",postedAt:b.createTime}));console.log("PostsTab: Loaded",p.length,"posts"),t(p),n(!1)}catch(S){console.error("Error fetching posts:",S),t([]),n(!1)}})()},[r]);const y=$=>new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),j=$=>{switch($){case"published":return e.jsx(ee,{variant:"default",className:"bg-success text-success-foreground",children:"Published"});case"scheduled":return e.jsx(ee,{variant:"secondary",className:"bg-warning/10 text-warning border-warning/20",children:"Scheduled"});case"draft":return e.jsx(ee,{variant:"outline",children:"Draft"});default:return e.jsx(ee,{variant:"outline",children:$})}},g=async()=>{if(r)try{const S=(await Se.getLocationPosts(r)).map(p=>({id:p.id,content:p.summary||"",status:"published",postedAt:p.createTime}));t(S)}catch($){console.error("Error refreshing posts:",$)}},I=async $=>{try{console.log("Creating post:",$);const S=`Profile ${r}`;$.scheduledAt?T({type:"post",title:"Post Scheduled",message:`Post scheduled for ${S} at ${new Date($.scheduledAt).toLocaleDateString()}.`,actionUrl:"/posts"}):T({type:"post",title:"Post Created",message:`Post created for ${S} and sent to Google Business Profile.`,actionUrl:"/posts"}),d(!1),i(null),await g(),K({title:"Post Created",description:"Your post has been successfully created and published."})}catch(S){console.error("Error creating post:",S),K({title:"Error",description:"Failed to create post. Please try again.",variant:"destructive"})}},U=$=>{i($),d(!0)},q=async $=>{try{const S={content:$.content,profileId:r};await I(S),K({title:"Post Duplicated",description:"Post has been successfully duplicated."})}catch(S){console.error("Error duplicating post:",S),K({title:"Error",description:"Failed to duplicate post. Please try again.",variant:"destructive"})}},Q=async()=>{if(u){v(!0);try{t($=>$.filter(S=>S.id!==u.id)),T({type:"post",title:"Post Deleted",message:"Post has been successfully deleted.",actionUrl:"/posts"}),K({title:"Post Deleted",description:"Your post has been successfully deleted."}),c(!1),x(null)}catch($){console.error("Error deleting post:",$),K({title:"Error",description:"Failed to delete post. Please try again.",variant:"destructive"})}finally{v(!1)}}},Z=$=>{x($),c(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"shadow-card border-0",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(B,{className:"text-lg sm:text-xl",children:"Posts & Updates"}),e.jsxs(N,{onClick:()=>d(!0),className:"bg-primary hover:bg-primary-hover text-xs sm:text-sm px-2 sm:px-4",size:"sm",children:[e.jsx(qs,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Post"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]})}),e.jsx(k,{children:a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx(St,{size:"lg",variant:"primary"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Loading Posts..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your latest posts from Google Business Profile"})]}),e.jsx("div",{className:"w-full max-w-2xl mt-8 space-y-4",children:Array.from({length:3}).map(($,S)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-16 bg-muted rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-20 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-4 w-4 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-full animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 animate-pulse"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-24 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-3 w-16 bg-muted rounded animate-pulse"})]})]},S))})]}):s.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(rs,{className:"h-10 w-10 sm:h-12 sm:w-12 text-muted-foreground mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 px-4",children:"Create your first post to start engaging with customers"}),e.jsxs(N,{onClick:()=>d(!0),variant:"outline",size:"sm",children:[e.jsx(qs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Create First Post"}),e.jsx("span",{className:"sm:hidden",children:"Create Post"})]})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:s.map($=>e.jsxs("div",{className:"border rounded-lg p-3 sm:p-4 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[j($.status),$.scheduledAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:y($.scheduledAt)}),e.jsx("span",{className:"sm:hidden",children:new Date($.scheduledAt).toLocaleDateString()})]}),$.postedAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(rs,{className:"h-3 w-3"}),e.jsxs("span",{className:"hidden sm:inline",children:["Posted ",y($.postedAt)]}),e.jsx("span",{className:"sm:hidden",children:new Date($.postedAt).toLocaleDateString()})]})]}),e.jsxs(Xt,{children:[e.jsx(Zt,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Yr,{className:"h-4 w-4"})})}),e.jsxs(wt,{align:"end",children:[e.jsxs(Ze,{onClick:()=>U($),className:"cursor-pointer",children:[e.jsx(ia,{className:"mr-2 h-4 w-4"}),"Edit Post"]}),e.jsxs(Ze,{onClick:()=>q($),className:"cursor-pointer",children:[e.jsx(Jt,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),e.jsxs(Ze,{onClick:()=>Z($),className:"text-destructive cursor-pointer focus:text-destructive",children:[e.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[$.imageUrl&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:$.imageUrl,alt:"Post image",className:"w-12 h-12 sm:w-16 sm:h-16 object-cover rounded-md"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm leading-relaxed break-words",children:$.content})})]})]},$.id))})})]}),e.jsx(Pn,{open:o,onOpenChange:$=>{d($),$||i(null)},onSubmit:I,profileId:r,editingPost:m}),e.jsx(kl,{open:h,onOpenChange:c,children:e.jsxs(yn,{children:[e.jsxs(bn,{children:[e.jsx(wn,{children:"Delete Post"}),e.jsx(Nn,{children:"Are you sure you want to delete this post? This action cannot be undone and the post will be permanently removed from your Google Business Profile."})]}),e.jsxs(vn,{children:[e.jsx(Sn,{children:"Cancel"}),e.jsx(kn,{onClick:Q,disabled:f,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:f?"Deleting...":"Delete Post"})]})]})})]})},Tl=({profileId:r})=>{var $,S;const{currentUser:s}=Ye(),[t,a]=l.useState([]),[n,o]=l.useState(!0),[d,m]=l.useState(!1),[i,h]=l.useState(!1),[c,u]=l.useState(0),[x,f]=l.useState(!1),{addNotification:v}=ea(),[T,y]=l.useState({enabled:!1,autoReplyEnabled:!1,replyTemplate:"",minRating:void 0,maxRating:void 0}),j=async(p=!1)=>{if(!r){o(!1);return}p?m(!0):o(!0);try{console.log("ReviewsTab: Fetching reviews for profileId:",r);const b=await Se.getLocationReviews(`locations/${r}`,p?{forceRefresh:!0}:{});console.log("ReviewsTab: Raw review data from API:",b);const L=b.map(C=>{var ae,E,Y;const ie=C.name?C.name.split("/").pop():C.id;return console.log("ReviewsTab: Processing review:",{name:C.name,extractedId:ie,id:C.id,author:C.reviewer.displayName,rating:C.starRating,hasReply:!!C.reply,replyContent:(ae=C.reply)==null?void 0:ae.comment}),{id:ie,fullReviewName:C.name,author:C.reviewer.displayName,rating:C.starRating,content:C.comment||"",createdAt:C.createTime,replied:!!C.reply,replyContent:(E=C.reply)==null?void 0:E.comment,repliedAt:(Y=C.reply)==null?void 0:Y.updateTime}});if(console.log("ReviewsTab: Loaded",L.length,"reviews with replies:",L.filter(C=>C.replied).length),L.length>c&&c>0){const C=L.length-c;console.log(`🆕 Detected ${C} new reviews!`),v({type:"review",title:`${C} New Review${C>1?"s":""}!`,message:`You have received ${C} new customer review${C>1?"s":""}`,actionUrl:`/dashboard/profiles/${r}?tab=reviews`,metadata:{profileId:r,newReviewsCount:C}}),K({title:"New Review Received! 🌟",description:`You have ${C} new customer review${C>1?"s":""}`})}a(L),u(L.length),p&&!i&&K({title:"Reviews Refreshed",description:`Loaded ${L.length} reviews from Google Business Profile`})}catch(b){console.error("Error fetching reviews:",b),a([]),K({title:"Error Loading Reviews",description:"Failed to fetch reviews from Google Business Profile",variant:"destructive"})}finally{o(!1),m(!1)}};l.useEffect(()=>{g(),j();const p=setInterval(()=>{i&&(console.log("🔄 Auto-polling for new reviews..."),j(!0))},3e4);return h(!0),()=>{clearInterval(p)}},[r,i]);const g=()=>{const p=pt.getConfiguration(r);p&&y({enabled:p.enabled,autoReplyEnabled:p.autoReplyEnabled,replyTemplate:p.replyTemplate||"",minRating:p.minRating,maxRating:p.maxRating})},I=async p=>{var L;const b={...T,...p};if(y(b),pt.saveConfiguration({locationId:r,businessName:"Current Location",enabled:b.enabled,autoReplyEnabled:b.autoReplyEnabled,replyTemplate:b.replyTemplate,minRating:b.minRating,maxRating:b.maxRating}),b.autoReplyEnabled){f(!0);try{const C=localStorage.getItem("google_business_account_id"),ie=localStorage.getItem("google_business_name")||"Current Location",ae=Re.getConfiguration(r),E=ae!=null&&ae.keywords?Array.isArray(ae.keywords)?ae.keywords.join(", "):ae.keywords:"",Y=((L=ae==null?void 0:ae.categories)==null?void 0:L[0])||"";await Ls.enableAutoReply(r,ie,!0,s==null?void 0:s.uid,C||void 0,E,Y),K({title:"Review Settings Saved",description:"Auto-reply will continue running even when you're offline.",duration:4e3})}catch(C){console.error("Failed to save to server:",C),K({title:"Server sync failed",description:"Settings saved locally but server sync failed. Auto-reply may not work when offline.",variant:"destructive",duration:5e3})}finally{f(!1)}}else try{await Ls.disableAutoReply(r),K({title:"Review Settings Saved",description:"Auto-reply has been disabled."})}catch(C){console.error("Failed to disable on server:",C),K({title:"Review Settings Saved",description:"Your review automation settings have been updated."})}},U=async(p,b,L,C)=>{try{console.log("Auto-replying to review:",{reviewId:p,reviewContent:b,reviewerName:L,rating:C});const ie=pt.getConfiguration(r);let ae;ie!=null&&ie.replyTemplate&&ie.replyTemplate.trim()?ae=ie.replyTemplate.replace(/\{businessName\}/g,"Our Business").replace(/\{reviewerName\}/g,L).replace(/\{rating\}/g,C.toString()).replace(/\{comment\}/g,b):ae=await pt.generateAIReply({reviewText:b,reviewerName:L,rating:C,businessName:"Our Business",locationId:r}),console.log("Generated reply text:",ae);const E=t.find(R=>R.id===p),Y=E==null?void 0:E.fullReviewName;if(!Y)throw new Error("Review name not available. Please refresh the reviews list.");console.log("ReviewsTab: Sending reply with full review name:",Y),await Se.replyToReview(Y,ae),await j(!0),v({type:"reply",title:"AI Reply Posted",message:`Successfully replied to ${L}'s ${C}-star review with AI-generated response`,actionUrl:`/dashboard/profiles/${r}?tab=reviews`,metadata:{profileId:r,reviewId:p,reviewerName:L,rating:C,replyText:ae.substring(0,100)}}),K({title:"AI Reply Sent Successfully",description:"Your personalized AI-generated reply has been posted"}),console.log("AI reply sent successfully!")}catch(ie){console.error("Error replying to review:",ie),K({title:"Failed to Send Reply",description:ie instanceof Error?ie.message:"Please try again",variant:"destructive"})}},q=p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Q=p=>Array.from({length:5}).map((b,L)=>e.jsx(us,{className:M("h-4 w-4",L<p?"fill-yellow-400 text-yellow-400":"text-muted-foreground")},L)),Z=p=>p.split(" ").map(b=>b[0]).join("").toUpperCase();return e.jsxs(et,{defaultValue:"reviews",className:"w-full",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-2",children:[e.jsx(Ue,{value:"reviews",className:"text-xs sm:text-sm",children:"Customer Reviews"}),e.jsx(Ue,{value:"automation",className:"text-xs sm:text-sm",children:"Auto-Reply Settings"})]}),e.jsx(Le,{value:"reviews",className:"space-y-4",children:e.jsxs(w,{className:"shadow-card border-0",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(B,{className:"text-lg sm:text-xl",children:"Customer Reviews"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>j(!0),disabled:d,className:"gap-1 sm:gap-2",children:[e.jsx(Me,{className:M("h-3 w-3",d&&"animate-spin")}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Refresh"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:M("h-2 w-2 rounded-full",i?"bg-green-500 animate-pulse":"bg-gray-400")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i?"Live":"Offline"})]}),e.jsxs(ee,{variant:"secondary",className:"bg-primary/10 text-primary text-xs",children:[t.length," Total Reviews"]})]})]})}),e.jsx(k,{children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx(St,{size:"lg",variant:"primary"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Loading Reviews..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your latest customer reviews from Google Business Profile"})]}),e.jsx("div",{className:"w-full max-w-2xl mt-8 space-y-4",children:Array.from({length:3}).map((p,b)=>e.jsx("div",{className:"border-b border-border pb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 animate-pulse"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:5}).map((L,C)=>e.jsx("div",{className:"h-4 w-4 bg-muted rounded animate-pulse"},C))})]}),e.jsx("div",{className:"h-3 bg-muted rounded w-full animate-pulse"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4 animate-pulse"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2 animate-pulse"})]})]})},b))})]}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(us,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No reviews yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Customer reviews will appear here once you receive them"})]}):e.jsx("div",{className:"space-y-4 sm:space-y-6",children:t.map((p,b)=>e.jsx("div",{className:M("pb-4 sm:pb-6",b<t.length-1&&"border-b border-border"),children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx(Nt,{className:"h-8 w-8 sm:h-10 sm:w-10 flex-shrink-0",children:e.jsx(kt,{className:"bg-primary/10 text-primary text-xs sm:text-sm",children:Z(p.author)})}),e.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-sm sm:text-base truncate",children:p.author}),e.jsx("div",{className:"flex items-center gap-0.5 sm:gap-1",children:Q(p.rating)})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(rs,{className:"h-3 w-3"}),q(p.createdAt)]})]}),!p.replied&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>U(p.id,p.content,p.author,p.rating),className:"gap-1 sm:gap-2 w-full sm:w-auto text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(la,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Reply with AI"}),e.jsx("span",{className:"sm:hidden",children:"AI Reply"})]})]}),e.jsx("p",{className:"text-xs sm:text-sm leading-relaxed break-words",children:p.content}),p.replied&&p.replyContent&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2 sm:p-3 ml-0 sm:ml-4 border-l-2 border-primary/20",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2 mb-2",children:[e.jsx(Es,{className:"h-3 w-3 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-primary",children:"Your Reply"}),p.repliedAt&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• ",q(p.repliedAt)]})]}),e.jsx("p",{className:"text-xs sm:text-sm break-words",children:p.replyContent})]})]})]})},p.id))})})]})}),e.jsx(Le,{value:"automation",className:"space-y-4",children:e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(Eo,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"text-base sm:text-lg",children:"Review Auto-Reply Settings"})]})}),e.jsxs(k,{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{className:"text-sm sm:text-base",children:"Enable Review Automation"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Monitor and automatically reply to customer reviews"})]}),e.jsx(ts,{checked:T.enabled,onCheckedChange:p=>I({enabled:p})})]}),T.enabled&&e.jsxs(e.Fragment,{children:[e.jsx(Gs,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(oe,{children:"Auto-Reply to Reviews"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically generate and post replies using AI"})]}),e.jsx(ts,{checked:T.autoReplyEnabled,onCheckedChange:p=>I({autoReplyEnabled:p})})]}),T.autoReplyEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"Reply to reviews with rating from:"}),e.jsxs(De,{value:(($=T.minRating)==null?void 0:$.toString())||"any",onValueChange:p=>I({minRating:p==="any"?void 0:parseInt(p)}),children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Any rating"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"any",children:"Any rating"}),e.jsx(G,{value:"1",children:"1 star and above"}),e.jsx(G,{value:"2",children:"2 stars and above"}),e.jsx(G,{value:"3",children:"3 stars and above"}),e.jsx(G,{value:"4",children:"4 stars and above"}),e.jsx(G,{value:"5",children:"5 stars only"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"To:"}),e.jsxs(De,{value:((S=T.maxRating)==null?void 0:S.toString())||"any",onValueChange:p=>I({maxRating:p==="any"?void 0:parseInt(p)}),children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Any rating"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"any",children:"Any rating"}),e.jsx(G,{value:"1",children:"1 star only"}),e.jsx(G,{value:"2",children:"2 stars and below"}),e.jsx(G,{value:"3",children:"3 stars and below"}),e.jsx(G,{value:"4",children:"4 stars and below"}),e.jsx(G,{value:"5",children:"5 stars and below"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{children:"Custom Reply Template (Optional)"}),e.jsx(lt,{placeholder:"Leave blank to use AI-generated replies. Use {businessName}, {reviewerName}, {rating}, {comment} as placeholders.",value:T.replyTemplate,onChange:p=>y(b=>({...b,replyTemplate:p.target.value})),onBlur:()=>I({replyTemplate:T.replyTemplate}),rows:3}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["If empty, AI will generate personalized replies. Use placeholders like ","{businessName}",", ","{reviewerName}",", ","{rating}",", ","{comment}","."]})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4"}),"How it works:"]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Reviews are checked every minute for new reviews"}),e.jsx("li",{children:"• Only reviews matching your criteria will get replies"}),e.jsx("li",{children:"• AI generates personalized, professional responses"}),e.jsx("li",{children:"• Reviews that already have replies are skipped"})]})]})]})]})]})]})})]})},Rl=({profileId:r})=>{const[s,t]=l.useState([]),[a,n]=l.useState(!0),[o,d]=l.useState(null);l.useState(!1),l.useState(""),l.useState([]),l.useState(!1),l.useRef(null),l.useEffect(()=>{m()},[r]);const m=async()=>{try{n(!0),d(null),console.log("📸 Loading photos for location:",r);const h=await Se.getLocationPhotos(r);console.log("📸 Received photos data:",h),t(h),h.length===0&&d("No photos found for this location. Photos can be added via Google Business Profile manager.")}catch(h){console.error("Failed to load photos:",h),d("Failed to load photos. Please check your connection and try again.")}finally{n(!1)}},i=()=>{m()};return e.jsx("div",{className:"space-y-6",children:e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"}),"Business Photos",s.length>0&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",s.length," real-time)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(N,{variant:"outline",size:"sm",onClick:i,disabled:a,className:"flex items-center gap-2",children:[e.jsx(Me,{className:`h-4 w-4 ${a?"animate-spin":""}`}),"Refresh"]})})]})}),e.jsxs(k,{children:[a&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Me,{className:"h-5 w-5 animate-spin"}),"Loading photos from Google Business Profile..."]})}),o&&!a&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Ve,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Photos not available"}),e.jsx("p",{className:"text-yellow-700 text-sm",children:o}),e.jsx(N,{variant:"outline",size:"sm",onClick:i,className:"mt-2",children:"Try Again"})]})]}),!a&&!o&&s.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map(h=>e.jsxs(w,{className:"overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:h.thumbnailUrl||h.url,alt:`Business photo - ${h.category}`,className:"w-full h-full object-cover transition-transform group-hover:scale-105",onError:c=>{const u=c.target;u.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiNGM0Y0RjYiLz48cGF0aCBkPSJNMTUwIDEyMEMyNi4xNSAxMjAgMTA1IDEzOC44NSAxMDUgMTYyQzEwNSAxODUuMTUgMTI2LjE1IDIwNCAxNTAgMjA0QzE3My44NSAyMDQgMTk1IDE4NS4xNSAxOTUgMTYyQzE5NSAxMzguODUgMTczLjg1IDEyMCAxNTAgMTIwWiIgZmlsbD0iIzlDQTNBRiIvPjwvc3ZnPg=="}}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx(N,{size:"sm",variant:"secondary",className:"mr-2",onClick:()=>window.open(h.url,"_blank"),children:e.jsx(Do,{className:"h-4 w-4"})})})]}),e.jsxs(k,{className:"p-3",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:h.category.replace("_"," ").toLowerCase().replace(/^\w/,c=>c.toUpperCase())}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.mediaFormat," • ",new Date(h.createTime).toLocaleDateString()]}),h.dimensions.width>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.dimensions.width," × ",h.dimensions.height]})]})]},h.id))}),!a&&!o&&s.length===0&&e.jsxs("div",{className:"mt-6 p-6 border-2 border-dashed border-muted rounded-lg text-center",children:[e.jsx(Pa,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Photos Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This location doesn't have any photos yet. Add photos via Google Business Profile manager to see them here."}),e.jsxs(N,{onClick:i,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Check Again"]})]})]})]})})},Il=({profileId:r})=>{const[s,t]=l.useState(!1),[a,n]=l.useState(!1),[o,d]=l.useState(!0),[m,i]=l.useState(null),{accounts:h}=Fs(),{toast:c}=ss(),[u,x]=l.useState({businessName:"",description:"",phone:"",website:"",address:"",hours:{monday:"",tuesday:"",wednesday:"",thursday:"",friday:"",saturday:"",sunday:""}});l.useEffect(()=>{(()=>{var I;if(!r||!h.length){d(!1);return}let g=null;for(const U of h)if(g=U.locations.find(q=>q.locationId===r)||null,g)break;if(g){i(g);const U=[];(I=g.address.addressLines)!=null&&I.length&&U.push(...g.address.addressLines),g.address.locality&&U.push(g.address.locality),g.address.administrativeArea&&U.push(g.address.administrativeArea),g.address.postalCode&&U.push(g.address.postalCode),x({businessName:g.displayName||"",description:"",phone:g.phoneNumber||"",website:g.websiteUrl||"",address:U.join(", "),hours:{monday:"",tuesday:"",wednesday:"",thursday:"",friday:"",saturday:"",sunday:""}})}d(!1)})()},[r,h]);const f=(j,g)=>{x(I=>({...I,[j]:g}))},v=(j,g)=>{x(I=>({...I,hours:{...I.hours,[j]:g}}))},T=async()=>{if(!m){c({title:"Error",description:"No location data available",variant:"destructive"});return}n(!0);try{const j="http://localhost:5000",g={displayName:u.businessName,phoneNumber:u.phone,websiteUrl:u.website},I=await fetch(`${j}/api/locations/${r}/update`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(I.ok){const U=await I.json();i(q=>q?{...q,displayName:u.businessName,phoneNumber:u.phone,websiteUrl:u.website}:null),t(!1),c({title:"Profile Updated",description:"Your business profile has been successfully updated."})}else{const U=await I.json();throw new Error(U.message||"Failed to update profile")}}catch(j){console.error("Error updating profile:",j),c({title:"Update Failed",description:j instanceof Error?j.message:"Failed to update profile. Please try again.",variant:"destructive"})}finally{n(!1)}},y=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];return o?e.jsx("div",{className:"space-y-6",children:e.jsx(w,{children:e.jsx(k,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(zt,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading profile data..."})]})})})}):m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"h-5 w-5"}),"Edit Profile Information"]}),e.jsx(N,{onClick:()=>s?T():t(!0),disabled:a,className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):s?e.jsxs(e.Fragment,{children:[e.jsx(Fo,{className:"h-4 w-4"}),"Save Changes"]}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"h-4 w-4"}),"Edit Profile"]})})]})}),e.jsx(k,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"businessName",children:"Business Name"}),e.jsx(fe,{id:"businessName",value:u.businessName,onChange:j=>f("businessName",j.target.value),disabled:!s})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(fe,{id:"phone",value:u.phone,onChange:j=>f("phone",j.target.value),disabled:!s})]})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"website",children:"Website"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ba,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(fe,{id:"website",value:u.website,onChange:j=>f("website",j.target.value),disabled:!s})]})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"address",children:"Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(fe,{id:"address",value:u.address,onChange:j=>f("address",j.target.value),disabled:!s})]})]})]}),e.jsxs("div",{children:[e.jsx(oe,{htmlFor:"description",children:"Business Description"}),e.jsx(lt,{id:"description",value:u.description,onChange:j=>f("description",j.target.value),disabled:!s,rows:8,placeholder:"Describe your business, services, and what makes you unique..."})]})]})})]}),e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Business Hours"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:y.map(j=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(oe,{className:"w-24 capitalize",children:j}),e.jsx(fe,{value:u.hours[j],onChange:g=>v(j,g.target.value),disabled:!s,placeholder:"e.g., 9:00 AM - 6:00 PM or Closed",className:"flex-1"})]},j))})})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(w,{children:e.jsx(k,{className:"py-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Profile not found or access denied."})})})})},El=()=>{const{profileId:r}=Vr(),s=_e(),[t,a]=l.useState(null),[n,o]=l.useState(!0),[d,m]=l.useState(null),[i,h]=l.useState(!1),{accounts:c,isLoading:u}=Fs(),{getAccessibleAccounts:x}=dt(),f=v=>v.categoriesFormatted&&Array.isArray(v.categoriesFormatted)?v.categoriesFormatted:[];return l.useEffect(()=>{const v=()=>{if(console.log("ProfileDetails: Looking for profileId:",r),console.log("ProfileDetails: Available accounts:",c),!r||!c.length){o(!1);return}const y=x(c);let j=null,g=!1;for(const I of y){const U=I.locations.find(q=>q.locationId===r);if(U){j=U;break}}if(!j){for(const I of c)if(!y.includes(I)&&I.locations.find(q=>q.locationId===r)){g=!0;break}}console.log("ProfileDetails: Found location:",j),console.log("ProfileDetails: Found in inaccessible account:",g),a(j),h(g),o(!1)},T=()=>{const y=Re.getGlobalStats();m(y)};u||(v(),T())},[r,c,u]),n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-8 bg-muted rounded w-64 animate-pulse"})]}),e.jsx("div",{className:"h-48 bg-muted rounded animate-pulse"})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(ke,{to:"/dashboard",children:e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})})}),e.jsx(w,{className:"border-orange-200 bg-orange-50",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(as,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-2",children:"Profile Access Restricted"}),e.jsx("p",{className:"text-orange-800 mb-4",children:"This business profile requires an Enterprise plan to access. Your current plan allows access to 1 profile only."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{onClick:()=>s("/dashboard/billing"),className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Upgrade to Access All Profiles"]}),e.jsx(ke,{to:"/dashboard",children:e.jsx(N,{variant:"outline",children:"View Available Profiles"})})]})]})]})})})]}):t?e.jsxs("div",{className:"space-y-3 sm:space-y-4 md:space-y-6 animate-fade-in min-w-0 w-full overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx(ke,{to:"/dashboard",children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 sm:h-10 sm:w-10 p-0 sm:p-2",children:e.jsx(Ks,{className:"h-4 w-4"})})}),e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold tracking-tight truncate",children:t.displayName})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 md:gap-6",children:[e.jsxs(w,{className:"shadow-sm",children:[e.jsx(O,{children:e.jsx(B,{className:"text-sm sm:text-base md:text-lg",children:"Profile Overview"})}),e.jsxs(k,{className:"space-y-2 sm:space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx(as,{className:"h-3 w-3 sm:h-4 sm:w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-[11px] sm:text-xs md:text-sm break-words leading-snug flex-1",children:t.address.addressLines.length>0?`${t.address.addressLines.join(", ")}, ${t.address.locality}`:t.address.locality||"No address available"})]}),t.websiteUrl&&e.jsxs("div",{className:"flex items-start gap-1.5 sm:gap-2",children:[e.jsx(ba,{className:"h-3 w-3 sm:h-4 sm:w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsxs("a",{href:t.websiteUrl,target:"_blank",rel:"noopener noreferrer",className:"text-[11px] sm:text-xs md:text-sm text-primary hover:text-primary-hover flex items-center gap-1 break-all flex-1 min-w-0",children:[e.jsx("span",{className:"truncate",children:t.websiteUrl}),e.jsx(pa,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 flex-shrink-0"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 max-w-full",children:f(t).map(v=>e.jsx(ee,{variant:"secondary",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 whitespace-nowrap leading-tight",children:v.name},v.name))})]})]}),d&&e.jsxs(w,{className:"shadow-sm",children:[e.jsx(O,{children:e.jsxs(B,{className:"flex items-center gap-1.5 sm:gap-2 text-sm sm:text-base md:text-lg",children:[e.jsx(Is,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 md:h-5 md:w-5"}),e.jsx("span",{className:"text-xs sm:text-sm md:text-base",children:"Today's Statistics"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[e.jsx(w,{className:"border border-green-200 bg-green-50",children:e.jsxs(k,{className:"p-2 sm:p-3 md:p-4 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-green-600",children:d.successfulPostsToday}),e.jsx("div",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground leading-tight",children:"Successful"})]})}),e.jsx(w,{className:"border border-red-200 bg-red-50",children:e.jsxs(k,{className:"p-2 sm:p-3 md:p-4 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-red-600",children:d.failedPostsToday}),e.jsx("div",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground leading-tight",children:"Failed"})]})}),e.jsx(w,{className:"border border-blue-200 bg-blue-50",children:e.jsxs(k,{className:"p-2 sm:p-3 md:p-4 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-blue-600",children:d.activeConfigurations}),e.jsx("div",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground leading-tight",children:"Active"})]})}),e.jsx(w,{className:"border border-gray-200 bg-gray-50",children:e.jsxs(k,{className:"p-2 sm:p-3 md:p-4 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-700",children:d.totalPostsToday}),e.jsx("div",{className:"text-[10px] sm:text-xs md:text-sm text-muted-foreground leading-tight",children:"Total"})]})})]})})]})]}),e.jsxs(et,{defaultValue:"auto-posting",className:"space-y-3 sm:space-y-4 md:space-y-6",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 h-auto gap-0.5 sm:gap-1 p-0.5 sm:p-1",children:[e.jsx(Ue,{value:"auto-posting",className:"text-[10px] sm:text-xs md:text-sm px-1 sm:px-2 md:px-3 py-1.5 sm:py-2 data-[state=active]:text-[10px] sm:data-[state=active]:text-xs md:data-[state=active]:text-sm",children:"Auto Posting"}),e.jsx(Ue,{value:"posts",className:"text-[10px] sm:text-xs md:text-sm px-1 sm:px-2 md:px-3 py-1.5 sm:py-2",children:"Posts"}),e.jsx(Ue,{value:"reviews",className:"text-[10px] sm:text-xs md:text-sm px-1 sm:px-2 md:px-3 py-1.5 sm:py-2",children:"Reviews"}),e.jsx(Ue,{value:"photos",className:"text-[10px] sm:text-xs md:text-sm px-1 sm:px-2 md:px-3 py-1.5 sm:py-2",children:"Photos"}),e.jsx(Ue,{value:"edit",className:"text-[10px] sm:text-xs md:text-sm px-1 sm:px-2 md:px-3 py-1.5 sm:py-2",children:"Edit Profile"})]}),e.jsx(Le,{value:"auto-posting",children:e.jsx(Nl,{location:{id:t.locationId,name:t.displayName,categories:f(t).map(v=>v.name),websiteUri:t.websiteUrl,phoneNumber:t.phoneNumber,address:t.address}})}),e.jsx(Le,{value:"posts",children:e.jsx(Pl,{profileId:t.locationId})}),e.jsx(Le,{value:"reviews",children:e.jsx(Tl,{profileId:t.locationId})}),e.jsx(Le,{value:"photos",children:e.jsx(Rl,{profileId:t.locationId})}),e.jsx(Le,{value:"edit",children:e.jsx(Il,{profileId:t.locationId})})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Location Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The requested business location could not be found."}),e.jsx(ke,{to:"/dashboard",children:e.jsxs(N,{variant:"outline",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})})]})})},Dl=()=>{const[r,s]=l.useState([]),[t,a]=l.useState(!0),[n,o]=l.useState(!1),[d,m]=l.useState(""),[i,h]=l.useState("all"),[c,u]=l.useState("all"),{accounts:x,isConnected:f,isLoading:v}=Fs(),{addNotification:T}=ea(),y=_e(),{isFeatureBlocked:j,status:g}=Je(),{getAccessibleAccounts:I,getAccountLockMessage:U,canAccessMultipleProfiles:q}=dt(),Q=l.useMemo(()=>I(x),[x,I]),Z=l.useMemo(()=>U(x.length),[x.length,U]),$=l.useMemo(()=>!q&&x.length>1,[q,x.length]);l.useEffect(()=>{const E=async()=>{if(v){a(!0);return}if(!f||!Q.length){s([]),a(!1);return}a(!0);try{console.log("Posts: Fetching posts across all profiles (PARALLEL LOADING)");const Y=Q.flatMap(xe=>xe.locations.map(W=>({account:xe,location:W,task:async()=>{try{console.log(`📍 Posts: Processing location - "${W.displayName}"`);const V=new AbortController,de=setTimeout(()=>V.abort(),6e3),pe=await Se.getLocationPosts(W.locationId);return clearTimeout(de),console.log(`📍 Posts: Received ${pe.length} posts for ${W.displayName}`),pe.map(Ke=>({id:Ke.id,profileId:W.locationId,profileName:W.displayName,content:Ke.summary||"",status:"published",postedAt:Ke.createTime}))}catch(V){return console.warn(`⚠️ Failed to fetch posts for ${W.displayName}:`,V),[]}}})));console.log(`🚀 Starting parallel loading of posts for ${Y.length} locations`);const R=Date.now(),X=Y.map(({task:xe})=>xe()),le=await Promise.allSettled(X),H=[];le.forEach((xe,W)=>{xe.status==="fulfilled"?H.push(...xe.value):console.warn(`Location ${W} failed:`,xe.reason)});const J=Date.now()-R;console.log(`✅ Parallel loading completed in ${J}ms: Loaded ${H.length} posts from ${Y.length} locations`),s(H),a(!1)}catch(Y){console.error("Error fetching posts:",Y),s([]),a(!1)}};a(!0),E()},[Q,f,v]);const S=E=>new Date(E).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),p=E=>{switch(E){case"published":return e.jsx(ee,{variant:"default",className:"bg-success text-success-foreground",children:"Published"});case"scheduled":return e.jsx(ee,{variant:"secondary",className:"bg-warning/10 text-warning border-warning/20",children:"Scheduled"});case"draft":return e.jsx(ee,{variant:"outline",children:"Draft"});case"failed":return e.jsx(ee,{variant:"destructive",children:"Failed"});default:return e.jsx(ee,{variant:"outline",children:E})}},b=Q.flatMap(E=>E.locations.map(Y=>({id:Y.locationId,name:Y.displayName,accountName:E.accountName}))),L=r.filter(E=>{const Y=E.content.toLowerCase().includes(d.toLowerCase())||E.profileName.toLowerCase().includes(d.toLowerCase()),R=i==="all"||E.status===i,X=c==="all"||E.profileId===c;return Y&&R&&X}),C=async E=>{try{console.log("Creating post:",E);const Y=Q.flatMap(J=>J.locations).find(J=>J.locationId===E.profileId);if(!Y)throw new Error("Selected location not found");const R=await Se.createLocationPost(Y.locationId,{summary:E.content,topicType:"STANDARD",callToAction:E.callToAction});console.log("Post created successfully:",R);const X=R.status||R.state||"pending",le=R.realTime||!1,H={id:R.id,profileId:Y.locationId,profileName:Y.displayName,content:R.summary||"",status:X==="PENDING"||X==="UNDER_REVIEW"?"scheduled":X==="LIVE"?"published":"draft",postedAt:R.createTime,scheduledAt:X==="PENDING"?R.createTime:void 0};s(J=>[H,...J]),o(!1),T(le?X==="PENDING"||X==="UNDER_REVIEW"?{type:"post",title:"Post Sent for Review",message:`Post for "${Y.displayName}" has been sent to Google Business Profile for review.`,actionUrl:"/posts"}:X==="LIVE"?{type:"post",title:"Post Published!",message:`Your post for "${Y.displayName}" is now live on Google Business Profile.`,actionUrl:"/posts"}:{type:"post",title:"Post Created",message:`Post for "${Y.displayName}" has been created successfully.`,actionUrl:"/posts"}:{type:"post",title:"Post Drafted",message:`Post for "${Y.displayName}" has been drafted locally due to API restrictions.`,actionUrl:"/posts"}),alert(le?X==="PENDING"||X==="UNDER_REVIEW"?`🎉 Post successfully submitted to Google Business Profile!

📋 Status: ${X}

⏳ Your post is now under Google's review and will appear on your Business Profile once approved. This usually takes a few minutes to a few hours.`:X==="LIVE"?`🎉 Post published successfully to Google Business Profile! 

✅ Your post is now LIVE and visible to customers on Google!`:`🎉 Post submitted to Google Business Profile!

📋 Status: ${X}

${R.message||"Your post has been processed by Google."}`:X==="SIMULATED"?`⚠️ Google Business Profile Posts API Restriction

🔒 Google has restricted access to the Posts API. Your post was saved locally but not submitted to Google Business Profile.

💡 To post to your Google Business Profile:
• Use Google Business Profile Manager directly
• Or contact Google for API access approval

📝 Post content: "${E.content}"`:`🎉 Post created successfully! 

⚠️ Note: This was processed locally due to API restrictions.

${R.warning||""}`)}catch(Y){console.error("Error creating post:",Y);let R="Failed to create post. Please try again.";Y instanceof Error&&(Y.message.includes("fetch")?R="Network error. Please check your connection and try again.":Y.message.includes("Access token")?R="Authentication error. Please reconnect your Google Business Profile.":Y.message.includes("API")?R=`API Error: ${Y.message}`:R=`Error: ${Y.message}`),alert(`❌ ${R}

💡 If this continues, try:
• Checking your internet connection
• Reconnecting your Google Business Profile
• Refreshing the page`)}},ae={all:r.length,published:r.filter(E=>E.status==="published").length,scheduled:r.filter(E=>E.status==="scheduled").length,draft:r.filter(E=>E.status==="draft").length};return j||g==="none"?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[500px] text-center space-y-6",children:e.jsxs("div",{className:"bg-red-950/30 border-2 border-red-500/50 rounded-2xl p-8 max-w-2xl w-full backdrop-blur-sm",children:[e.jsx(Ve,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:g==="none"?"No Subscription - Upgrade Required":"Trial Expired - Upgrade Required"}),e.jsx("p",{className:"text-red-300/90 mb-6 text-lg",children:g==="none"?"You need an active subscription to access this feature. Start your 15-day free trial or upgrade now to create and manage posts.":"Your 15-day trial has expired. Upgrade now to create and manage posts for your Google Business Profiles."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:()=>y("/dashboard/billing"),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg w-full",size:"lg",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),g==="none"?"Start Free Trial":"Upgrade Now"]}),e.jsx("p",{className:"text-sm text-red-400/80",children:"Starting from ₹1,099/month • Unlimited Profiles • All Features"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold tracking-tight",children:"Posts"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:"Manage posts across all your business profiles"})]}),e.jsxs(N,{onClick:()=>o(!0),className:"bg-primary hover:bg-primary-hover shadow-primary w-full sm:w-auto",size:"sm",disabled:j||g==="none",children:[e.jsx(qs,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Create Post"})]})]}),$&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_s,{className:"h-5 w-5 text-orange-600 mt-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Multiple Profiles Available"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:Z}),e.jsx(N,{onClick:()=>y("/dashboard/billing"),size:"sm",className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Upgrade to Access All Profiles"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:ae.all}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Posts"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:ae.published}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Published"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:ae.scheduled}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Scheduled"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:ae.draft}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Drafts"})]})})]}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(fe,{placeholder:"Search posts...",value:d,onChange:E=>m(E.target.value),className:"pl-10"})]}),e.jsxs(De,{value:c,onValueChange:u,children:[e.jsxs(Ie,{className:"w-full sm:w-64",children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Select business profile"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Profiles"}),b.map(E=>e.jsx(G,{value:E.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:E.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E.accountName})]})},E.id))]})]}),e.jsxs(De,{value:i,onValueChange:h,children:[e.jsxs(Ie,{className:"w-full sm:w-48",children:[e.jsx(qt,{className:"mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Filter by status"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Status"}),e.jsx(G,{value:"published",children:"Published"}),e.jsx(G,{value:"scheduled",children:"Scheduled"}),e.jsx(G,{value:"draft",children:"Draft"}),e.jsx(G,{value:"failed",children:"Failed"})]})]})]})})}),e.jsxs(w,{className:"shadow-card border-2 border-border/60",children:[e.jsx(O,{children:e.jsx(B,{children:"All Posts"})}),e.jsx(k,{children:t?e.jsx("div",{className:"space-y-4",children:Array.from({length:10}).map((E,Y)=>e.jsxs("div",{className:"border-2 border-border/60 rounded-lg p-4 animate-pulse shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-6 bg-muted rounded w-20"})]}),e.jsx("div",{className:"h-3 bg-muted rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]},Y))}):L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(rs,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:d||i!=="all"?"No posts found":"No posts yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:d||i!=="all"?"Try adjusting your search or filters":"Create your first post to start engaging with customers"}),!d&&i==="all"&&e.jsxs(N,{onClick:()=>o(!0),variant:"outline",children:[e.jsx(qs,{className:"mr-2 h-4 w-4"}),"Create First Post"]})]}):e.jsx("div",{className:"space-y-4",children:L.map(E=>e.jsxs("div",{className:"border-2 border-border/60 rounded-lg p-4 hover:bg-muted/30 transition-colors shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:E.profileName}),p(E.status),E.scheduledAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ns,{className:"h-3 w-3"}),S(E.scheduledAt)]}),E.postedAt&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(rs,{className:"h-3 w-3"}),"Posted ",S(E.postedAt)]})]}),e.jsxs(Xt,{children:[e.jsx(Zt,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Yr,{className:"h-4 w-4"})})}),e.jsxs(wt,{align:"end",children:[e.jsx(Ze,{children:"Edit Post"}),e.jsx(Ze,{children:"Duplicate"}),e.jsx(Ze,{children:"Reschedule"}),e.jsx(Ze,{className:"text-destructive",children:"Delete"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[E.imageUrl&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:E.imageUrl,alt:"Post image",className:"w-16 h-16 object-cover rounded-md"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm leading-relaxed",children:E.content})})]})]},E.id))})})]})]}),e.jsx(Pn,{open:n,onOpenChange:o,onSubmit:C,profileId:c!=="all"?c:"",availableProfiles:b})]})},xt=[{id:"positive",name:"Positive Review",content:"Thank you so much for your wonderful review! We're thrilled to hear about your positive experience. Your feedback means the world to us and motivates our team to continue providing excellent service. We look forward to serving you again soon!"},{id:"negative",name:"Negative Review",content:"Thank you for taking the time to share your feedback. We sincerely apologize for not meeting your expectations. Your concerns are important to us, and we would appreciate the opportunity to discuss this further and make things right. Please contact us directly so we can address your concerns properly."},{id:"neutral",name:"Neutral Review",content:"Thank you for your review and feedback. We appreciate you taking the time to share your experience with us. We're always working to improve our services and your input helps us do that. We hope to have the opportunity to serve you again and provide an even better experience."},{id:"general",name:"General Response",content:"Thank you for your review! We appreciate your feedback and look forward to serving you better in the future."}],Fl=()=>{const[r,s]=l.useState([]),[t,a]=l.useState(!0),[n,o]=l.useState(!1),[d,m]=l.useState({search:"",rating:"all",reply:"all",location:"all",dateRange:"all",sentiment:"all"}),[i,h]=l.useState({field:"date",direction:"desc"}),[c,u]=l.useState(null),[x,f]=l.useState(!1),[v,T]=l.useState(""),[y,j]=l.useState("custom"),[g,I]=l.useState(!1),[U,q]=l.useState([]),[Q,Z]=l.useState(!1),[$,S]=l.useState(null),{accounts:p,isConnected:b,isLoading:L}=Fs(),C=_e(),{isFeatureBlocked:ie,status:ae}=Je(),{getAccessibleAccounts:E,getAccountLockMessage:Y,canAccessMultipleProfiles:R}=dt(),X=l.useMemo(()=>E(p),[p,E]),le=l.useMemo(()=>Y(p.length),[p.length,Y]),H=l.useMemo(()=>!R&&p.length>1,[R,p.length]),J=(A,z)=>{if(A>=4)return"positive";if(A<=2)return"negative";const se=["bad","terrible","awful","horrible","worst","disappointing","poor"],ce=["good","great","excellent","amazing","wonderful","fantastic","perfect"],me=z.toLowerCase(),he=se.some(ne=>me.includes(ne)),Ae=ce.some(ne=>me.includes(ne));return Ae&&!he?"positive":he&&!Ae?"negative":"neutral"},xe=async(A=!1)=>{if(L){a(!0);return}if(!b||!X.length){s([]),a(!1);return}A?o(!0):a(!0);try{console.log("Reviews: Fetching reviews across all profiles (PARALLEL LOADING)");const z=X.flatMap(ne=>ne.locations.map(Pe=>({account:ne,location:Pe,task:async()=>{try{console.log(`📍 Frontend: Processing location - Name: "${Pe.displayName}", ID: "${Pe.locationId}"`);const Be=new AbortController,Ce=setTimeout(()=>Be.abort(),8e3),He=await Se.getLocationReviews(Pe.name,{forceRefresh:A});return clearTimeout(Ce),console.log(`📍 Frontend: Received ${He.length} reviews for ${Pe.displayName}`),He.map(Te=>{var sa,vs;return{id:Te.id,profileId:Pe.locationId,profileName:Pe.displayName,fullReviewName:Te.name,author:Te.reviewer.displayName,rating:Te.starRating,content:Te.comment||"",createdAt:Te.createTime,replied:!!Te.reply,replyContent:(sa=Te.reply)==null?void 0:sa.comment,repliedAt:(vs=Te.reply)==null?void 0:vs.updateTime,sentiment:J(Te.starRating,Te.comment||"")}})}catch(Be){return console.warn(`⚠️ Failed to fetch reviews for ${Pe.displayName}:`,Be),[]}}})));console.log(`🚀 Starting parallel loading of reviews for ${z.length} locations`);const se=Date.now(),ce=z.map(({task:ne})=>ne()),me=await Promise.allSettled(ce),he=[];me.forEach((ne,Pe)=>{ne.status==="fulfilled"?he.push(...ne.value):console.warn(`Location ${Pe} failed:`,ne.reason)});const Ae=Date.now()-se;console.log(`✅ Parallel loading completed in ${Ae}ms: Loaded ${he.length} reviews from ${z.length} locations`),s(he)}catch(z){console.error("Error fetching reviews:",z),s([])}finally{a(!1),o(!1)}};l.useEffect(()=>{a(!0),xe()},[X,b,L]),l.useEffect(()=>{const A=setInterval(()=>{b&&X.length&&xe(!0)},3e5);return()=>clearInterval(A)},[b,X]);const W=async A=>{const z=r.find(ce=>ce.id===A);if(!z)return;const se=xt.find(ce=>ce.id===z.sentiment)||xt.find(ce=>ce.id==="general");se&&(j(se.id),T(se.content)),u(z),f(!0)},V=async()=>{if(!(!c||!v.trim())){I(!0);try{console.log("Sending reply to review:",c.id);const A=c.fullReviewName;if(!A)throw new Error("Review name not available. Please refresh the reviews list.");console.log("Reviews: Sending reply with full review name:",A),await Se.replyToReview(A,v),s(z=>z.map(se=>se.id===c.id?{...se,replied:!0,replyContent:v,repliedAt:new Date().toISOString()}:se)),f(!1),u(null),T(""),j(""),console.log("Reply sent successfully!")}catch(A){console.error("Error replying to review:",A),alert("Failed to send reply. Please try again.")}finally{I(!1)}}},de=A=>{j(A);const z=xt.find(se=>se.id===A);z&&A!=="custom"&&T(z.content)},pe=A=>{T(A),!xt.some(se=>se.content===A||A==="")&&y!=="custom"&&j("custom")},qe=async A=>{if(A){Z(!0);try{let z=[];try{const ce=await fetch("http://localhost:5000/api/ai-reviews/reply-suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({businessName:A.profileName,reviewContent:A.content,reviewRating:A.rating,reviewId:A.id})});if(ce.ok){const me=await ce.json();me.success&&me.suggestions&&(z=me.suggestions.map(he=>he.text||he.reply||he).slice(0,3),console.log("Using backend AI reply suggestions:",z.length,"suggestions received"))}else throw new Error("Backend AI service unavailable")}catch(se){console.log("Backend AI service unavailable, using local suggestions:",se.message),z=Ke(A)}z.length===0&&(z=Ke(A)),q(z)}catch(z){console.error("Error generating AI suggestions:",z),q([])}finally{Z(!1)}}},Ke=A=>{const z=[],se=A.profileName,ce=A.rating,me=A.content.toLowerCase(),he=Date.now(),Ae=A.id,ne=me.includes("service"),Pe=me.includes("staff")||me.includes("team");me.includes("quality"),me.includes("price")||me.includes("cost");const Be=me.includes("wait")||me.includes("time");me.includes("clean"),me.includes("food")||me.includes("meal"),me.includes("atmosphere")||me.includes("ambiance");const He=(parseInt(Ae.slice(-4),16)+he)%3,bs=["Thank you so much for","We really appreciate","We're grateful for","Thank you for taking the time to share"],Te=[`We look forward to welcoming you back to ${se} soon!`,`We hope to see you again at ${se} in the near future!`,`We'd love to serve you again at ${se}!`,`Thank you for choosing ${se} and we hope to see you soon!`],xs=["We're always looking for ways to improve","We're committed to continuous improvement","We value your input as we work to enhance our service","Your feedback helps us grow and improve"];if(ce>=4){const vs=bs[He%bs.length],st=Te[He%Te.length];if(z.push(`${vs} your wonderful ${ce}-star review! We're thrilled to hear about your positive experience at ${se}. Your feedback means the world to us and motivates our team to continue providing excellent service.`),ne){const $s=["We're so glad you were happy with our service! Our team works hard to ensure every customer has a great experience.","It's wonderful to hear that our service met your expectations! We pride ourselves on providing excellent customer care.","Your satisfaction with our service is exactly what we strive for! Thank you for recognizing our efforts."];z.push($s[He%$s.length])}if(Pe){const $s=["Our team will be delighted to hear your kind words! We'll make sure to share your feedback with them.","I'll be sure to pass along your compliments to our team - they'll be thrilled to hear this!","Your recognition of our staff means so much to us. They work hard to provide excellent service every day."];z.push($s[He%$s.length])}z.push(st)}else if(ce===3){const vs=xs[He%xs.length];z.push(`Thank you for your honest feedback about your experience at ${se}. We appreciate you taking the time to share your thoughts and ${vs.toLowerCase()}.`);const st=["We value your feedback and would love to discuss how we can enhance your experience.","Your input is valuable to us and we'd appreciate the opportunity to address any concerns.","We take all feedback seriously and would welcome the chance to improve your experience."];z.push(st[He%st.length]),ne&&z.push(`We appreciate your feedback about our service. ${vs} and your input helps us identify areas where we can do better.`)}else{const vs=["We sincerely apologize that your experience","We're truly sorry that your visit","We deeply regret that your experience"],st=vs[He%vs.length];z.push(`${st} at ${se} didn't meet your expectations. Your feedback is important to us, and we take all concerns seriously. We'd appreciate the opportunity to discuss this with you directly to make things right.`),Be&&z.push("We're sorry about the wait time you experienced. We're working on improving our efficiency to serve our customers better. Please give us another chance to provide you with the quality service you deserve."),ne&&z.push(`We apologize for falling short in our service. This is not the standard we strive for at ${se}. We would welcome the opportunity to speak with you about your experience and show you the level of service we're known for.`);const $s=["Thank you for bringing this to our attention. We're committed to making improvements","We appreciate you sharing your concerns with us. We're dedicated to doing better","Your feedback helps us grow and improve. We're working hard to address these issues"];z.push(`${$s[He%$s.length]} and would like to invite you back to experience the better service we're working towards.`)}return[...new Set(z)].slice(0,3)},D=async(A,z)=>{try{await navigator.clipboard.writeText(A),S(z),setTimeout(()=>S(null),2e3)}catch(se){console.error("Failed to copy suggestion:",se);const ce=document.createElement("textarea");ce.value=A,document.body.appendChild(ce),ce.select(),document.execCommand("copy"),document.body.removeChild(ce),S(z),setTimeout(()=>S(null),2e3)}},_=A=>new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),P=A=>Array.from({length:5}).map((z,se)=>e.jsx(us,{className:M("h-4 w-4",se<A?"fill-yellow-400 text-yellow-400":"text-muted-foreground")},se)),F=A=>A.split(" ").map(z=>z[0]).join("").toUpperCase(),re=l.useMemo(()=>{let A=r.filter(z=>{const se=z.content.toLowerCase().includes(d.search.toLowerCase())||z.author.toLowerCase().includes(d.search.toLowerCase())||z.profileName.toLowerCase().includes(d.search.toLowerCase()),ce=d.rating==="all"||z.rating.toString()===d.rating,me=d.reply==="all"||d.reply==="replied"&&z.replied||d.reply==="not-replied"&&!z.replied,he=d.location==="all"||z.profileName===d.location,Ae=d.sentiment==="all"||z.sentiment===d.sentiment;let ne=!0;if(d.dateRange!=="all"){const Pe=new Date(z.createdAt),Ce=(new Date().getTime()-Pe.getTime())/(1e3*3600*24);switch(d.dateRange){case"7d":ne=Ce<=7;break;case"30d":ne=Ce<=30;break;case"90d":ne=Ce<=90;break;case"1y":ne=Ce<=365;break}}return se&&ce&&me&&he&&Ae&&ne});return A.sort((z,se)=>{const ce=i.direction==="asc"?1:-1;switch(i.field){case"date":return ce*(new Date(z.createdAt).getTime()-new Date(se.createdAt).getTime());case"rating":return ce*(z.rating-se.rating);case"author":return ce*z.author.localeCompare(se.author);default:return 0}}),A},[r,d,i]),te=l.useMemo(()=>{const A=r.length,z=r.filter(ne=>ne.replied).length,se=A-z,ce={all:A,5:r.filter(ne=>ne.rating===5).length,4:r.filter(ne=>ne.rating===4).length,3:r.filter(ne=>ne.rating===3).length,2:r.filter(ne=>ne.rating===2).length,1:r.filter(ne=>ne.rating===1).length},me=A>0?r.reduce((ne,Pe)=>ne+Pe.rating,0)/A:0,he={positive:r.filter(ne=>ne.sentiment==="positive").length,neutral:r.filter(ne=>ne.sentiment==="neutral").length,negative:r.filter(ne=>ne.sentiment==="negative").length},Ae=Array.from(new Set(r.map(ne=>ne.profileName)));return{total:A,replied:z,needReply:se,ratingCounts:ce,avgRating:me,sentimentCounts:he,locations:Ae}},[r]),je=()=>{xe(!0)},ue=A=>{h(z=>({field:A,direction:z.field===A&&z.direction==="desc"?"asc":"desc"}))},we=(A,z)=>{m(se=>({...se,[A]:z}))},Ge=A=>{switch(A){case"positive":return e.jsx(Ta,{className:"h-3 w-3 text-green-500"});case"negative":return e.jsx(Lo,{className:"h-3 w-3 text-red-500"});default:return e.jsx(Uo,{className:"h-3 w-3 text-yellow-500"})}},Oe=A=>{switch(A){case"positive":return"text-green-600 bg-green-50 border-green-200";case"negative":return"text-red-600 bg-red-50 border-red-200";default:return"text-yellow-600 bg-yellow-50 border-yellow-200"}},ze=A=>{const z=re.map(se=>({Author:se.author,Rating:se.rating,Review:se.content,Location:se.profileName,Date:_(se.createdAt),Replied:se.replied?"Yes":"No",Reply:se.replyContent||"",Sentiment:se.sentiment||"neutral"}));if(A==="csv"){const se=Object.keys(z[0]||{}),ce=[se.join(","),...z.map(Ae=>se.map(ne=>`"${String(Ae[ne]).replace(/"/g,'""')}"`).join(","))].join(`
`),me=new Blob([ce],{type:"text/csv;charset=utf-8;"}),he=document.createElement("a");he.href=URL.createObjectURL(me),he.download=`reviews_export_${new Date().toISOString().split("T")[0]}.csv`,he.click()}else{const se=JSON.stringify(z,null,2),ce=new Blob([se],{type:"application/json;charset=utf-8;"}),me=document.createElement("a");me.href=URL.createObjectURL(ce),me.download=`reviews_export_${new Date().toISOString().split("T")[0]}.json`,me.click()}};return ie||ae==="none"?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[500px] text-center space-y-6",children:e.jsxs("div",{className:"bg-red-950/30 border-2 border-red-500/50 rounded-2xl p-8 max-w-2xl w-full backdrop-blur-sm",children:[e.jsx(Ve,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:ae==="none"?"No Subscription - Upgrade Required":"Trial Expired - Upgrade Required"}),e.jsx("p",{className:"text-red-300/90 mb-6 text-lg",children:ae==="none"?"You need an active subscription to access this feature. Start your 15-day free trial or upgrade now to manage and respond to reviews.":"Your 15-day trial has expired. Upgrade now to manage and respond to reviews for your Google Business Profiles."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:()=>C("/dashboard/billing"),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg w-full",size:"lg",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),ae==="none"?"Start Free Trial":"Upgrade Now"]}),e.jsx("p",{className:"text-sm text-red-400/80",children:"Starting from ₹1,099/month • Unlimited Profiles • All Features"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Reviews"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:"Manage customer reviews across all your business profiles"})]})}),H&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_s,{className:"h-5 w-5 text-orange-600 mt-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Multiple Profiles Available"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:le}),e.jsx(N,{onClick:()=>C("/dashboard/billing"),size:"sm",className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Upgrade to Access All Profiles"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 sm:gap-4",children:[e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:te.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Reviews"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("div",{className:"text-2xl font-bold",children:te.avgRating.toFixed(1)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average Rating"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:te.replied}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Replied"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:te.needReply}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Need Reply"})]})}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsxs(k,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Ge("positive"),e.jsx("div",{className:"text-2xl font-bold",children:te.sentimentCounts.positive})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Positive"})]})})]}),e.jsx(w,{className:"shadow-card border-2 border-border/60",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(fe,{placeholder:"Search reviews...",value:d.search,onChange:A=>we("search",A.target.value),className:"pl-10 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(ua,{children:e.jsxs(Ga,{children:[e.jsx(Oa,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",onClick:je,disabled:n,children:e.jsx(Me,{className:M("h-4 w-4",n&&"animate-spin")})})}),e.jsx(ha,{children:"Refresh Reviews"})]})}),e.jsxs(De,{onValueChange:A=>A&&ze(A),children:[e.jsxs(Ie,{className:"w-32 sm:w-36",children:[e.jsx(va,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Export"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"csv",children:"Export CSV"}),e.jsx(G,{value:"json",children:"Export JSON"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:[e.jsxs(De,{value:d.rating,onValueChange:A=>we("rating",A),children:[e.jsxs(Ie,{className:"w-28 sm:w-36",children:[e.jsx(qt,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Rating"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Ratings"}),e.jsx(G,{value:"5",children:"5 Stars"}),e.jsx(G,{value:"4",children:"4 Stars"}),e.jsx(G,{value:"3",children:"3 Stars"}),e.jsx(G,{value:"2",children:"2 Stars"}),e.jsx(G,{value:"1",children:"1 Star"})]})]}),e.jsxs(De,{value:d.reply,onValueChange:A=>we("reply",A),children:[e.jsxs(Ie,{className:"w-32 sm:w-40",children:[e.jsx(Es,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Reply"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All"}),e.jsx(G,{value:"replied",children:"Replied"}),e.jsx(G,{value:"not-replied",children:"Need Reply"})]})]}),e.jsxs(De,{value:d.location,onValueChange:A=>we("location",A),children:[e.jsxs(Ie,{className:"w-36 sm:w-48",children:[e.jsx(qt,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Location"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Locations"}),te.locations.map(A=>e.jsx(G,{value:A,children:A},A))]})]}),e.jsxs(De,{value:d.sentiment,onValueChange:A=>we("sentiment",A),children:[e.jsxs(Ie,{className:"w-32 sm:w-36",children:[e.jsx(Ta,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Sentiment"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All"}),e.jsx(G,{value:"positive",children:"Positive"}),e.jsx(G,{value:"neutral",children:"Neutral"}),e.jsx(G,{value:"negative",children:"Negative"})]})]}),e.jsxs(De,{value:d.dateRange,onValueChange:A=>we("dateRange",A),children:[e.jsxs(Ie,{className:"w-28 sm:w-36",children:[e.jsx(rs,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx(Fe,{placeholder:"Date"})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Time"}),e.jsx(G,{value:"7d",children:"Last 7 days"}),e.jsx(G,{value:"30d",children:"Last 30 days"}),e.jsx(G,{value:"90d",children:"Last 3 months"}),e.jsx(G,{value:"1y",children:"Last year"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Sort by:"}),e.jsxs(N,{variant:"ghost",size:"sm",className:M("h-7",i.field==="date"&&"bg-muted"),onClick:()=>ue("date"),children:["Date",i.field==="date"&&(i.direction==="desc"?e.jsx(Dt,{className:"ml-1 h-3 w-3"}):e.jsx(ta,{className:"ml-1 h-3 w-3"}))]}),e.jsxs(N,{variant:"ghost",size:"sm",className:M("h-7",i.field==="rating"&&"bg-muted"),onClick:()=>ue("rating"),children:["Rating",i.field==="rating"&&(i.direction==="desc"?e.jsx(Dt,{className:"ml-1 h-3 w-3"}):e.jsx(ta,{className:"ml-1 h-3 w-3"}))]}),e.jsxs(N,{variant:"ghost",size:"sm",className:M("h-7",i.field==="author"&&"bg-muted"),onClick:()=>ue("author"),children:["Author",i.field==="author"&&(i.direction==="desc"?e.jsx(Dt,{className:"ml-1 h-3 w-3"}):e.jsx(ta,{className:"ml-1 h-3 w-3"}))]})]})]})})}),e.jsxs(w,{className:"shadow-card border-2 border-border/60",children:[e.jsxs(O,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-2",children:[e.jsxs(B,{className:"text-lg sm:text-xl",children:["All Reviews (",re.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-4 w-4 animate-spin"}),"Updating..."]}),re.length>0&&e.jsxs(ee,{variant:"outline",className:"text-xs",children:["Showing ",re.length," of ",te.total," reviews"]})]})]}),e.jsx(k,{children:t?e.jsx("div",{className:"space-y-6",children:Array.from({length:4}).map((A,z)=>e.jsx("div",{className:"border-2 border-border/60 rounded-lg p-4 shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})]})},z))}):re.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(us,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:Object.values(d).some(A=>A!=="all"&&A!=="")?"No reviews found":"No reviews yet"}),e.jsx("p",{className:"text-muted-foreground",children:Object.values(d).some(A=>A!=="all"&&A!=="")?"Try adjusting your search or filters":"Customer reviews will appear here once you receive them"})]}):e.jsx("div",{className:"space-y-6",children:re.map((A,z)=>e.jsx("div",{className:"border-2 border-border/60 rounded-lg p-3 sm:p-4 shadow-sm hover:bg-muted/30 transition-colors",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx(Nt,{className:"h-8 w-8 sm:h-10 sm:w-10 flex-shrink-0",children:e.jsx(kt,{className:"bg-primary/10 text-primary text-xs sm:text-sm",children:F(A.author)})}),e.jsxs("div",{className:"flex-1 space-y-3 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-sm sm:text-base truncate",children:A.author}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex items-center gap-1",children:P(A.rating)}),e.jsx(ee,{variant:"outline",className:"text-xs truncate max-w-[120px]",children:A.profileName}),A.sentiment&&e.jsx(ee,{variant:"outline",className:M("text-xs hidden sm:flex",Oe(A.sentiment)),children:e.jsxs("div",{className:"flex items-center gap-1",children:[Ge(A.sentiment),A.sentiment]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(rs,{className:"h-3 w-3"}),_(A.createdAt)]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[A.replied&&e.jsx(ua,{children:e.jsxs(Ga,{children:[e.jsx(Oa,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>{u(A),T(A.replyContent||""),f(!0)},className:"h-8 w-8 p-0",children:e.jsx($o,{className:"h-3 w-3"})})}),e.jsx(ha,{children:"Edit Reply"})]})}),!A.replied&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>W(A.id),className:"gap-1 px-2 sm:px-3 text-xs sm:text-sm",children:[e.jsx(la,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Reply"})]})]})]}),e.jsx("p",{className:"text-sm leading-relaxed break-words",children:A.content}),A.replied&&A.replyContent&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 ml-2 sm:ml-4 border-l-2 border-primary/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-3 w-3 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-primary",children:"Your Reply"})]}),A.repliedAt&&e.jsx("span",{className:"text-xs text-muted-foreground",children:_(A.repliedAt)})]}),e.jsx("p",{className:"text-sm break-words",children:A.replyContent})]})]})]})},A.id))})})]}),e.jsx(hs,{open:x,onOpenChange:f,children:e.jsxs(os,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(is,{children:[e.jsx(ls,{className:"text-lg sm:text-xl",children:"Reply to Review"}),e.jsx(cs,{children:c&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm sm:text-base",children:c.author}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:P(c.rating)}),e.jsx(ee,{variant:"outline",className:"text-xs",children:c.profileName})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground italic break-words",children:['"',c.content,'"']})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Reply Template (Optional)"}),e.jsxs(De,{value:y,onValueChange:de,children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Choose a template"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"custom",children:"Custom Reply"}),xt.map(A=>e.jsx(G,{value:A.id,children:A.name},A.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"AI Suggestions"}),e.jsxs(N,{variant:"outline",onClick:()=>c&&qe(c),disabled:Q,className:"w-full justify-start text-xs sm:text-sm",children:[Q?e.jsx(Me,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(la,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Generate Smart Replies"}),e.jsx("span",{className:"sm:hidden",children:"Generate Replies"})]})]})]}),U.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"AI-Generated Suggestions"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:U.map((A,z)=>e.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/50 transition-colors group",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"text-sm flex-1 leading-relaxed",children:A}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>D(A,z),className:"h-8 w-8 p-0",title:"Copy to clipboard",children:$===z?e.jsx(Bs,{className:"h-3 w-3 text-green-600"}):e.jsx(Jt,{className:"h-3 w-3"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T(A),className:"h-8 w-8 p-0",title:"Use this suggestion",children:e.jsx(Ot,{className:"h-3 w-3"})})]})]})},`suggestion-${z}-${c==null?void 0:c.id}`))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Your Reply"}),e.jsx(lt,{placeholder:"Write your reply to this review or select an AI suggestion above...",value:v,onChange:A=>pe(A.target.value),rows:4,className:"resize-none"}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[v.length,"/4000 characters"]}),v&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T(""),className:"text-xs h-6",children:"Clear"})]})]})]}),e.jsxs(Xs,{children:[e.jsxs(N,{variant:"outline",onClick:()=>{f(!1),u(null),T(""),j(""),q([]),S(null)},children:[e.jsx(ys,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(N,{onClick:V,disabled:!v.trim()||g,className:"gap-2",children:[g?e.jsx(Me,{className:"w-4 h-4 animate-spin"}):e.jsx(Ot,{className:"w-4 h-4"}),c!=null&&c.replied?"Update Reply":"Send Reply"]})]})]})})]})},$l=()=>{const r=_e(),{accounts:s,isConnected:t,isLoading:a}=Fs(),{toast:n}=ss(),{getAccessibleAccounts:o,getAccountLockMessage:d,canAccessMultipleProfiles:m}=dt(),[i,h]=l.useState({isOpen:!1,locationName:"",locationId:"",address:""}),[c,u]=l.useState({isOpen:!1,location:null,googleReviewLink:""}),[x,f]=l.useState(null);l.useState(!1),l.useState(null);const[v,T]=l.useState(new Map),y="http://localhost:5000",j=l.useMemo(()=>o(s),[s,o]),g=l.useMemo(()=>d(s.length),[s.length,d]),I=l.useMemo(()=>!m&&s.length>1,[m,s.length]);l.useEffect(()=>{U()},[j]);const U=async()=>{try{const p=await fetch(`${y}/api/qr-codes`);if(p.ok){const{qrCodes:b}=await p.json(),L=new Map;b.forEach(C=>{L.set(C.locationId,C)}),T(L),console.log(`[AskForReviews] Loaded ${b.length} existing QR codes`)}}catch(p){console.error("Error loading existing QR codes:",p)}},q=p=>{console.log("Opening review link modal for location:",p),u({isOpen:!0,location:p,googleReviewLink:""})},Q=p=>{const b=v.get(p.locationId);b&&h({isOpen:!0,locationName:b.locationName,locationId:p.locationId,address:b.address,placeId:b.placeId,qrCodeUrl:b.qrCodeUrl,reviewLink:b.publicReviewUrl,aiReviews:[]})},Z=async()=>{var L,C,ie,ae,E,Y;const{location:p,googleReviewLink:b}=c;if(!b){n({title:"Review Link Required",description:"Please enter your Google review link to continue.",variant:"destructive"});return}f(p.locationId),u({...c,isOpen:!1});try{console.log("🔍 Generating QR code for custom review suggestions page");const X=`https://app.googleranker.com/review/${p.locationId}?business=${encodeURIComponent(p.displayName)}&location=${encodeURIComponent(((L=p.address)==null?void 0:L.locality)||((C=p.address)==null?void 0:C.administrativeArea)||"Location")}&googleReviewLink=${encodeURIComponent(b)}`;console.log("🔍 Public review URL:",X);const le=await ai.toDataURL(X,{errorCorrectionLevel:"M",type:"image/png",quality:.92,margin:2,color:{dark:"#000000",light:"#FFFFFF"},width:512});try{const H={locationId:p.locationId,locationName:p.displayName,address:((ie=p.address)==null?void 0:ie.locality)||((ae=p.address)==null?void 0:ae.administrativeArea)||"Location",googleReviewLink:b,publicReviewUrl:X,qrCodeUrl:le,createdAt:new Date().toISOString()};await fetch(`${y}/api/qr-codes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)}),await U()}catch(H){console.warn("Failed to save QR code data:",H)}console.log("✅ QR code generated successfully"),h({isOpen:!0,locationName:p.displayName,locationId:p.locationId,address:((E=p.address)==null?void 0:E.locality)||((Y=p.address)==null?void 0:Y.administrativeArea)||"Location",placeId:p.placeId||"",qrCodeUrl:le,reviewLink:X,aiReviews:[]}),n({title:"QR Code Generated",description:"Your QR code will show customers AI-generated review suggestions with SEO keywords, then redirect them to your Google review page."})}catch(R){console.error("Error generating QR code:",R),n({title:"Error",description:"Failed to generate QR code. Please try again.",variant:"destructive"})}finally{f(null)}},$=()=>{if(!i.qrCodeUrl)return;const p=document.createElement("a");p.download=`${i.locationName.replace(/\s+/g,"_")}_QR_Code.png`,p.href=i.qrCodeUrl,p.click(),n({title:"QR Code Downloaded",description:"The QR code has been saved to your device."})},S=async()=>{if(!i.reviewLink){n({title:"Copy Error",description:"No preview link available. Please generate a QR code first.",variant:"destructive"});return}try{await navigator.clipboard.writeText(i.reviewLink),n({title:"Link Copied!",description:"Preview link has been copied to your clipboard."})}catch{n({title:"Copy Error",description:"Failed to copy link. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ask for Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Generate QR codes and AI-powered review suggestions for your business locations"})]}),I&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_s,{className:"h-5 w-5 text-orange-600 mt-0.5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Multiple Profiles Available"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:g}),e.jsx(N,{onClick:()=>r("/dashboard/billing"),size:"sm",className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Upgrade to Access All Profiles"})]})]})}),t&&!a&&j.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Business Locations"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.flatMap(p=>p.locations.map(b=>{var L,C,ie,ae;return e.jsxs(w,{className:"shadow-card border-[3px] hover:shadow-glow glow-hover transition-all duration-300",style:{borderColor:"#8B5CF6",borderStyle:"solid"},children:[e.jsx(O,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{className:"text-lg",children:b.displayName}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(as,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((L=b.storefrontAddress)==null?void 0:L.locality)||((C=b.storefrontAddress)==null?void 0:C.administrativeArea)||((ae=(ie=b.storefrontAddress)==null?void 0:ie.addressLines)==null?void 0:ae[0])||p.accountName})]})]}),e.jsx(Ms,{className:"h-5 w-5 text-primary"})]})}),e.jsx(k,{children:v.has(b.locationId)?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{onClick:()=>Q(b),className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(At,{className:"mr-2 h-4 w-4"}),"View QR Code"]}),e.jsx(N,{onClick:()=>q(b),variant:"outline",className:"w-full",disabled:x===b.locationId,children:x===b.locationId?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"mr-2 h-4 w-4"}),"Update Link"]})})]}):e.jsx(N,{onClick:()=>q(b),disabled:x===b.locationId,className:"w-full bg-gradient-to-r from-primary to-blue-600 hover:from-primary/90 hover:to-blue-600/90",children:x===b.locationId?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"mr-2 h-4 w-4"}),"Generate QR & Reviews"]})})})]},b.locationId)}))})]}),t&&!a&&j.length===0&&e.jsx(w,{className:"shadow-card",children:e.jsxs(k,{className:"py-12 text-center",children:[e.jsx(ar,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Business Profiles Connected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Connect your Google Business Profile to generate QR codes and AI reviews."}),e.jsx(N,{variant:"outline",children:"Connect Business Profile"})]})}),a&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:3}).map((p,b)=>e.jsx(w,{className:"shadow-card",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-3"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-10 bg-muted rounded w-full"})]})})},b))})}),e.jsx(hs,{open:c.isOpen,onOpenChange:p=>!p&&u({...c,isOpen:!1}),children:e.jsxs(os,{className:"max-w-lg",children:[e.jsxs(is,{children:[e.jsxs(ls,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Go,{className:"h-6 w-6 text-primary"}),"Enter Google Review Link"]}),e.jsx(cs,{children:"Please provide your Google review link to generate the QR code"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Hs,{children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx(Js,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"How to get your Google review link:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Open Google Business Profile Manager"}),e.jsx("li",{children:"Select your business location"}),e.jsx("li",{children:'Click on "Home" or "Get more reviews"'}),e.jsx("li",{children:"Copy the review link (looks like: g.page/r/...)"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"review-link",children:"Google Review Link"}),e.jsx(fe,{id:"review-link",type:"url",placeholder:"Enter your Google review link",value:c.googleReviewLink,onChange:p=>u({...c,googleReviewLink:p.target.value}),className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: https://g.page/r/YOUR_PLACE_ID/review"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>u({...c,isOpen:!1}),className:"flex-1",children:"Cancel"}),e.jsxs(N,{onClick:Z,disabled:!c.googleReviewLink,className:"flex-1 bg-gradient-to-r from-primary to-blue-600 hover:from-primary/90 hover:to-blue-600/90",children:[e.jsx(At,{className:"mr-2 h-4 w-4"}),"Generate QR Code"]})]})]})]})}),e.jsx(hs,{open:i.isOpen,onOpenChange:p=>!p&&h({...i,isOpen:!1}),children:e.jsxs(os,{className:"max-w-lg",children:[e.jsxs(is,{children:[e.jsxs(ls,{className:"text-2xl flex items-center gap-2",children:[e.jsx(At,{className:"h-6 w-6 text-primary"}),i.locationName]}),e.jsx(cs,{children:"QR code for customer reviews - Scan to see AI-powered review suggestions"})]}),e.jsx(w,{children:e.jsx(k,{className:"space-y-4 pt-6",children:i.qrCodeUrl&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg border-2 border-gray-200 flex justify-center max-w-xs mx-auto",children:e.jsx("img",{src:i.qrCodeUrl,alt:"QR Code",className:"w-48 h-48"})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"How it works:"}),e.jsxs("ol",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"1. Customer scans QR code"}),e.jsx("li",{children:"2. Sees AI-generated review suggestions with SEO keywords"}),e.jsx("li",{children:'3. Clicks "Write Review on Google" button'}),e.jsx("li",{children:"4. Gets redirected to your Google review page"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Preview Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i.reviewLink||"",readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm font-mono text-gray-600",placeholder:"No preview link available"}),e.jsx(N,{onClick:S,size:"sm",variant:"outline",disabled:!i.reviewLink,children:e.jsx(Jt,{className:"h-4 w-4"})})]})]}),e.jsxs(N,{onClick:$,className:"w-full",variant:"default",children:[e.jsx(va,{className:"mr-2 h-4 w-4"}),"Download QR Code"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"Print this QR code and display it in your business location"})]})})})]})})]})},Ul=()=>{const r=_e(),{isFeatureBlocked:s,status:t}=Je(),{accounts:a,isConnected:n}=ct(),[o,d]=l.useState(""),[m,i]=l.useState(null),[h,c]=l.useState([]),[u,x]=l.useState(null),[f,v]=l.useState(!1),[T,y]=l.useState([]),[j,g]=l.useState(!1),I=l.useRef(null),U=(a||[]).flatMap(p=>(p.locations||[]).map(b=>({id:b.locationId,name:b.displayName,accountName:p.accountName,fullName:b.name})));ja.useEffect(()=>{U.length>0&&!o&&d(U[0].id)},[U,o]),U.find(p=>p.id===o);const q=p=>{var L;const b=(L=p.target.files)==null?void 0:L[0];b&&b.type==="text/csv"?(i(b),Q(b)):K({title:"Invalid File",description:"Please upload a valid CSV file.",variant:"destructive"})},Q=async p=>{v(!0);try{const L=(await p.text()).split(`
`),C=L[0].split(",").map(H=>H.trim().toLowerCase()),ie=C.findIndex(H=>H.includes("name")),ae=C.findIndex(H=>H.includes("email")),E=C.findIndex(H=>H.includes("phone"));if(ie===-1||ae===-1)throw new Error("CSV must contain at least Name and Email columns");const Y=[];for(let H=1;H<L.length;H++){const J=L[H].split(",").map(xe=>xe.trim());if(J.length>=2&&J[ie]&&J[ae]){const xe=Math.random()>.7,W=xe?new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString():void 0,V=xe?Math.floor(Math.random()*2)+4:void 0;Y.push({id:`customer-${H}`,name:J[ie],email:J[ae],phone:E!==-1?J[E]:void 0,hasReviewed:xe,reviewDate:W,reviewRating:V,source:"csv"})}}c(Y);const R=Y.filter(H=>H.hasReviewed).length,X=Y.filter(H=>H.reviewRating).reduce((H,J)=>H+(J.reviewRating||0),0)/R||0,le={totalCustomers:Y.length,reviewedCustomers:R,pendingReviews:Y.length-R,averageRating:X,completionRate:R/Y.length*100};x(le),K({title:"Analysis Complete!",description:`Analyzed ${Y.length} customers. ${Y.length-R} need review requests.`})}catch(b){K({title:"Analysis Failed",description:b instanceof Error?b.message:"Failed to analyze CSV file.",variant:"destructive"})}finally{v(!1)}},Z=async p=>{const b=T.length>0?h.filter(L=>T.includes(L.id)&&!L.hasReviewed):h.filter(L=>!L.hasReviewed);if(b.length===0){K({title:"No Customers Selected",description:"Please select customers who haven't reviewed yet.",variant:"destructive"});return}g(!0);try{for(let L=0;L<b.length;L++)await new Promise(C=>setTimeout(C,500));K({title:`${p.toUpperCase()} Requests Sent!`,description:`Review requests sent to ${b.length} customers via ${p}.`}),y([])}catch{K({title:"Failed to Send",description:"There was an error sending review requests. Please try again.",variant:"destructive"})}finally{g(!1)}},$=p=>{y(b=>b.includes(p)?b.filter(L=>L!==p):[...b,p])},S=()=>{const p=h.filter(b=>!b.hasReviewed).map(b=>b.id);y(p)};return n?s||t==="none"?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[500px] text-center space-y-6",children:e.jsxs("div",{className:"bg-red-950/30 border-2 border-red-500/50 rounded-2xl p-8 max-w-2xl w-full backdrop-blur-sm",children:[e.jsx(Ve,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:t==="none"?"No Subscription - Upgrade Required":"Trial Expired - Upgrade Required"}),e.jsx("p",{className:"text-red-300/90 mb-6 text-lg",children:t==="none"?"You need an active subscription to access this feature. Start your 15-day free trial or upgrade now to request reviews from your customers.":"Your 15-day trial has expired. Upgrade now to request reviews from your customers and manage review campaigns."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:()=>r("/dashboard/billing"),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg w-full",size:"lg",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),t==="none"?"Start Free Trial":"Upgrade Now"]}),e.jsx("p",{className:"text-sm text-red-400/80",children:"Starting from ₹1,099/month • Unlimited Profiles • All Features"})]})]})}):e.jsxs("div",{className:"relative p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 min-h-[calc(100vh-4rem)]",children:[e.jsx("div",{className:"absolute inset-0 z-10 flex items-start justify-center backdrop-blur-sm bg-background/90 p-4 pt-8 sm:pt-12 overflow-y-auto",children:e.jsx(w,{className:"w-full max-w-xs sm:max-w-md md:max-w-lg mx-auto shadow-2xl border-2 animate-fade-in",children:e.jsxs(k,{className:"pt-8 sm:pt-10 md:pt-12 pb-6 sm:pb-8 md:pb-10 px-4 sm:px-6 md:px-8 text-center",children:[e.jsxs("div",{className:"mb-4 sm:mb-6 flex items-center justify-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 animate-ping",children:e.jsx(zs,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-primary/60"})}),e.jsx(zs,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-primary relative"})]}),e.jsx(ns,{className:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12 text-primary animate-pulse"})]}),e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-3 sm:mb-4 bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:"Coming Soon"}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-muted-foreground mb-4 sm:mb-6 leading-relaxed px-2",children:"We're working hard to bring you an amazing review request feature. This powerful tool will help you collect more reviews effortlessly!"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs sm:text-sm text-muted-foreground mb-4 sm:mb-6",children:[e.jsx(ns,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{children:"Expected launch: Coming very soon"})]}),e.jsxs("div",{className:"mt-6 sm:mt-8 pt-4 sm:pt-6 border-t",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-3",children:"Get notified when this feature launches"}),e.jsxs(N,{className:"w-full h-10 sm:h-11 text-sm sm:text-base",children:[e.jsx(Ds,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),e.jsx("span",{children:"Notify Me"})]})]})]})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Request for Reviews"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload customer data, analyze review status, and send automated review requests"})]}),e.jsxs(et,{defaultValue:"upload",className:"space-y-6",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-3",children:[e.jsx(Ue,{value:"upload",children:"Upload & Analyze"}),e.jsx(Ue,{value:"customers",children:"Customer List"}),e.jsx(Ue,{value:"send",children:"Send Requests"})]}),e.jsxs(Le,{value:"upload",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5"}),"Select Business Location"]})}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:U.map(p=>{const b=o===p.id;return e.jsx("div",{className:`relative rounded-lg border-2 transition-all duration-200 cursor-pointer ${b?"border-primary bg-primary/5 shadow-md":"border-border hover:border-primary/50"}`,onClick:()=>d(p.id),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-sm leading-tight break-words",children:p.name}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 break-words",children:p.accountName}),b&&e.jsx(ee,{className:"mt-2 text-xs",children:"Selected"})]})},p.id)})})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Et,{className:"h-5 w-5"}),"Upload Customer Data"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV file with customer information to analyze review status"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[e.jsx(Et,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Upload CSV File"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"CSV should contain columns: Name, Email, Phone (optional)"})]}),e.jsx(N,{onClick:()=>{var p;return(p=I.current)==null?void 0:p.click()},disabled:f,className:"mt-4",children:f?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"h-4 w-4 mr-2"}),"Choose CSV File"]})}),e.jsx("input",{ref:I,type:"file",accept:".csv",onChange:q,className:"hidden"})]}),m&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qs,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:m.name})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>{i(null),c([]),x(null)},children:e.jsx(ys,{className:"h-4 w-4"})})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Vt,{value:66,className:"w-full"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Analyzing customer data and checking review status..."})]})]})]}),u&&e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5"}),"Analysis Results"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.totalCustomers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Customers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.reviewedCustomers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Have Reviewed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.pendingReviews}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Need Reviews"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[u.completionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Review Rate"})]})]}),u.averageRating>0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-medium",children:["Average Rating: ",u.averageRating.toFixed(1)," / 5"]})]})})]})]})]}),e.jsx(Le,{value:"customers",className:"space-y-6",children:e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5"}),"Customer List (",h.length,")"]}),h.length>0&&e.jsx(N,{onClick:S,variant:"outline",size:"sm",children:"Select All Non-Reviewed"})]})}),e.jsx(k,{children:h.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.map(p=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all ${T.includes(p.id)?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>$(p.id),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:p.name}),p.hasReviewed?e.jsxs(ee,{variant:"default",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Reviewed"]}):e.jsxs(ee,{variant:"secondary",children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"}),"Pending"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p.email}),p.phone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:p.phone})]}),p.hasReviewed&&p.reviewRating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"h-4 w-4 text-yellow-500 fill-current"}),e.jsx("span",{className:"text-sm font-medium",children:p.reviewRating})]})]},p.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ms,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No customer data uploaded yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV file to see customer analysis"})]})})]})}),e.jsx(Le,{value:"send",className:"space-y-6",children:e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5"}),"Send Review Requests"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send review requests to customers who haven't reviewed yet"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Ready to Send"})]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[T.length>0?`${T.filter(p=>{var b;return!((b=h.find(L=>L.id===p))!=null&&b.hasReviewed)}).length} selected customers`:`${h.filter(p=>!p.hasReviewed).length} customers without reviews`," will receive review requests."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(w,{className:"cursor-pointer hover:shadow-md transition-shadow",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx(Ds,{className:"h-8 w-8 mx-auto mb-2 text-blue-600"}),e.jsx("h3",{className:"font-medium mb-2",children:"Email"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Send professional review request emails"}),e.jsx(N,{onClick:()=>Z("email"),disabled:j||h.filter(p=>!p.hasReviewed).length===0,className:"w-full",size:"sm",children:j?"Sending...":"Send via Email"})]})}),e.jsx(w,{className:"cursor-pointer hover:shadow-md transition-shadow",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx(bt,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),e.jsx("h3",{className:"font-medium mb-2",children:"SMS"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Send review requests via text message"}),e.jsx(N,{onClick:()=>Z("sms"),disabled:j||h.filter(p=>!p.hasReviewed&&p.phone).length===0,className:"w-full",size:"sm",children:j?"Sending...":"Send via SMS"})]})}),e.jsx(w,{className:"cursor-pointer hover:shadow-md transition-shadow",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx(Es,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("h3",{className:"font-medium mb-2",children:"WhatsApp"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Send requests via WhatsApp messaging"}),e.jsx(N,{onClick:()=>Z("whatsapp"),disabled:j||h.filter(p=>!p.hasReviewed&&p.phone).length===0,className:"w-full",size:"sm",children:j?"Sending...":"Send via WhatsApp"})]})})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Vt,{value:75,className:"w-full"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Sending review requests to customers..."})]})]})]})})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center p-6",children:e.jsxs(w,{className:"max-w-md w-full",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Et,{className:"h-8 w-8 text-primary"})}),e.jsx(B,{className:"text-xl",children:"Connect Google Business Profile"})]}),e.jsxs(k,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Connect your Google Business Profile to analyze customer reviews and send requests."}),e.jsx(N,{asChild:!0,children:e.jsx("a",{href:"/dashboard/settings",children:"Go to Settings"})})]})]})})},Ll=()=>{const{isConnected:r,isLoading:s,accounts:t,selectedAccount:a,selectedLocation:n,error:o,connectGoogleBusiness:d,disconnectGoogleBusiness:m,selectAccount:i,selectLocation:h,refreshAccounts:c}=Fs(),{canAccessMultipleProfiles:u,isAccountAccessible:x,isLocationAccessible:f,getAccountLockMessage:v,getLocationLockMessage:T,handleContactSupport:y}=dt();return s?e.jsx(w,{children:e.jsxs(k,{className:"flex items-center justify-center py-8",children:[e.jsx(Me,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading Google Business Profile..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{children:e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/ggg.png",alt:"Google Business Profile",className:"h-5 w-5"}),e.jsx(B,{children:"Google Business Profile"}),e.jsxs(ee,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Connected"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:c,disabled:s,children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:m,disabled:s,children:[e.jsx(Oo,{className:"h-4 w-4 mr-2"}),"Disconnect"]})]})]}),e.jsx(ge,{children:"Your Google Business Profile is connected and syncing automatically."})]})}),r&&t.length===0&&!s&&e.jsx(w,{children:e.jsxs(k,{className:"text-center py-8",children:[e.jsx(Ve,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Business Profiles Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"We couldn't find any Google Business Profiles associated with your account."}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200 text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"To get started:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["• Create a Google Business Profile at ",e.jsx("a",{href:"https://business.google.com",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"business.google.com"})]}),e.jsx("li",{children:"• Verify your business location"}),e.jsx("li",{children:"• Make sure you're signed in with the correct Google account"}),e.jsx("li",{children:"• Ensure you have owner or manager permissions"})]})]}),e.jsxs(N,{onClick:c,className:"mt-4",disabled:s,children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Check Again"]})]})}),t.length>0&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Choose Account"}),e.jsx(ge,{children:u?"Select the Google Business account you want to manage.":"Select 1 Google Business account (upgrade to Enterprise for multiple accounts)."})]}),e.jsxs(k,{className:"space-y-3",children:[t.map((j,g)=>{const I=!x(g);return e.jsxs("div",{className:`p-4 border rounded-lg transition-colors relative ${I?"border-gray-700 bg-gray-800/50 cursor-not-allowed opacity-70":(a==null?void 0:a.name)===j.name?"border-primary bg-primary/5 cursor-pointer":"border-border hover:border-primary/50 cursor-pointer"}`,onClick:()=>!I&&i(j),children:[I&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Us,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-lg flex items-center justify-center ${I?"bg-gray-100":"bg-primary/10"}`,children:e.jsx(Bo,{className:`h-5 w-5 ${I?"text-gray-400":"text-primary"}`})}),e.jsxs("div",{children:[e.jsxs("h4",{className:`font-medium ${I?"text-gray-400":""}`,children:[j.accountName,I&&e.jsx("span",{className:"ml-2 text-xs text-orange-600",children:"(Requires Enterprise)"})]}),e.jsxs("p",{className:`text-sm ${I?"text-gray-400":"text-muted-foreground"}`,children:[j.locations.length," location",j.locations.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:j.state==="VERIFIED"?"default":"secondary",children:j.role}),I&&e.jsxs(ee,{variant:"outline",className:"text-orange-600 border-orange-200",children:[e.jsx(Vs,{className:"h-3 w-3 mr-1"}),"Pro"]})]})]})]},j.name)}),!u&&t.length>1&&e.jsx(w,{className:"border-orange-200 bg-orange-50",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vs,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-1",children:"Multiple Profiles Detected"}),e.jsx("p",{className:"text-sm text-orange-800 mb-3",children:v(t.length)}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>y("Multiple Business Accounts"),className:"border-orange-300 text-orange-700 hover:bg-orange-100",children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Contact for Enterprise Plan"]})]})]})})})]})]}),a&&a.locations.length>0&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Choose Location"}),e.jsx(ge,{children:u?`Select the business location you want to manage from ${a.accountName}.`:`Select 1 business location from ${a.accountName} (upgrade to Enterprise for multiple locations).`})]}),e.jsxs(k,{className:"space-y-3",children:[a.locations.map((j,g)=>{var U,q;const I=!f(g);return e.jsxs("div",{className:`p-4 border rounded-lg transition-colors relative ${I?"border-gray-700 bg-gray-800/50 cursor-not-allowed opacity-70":(n==null?void 0:n.name)===j.name?"border-primary bg-primary/5 cursor-pointer":"border-border hover:border-primary/50 cursor-pointer"}`,onClick:()=>!I&&h(j),children:[I&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Us,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-lg flex items-center justify-center ${I?"bg-gray-100":"bg-blue-100"}`,children:e.jsx(as,{className:`h-5 w-5 ${I?"text-gray-400":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:`font-medium ${I?"text-gray-400":""}`,children:[j.displayName,I&&e.jsx("span",{className:"ml-2 text-xs text-orange-600",children:"(Requires Enterprise)"})]}),e.jsxs("div",{className:`flex items-center gap-1 text-sm mt-1 ${I?"text-gray-400":"text-muted-foreground"}`,children:[e.jsx(as,{className:"h-3 w-3"}),e.jsxs("span",{children:[j.address.addressLines.join(", "),", ",j.address.locality]})]}),j.phoneNumber&&e.jsxs("div",{className:`flex items-center gap-1 text-sm mt-1 ${I?"text-gray-400":"text-muted-foreground"}`,children:[e.jsx(bt,{className:"h-3 w-3"}),e.jsx("span",{children:j.phoneNumber})]}),j.websiteUrl&&e.jsxs("div",{className:`flex items-center gap-1 text-sm mt-1 ${I?"text-gray-400":"text-muted-foreground"}`,children:[e.jsx(ba,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-xs",children:j.websiteUrl})]}),j.categories.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[j.categories.slice(0,2).map((Q,Z)=>e.jsx(ee,{variant:"outline",className:"text-xs",children:Q.name},Z)),j.categories.length>2&&e.jsxs(ee,{variant:"outline",className:"text-xs",children:["+",j.categories.length-2," more"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[((U=j.metadata)==null?void 0:U.suspended)&&e.jsx(ee,{variant:"destructive",className:"text-xs",children:"Suspended"}),((q=j.metadata)==null?void 0:q.duplicate)&&e.jsx(ee,{variant:"secondary",className:"text-xs",children:"Duplicate"})]})]})]},j.name)}),!u&&a&&a.locations.length>1&&e.jsx(w,{className:"border-orange-200 bg-orange-50",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Vs,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-1",children:"Multiple Locations Detected"}),e.jsx("p",{className:"text-sm text-orange-800 mb-3",children:T(a.locations.length)}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>y("Multiple Business Locations"),className:"border-orange-300 text-orange-700 hover:bg-orange-100",children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Contact for Enterprise Plan"]})]})]})})})]})]}),n&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-green-600"}),"Location Selected"]}),e.jsxs(ge,{children:["You're now managing ",n.displayName]})]}),e.jsx(k,{children:e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 mb-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Ready to manage your business!"})]}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Google Business Profile is now connected and ready for automated management. You can now create posts, monitor reviews, and track analytics."})]})})]})]}):e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/ggg.png",alt:"Google Business Profile",className:"h-5 w-5"}),"Connect Google Business Profile"]}),e.jsx(ge,{children:"Connect your Google Business Profile to manage your business listings, posts, and reviews automatically."})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"What you'll get:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Automatic profile synchronization"}),e.jsx("li",{children:"• Real-time post management"}),e.jsx("li",{children:"• Review monitoring and responses"}),e.jsx("li",{children:"• Multi-location support"}),e.jsx("li",{children:"• Analytics and insights"})]})]}),o&&e.jsx("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:o})]})}),e.jsxs(N,{onClick:()=>{console.log("🔴 DEBUGGING: Connect button clicked!"),d()},className:"w-full",size:"lg",children:[e.jsx("img",{src:"/ggg.png",alt:"Google Business Profile",className:"mr-2 h-4 w-4"}),"Connect Google Business Profile"]})]})]})},Gl=()=>{const[r,s]=l.useState({newReviews:!0,scheduledPosts:!0,weeklyReports:!1,accountAlerts:!0}),[t,a]=l.useState({enabled:!1,positiveReviews:!0,neutralReviews:!0,negativeReviews:!1});ss();const{currentUser:n,logout:o}=Ye(),d=_e(),m=async()=>{try{await o(),d("/login")}catch(i){console.error("Logout error:",i)}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"px-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold tracking-tight",children:"Settings"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:"Manage your account preferences and business profile settings"})]}),e.jsxs(et,{defaultValue:"connections",className:"space-y-4 sm:space-y-6",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-2 sm:grid-cols-3 h-auto",children:[e.jsxs(Ue,{value:"connections",className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(ms,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Connections"}),e.jsx("span",{className:"sm:hidden",children:"Connect"})]}),e.jsxs(Ue,{value:"notifications",className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(Bt,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Notifications"}),e.jsx("span",{className:"sm:hidden",children:"Notify"})]}),e.jsxs(Ue,{value:"account",className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3 py-2",children:[e.jsx(_t,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Account"]})]}),e.jsx(Le,{value:"connections",className:"space-y-6",children:e.jsx(Ll,{})}),e.jsxs(Le,{value:"notifications",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"h-5 w-5"}),"Notification Preferences"]}),e.jsx(ge,{children:"Choose what notifications you want to receive"})]}),e.jsx(k,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{htmlFor:"new-reviews",className:"text-sm sm:text-base",children:"New Reviews"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Get notified when you receive new customer reviews"})]}),e.jsx(ts,{id:"new-reviews",checked:r.newReviews,onCheckedChange:i=>s(h=>({...h,newReviews:i}))})]}),e.jsx(Gs,{}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{htmlFor:"scheduled-posts",className:"text-sm sm:text-base",children:"Scheduled Posts"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Receive confirmations when posts are published"})]}),e.jsx(ts,{id:"scheduled-posts",checked:r.scheduledPosts,onCheckedChange:i=>s(h=>({...h,scheduledPosts:i}))})]}),e.jsx(Gs,{}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{htmlFor:"weekly-reports",className:"text-sm sm:text-base",children:"Weekly Reports"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Get weekly performance summaries via email"})]}),e.jsx(ts,{id:"weekly-reports",checked:r.weeklyReports,onCheckedChange:i=>s(h=>({...h,weeklyReports:i}))})]}),e.jsx(Gs,{}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{htmlFor:"account-alerts",className:"text-sm sm:text-base",children:"Account Alerts"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Important account and billing notifications"})]}),e.jsx(ts,{id:"account-alerts",checked:r.accountAlerts,onCheckedChange:i=>s(h=>({...h,accountAlerts:i}))})]})]})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5"}),"Auto Reply Settings"]}),e.jsx(ge,{children:"Configure automatic responses to customer reviews"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5 flex-1",children:[e.jsx(oe,{htmlFor:"auto-reply",className:"text-sm sm:text-base",children:"Enable Auto Reply"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Automatically respond to reviews using AI-generated responses"})]}),e.jsx(ts,{id:"auto-reply",checked:t.enabled,onCheckedChange:i=>a(h=>({...h,enabled:i}))})]}),t.enabled&&e.jsxs("div",{className:"space-y-4 border-l-2 border-primary/20 pl-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(oe,{htmlFor:"positive-reviews",className:"text-sm sm:text-base",children:"Positive Reviews (4-5 stars)"}),e.jsx(ts,{id:"positive-reviews",checked:t.positiveReviews,onCheckedChange:i=>a(h=>({...h,positiveReviews:i}))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(oe,{htmlFor:"neutral-reviews",className:"text-sm sm:text-base",children:"Neutral Reviews (3 stars)"}),e.jsx(ts,{id:"neutral-reviews",checked:t.neutralReviews,onCheckedChange:i=>a(h=>({...h,neutralReviews:i}))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(oe,{htmlFor:"negative-reviews",className:"text-sm sm:text-base",children:"Negative Reviews (1-2 stars)"}),e.jsx(ts,{id:"negative-reviews",checked:t.negativeReviews,onCheckedChange:i=>a(h=>({...h,negativeReviews:i}))})]})]})]})]})]}),e.jsxs(Le,{value:"account",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-5 w-5"}),"Account Information"]}),e.jsx(ge,{children:"Manage your personal account details"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"display-name",children:"Display Name"}),e.jsx(fe,{id:"display-name",defaultValue:(n==null?void 0:n.displayName)||"",placeholder:"Your display name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"email",children:"Email Address"}),e.jsx(fe,{id:"email",type:"email",defaultValue:(n==null?void 0:n.email)||"",placeholder:"your@email.com",disabled:!0})]})]}),e.jsx(Gs,{}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm sm:text-base",children:"Account Status"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Your account is active and verified"})]}),e.jsx(ee,{variant:"secondary",className:"bg-green-100 text-green-800 shrink-0",children:"Active"})]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Security"]}),e.jsx(ge,{children:"Manage your account security settings"})]}),e.jsx(k,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm sm:text-base",children:"Sign Out"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Sign out of your account on this device"})]}),e.jsxs(N,{variant:"outline",onClick:m,className:"w-full sm:w-auto",children:[e.jsx(ga,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Sign Out"]})]})})]})]})]})]})},Ol=()=>{var xe,W,V,de,pe,qe,Ke;const r=_e(),{isFeatureBlocked:s,status:t}=Je();if(s||t==="none")return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[500px] text-center space-y-6",children:e.jsxs("div",{className:"bg-red-950/30 border-2 border-red-500/50 rounded-2xl p-8 max-w-2xl w-full backdrop-blur-sm",children:[e.jsx(Ve,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:t==="none"?"No Subscription - Upgrade Required":"Trial Expired - Upgrade Required"}),e.jsx("p",{className:"text-red-300/90 mb-6 text-lg",children:t==="none"?"You need an active subscription to access this feature. Start your 15-day free trial or upgrade now to access the Audit Tool.":"Your 15-day trial has expired. Upgrade now to access the Audit Tool and analyze your Google Business Profile performance."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{onClick:()=>r("/dashboard/billing"),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-6 text-lg w-full",size:"lg",children:[e.jsx(We,{className:"mr-2 h-5 w-5"}),t==="none"?"Start Free Trial":"Upgrade Now"]}),e.jsx("p",{className:"text-sm text-red-400/80",children:"Starting from ₹1,099/month • Unlimited Profiles • All Features"})]})]})});const{accounts:a,isConnected:n,isLoading:o}=ct(),{subscription:d}=Je(),{currentUser:m}=Ye(),[i,h]=l.useState(""),[c,u]=l.useState([]),[x,f]=l.useState(null),[v,T]=l.useState(!1),[y,j]=l.useState(null),[g,I]=l.useState(!0),[U,q]=l.useState(5*60*1e3),[Q,Z]=l.useState("area"),[$,S]=l.useState(null),[p,b]=l.useState(!1),L=(a||[]).flatMap(D=>(D.locations||[]).map(_=>({..._,id:_.locationId,name:_.displayName,accountName:D.accountName,fullName:_.name}))),C=(d==null?void 0:d.profileCount)||1,ae=t==="active"||t==="trial"?L.slice(0,C):L.slice(0,1),E=L.slice(C);l.useEffect(()=>{ae.length>0&&!i&&h(ae[0].id)},[ae.length,i]),l.useEffect(()=>{i&&(console.log("Location changed to:",i),R(i))},[i]);const Y=async(D,_,P,F=null)=>{try{if(!m){console.warn("No current user, skipping audit save");return}const re=L.find(ue=>ue.id===D);if(!re){console.warn("Location not found, skipping audit save");return}const te={userId:m.uid,userEmail:m.email||"unknown",locationId:re.fullName||D,locationName:re.name,performance:{timeSeriesData:_},score:P,recommendations:F||{recommendations:[]},dateRange:{startDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]},metadata:{source:"audit_tool",timestamp:new Date().toISOString()}},je=await fetch("http://localhost:5000/api/audit-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});je.ok?console.log("✅ Audit result saved successfully"):console.error("Failed to save audit result:",await je.text())}catch(re){console.error("Error saving audit result:",re)}};l.useEffect(()=>{if(!i||!g)return;const D=setInterval(()=>{v||(console.log("Auto-refreshing audit data..."),R(i))},U);return()=>clearInterval(D)},[i,g,U,v]),l.useEffect(()=>{const D=()=>{!document.hidden&&i&&g&&(!y||new Date().getTime()-y.getTime()>12e4)&&(console.log("Page became visible - refreshing audit data..."),R(i))};return document.addEventListener("visibilitychange",D),()=>document.removeEventListener("visibilitychange",D)},[i,g,y]);const R=async D=>{var P,F,re,te,je,ue;if(!D)return;if(L.findIndex(we=>we.id===D)>=C){K({title:"Profile Locked",description:`This profile requires an upgrade. You have access to ${C} profile${C===1?"":"s"}.`,variant:"destructive"});return}T(!0);try{const we=localStorage.getItem("google_business_tokens");if(!we)throw new Error("No Google Business Profile connection found. Please connect your Google Business Profile in Settings > Connections.");const Ge=JSON.parse(we);if(!Ge.access_token)throw new Error("Invalid token data. Please reconnect your Google Business Profile in Settings.");const Oe=Date.now(),ze=Ge.expires_at||Ge.stored_at+Ge.expires_in*1e3;if(ze&&Oe>=ze)throw new Error("Google Business Profile token expired. Please reconnect in Settings > Connections.");const A=Ge.access_token,z=new Date().toISOString().split("T")[0],se=new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],ce="http://localhost:5000",[me,he]=await Promise.allSettled([fetch(`${ce}/api/locations/${D}/audit/performance?startDate=${se}&endDate=${z}`,{headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}}),fetch(`${ce}/api/locations/${D}/reviews`,{headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}})]);let Ae=null,ne=J,Pe=null;if(me.status==="fulfilled"&&me.value.ok){const Ce=await me.value.json();if(console.log("📊 Audit Tool - Received performance data:",Ce),(re=(F=(P=Ce.performance)==null?void 0:P.locationMetrics)==null?void 0:F[0])!=null&&re.dailyMetrics){const He=Ce.performance.locationMetrics[0].dailyMetrics;console.log("📈 Audit Tool - Daily metrics count:",He.length);const bs=He.map(Te=>({views:Te.views||0,impressions:Te.impressions||0,calls:Te.calls||0,websiteClicks:Te.websiteClicks||0,directionRequests:Te.directionRequests||0,date:Te.date}));console.log("✅ Audit Tool - Converted metrics:",bs.slice(0,3)),u(bs),Ae=bs}else console.warn("⚠️ Audit Tool - No daily metrics in response:",Ce)}else if(me.status==="fulfilled"&&me.value.status===503){const Ce=await me.value.json();console.warn("Performance API access required:",Ce.message)}else if(me.status==="fulfilled"){console.error("❌ Audit Tool - API error:",me.value.status,me.value.statusText);try{const Ce=await me.value.json();console.error("❌ Audit Tool - Error details:",Ce)}catch{console.error("❌ Audit Tool - Could not parse error response")}}else console.error("❌ Audit Tool - Promise rejected:",me.reason);if(console.log("📊 Audit Tool - Using profile data from selectedLocation:",ne),console.log("📊 ALL KEYS in profileData:",Object.keys(ne||{})),console.log("📊 Profile has title?",!!(ne!=null&&ne.title)),console.log("📊 Profile has categories?",!!(ne!=null&&ne.categories)),console.log("📊 Profile has description?",!!((te=ne==null?void 0:ne.profile)!=null&&te.description)),he.status==="fulfilled"&&he.value.ok){const Ce=await he.value.json();console.log("📊 Audit Tool - Received reviews data:",Ce),console.log("📊 Number of reviews:",((je=Ce==null?void 0:Ce.reviews)==null?void 0:je.length)||0),console.log("📊 First review:",(ue=Ce==null?void 0:Ce.reviews)==null?void 0:ue[0]),Pe=Ce}else console.error("❌ Reviews data fetch failed:",he);if(!Ae&&!ne&&!Pe)throw new Error("Unable to fetch any data from Google Business Profile API. Please ensure proper API access and permissions.");Ae||console.warn("⚠️ Performance API not available - audit scores will be calculated from profile and review data only"),console.log("🔍 Data summary before calculation:"),console.log("   - Performance data:",Ae?"Available":"Missing"),console.log("   - Profile data:",ne?"Available":"Missing"),console.log("   - Reviews data:",Pe?"Available":"Missing");const Be=le(Ae||[],ne,Pe);console.log("📊 Calculated audit score:",Be),f(Be),j(new Date),await Y(D,Ae,Be),K({title:"Audit Complete",description:"Real-time performance metrics updated."})}catch(we){console.error("Error fetching real-time data:",we),u([]),f(null),j(null),console.error("🚨 AUDIT TOOL ERROR:",we.message),console.error("🔍 Error details:",we),K({title:"Performance Data Unavailable",description:"Unable to retrieve metrics for this profile. Please verify your profile at business.google.com",variant:"default",duration:5e3})}finally{T(!1)}},X=(D,_,P)=>{let F=0;for(let te=0;te<D.length;te++){const je=D.charCodeAt(te);F=(F<<5)-F+je,F=F&F}const re=Math.abs(F)/2147483647;return Math.round(_+re*(P-_))},le=(D,_=null,P=null)=>{var ce,me;const F=i||"0";console.log("🎯 Calculating scores for location:",F);let re=X(F+"perf",45,95),te=X(F+"engage",50,90),je=X(F+"rank",1,15);if(console.log("🎯 Generated scores:",{locationId:F,performanceScore:re,engagementScore:te,estimatedRank:je}),D&&D.length>0){const he=D.slice(-7),Ae=he.reduce((Te,xs)=>Te+(xs.views||0),0),ne=Ae/he.length;re=Math.min(100,ne/100*100);const Pe=he.reduce((Te,xs)=>Te+(xs.impressions||0),0),Be=he.reduce((Te,xs)=>Te+(xs.calls||0)+(xs.websiteClicks||0)+(xs.directionRequests||0),0),Ce=Pe>0?Be/Pe*100:0;te=Math.min(100,Ce*20);const He=Ae,bs=Pe>0?He/Pe:0;je=bs>0?Math.max(1,Math.min(30,Math.round(1/(bs+.1)))):30}let ue=X(F+"profile",65,98),we={totalFields:15,completedFields:Math.round(ue/100*15),missingFields:[]};if(_&&(_.title||_.name)){const he=[{key:"title",name:"Business Name"},{key:"phoneNumbers",name:"Phone Number"},{key:"storefrontAddress",name:"Address"},{key:"websiteUri",name:"Website"},{key:"categories",name:"Categories"},{key:"profile.description",name:"Description"},{key:"regularHours",name:"Business Hours"},{key:"serviceArea",name:"Service Area"},{key:"labels",name:"Labels"},{key:"adWordsLocationExtensions",name:"Google Ads"},{key:"languageCode",name:"Language"},{key:"metadata",name:"Metadata"},{key:"profile",name:"Profile"},{key:"attributes",name:"Attributes"},{key:"moreHours",name:"Special Hours"}];we.totalFields=he.length,we.completedFields=0,we.missingFields=[],he.forEach(ne=>{const Pe=ne.key.split(".");let Be=_;for(const Ce of Pe)Be=Be==null?void 0:Be[Ce];Be&&(!Array.isArray(Be)||Be.length>0)&&(typeof Be!="object"||Object.keys(Be).length>0)?we.completedFields++:we.missingFields.push(ne.name)});const Ae=Math.round(we.completedFields/we.totalFields*100);Ae>0&&(ue=Ae)}let Ge=X(F+"seo",55,95),Oe={hasDescription:!0,hasKeywords:!0,hasCategories:!0};if(_&&(_.title||_.name)){let he=0;Oe={hasDescription:!1,hasKeywords:!1,hasCategories:!1},(ce=_.profile)!=null&&ce.description&&_.profile.description.length>50&&(Oe.hasDescription=!0,he+=33),(me=_.profile)!=null&&me.description&&_.profile.description.length>100&&(Oe.hasKeywords=!0,he+=33),_.categories&&(_.categories.length>0||_.categories.primaryCategory)&&(Oe.hasCategories=!0,he+=34),he>0&&(Ge=he)}let ze=0,A={totalReviews:0,reviewsLast30Days:0,reviewsPerWeek:0,repliedReviews:0,replyRate:0};if(P&&P.reviews){A.totalReviews=P.reviews.length;const he=new Date;he.setDate(he.getDate()-30),A.reviewsLast30Days=P.reviews.filter(Ae=>new Date(Ae.createTime)>=he).length,A.reviewsPerWeek=A.reviewsLast30Days/30*7,A.reviewsPerWeek>=2?ze=100:A.reviewsPerWeek>=1?ze=50:A.reviewsPerWeek>0&&(ze=25),A.repliedReviews=P.reviews.filter(Ae=>Ae.reviewReply||Ae.reply).length,A.replyRate=A.totalReviews>0?A.repliedReviews/A.totalReviews*100:0}const z=Math.round(A.replyRate),se=Math.round(re*.15+te*.15+ue*.2+Ge*.2+ze*.15+z*.15);return{overall:Math.round(se),performance:Math.round(re),engagement:Math.round(te),searchRank:je,profileCompletion:Math.round(ue),seoScore:Math.round(Ge),reviewScore:Math.round(ze),reviewReplyScore:Math.round(z),profileCompletionDetails:we,seoDetails:Oe,reviewDetails:A}},H=async()=>{if(!c||c.length===0||!x){K({title:"No Data Available",description:"Please fetch performance data first before generating AI insights.",variant:"destructive"});return}b(!0);try{const D=c.slice(-7),_=D.reduce((se,ce)=>se+ce.views,0),P=D.reduce((se,ce)=>se+ce.impressions,0),F=D.reduce((se,ce)=>se+ce.calls,0),re=D.reduce((se,ce)=>se+ce.websiteClicks,0),te=D.reduce((se,ce)=>se+ce.directionRequests,0),je=(_/7).toFixed(1),ue=(P/7).toFixed(1),we=P>0?((F+re+te)/P*100).toFixed(2):"0",Oe=c.slice(-14,-7).reduce((se,ce)=>se+ce.views,0),ze=Oe>0?((_-Oe)/Oe*100).toFixed(1):"N/A",A=`You are an expert Google Business Profile consultant. Analyze this data and provide concise, actionable insights.

Business: ${J==null?void 0:J.name}
Overall Score: ${x.overall}% | Performance: ${x.performance}% | Engagement: ${x.engagement}%

Last 7 Days: ${_} views, ${P} impressions, ${F} calls, ${re} clicks, ${te} directions
Conversion Rate: ${we}% | Trend: ${ze}%

Provide a brief, scannable analysis in this exact format (NO hashtags, NO emojis, short sentences):

PERFORMANCE SUMMARY
[2-3 sentences about current performance]

KEY STRENGTHS
• [strength 1]
• [strength 2]
• [strength 3]

AREAS TO IMPROVE
• [area 1]
• [area 2]
• [area 3]

TOP 3 ACTIONS
1. [specific action with expected impact]
2. [specific action with expected impact]
3. [specific action with expected impact]

Keep it professional, specific with numbers, and under 200 words total.`,z=await Zi(A,"gpt-4o");S(z),K({title:"AI Insights Generated",description:"Detailed analysis and recommendations are ready."})}catch(D){console.error("Error generating AI insights:",D),K({title:"Error Generating Insights",description:"Unable to generate AI insights. Please try again.",variant:"destructive"})}finally{b(!1)}};if(!n)return e.jsx("div",{className:"h-full flex items-center justify-center p-6",children:e.jsxs(w,{className:"max-w-md w-full",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ve,{className:"h-8 w-8 text-primary"})}),e.jsx(B,{className:"text-xl",children:"Connect Google Business Profile"})]}),e.jsxs(k,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Connect your Google Business Profile to access the audit tool and performance insights."}),e.jsx(N,{asChild:!0,children:e.jsx("a",{href:"/dashboard/settings",children:"Go to Settings"})})]})]})});if(o||!a||L.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:a?"Loading your business profiles...":"Initializing..."})]})});const J=ae.find(D=>D.id===i);return e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"Business Profile Audit"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Real-time performance insights and optimization recommendations"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4 w-full lg:w-auto",children:[y&&e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Last updated: ",y.toLocaleTimeString()]}),g&&e.jsxs("p",{className:"text-xs opacity-75",children:["Auto-refresh: ",Math.floor(U/6e4)," min"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(N,{onClick:()=>I(!g),variant:g?"default":"outline",size:"sm",className:"text-xs sm:text-sm",children:g?"🔄 Live":"📍 Manual"}),e.jsxs(N,{onClick:()=>R(i),disabled:v,size:"sm",className:"text-xs sm:text-sm",children:[v?e.jsx(Me,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-1 sm:mr-2"}):e.jsx(Me,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]})]}),J&&e.jsx(w,{className:"border-2 border-primary/20 bg-gradient-to-r from-blue-50/50 to-purple-50/30",children:e.jsx(k,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Is,{className:"h-5 w-5 text-primary"})}),e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full animate-pulse border-2 border-white"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Audit Analysis For:"}),e.jsx("span",{className:"text-sm font-bold text-primary",children:J.name})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[J.accountName," • ",y?`Updated ${y.toLocaleTimeString()}`:"No data"]})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Live"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ns,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:[x.overall,"%"]})]})]})]})})}),e.jsxs(w,{className:"border-2 border-primary/40 shadow-lg",children:[e.jsxs(O,{className:"bg-primary/5 border-b border-border/60",children:[e.jsxs(B,{className:"text-xl flex items-center gap-2",children:[e.jsx(as,{className:"h-6 w-6 text-primary"}),"Select Business Profile to Audit"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-base text-muted-foreground",children:"Choose which business profile you want to analyze"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[ae.length," of ",L.length," profiles available",(d==null?void 0:d.profileCount)&&e.jsxs("span",{className:"ml-2 text-primary font-medium",children:["(Plan: ",d.profileCount," profiles)"]})]})]})]}),e.jsxs(k,{className:"space-y-4 pt-6",children:[e.jsx("div",{className:"w-full",children:e.jsxs(De,{value:i,onValueChange:D=>{if(L.findIndex(P=>P.id===D)>=C){K({title:"Profile Locked",description:`This profile requires an upgrade. You have access to ${C} profile${C===1?"":"s"}.`,variant:"destructive"});return}h(D)},children:[e.jsx(Ie,{className:"w-full h-14 text-base font-medium border-2 border-primary/40 bg-card hover:border-primary focus:ring-4 focus:ring-primary/20",children:e.jsx(Fe,{placeholder:"Select a business profile to audit...",children:i&&(()=>{const D=L.find(_=>_.id===i);return D?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:D.name}),e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"})]}):null})()})}),e.jsxs(Ee,{children:[ae.length>0&&e.jsxs(_a,{children:[e.jsx(xa,{children:"Available Profiles"}),ae.map(D=>e.jsx(G,{value:D.id,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:D.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:D.accountName})]}),e.jsx("div",{className:"ml-2 w-2 h-2 bg-green-500 rounded-full flex-shrink-0"})]})},D.id))]}),E.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(fn,{}),e.jsxs(_a,{children:[e.jsxs(xa,{className:"flex items-center gap-2",children:[e.jsx(Vs,{className:"h-3 w-3 text-yellow-600"}),"Locked Profiles (Upgrade Required)"]}),E.map(D=>e.jsx(G,{value:D.id,disabled:!0,className:"opacity-60",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-500",children:D.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:D.accountName})]}),e.jsxs("div",{className:"ml-2 flex items-center gap-1",children:[e.jsx(Vs,{className:"h-3 w-3 text-yellow-500"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})]})]})},D.id))]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[J&&e.jsx("div",{className:"p-4 bg-green-950/20 border-2 border-green-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-400",children:"Selected Profile"}),e.jsx("p",{className:"text-sm text-green-300",children:J.name}),e.jsx("p",{className:"text-xs text-green-400/80",children:J.accountName})]}),e.jsx(ee,{className:"bg-green-500/20 text-green-300 border border-green-500/40",children:"Active"})]})}),E.length>0&&e.jsx("div",{className:"p-4 bg-orange-950/20 border-2 border-orange-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vs,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-orange-300",children:[E.length," profile",E.length===1?"":"s"," locked"]}),e.jsxs("p",{className:"text-sm text-orange-400/90 mt-1",children:["Upgrade to audit all ",L.length," profiles"]})]}),e.jsxs(N,{size:"sm",className:"flex items-center gap-2",onClick:()=>window.location.href="/dashboard/billing",children:[e.jsx(Vs,{className:"h-4 w-4"}),"Upgrade"]})]})})]})]})]}),!i&&e.jsxs(w,{className:"max-w-2xl mx-auto border-dashed border-2",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(as,{className:"h-8 w-8 text-blue-600"})}),e.jsx(B,{className:"text-xl",children:"Select a Business Profile"})]}),e.jsxs(k,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Please select a business profile from the dropdown above to begin the audit analysis."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-blue-600",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{children:"Ready to analyze your Google Business Profile performance"})]})]})]}),!x&&i&&!v&&e.jsxs(w,{className:"max-w-2xl mx-auto",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Ve,{className:"h-8 w-8 text-blue-600"})}),e.jsx(B,{className:"text-xl",children:"Performance Data Unavailable"})]}),e.jsxs(k,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Unable to retrieve performance metrics for this business profile."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Common Reasons:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-2",children:[e.jsx("li",{children:"• Profile needs to be verified in Google Business Profile"}),e.jsx("li",{children:"• Insufficient historical data (requires 18+ months of activity)"}),e.jsx("li",{children:"• Profile doesn't meet eligibility requirements for Performance API"}),e.jsx("li",{children:"• Recent changes may take 24-48 hours to reflect"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{onClick:()=>window.open("https://business.google.com","_blank"),className:"flex-1",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Manage Profile"]}),e.jsxs(N,{onClick:()=>R(i),disabled:v,variant:"outline",className:"flex-1",children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${v?"animate-spin":""}`}),"Retry"]})]})]})]}),x&&e.jsxs(et,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Ws,{className:"grid w-full grid-cols-3",children:[e.jsx(Ue,{value:"overview",children:"Overview"}),e.jsx(Ue,{value:"performance",children:"Performance"}),e.jsx(Ue,{value:"insights",children:"Insights"})]}),e.jsxs(Le,{value:"overview",className:"space-y-6",children:[e.jsx(w,{className:"border-2 border-blue-500/30 bg-blue-950/20",children:e.jsxs(k,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm",children:e.jsxs("svg",{className:"w-7 h-7",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),e.jsx("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),e.jsx("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),e.jsx("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg mb-1",children:"Google Search Rank"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. position of your business on Google Search"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-5xl font-bold ${x.searchRank<=5?"text-green-500":x.searchRank<=10?"text-yellow-500":"text-red-500"}`,children:x.searchRank}),e.jsx("p",{className:`text-sm font-semibold mt-1 ${x.searchRank<=5?"text-green-500":x.searchRank<=10?"text-yellow-500":"text-red-500"}`,children:x.searchRank<=5?"Good":x.searchRank<=10?"Average":"Poor"})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-foreground",children:"Good"}),e.jsx("span",{className:"text-muted-foreground",children:"Less than 5"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-foreground",children:"Average"}),e.jsx("span",{className:"text-muted-foreground",children:"Between 6-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-foreground",children:"Poor"}),e.jsx("span",{className:"text-muted-foreground",children:"Beyond 10"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(w,{className:"border-2 border-border/60",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Profile Completion"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"text-5xl font-bold text-foreground",children:[x.profileCompletion,"%"]}),e.jsx("span",{className:`text-lg font-semibold mb-2 ${x.profileCompletion>=90?"text-green-600":x.profileCompletion>=70?"text-yellow-600":"text-red-500"}`,children:x.profileCompletion>=90?"Excellent":x.profileCompletion>=70?"Average":"Poor"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[((xe=x.profileCompletionDetails)==null?void 0:xe.missingFields.length)||0," fields are missing"]})]})})}),e.jsx(w,{className:"border-2 border-border/60",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"SEO Score"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"text-5xl font-bold text-foreground",children:[x.seoScore,"%"]}),e.jsx("span",{className:`text-lg font-semibold mb-2 ${x.seoScore>=80?"text-green-600":x.seoScore>=60?"text-yellow-600":"text-red-500"}`,children:x.seoScore>=80?"Good":x.seoScore>=60?"Average":"Poor"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:(W=x.seoDetails)!=null&&W.hasKeywords?(V=x.seoDetails)!=null&&V.hasDescription?(de=x.seoDetails)!=null&&de.hasCategories?"All SEO elements present":"Categories missing":"Description missing":"Keywords missing"})]})})}),e.jsx(w,{className:"border-2 border-border/60",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Review Score"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"text-5xl font-bold text-foreground",children:[e.jsx("span",{children:((pe=x.reviewDetails)==null?void 0:pe.reviewsPerWeek.toFixed(1))||"0"}),e.jsx("span",{className:"text-2xl text-muted-foreground",children:"/week"})]}),e.jsx("span",{className:`text-lg font-semibold mb-2 ${x.reviewScore>=80?"text-green-600":x.reviewScore>=40?"text-yellow-600":"text-red-500"}`,children:x.reviewScore>=80?"Excellent":x.reviewScore>=40?"Average":"Poor"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ideal - 2 per week"})]})})}),e.jsx(w,{className:"border-2 border-border/60",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Review Reply Score"}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"text-5xl font-bold text-foreground",children:[x.reviewReplyScore,"%"]}),e.jsx("span",{className:`text-lg font-semibold mb-2 ${x.reviewReplyScore>=80?"text-green-600":x.reviewReplyScore>=50?"text-yellow-600":"text-red-500"}`,children:x.reviewReplyScore>=80?"Excellent":x.reviewReplyScore>=50?"Average":"Poor"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ideal - above 80% (",((qe=x.reviewDetails)==null?void 0:qe.repliedReviews)||0,"/",((Ke=x.reviewDetails)==null?void 0:Ke.totalReviews)||0," replied)"]})]})})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"border-2 border-border/60",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ht,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.slice(-7).reduce((D,_)=>D+_.views,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Views (7d)"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.slice(-7).reduce((D,_)=>D+_.impressions,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Impressions (7d)"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{className:"h-4 w-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.slice(-7).reduce((D,_)=>D+_.calls,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calls (7d)"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ya,{className:"h-4 w-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.slice(-7).reduce((D,_)=>D+_.websiteClicks,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Website Clicks (7d)"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.slice(-7).reduce((D,_)=>D+_.directionRequests,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Directions (7d)"})]})]})})})]})})]}),e.jsxs(Le,{value:"performance",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ds,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Performance"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Performance metrics for ",e.jsx("span",{className:"font-medium text-foreground",children:J==null?void 0:J.name})]})]})]}),e.jsx(ee,{variant:"secondary",className:"px-3 py-1",children:J==null?void 0:J.accountName})]}),e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(B,{children:"Performance Trends (Last 30 Days)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your business profile performance over time"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:Q==="area"?"default":"outline",size:"sm",onClick:()=>Z("area"),children:"Area"}),e.jsx(N,{variant:Q==="line"?"default":"outline",size:"sm",onClick:()=>Z("line"),children:"Line"})]})]})}),e.jsx(k,{children:c.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-80",children:e.jsx(ks,{width:"100%",height:"100%",children:Q==="area"?e.jsxs(ma,{data:c.map(D=>({...D,date:new Date(D.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ts,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(Rs,{dataKey:"date",tick:{fontSize:12},interval:"preserveStartEnd"}),e.jsx(Ss,{tick:{fontSize:12}}),e.jsx(ps,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(As,{}),e.jsx(Ys,{type:"monotone",dataKey:"views",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Views"}),e.jsx(Ys,{type:"monotone",dataKey:"impressions",stackId:"2",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Impressions"}),e.jsx(Ys,{type:"monotone",dataKey:"calls",stackId:"3",stroke:"#f59e0b",fill:"#f59e0b",fillOpacity:.6,name:"Calls"}),e.jsx(Ys,{type:"monotone",dataKey:"websiteClicks",stackId:"4",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.6,name:"Website Clicks"}),e.jsx(Ys,{type:"monotone",dataKey:"directionRequests",stackId:"5",stroke:"#ef4444",fill:"#ef4444",fillOpacity:.6,name:"Direction Requests"})]}):e.jsxs(jt,{data:c.map(D=>({...D,date:new Date(D.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})),margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ts,{strokeDasharray:"3 3",className:"opacity-30"}),e.jsx(Rs,{dataKey:"date",tick:{fontSize:12},interval:"preserveStartEnd"}),e.jsx(Ss,{tick:{fontSize:12}}),e.jsx(ps,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(As,{}),e.jsx(gs,{type:"monotone",dataKey:"views",stroke:"#3b82f6",strokeWidth:2,dot:{r:4},name:"Views"}),e.jsx(gs,{type:"monotone",dataKey:"impressions",stroke:"#10b981",strokeWidth:2,dot:{r:4},name:"Impressions"}),e.jsx(gs,{type:"monotone",dataKey:"calls",stroke:"#f59e0b",strokeWidth:2,dot:{r:4},name:"Calls"}),e.jsx(gs,{type:"monotone",dataKey:"websiteClicks",stroke:"#8b5cf6",strokeWidth:2,dot:{r:4},name:"Website Clicks"}),e.jsx(gs,{type:"monotone",dataKey:"directionRequests",stroke:"#ef4444",strokeWidth:2,dot:{r:4},name:"Direction Requests"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(c.reduce((D,_)=>D+_.views,0)/c.length).toFixed(0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Daily Views"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(c.reduce((D,_)=>D+_.impressions,0)/c.length).toFixed(0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Daily Impressions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(c.reduce((D,_)=>D+_.calls,0)/c.length).toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Daily Calls"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(c.reduce((D,_)=>D+_.websiteClicks,0)/c.length).toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Daily Clicks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:(c.reduce((D,_)=>D+_.directionRequests,0)/c.length).toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Daily Directions"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Is,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No performance data available"})]})})]})]}),e.jsxs(Le,{value:"insights",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between border-b pb-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(Ns,{className:"h-5 w-5 sm:h-6 sm:w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Insights"}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Business insights for ",e.jsx("span",{className:"font-medium text-foreground",children:J==null?void 0:J.name})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx(N,{onClick:H,disabled:p||!c||c.length===0,size:"sm",className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-xs sm:text-sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Analyzing..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Generate AI Insights"}),e.jsx("span",{className:"sm:hidden",children:"Insights"})]})}),e.jsx(ee,{variant:"secondary",className:"px-2 sm:px-3 py-1 text-xs",children:J==null?void 0:J.accountName})]})]}),$&&e.jsxs(w,{className:"border-2 border-blue-200 bg-white shadow-lg",children:[e.jsxs(O,{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-b",children:[e.jsxs(B,{className:"flex flex-wrap items-center gap-2 text-gray-900 text-base sm:text-lg",children:[e.jsx(Ns,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"}),e.jsx("span",{className:"text-sm sm:text-base",children:"AI-Powered Insights"}),e.jsx(ee,{className:"bg-blue-600 text-white text-xs",children:"GPT-4"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:["Expert recommendations for ",J==null?void 0:J.name]})]}),e.jsx(k,{className:"pt-4 sm:pt-6",children:e.jsx("div",{className:"space-y-4 sm:space-y-6",children:$.split(`

`).map((D,_)=>{var te;const P=D.split(`
`),F=(te=P[0])==null?void 0:te.trim(),re=P.slice(1);return F?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-xs sm:text-sm text-blue-900 uppercase tracking-wide",children:F}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-700 space-y-1 pl-1",children:re.map((je,ue)=>e.jsx("div",{className:je.trim().startsWith("•")||je.trim().match(/^\d\./)?"ml-2":"",children:je},ue))})]},_):null})})})]}),!$&&!p&&e.jsx(w,{className:"border-2 border-dashed border-blue-200",children:e.jsxs(k,{className:"py-8 sm:py-12 text-center px-4",children:[e.jsx("div",{className:"mx-auto mb-3 sm:mb-4 h-12 w-12 sm:h-16 sm:w-16 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Ns,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-2",children:"Get AI-Powered Insights"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-4 max-w-md mx-auto",children:"Get a concise analysis with key strengths, areas to improve, and top 3 actions to boost your profile performance."}),e.jsxs(N,{onClick:H,disabled:!c||c.length===0,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 w-full sm:w-auto",size:"sm",children:[e.jsx(Ns,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Generate Insights"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{className:"flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Real-time Monitoring"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),"Manual Updates"]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g?"Data automatically refreshes every 5 minutes":"Click refresh to update data manually"})]}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Data Source"}),e.jsx(ee,{variant:"outline",children:"Google Business Profile API"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Update Frequency"}),e.jsx("span",{className:"text-sm font-medium",children:g?`${Math.floor(U/6e4)} minutes`:"Manual"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Last Refresh"}),e.jsx("span",{className:"text-sm font-medium",children:y?y.toLocaleTimeString():"Never"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Data Points"}),e.jsxs("span",{className:"text-sm font-medium",children:[c.length," days"]})]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Performance Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Key metrics overview (last 7 days)"})]}),e.jsx(k,{className:"space-y-3",children:c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Total Views"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:c.slice(-7).reduce((D,_)=>D+_.views,0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Impressions"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:c.slice(-7).reduce((D,_)=>D+_.impressions,0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Customer Actions"}),e.jsx("span",{className:"text-lg font-bold text-purple-600",children:c.slice(-7).reduce((D,_)=>D+_.calls+_.websiteClicks+_.directionRequests,0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"View Rate"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:[(c.slice(-7).reduce((D,_)=>D+_.views,0)/c.slice(-7).reduce((D,_)=>D+_.impressions,0)*100).toFixed(1),"%"]})]})]})})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Business Insights"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"AI-powered insights about your Google Business Profile performance"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("h4",{className:"font-medium",children:"Visibility Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your profile visibility has been ",c.length>14?c.slice(-7).reduce((D,_)=>D+_.views,0)>c.slice(-14,-7).reduce((D,_)=>D+_.views,0)?"increasing 📈":"decreasing 📉":"stable 📋"," over the past week."]}),c.length>14&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Change: ",((c.slice(-7).reduce((D,_)=>D+_.views,0)-c.slice(-14,-7).reduce((D,_)=>D+_.views,0))/c.slice(-14,-7).reduce((D,_)=>D+_.views,0)*100).toFixed(1),"% vs. previous week"]})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[e.jsx("h4",{className:"font-medium",children:"Customer Actions"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Customers are most likely to ",c.length>0&&(c.slice(-7).reduce((D,_)=>D+_.calls,0)>c.slice(-7).reduce((D,_)=>D+_.websiteClicks,0)?"call your business 📞":"visit your website 🌐")," after viewing your profile."]}),c.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Action rate: ",(c.slice(-7).reduce((D,_)=>D+_.calls+_.websiteClicks+_.directionRequests,0)/c.slice(-7).reduce((D,_)=>D+_.views,0)*100).toFixed(1),"% of viewers take action"]})]}),e.jsxs("div",{className:"border-l-4 border-orange-500 pl-4",children:[e.jsx("h4",{className:"font-medium",children:"Optimization Opportunity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.overall<80?"Improve your business profile performance to increase visibility. 🎯":"Your profile is performing well. Keep up the great work! ✅"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Overall score: ",x.overall,"%"]})]}),e.jsxs("div",{className:"border-l-4 border-purple-500 pl-4",children:[e.jsx("h4",{className:"font-medium",children:"Industry Benchmark"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your engagement rate is ",x.engagement>60?"above 🚀":"below 📉"," industry average.",x.engagement>60?" Keep up the great work!":" Consider posting more engaging content."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Engagement score: ",x.engagement,"% (target: 60%+)"]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Quick Win Recommendations"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Post 2-3 times weekly"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Respond to all reviews"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Add 5+ photos monthly"})]})]})]})]})]})]})]})]})},Bl=()=>{const r=_e();return l.useEffect(()=>{r("/dashboard/billing")},[r]),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Redirecting to billing page..."})})})},Ml=()=>{const[r,s]=l.useState(!1),[t,a]=l.useState([]),[n,o]=l.useState(!1),[d,m]=l.useState(!1),{subscription:i,status:h,daysRemaining:c,plans:u,cancelSubscription:x,isLoading:f}=Je();Ye(),ss();const v="http://localhost:5000";l.useEffect(()=>{if(i!=null&&i.gbpAccountId&&(T(),(i==null?void 0:i.status)==="active"&&(i!=null&&i.lastPaymentDate))){const g=new Date(i.lastPaymentDate),I=new Date(Date.now()-5*60*1e3);g>I&&(m(!0),setTimeout(()=>m(!1),1e4))}},[i]);const T=async()=>{if(i!=null&&i.gbpAccountId){o(!0);try{const g=await fetch(`${v}/api/payment/subscription/${i.gbpAccountId}/payments`);if(g.ok){const U=(await g.json()).payments||(i==null?void 0:i.paymentHistory)||[];a(U)}}catch(g){console.error("Error fetching payment history:",g),i!=null&&i.paymentHistory&&a(i.paymentHistory)}finally{o(!1)}}},y=g=>{switch(g){case"trial":return e.jsx(ee,{className:"bg-blue-100 text-blue-800",children:"Free Trial"});case"active":return e.jsx(ee,{className:"bg-green-100 text-green-800",children:"Active"});case"expired":return e.jsx(ee,{className:"bg-red-100 text-red-800",children:"Expired"});case"cancelled":return e.jsx(ee,{className:"bg-gray-100 text-gray-800",children:"Cancelled"});default:return e.jsx(ee,{children:"No Subscription"})}},j=i!=null&&i.planId?u.find(g=>g.id===i.planId):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Billing & Subscription"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your subscription and payment details"})]}),d&&e.jsxs(Hs,{className:"bg-green-50 border-green-200",children:[e.jsx(zs,{className:"h-4 w-4 text-green-600"}),e.jsxs(Js,{className:"text-green-800",children:[e.jsx("strong",{children:"Congratulations!"})," Your subscription has been successfully upgraded. All premium features are now unlocked!"]})]}),e.jsxs(w,{className:h==="active"?"border-2 border-green-500 ring-4 ring-green-200 shadow-xl rounded-2xl":"border-2 border-blue-500 shadow-lg rounded-2xl",children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Current Subscription"}),h==="active"&&e.jsx($e,{className:"h-5 w-5 text-green-500"})]}),e.jsx(ge,{children:"Your active plan and billing details"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Status:"}),y(h)]}),c!==null&&h==="trial"&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c," days remaining in your free trial"]}),h==="active"&&(i==null?void 0:i.subscriptionEndDate)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Next billing date: ",Xe(new Date(i.subscriptionEndDate),"MMM dd, yyyy")]})]}),h==="expired"||h==="none"?e.jsxs(N,{onClick:()=>s(!0),children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Get Started"]}):h==="trial"?e.jsxs(N,{variant:"outline",onClick:()=>s(!0),children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Upgrade to Pro"]}):h==="active"?e.jsxs(N,{variant:"outline",onClick:()=>s(!0),children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Upgrade Plan"]}):null]}),j&&h==="active"&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 mb-3",children:[e.jsx("h4",{className:"font-semibold text-green-900 mb-1",children:j.name}),e.jsx("p",{className:"text-sm text-green-700",children:"Your premium plan is active"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Billing Amount:"}),e.jsxs("p",{className:"font-medium text-lg",children:["₹",j.amount,"/",j.interval]})]}),(i==null?void 0:i.lastPaymentDate)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Payment:"}),e.jsx("p",{className:"font-medium",children:Xe(new Date(i.lastPaymentDate),"MMM dd, yyyy")})]}),(i==null?void 0:i.subscriptionStartDate)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Started:"}),e.jsx("p",{className:"font-medium",children:Xe(new Date(typeof i.subscriptionStartDate=="string"?i.subscriptionStartDate:i.subscriptionStartDate.seconds*1e3),"MMM dd, yyyy")})]}),(i==null?void 0:i.subscriptionEndDate)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Next Billing:"}),e.jsx("p",{className:"font-medium",children:Xe(new Date(i.subscriptionEndDate),"MMM dd, yyyy")})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Premium Features Unlocked:"})," Unlimited Google Business Profiles, unlimited posts, priority support"]})})]}),h==="trial"&&j&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Trial Plan"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Enjoying full access during your ",c,"-day trial period"]})]})]})]}),e.jsxs(et,{defaultValue:"plans",className:"space-y-4",children:[e.jsxs(Ws,{children:[e.jsx(Ue,{value:"plans",children:"Available Plans"}),e.jsx(Ue,{value:"history",children:"Payment History"})]}),e.jsx(Le,{value:"plans",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 mt-8",children:[u.map(g=>e.jsxs("div",{className:"relative pt-6",children:[(j==null?void 0:j.id)===g.id&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 z-10",children:e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-1.5 rounded-full text-xs font-bold shadow-lg whitespace-nowrap",children:"CURRENT PLAN"})}),e.jsxs(w,{className:`transition-all duration-300 rounded-2xl ${(j==null?void 0:j.id)===g.id?"border-2 border-green-500 ring-4 ring-green-200 shadow-xl":"border-2 border-blue-500 shadow-lg"}`,children:[e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:"text-lg",children:g.name}),g.id==="pro_yearly"&&e.jsx(ee,{className:"bg-green-100 text-green-800",children:"Best Value"})]}),e.jsxs(ge,{className:"text-2xl font-bold text-foreground mt-2",children:["₹",g.amount]})]}),e.jsxs(k,{children:[e.jsx("ul",{className:"space-y-2",children:g.features.map((I,U)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm",children:I})]},U))}),(j==null?void 0:j.id)!==g.id&&e.jsx(N,{className:"w-full mt-4",onClick:()=>s(!0),children:h==="active"?"Switch to this Plan":"Get Started"}),(j==null?void 0:j.id)===g.id&&e.jsx("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:"Current Plan"})]})]})]},g.id)),e.jsx("div",{className:"relative pt-6",children:e.jsxs(w,{className:"bg-gradient-to-br from-slate-800 to-slate-900 border-2 border-blue-500 shadow-xl rounded-2xl",children:[e.jsx(O,{className:"border-b border-slate-700 pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-14 w-14 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(Mo,{className:"h-7 w-7 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-2xl text-white font-bold",children:"Need Help?"}),e.jsx(ge,{className:"text-slate-300 mt-1 font-medium",children:"We're here to assist you with any questions or concerns"})]})]})}),e.jsxs(k,{className:"space-y-4 pt-6",children:[e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed font-medium",children:"Our support team is ready to help you get the most out of your subscription. Reach out to us through any of the following channels:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-800/50 rounded-xl border-2 border-blue-500/30",children:[e.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx(Ds,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-white mb-1",children:"Email Support"}),e.jsx("a",{href:"mailto:Support@googleranker.com",className:"text-sm text-blue-400 hover:text-blue-300 font-semibold hover:underline break-all",children:"Support@googleranker.com"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-800/50 rounded-xl border-2 border-green-500/30",children:[e.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-green-600 to-green-700 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx(_o,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-white mb-1",children:"WhatsApp Support"}),e.jsx("a",{href:"https://wa.me/917710616166",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-green-400 hover:text-green-300 font-semibold hover:underline",children:"+91 7710616166"})]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-slate-800/50 rounded-xl border-2 border-slate-600",children:e.jsxs("p",{className:"text-xs text-slate-300 leading-relaxed font-medium",children:[e.jsx("strong",{className:"text-white font-bold",children:"Response Time:"})," We typically respond within 24 hours on business days. Premium subscribers receive priority support."]})})]})]})})]})}),e.jsx(Le,{value:"history",className:"space-y-4",children:e.jsxs(w,{className:"border-2 border-blue-500 shadow-lg rounded-2xl",children:[e.jsxs(O,{children:[e.jsx(B,{children:"Payment History"}),e.jsx(ge,{children:"Your past transactions and invoices"})]}),e.jsx(k,{children:n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Me,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):t.length>0?e.jsx("div",{className:"space-y-3",children:t.map((g,I)=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[g.status==="success"?e.jsx($e,{className:"h-5 w-5 text-green-500"}):g.status==="failed"?e.jsx(Wt,{className:"h-5 w-5 text-red-500"}):e.jsx(ns,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["₹",g.amount]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g.paidAt?Xe(new Date(g.paidAt),"MMM dd, yyyy HH:mm"):g.createdAt?Xe(new Date(typeof g.createdAt=="string"?g.createdAt:g.createdAt.seconds*1e3),"MMM dd, yyyy"):"Date not available"}),g.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:g.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{variant:g.status==="success"?"default":g.status==="failed"?"destructive":"secondary",children:g.status}),g.razorpayPaymentId&&e.jsx(N,{variant:"ghost",size:"sm",children:e.jsx(Ra,{className:"h-4 w-4"})})]})]},g.razorpayPaymentId||I))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ra,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No payment history yet"})]})})]})})]}),e.jsx(Sa,{isOpen:r,onClose:()=>s(!1)})]})},qa=()=>{const{toast:r}=ss(),{locationId:s}=Vr(),[t]=zo(),[a,n]=l.useState(null),[o,d]=l.useState(!0),m=(a==null?void 0:a.locationName)||t.get("business")||"Business",i=(a==null?void 0:a.address)||t.get("location")||"Location";a!=null&&a.placeId||t.get("placeId");const h=(a==null?void 0:a.googleReviewLink)||t.get("googleReviewLink")||"";console.log("🔍 PUBLIC REVIEW PAGE LOADED:"),console.log("🔍 Full URL:",window.location.href),console.log("🔍 Location ID from params:",s),console.log("🔍 Search params string:",window.location.search),console.log("🔍 Business Name:",m),console.log("🔍 Location:",i),console.log("🔍 Google Review Link:",h),console.log("🔍 All URL parameters:"),t.forEach((S,p)=>{console.log(`  ${p}: ${S}`)});const[c,u]=l.useState([]),[x,f]=l.useState(!0),[v,T]=l.useState(null),[y,j]=l.useState(!0),g="http://localhost:5000",I=async()=>{if(!s){console.log("🔍 No location ID provided, using URL parameters only"),d(!1);return}try{console.log("🔍 Fetching QR code data for location:",s);const S=new AbortController,p=setTimeout(()=>S.abort(),5e3),b=await fetch(`${g}/api/qr-codes/${s}`,{signal:S.signal});if(clearTimeout(p),b.ok){const L=await b.json();console.log("✅ QR code data received:",L),n(L.qrCode)}else console.log("⚠️ QR code not found, using URL parameters as fallback")}catch(S){console.log("⚠️ Error fetching QR code data (using fallback):",S.message)}finally{d(!1)}};l.useEffect(()=>{I(),U();const S=()=>{window.scrollY>100&&j(!1)};return window.addEventListener("scroll",S),()=>window.removeEventListener("scroll",S)},[s]);const U=async()=>{const S=q();u(S),f(!1);try{console.log("Loading fallback reviews instantly, fetching AI reviews in background...");const p=new AbortController,b=setTimeout(()=>p.abort(),2e3),L=await fetch(`${g}/api/ai-reviews/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({businessName:decodeURIComponent(m),location:decodeURIComponent(i),businessType:"business"}),signal:p.signal});if(clearTimeout(b),L.ok){const C=await L.json();console.log("✅ AI reviews loaded, replacing fallback reviews"),u(C.suggestions||S)}else console.log("AI reviews failed, keeping fallback reviews")}catch(p){console.log("AI reviews timeout/error, keeping fallback reviews:",p.message)}},q=()=>{const S=decodeURIComponent(m),p=decodeURIComponent(i),b=p&&p!=="Location"?` in ${p}`:"";return[{id:"fallback_1",review:`Great experience at ${S}${b}! The service was excellent and the staff was very professional. I would definitely recommend this business to others. Thank you for the wonderful service!`,rating:5,focus:"service",length:"medium",keywords:["service","professional","recommend"]},{id:"fallback_2",review:`${S} provided exactly what I was looking for. The quality was outstanding and the attention to detail was impressive. Will definitely be returning as a satisfied customer.`,rating:4,focus:"quality",length:"medium",keywords:["quality","outstanding","satisfied"]},{id:"fallback_3",review:`Highly recommend ${S}${b}! The team was friendly, knowledgeable, and went above and beyond to help. Excellent customer service all around.`,rating:5,focus:"staff",length:"medium",keywords:["friendly","knowledgeable","customer service"]},{id:"fallback_4",review:`Amazing atmosphere at ${S}! The environment is welcoming and comfortable. Perfect place for what I needed. The overall experience exceeded my expectations completely.`,rating:5,focus:"atmosphere",length:"medium",keywords:["atmosphere","welcoming","comfortable"]},{id:"fallback_5",review:`Good value for money at ${S}${b}. Fair pricing and quality service. Would return for their reliable and consistent performance. Definitely worth visiting.`,rating:4,focus:"value",length:"medium",keywords:["value","fair pricing","reliable"]}]},Q=async(S,p)=>{try{await navigator.clipboard.writeText(S),T(p),r({title:"Review Copied!",description:"You can now paste this review on Google."}),setTimeout(()=>T(null),2e3)}catch{r({title:"Error",description:"Failed to copy. Please try selecting and copying manually.",variant:"destructive"})}},Z=()=>{if(console.log("🚀 BUTTON CLICKED: Write Review on Google button clicked!"),console.log("🔍 QR Code Data:",a),console.log("🔍 Google review link from QR data:",a==null?void 0:a.googleReviewLink),console.log("🔍 Google review link from URL params:",t.get("googleReviewLink")),console.log("🔍 Final googleReviewLink being used:",h),h&&h!=="undefined"&&h!==""&&h!=="null")try{let S=h;if(a&&a.googleReviewLink)console.log("✅ Using Google review link from QR code data (no decoding needed)"),S=a.googleReviewLink;else{console.log("🔄 Using Google review link from URL params (decoding needed)");try{if(S=decodeURIComponent(h),S.includes("%2F")||S.includes("%3A"))try{S=decodeURIComponent(S)}catch(b){console.error("❌ Second decodeURIComponent failed:",b)}}catch(b){console.error("❌ decodeURIComponent failed:",b),console.error("❌ Raw googleReviewLink causing error:",h),r({title:"Invalid Review Link",description:"The review link appears to be truncated. Please try generating a new QR code.",variant:"destructive"});return}}console.log("🎯 Final Google review link:",S),(S.includes("g.page")||S.includes("google.com")||S.includes("maps.app.goo.gl")||S.includes("search.google.com/local/writereview"))&&(S.startsWith("http://")||S.startsWith("https://"))?(console.log("✅ Opening Google review link:",S),window.open(S,"_blank","noopener,noreferrer")||(window.location.href=S)):(console.error("❌ Invalid or non-Google URL:",S),r({title:"Invalid Review Link",description:"The review link format is invalid. Please contact the business.",variant:"destructive"}))}catch(S){console.error("❌ Unexpected error in redirectToGoogleReviews:",S),r({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}else{const S=t.get("placeId");if(S){const p=`https://search.google.com/local/writereview?placeid=${S}`;console.log("🔄 Using fallback Google review URL:",p),window.open(p,"_blank","noopener,noreferrer")}else console.log("❌ No valid review link or place ID found"),r({title:"Review Link Not Available",description:"Please contact the business for their review link.",variant:"destructive"})}},$=S=>Array.from({length:5}).map((p,b)=>e.jsx(us,{className:`h-5 w-5 ${b<S?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},b));return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white",children:[e.jsx("div",{className:"bg-white shadow-sm border-b sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ms,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:decodeURIComponent(m)}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(as,{className:"h-3 w-3"}),e.jsx("span",{children:decodeURIComponent(i)})]})]})]})})})}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(w,{className:"bg-gradient-to-r from-primary to-blue-600 text-white border-0",children:e.jsxs(k,{className:"p-8 text-center",children:[e.jsx(zs,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Share Your Experience!"}),e.jsx("p",{className:"text-lg mb-6 opacity-90",children:"Your feedback helps us improve and helps others discover our business. Choose a review suggestion below or write your own!"}),y&&e.jsx("div",{className:"animate-bounce mt-4",children:e.jsx(Dt,{className:"h-8 w-8 mx-auto"})})]})})}),e.jsxs("div",{className:"container mx-auto px-4 pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Review Suggestions"}),e.jsx("p",{className:"text-muted-foreground",children:'Click on any suggestion to copy it, then click "Write Review" below and paste it in the Google review text box'})]}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-lg font-medium",children:"Generating personalized review suggestions..."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"This may take a few seconds"})]}),Array.from({length:5}).map((S,p)=>e.jsx(w,{className:"animate-pulse",children:e.jsxs(k,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/4 mb-3"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})},p))]}):e.jsx("div",{className:"space-y-4",children:c.map(S=>e.jsx(w,{className:"hover:shadow-lg transition-all cursor-pointer border-2 hover:border-primary/50",onClick:()=>Q(S.review,S.id),children:e.jsxs(k,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[$(S.rating),e.jsx(ee,{variant:"secondary",children:S.focus})]}),e.jsx(N,{size:"sm",variant:"ghost",className:"hover:bg-transparent",onClick:p=>{p.stopPropagation(),Q(S.review,S.id)},children:v===S.id?e.jsx(Bs,{className:"h-5 w-5 text-green-500"}):e.jsx(Jt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:S.review}),S.keywords&&S.keywords.length>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Keywords:"}),S.keywords.map((p,b)=>e.jsx(ee,{variant:"outline",className:"text-xs",children:p},b))]}),v===S.id&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-md",children:e.jsx("p",{className:"text-sm text-green-700 font-medium",children:'✓ Copied! Now click "Write Review on Google" below and paste (Ctrl+V) in the text box'})})]})},S.id))})]}),e.jsx("div",{className:"sticky bottom-0 bg-white border-t shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs(N,{onClick:Z,size:"lg",className:"w-full bg-gradient-to-r from-primary to-blue-600 hover:from-primary/90 hover:to-blue-600/90 text-lg py-6",children:[e.jsx(Es,{className:"mr-2 h-5 w-5"}),"Write Review on Google",e.jsx(pa,{className:"ml-2 h-4 w-4"})]})})})]})},Qe="http://localhost:5000",Tn=l.createContext(void 0),Cs=()=>{const r=l.useContext(Tn);if(r===void 0)throw new Error("useAdmin must be used within an AdminProvider");return r},_l=({children:r})=>{const{currentUser:s}=Ye(),[t,a]=l.useState(!1),[n,o]=l.useState(null),[d,m]=l.useState(!0),[i,h]=l.useState(null),[c,u]=l.useState([]),[x,f]=l.useState([]),[v,T]=l.useState([]),[y,j]=l.useState([]),[g,I]=l.useState(null),[U,q]=l.useState([]),[Q,Z]=l.useState(null);l.useEffect(()=>{(async()=>{if(!s){a(!1),o(null),m(!1);return}try{const V=await s.getIdTokenResult(!0),de=V.claims.role,pe=V.claims.adminLevel;console.log("[AdminContext] Token claims:",{role:de,level:pe}),a(de==="admin"),o(pe||"viewer")}catch(V){console.error("Error checking admin status:",V),a(!1),o(null)}finally{m(!1)}})()},[s]);const $=async()=>{if(!s)throw new Error("Not authenticated");return{Authorization:`Bearer ${await s.getIdToken(!0)}`,"Content-Type":"application/json"}},S=async()=>{try{const W=await $(),V=await fetch(`${Qe}/api/admin/dashboard/stats`,{headers:W});if(!V.ok)throw new Error("Failed to fetch dashboard stats");const de=await V.json();h(de.data)}catch(W){console.error("Error fetching dashboard stats:",W),K({title:"Error",description:W.message||"Failed to fetch dashboard statistics",variant:"destructive"})}},p=async(W={})=>{try{const V=await $(),de=new URLSearchParams(W).toString(),pe=await fetch(`${Qe}/api/admin/users?${de}`,{headers:V});if(!pe.ok)throw new Error("Failed to fetch users");const qe=await pe.json();u(qe.data.users||[])}catch(V){console.error("Error fetching users:",V),K({title:"Error",description:V.message||"Failed to fetch users",variant:"destructive"})}},b=async()=>{try{const W=await $(),V=await fetch(`${Qe}/api/admin/subscriptions`,{headers:W});if(!V.ok)throw new Error("Failed to fetch subscriptions");const de=await V.json();f(de.data||[])}catch(W){console.error("Error fetching subscriptions:",W),K({title:"Error",description:W.message||"Failed to fetch subscriptions",variant:"destructive"})}},L=async()=>{try{const W=await $(),V=await fetch(`${Qe}/api/admin/payments`,{headers:W});if(!V.ok)throw new Error("Failed to fetch payments");const de=await V.json();T(de.data||[])}catch(W){console.error("Error fetching payments:",W),K({title:"Error",description:W.message||"Failed to fetch payments",variant:"destructive"})}},C=async()=>{try{const W=await $(),V=await fetch(`${Qe}/api/admin/coupons`,{headers:W});if(!V.ok)throw new Error("Failed to fetch coupons");const de=await V.json();j(de.data||[])}catch(W){console.error("Error fetching coupons:",W),K({title:"Error",description:W.message||"Failed to fetch coupons",variant:"destructive"})}},xe={isAdmin:t,adminLevel:n,isLoading:d,dashboardStats:i,users:c,subscriptions:x,payments:v,coupons:y,analytics:g,auditLogs:U,auditStats:Q,fetchDashboardStats:S,fetchUsers:p,fetchSubscriptions:b,fetchPayments:L,fetchCoupons:C,fetchAnalytics:async(W="30days")=>{try{const V=await $(),de=await fetch(`${Qe}/api/admin/analytics/revenue?timeRange=${W}`,{headers:V});if(!de.ok)throw new Error("Failed to fetch analytics");const pe=await de.json();I(pe.data)}catch(V){console.error("Error fetching analytics:",V),K({title:"Error",description:V.message||"Failed to fetch analytics",variant:"destructive"})}},fetchAuditLogs:async(W={})=>{try{const V=await $(),de=new URLSearchParams(W).toString(),pe=await fetch(`${Qe}/api/admin/audit-logs?${de}`,{headers:V});if(!pe.ok)throw new Error("Failed to fetch audit logs");const qe=await pe.json();q(qe.data.logs||[])}catch(V){console.error("Error fetching audit logs:",V),K({title:"Error",description:V.message||"Failed to fetch audit logs",variant:"destructive"})}},fetchAuditStats:async()=>{try{const W=await $(),V=await fetch(`${Qe}/api/admin/audit-logs/stats`,{headers:W});if(!V.ok)throw new Error("Failed to fetch audit stats");const de=await V.json();Z(de.data)}catch(W){console.error("Error fetching audit stats:",W),K({title:"Error",description:W.message||"Failed to fetch audit statistics",variant:"destructive"})}},createCoupon:async W=>{try{const V=await $(),de=await fetch(`${Qe}/api/admin/coupons`,{method:"POST",headers:V,body:JSON.stringify(W)});if(!de.ok)throw new Error("Failed to create coupon");const pe=await de.json();return pe.success&&(K({title:"Success",description:"Coupon created successfully"}),await C()),pe}catch(V){throw console.error("Error creating coupon:",V),K({title:"Error",description:V.message||"Failed to create coupon",variant:"destructive"}),V}},deactivateCoupon:async W=>{try{const V=await $(),de=await fetch(`${Qe}/api/admin/coupons/${W}/deactivate`,{method:"PUT",headers:V});if(!de.ok)throw new Error("Failed to deactivate coupon");const pe=await de.json();return pe.success&&(K({title:"Success",description:"Coupon deactivated successfully"}),await C()),pe}catch(V){throw console.error("Error deactivating coupon:",V),K({title:"Error",description:V.message||"Failed to deactivate coupon",variant:"destructive"}),V}},updateUserRole:async(W,V,de="viewer")=>{try{const pe=await $(),qe=await fetch(`${Qe}/api/admin/users/${W}/role`,{method:"PUT",headers:pe,body:JSON.stringify({role:V,adminLevel:de})});if(!qe.ok)throw new Error("Failed to update user role");const Ke=await qe.json();return Ke.success&&(K({title:"Success",description:Ke.data.message}),await p()),Ke}catch(pe){throw console.error("Error updating user role:",pe),K({title:"Error",description:pe.message||"Failed to update user role",variant:"destructive"}),pe}},toggleUserStatus:async(W,V)=>{try{const de=await $(),pe=await fetch(`${Qe}/api/admin/users/${W}/status`,{method:"PUT",headers:de,body:JSON.stringify({disabled:V})});if(!pe.ok)throw new Error("Failed to toggle user status");const qe=await pe.json();return qe.success&&(K({title:"Success",description:qe.data.message}),await p()),qe}catch(de){throw console.error("Error toggling user status:",de),K({title:"Error",description:de.message||"Failed to toggle user status",variant:"destructive"}),de}},cancelUserSubscription:async W=>{try{const V=await $(),de=await fetch(`${Qe}/api/admin/subscriptions/${W}/cancel`,{method:"POST",headers:V});if(!de.ok)throw new Error("Failed to cancel subscription");const pe=await de.json();return pe.success&&(K({title:"Success",description:"Subscription cancelled successfully"}),await b(),await p()),pe}catch(V){throw console.error("Error cancelling subscription:",V),K({title:"Error",description:V.message||"Failed to cancel subscription",variant:"destructive"}),V}},createUserSubscription:async W=>{try{const V=await $(),de=await fetch(`${Qe}/api/admin/subscriptions/create`,{method:"POST",headers:V,body:JSON.stringify(W)});if(!de.ok)throw new Error("Failed to create subscription");const pe=await de.json();return pe.success&&(K({title:"Success",description:"Subscription created successfully"}),await b(),await p()),pe}catch(V){throw console.error("Error creating subscription:",V),K({title:"Error",description:V.message||"Failed to create subscription",variant:"destructive"}),V}}};return e.jsx(Tn.Provider,{value:xe,children:r})},It=({children:r})=>{const{currentUser:s}=Ye(),t=Zs();return s?e.jsx(e.Fragment,{children:r}):e.jsx(Qt,{to:"/login",state:{from:t},replace:!0})},Wa=({children:r})=>{const{currentUser:s,loading:t}=Ye();return l.useEffect(()=>{console.log("🔍 AuthRedirect - User:",(s==null?void 0:s.email)||"null","Loading:",t)},[s,t]),t?(console.log("⏳ AuthRedirect - Still loading..."),null):s?(console.log("✅ AuthRedirect - User authenticated, redirecting to dashboard"),e.jsx(Qt,{to:"/dashboard",replace:!0})):(console.log("❌ AuthRedirect - No user, showing login page"),e.jsx(e.Fragment,{children:r}))},zl=({children:r})=>{const{isAdmin:s,isLoading:t}=Cs();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Verifying admin access..."})]})}):s?e.jsx(e.Fragment,{children:r}):e.jsx(Qt,{to:"/dashboard",replace:!0})},ql=()=>{const r=_e(),[s,t]=l.useState("Processing authentication...");return l.useEffect(()=>{(async()=>{try{const n=new URLSearchParams(window.location.search),o=n.get("code"),d=n.get("state"),m=n.get("error");if(m)throw new Error(`OAuth error: ${m}`);if(!o)throw new Error("No authorization code received");console.log("✅ Received OAuth code, exchanging for tokens..."),console.log("📍 State parameter from URL:",d),console.log("📍 Full URL:",window.location.href),console.log("📍 URL search params:",window.location.search),t("Exchanging authorization code for permanent access...");const h=await fetch("http://localhost:5000/auth/google/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:o,state:d})});if(!h.ok){const x=await h.json();throw console.error("❌ Backend error response:",x),console.error("❌ Backend error details:",JSON.stringify(x,null,2)),new Error(x.error||x.message||"Failed to exchange authorization code")}const c=await h.json();console.log("✅ Tokens received and stored in backend:",c),console.log("✅ User ID:",c.userId),sessionStorage.setItem("oauth_success","true"),t("Success! Redirecting...");const u=sessionStorage.getItem("oauth_return_url")||"/settings?tab=connections";sessionStorage.removeItem("oauth_return_url"),setTimeout(()=>{r(u+"?oauth=success")},500)}catch(n){console.error("❌ OAuth callback error:",n);const o=n instanceof Error?n.message:"Authentication failed";console.error("❌ Error message shown to user:",o),t(o),sessionStorage.setItem("oauth_success","false");const d=sessionStorage.getItem("oauth_return_url")||"/settings";sessionStorage.removeItem("oauth_return_url"),setTimeout(()=>{r(d+"?tab=connections&oauth=failed")},1500)}})()},[r]),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#fff"},children:e.jsx("div",{style:{textAlign:"center",padding:"20px"},children:e.jsx("p",{style:{fontSize:"16px",color:"#333"},children:s})})})},Wl=()=>{const r=_e(),{checkSubscriptionStatus:s,subscription:t}=Je(),[a,n]=l.useState(!1),[o,d]=l.useState(null);return l.useEffect(()=>{const m=async()=>{try{console.log("[Payment Success] Verifying GBP connection after payment...");const h=await Se.recoverConnection();console.log(h?"[Payment Success] ✅ GBP connection verified and active":"[Payment Success] ⚠️ GBP connection needs renewal")}catch(h){console.error("[Payment Success] Error verifying GBP connection:",h)}};s(),m();const i=setTimeout(()=>{var h;if((h=t==null?void 0:t.planId)!=null&&h.includes("yearly"))console.log("[Payment Success] Showing mandate setup for yearly plan user"),n(!0);else{const c=setTimeout(()=>{r("/dashboard")},1e3);d(c)}},2e3);return()=>{clearTimeout(i),o&&clearTimeout(o)}},[r,s,t==null?void 0:t.planId]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx($e,{className:"w-20 h-20 text-green-500 mx-auto animate-pulse"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Payment Successful!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Thank you for your subscription. Your account has been successfully upgraded."}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-green-800 font-medium",children:"✨ All premium features are now unlocked"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting to dashboard in 3 seconds..."}),e.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-6 px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:"Go to Dashboard Now"})]}),e.jsx(xn,{isOpen:a,onClose:()=>{n(!1),r("/dashboard")},onSuccess:()=>{n(!1),r("/dashboard")}})]})},Yl=({isOpen:r,onClose:s,gbpAccountId:t,profileCount:a=1})=>{const[n,o]=l.useState(!1);l.useState(!1);const{Razorpay:d}=fa(),{currentUser:m}=Ye(),{checkSubscriptionStatus:i}=Je(),{toast:h}=ss(),c=_e(),u="http://localhost:5000",x="rzp_live_RWwON57KV1LaJn",f=async()=>{if(!m||!t){h({title:"Error",description:"User authentication or GBP connection required",variant:"destructive"});return}o(!0);try{const T=await fetch(`${u}/api/payment/subscription/trial`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m.uid,gbpAccountId:t,email:m.email})});if(!T.ok)throw new Error("Failed to create trial subscription");const y=await T.json();console.log("Trial created:",y);const j=await fetch(`${u}/api/payment/order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:1,currency:"INR",notes:{userId:m.uid,email:m.email,gbpAccountId:t,profileCount:a,setupType:"trial_with_autopay"}})});if(!j.ok)throw new Error("Failed to create trial setup order");const{order:g}=await j.json(),I={key:x,amount:g.amount,currency:g.currency,name:"GMB Profile Pulse",description:"15-Day Free Trial Setup",order_id:g.id,handler:async q=>{var Z;if((await fetch(`${u}/api/payment/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:q.razorpay_order_id,razorpay_payment_id:q.razorpay_payment_id,razorpay_signature:q.razorpay_signature,subscriptionId:(Z=y.subscription)==null?void 0:Z.id,gbpAccountId:t,planId:"yearly_pro"})})).ok)s(),await i(),h({title:"Free Trial Started! 🎉",description:"Your 15-day trial is active with auto-pay setup. Enjoy all features!"}),c("/dashboard");else throw new Error("Trial setup verification failed")},prefill:{name:m.displayName||"",email:m.email||"",contact:""},theme:{color:"#1E2DCD"},modal:{ondismiss:()=>{o(!1)}},notes:{trial_setup:"true",auto_pay_enabled:"true"}};new d(I).open()}catch(T){console.error("Trial setup error:",T),h({title:"Setup Failed",description:"There was an error setting up your trial. Please try again.",variant:"destructive"})}finally{o(!1)}},v=async()=>{if(!m||!t){h({title:"Error",description:"User authentication or GBP connection required",variant:"destructive"});return}o(!0);try{if((await fetch(`${u}/api/payment/subscription/trial`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m.uid,gbpAccountId:t,email:m.email})})).ok)s(),await i(),h({title:"Free Trial Started! 🎉",description:"Your 15-day trial is now active. Add payment details later in billing settings."}),c("/dashboard");else throw new Error("Failed to create trial subscription")}catch(T){console.error("Trial creation error:",T),h({title:"Error",description:"Failed to start trial. Please try again.",variant:"destructive"})}finally{o(!1)}};return e.jsx(hs,{open:r,onOpenChange:n?void 0:s,children:e.jsxs(os,{className:"max-w-2xl",children:[e.jsxs(is,{children:[e.jsxs(ls,{className:"flex items-center space-x-2",children:[e.jsx(qo,{className:"h-6 w-6 text-green-600"}),e.jsx("span",{children:"Claim Your Free 15-Day Trial"})]}),e.jsx(cs,{children:"Start managing your Google Business Profile with all premium features included!"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:[e.jsx(O,{children:e.jsx(B,{className:"text-lg text-green-800",children:"What's Included in Your Trial"})}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["Auto-Post Scheduling","Review Management & Auto-Reply","Performance Analytics","Advanced Analytics","API Access","Priority Support"].map((T,y)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:T})]},y))})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(We,{className:"h-5 w-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"After Trial: Simple Per-Profile Pricing"})]}),e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"Just $99/year per Google Business Profile you want to manage."}),e.jsxs("p",{className:"text-xs text-blue-600",children:[a," profile detected → $",a*99,"/year after trial"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(js,{className:"h-5 w-5 text-yellow-600"}),e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Secure Auto-Pay Setup"})]}),e.jsx("p",{className:"text-sm text-yellow-800 mb-2",children:"We'll securely save your payment method for seamless continuation after your trial."}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• No charges during your 15-day trial"}),e.jsx("li",{children:"• Cancel anytime during the trial"}),e.jsx("li",{children:"• Automatic billing only starts after trial ends"}),e.jsx("li",{children:"• Industry-standard security with Razorpay"})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx(N,{onClick:f,disabled:n,className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3",size:"lg",children:n?e.jsx(e.Fragment,{children:"Setting up trial..."}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{className:"mr-2 h-5 w-5"}),"Start Free Trial with Auto-Pay"]})}),e.jsx(N,{variant:"outline",onClick:v,disabled:n,className:"w-full",children:n?"Starting trial...":"Start Free Trial (Setup Payment Later)"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"🔒 Your payment information is encrypted and secure. Powered by Razorpay."})]})]})})},Vl=()=>{var i;const{showTrialSetup:r,setShowTrialSetup:s}=Je(),{accounts:t}=ct(),{currentUser:a}=Ye(),[n,o]=l.useState(!1);l.useEffect(()=>{(async()=>{if(a)try{const c=await a.getIdTokenResult(),u=c.claims.role==="admin"||c.claims.adminLevel;o(u)}catch(c){console.error("Error checking admin status:",c),o(!1)}})()},[a]);const d=t&&t.length>0?((i=t[0].name)==null?void 0:i.split("/")[1])||t[0].accountId:"",m=(t==null?void 0:t.reduce((h,c)=>{var u;return h+(((u=c.locations)==null?void 0:u.length)||0)},0))||1;return!r||!d||n?null:e.jsx(Yl,{isOpen:r,onClose:()=>s(!1),gbpAccountId:d,profileCount:Math.max(1,m)})},Kl=()=>(l.useState(!0),null),Hl=()=>{var h;const{currentUser:r,logout:s}=Ye(),{adminLevel:t}=Cs(),[a,n]=l.useState(!0),[o,d]=l.useState(!1),m=async()=>{await s()},i=[{name:"Dashboard",href:"/admin/dashboard",icon:Wo},{name:"Users",href:"/admin/users",icon:ms},{name:"User Audits",href:"/admin/user-audits",icon:Is},{name:"Subscriptions",href:"/admin/subscriptions",icon:We},{name:"Payments",href:"/admin/payments",icon:We},{name:"Coupons",href:"/admin/coupons",icon:Kr},{name:"Analytics",href:"/admin/analytics",icon:ds},{name:"Audit Logs",href:"/admin/audits",icon:Qs}];return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>d(!1)}),e.jsxs("aside",{className:`${a?"w-64":"w-20"} ${o?"translate-x-0":"-translate-x-full lg:translate-x-0"} fixed lg:relative h-full bg-white border-r border-gray-200 text-gray-800 transition-all duration-300 flex flex-col shadow-lg z-50`,children:[e.jsxs("div",{className:"p-4 sm:p-6 flex items-center justify-between",children:[a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Google Ranker"})]})]}):e.jsx(js,{className:"h-6 w-6 sm:h-8 sm:w-8 mx-auto text-primary"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>{n(!a),window.innerWidth<1024&&d(!1)},className:"text-gray-700 hover:bg-primary/10 hover:text-primary",children:a?e.jsx(ys,{className:"h-5 w-5"}):e.jsx(Lt,{className:"h-5 w-5"})})]}),e.jsx("nav",{className:"flex-1 px-4 space-y-2 overflow-y-auto",children:i.map(c=>e.jsxs(oa,{to:c.href,onClick:()=>{window.innerWidth<1024&&d(!1)},className:({isActive:u})=>`flex items-center gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg transition-colors ${u?"bg-primary text-white font-medium shadow-md":"text-gray-700 hover:bg-primary/10 hover:text-primary"}`,children:[e.jsx(c.icon,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),a&&e.jsx("span",{className:"text-sm sm:text-base",children:c.name})]},c.name))}),e.jsxs("div",{className:"p-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Nt,{className:"h-10 w-10 bg-primary/10",children:e.jsx(kt,{className:"bg-primary/10 text-primary font-semibold",children:((h=r==null?void 0:r.email)==null?void 0:h[0].toUpperCase())||"A"})}),a&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate text-gray-900",children:r==null?void 0:r.email}),e.jsx(ee,{variant:"secondary",className:"mt-1 text-xs bg-primary/10 text-primary",children:t||"Admin"})]})]}),a&&e.jsxs(N,{variant:"ghost",className:"w-full mt-4 text-gray-700 hover:bg-primary/10 hover:text-primary justify-start",onClick:m,children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>d(!o),className:"lg:hidden",children:e.jsx(Lt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-900",children:"Admin Portal"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 hidden sm:block",children:"Manage your Google Ranker application"})]})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:e.jsxs(ee,{variant:"outline",className:"flex items-center gap-1 sm:gap-2 text-xs",children:[e.jsx(js,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Administrator Access"}),e.jsx("span",{className:"sm:hidden",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-3 sm:p-4 md:p-6",children:e.jsx(Sr,{})})]})]})},Jl=()=>{var i,h,c;const{dashboardStats:r,analytics:s,fetchDashboardStats:t,fetchAnalytics:a}=Cs();l.useEffect(()=>{t(),a("30days")},[]);const n=r||{},o=(s==null?void 0:s.dailyRevenue)||[],d=["#0088FE","#00C49F","#FFBB28","#FF8042"],m=[{name:"Active",value:n.activeSubscriptions||0},{name:"Trial",value:n.trialSubscriptions||0},{name:"Total",value:n.totalSubscriptions||0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard Overview"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Monitor key metrics and application performance"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Revenue (30d)"}),e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((i=n.totalRevenue)==null?void 0:i.toFixed(2))||"0.00"]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(ds,{className:"h-3 w-3 text-green-500"}),e.jsxs("span",{className:"text-green-500",children:[n.revenueGrowth||0,"%"]})," from last period"]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Subscriptions"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.totalSubscriptions||0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"text-green-600 font-medium",children:n.activeSubscriptions||0})," active"," • ",e.jsx("span",{className:"text-blue-600 font-medium",children:n.trialSubscriptions||0})," trial"]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Monthly Recurring Revenue"}),e.jsx(ds,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((h=n.mrr)==null?void 0:h.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Estimated monthly revenue"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Payment Success Rate"}),e.jsx($e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.paymentSuccessRate||0,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[n.successfulPayments||0," successful payments"]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Today's Revenue"}),e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((c=n.todayRevenue)==null?void 0:c.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Revenue collected today"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Trial Conversion Rate"}),e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.trialConversionRate||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Trials converting to paid"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Active Subscriptions"}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.activeSubscriptions||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently active users"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Trial Users"}),e.jsx(ns,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.trialSubscriptions||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Users on trial period"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Revenue Trend (30 Days)"}),e.jsx(ge,{children:"Daily revenue over the last 30 days"})]}),e.jsx(k,{children:o.length>0?e.jsx(ks,{width:"100%",height:300,children:e.jsxs(jt,{data:o,children:[e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date",tickFormatter:u=>new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ss,{}),e.jsx(ps,{formatter:u=>`$${u.toFixed(2)}`,labelFormatter:u=>new Date(u).toLocaleDateString()}),e.jsx(As,{}),e.jsx(gs,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",strokeWidth:2,name:"Revenue ($)"})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Subscription Distribution"}),e.jsx(ge,{children:"Breakdown of subscription types"})]}),e.jsx(k,{children:e.jsx(ks,{width:"100%",height:300,children:e.jsxs(Hr,{children:[e.jsx(Jr,{data:m,cx:"50%",cy:"50%",labelLine:!1,label:({name:u,value:x})=>`${u}: ${x}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:m.map((u,x)=>e.jsx(Qr,{fill:d[x%d.length]},`cell-${x}`))}),e.jsx(ps,{}),e.jsx(As,{})]})})})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Quick Statistics"}),e.jsx(ge,{children:"Additional insights at a glance"})]}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(Is,{className:"h-4 w-4"}),"Average Transaction"]}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",((n.totalRevenue||0)/(n.successfulPayments||1)).toFixed(2)]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"Revenue Growth"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[n.revenueGrowth||0,"%"]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(ms,{className:"h-4 w-4"}),"Total Customers"]}),e.jsx("div",{className:"text-2xl font-bold",children:n.totalSubscriptions||0})]})]})})]})]})},mt=l.forwardRef(({className:r,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:M("w-full caption-bottom text-sm",r),...s})}));mt.displayName="Table";const ut=l.forwardRef(({className:r,...s},t)=>e.jsx("thead",{ref:t,className:M("[&_tr]:border-b",r),...s}));ut.displayName="TableHeader";const ht=l.forwardRef(({className:r,...s},t)=>e.jsx("tbody",{ref:t,className:M("[&_tr:last-child]:border-0",r),...s}));ht.displayName="TableBody";const Ql=l.forwardRef(({className:r,...s},t)=>e.jsx("tfoot",{ref:t,className:M("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s}));Ql.displayName="TableFooter";const es=l.forwardRef(({className:r,...s},t)=>e.jsx("tr",{ref:t,className:M("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s}));es.displayName="TableRow";const ve=l.forwardRef(({className:r,...s},t)=>e.jsx("th",{ref:t,className:M("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));ve.displayName="TableHead";const be=l.forwardRef(({className:r,...s},t)=>e.jsx("td",{ref:t,className:M("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));be.displayName="TableCell";const Xl=l.forwardRef(({className:r,...s},t)=>e.jsx("caption",{ref:t,className:M("mt-4 text-sm text-muted-foreground",r),...s}));Xl.displayName="TableCaption";const Zl=()=>{const{users:r,fetchUsers:s,updateUserRole:t,toggleUserStatus:a,cancelUserSubscription:n,adminLevel:o}=Cs(),[d,m]=l.useState(""),[i,h]=l.useState("all"),[c,u]=l.useState(null),[x,f]=l.useState(!1),[v,T]=l.useState(null);l.useEffect(()=>{s({search:d,status:i})},[d,i]);const y=Q=>{m(Q)},j=Q=>{h(Q)},g=(Q,Z)=>{u(Q),T(Z),f(!0)},I=async()=>{c&&(await t(c.uid,"admin","moderator"),f(!1),u(null))},U=async()=>{c&&(await a(c.uid,!c.disabled),f(!1),u(null))},q=Q=>{if(!Q)return e.jsx(ee,{variant:"secondary",children:"No Subscription"});switch(Q.status){case"active":return e.jsx(ee,{className:"bg-green-500",children:"Active"});case"trial":return e.jsx(ee,{className:"bg-blue-500",children:"Trial"});case"expired":return e.jsx(ee,{variant:"destructive",children:"Expired"});default:return e.jsx(ee,{variant:"secondary",children:Q.status})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage users, subscriptions, and permissions"})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Search & Filter"}),e.jsx(ge,{children:"Find users by email, name, or status"})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(fe,{placeholder:"Search by email or name...",value:d,onChange:Q=>y(Q.target.value),className:"pl-10"})]}),e.jsxs(De,{value:i,onValueChange:j,children:[e.jsx(Ie,{className:"w-48",children:e.jsx(Fe,{placeholder:"Filter by status"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Users"}),e.jsx(G,{value:"active",children:"Active"}),e.jsx(G,{value:"trial",children:"Trial"}),e.jsx(G,{value:"expired",children:"Expired"})]})]})]})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{children:["All Users (",r.length,")"]}),e.jsx(ge,{children:"Complete list of registered users"})]}),e.jsx(k,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(mt,{children:[e.jsx(ut,{children:e.jsxs(es,{children:[e.jsx(ve,{children:"Email"}),e.jsx(ve,{children:"Display Name"}),e.jsx(ve,{children:"Status"}),e.jsx(ve,{children:"Subscription"}),e.jsx(ve,{children:"GBP Connected"}),e.jsx(ve,{children:"Joined"}),e.jsx(ve,{children:"Actions"})]})}),e.jsx(ht,{children:r.length>0?r.map(Q=>{var Z;return e.jsxs(es,{children:[e.jsx(be,{className:"font-medium",children:Q.email}),e.jsx(be,{children:Q.displayName}),e.jsx(be,{children:Q.disabled?e.jsxs(ee,{variant:"destructive",children:[e.jsx(ca,{className:"h-3 w-3 mr-1"}),"Suspended"]}):e.jsxs(ee,{className:"bg-green-500",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Active"]})}),e.jsx(be,{children:q(Q.subscription)}),e.jsx(be,{children:Q.gbpAccountId?e.jsxs(ee,{variant:"outline",className:"bg-green-50",children:[e.jsx($e,{className:"h-3 w-3 mr-1 text-green-600"}),"Yes"]}):e.jsxs(ee,{variant:"outline",className:"bg-gray-50",children:[e.jsx(Wt,{className:"h-3 w-3 mr-1 text-gray-400"}),"No"]})}),e.jsx(be,{className:"text-sm text-gray-500",children:Xe(new Date(Q.createdAt),"MMM dd, yyyy")}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o==="super"&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>g(Q,"role"),children:[e.jsx(js,{className:"h-3 w-3 mr-1"}),"Role"]}),(o==="super"||o==="moderator")&&e.jsx(N,{variant:Q.disabled?"default":"outline",size:"sm",onClick:()=>g(Q,"status"),children:Q.disabled?"Activate":"Suspend"}),Q.gbpAccountId&&((Z=Q.subscription)==null?void 0:Z.status)==="active"&&(o==="super"||o==="moderator")&&e.jsxs(N,{variant:"destructive",size:"sm",onClick:async()=>{if(window.confirm(`Are you sure you want to cancel the subscription for ${Q.email}?`))try{await n(Q.gbpAccountId)}catch($){console.error("Error cancelling subscription:",$)}},children:[e.jsx(Wt,{className:"h-3 w-3 mr-1"}),"Cancel Sub"]})]})})]},Q.uid)}):e.jsx(es,{children:e.jsx(be,{colSpan:7,className:"text-center text-gray-500 py-8",children:"No users found"})})})]})})})]}),e.jsx(hs,{open:x,onOpenChange:f,children:e.jsxs(os,{children:[e.jsxs(is,{children:[e.jsx(ls,{children:v==="role"?"Update User Role":"Toggle User Status"}),e.jsx(cs,{children:v==="role"?`Make ${c==null?void 0:c.email} an admin`:`${c!=null&&c.disabled?"Activate":"Suspend"} ${c==null?void 0:c.email}'s account`})]}),e.jsxs(Xs,{children:[e.jsx(N,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(N,{onClick:v==="role"?I:U,children:"Confirm"})]})]})})]})},ec=()=>{const{subscriptions:r,fetchSubscriptions:s,cancelUserSubscription:t,createUserSubscription:a}=Cs(),[n,o]=l.useState(!1),[d,m]=l.useState(!1),[i,h]=l.useState(null),[c,u]=l.useState(!1),[x,f]=l.useState({userId:"",email:"",profileCount:1,durationMonths:1});l.useEffect(()=>{s()},[]);const v=g=>{switch(g){case"active":return e.jsx(ee,{className:"bg-green-500",children:"Active"});case"trial":return e.jsx(ee,{className:"bg-blue-500",children:"Trial"});case"expired":return e.jsx(ee,{variant:"destructive",children:"Expired"});case"cancelled":return e.jsx(ee,{variant:"secondary",children:"Cancelled"});default:return e.jsx(ee,{variant:"outline",children:g})}},T=g=>{h(g),o(!0)},y=async()=>{if(i){u(!0);try{await t(i.gbpAccountId),o(!1),h(null)}catch(g){console.error("Failed to cancel subscription:",g)}finally{u(!1)}}},j=async()=>{if(!x.userId||!x.email||x.profileCount<1||x.durationMonths<1){K({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}u(!0);try{await a({userId:x.userId,email:x.email,profileCount:x.profileCount,durationMonths:x.durationMonths}),m(!1),f({userId:"",email:"",profileCount:1,durationMonths:1})}catch(g){console.error("Failed to create subscription:",g)}finally{u(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Subscription Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View and manage all user subscriptions"})]}),e.jsxs(hs,{open:d,onOpenChange:m,children:[e.jsx(ml,{asChild:!0,children:e.jsxs(N,{children:[e.jsx(qs,{className:"mr-2 h-4 w-4"}),"Create Subscription"]})}),e.jsxs(os,{className:"sm:max-w-[500px]",children:[e.jsxs(is,{children:[e.jsx(ls,{children:"Create New Subscription"}),e.jsx(cs,{children:"Create a direct subscription for a user. The subscription will be active immediately."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"userId",children:"User ID"}),e.jsx(fe,{id:"userId",placeholder:"Enter user ID",value:x.userId,onChange:g=>f({...x,userId:g.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"email",children:"Email"}),e.jsx(fe,{id:"email",type:"email",placeholder:"user@example.com",value:x.email,onChange:g=>f({...x,email:g.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"profileCount",children:"Number of Profiles"}),e.jsxs(De,{value:x.profileCount.toString(),onValueChange:g=>f({...x,profileCount:parseInt(g)}),children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Select profiles"})}),e.jsx(Ee,{children:[1,2,3,4,5,10,15,20,25,30,50].map(g=>e.jsxs(G,{value:g.toString(),children:[g," ",g===1?"Profile":"Profiles"]},g))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"duration",children:"Duration"}),e.jsxs(De,{value:x.durationMonths.toString(),onValueChange:g=>f({...x,durationMonths:parseInt(g)}),children:[e.jsx(Ie,{children:e.jsx(Fe,{placeholder:"Select duration"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"1",children:"1 Month"}),e.jsx(G,{value:"2",children:"2 Months"}),e.jsx(G,{value:"3",children:"3 Months"}),e.jsx(G,{value:"6",children:"6 Months"}),e.jsx(G,{value:"9",children:"9 Months"}),e.jsx(G,{value:"12",children:"1 Year"})]})]})]})]}),e.jsxs(Xs,{children:[e.jsx(N,{variant:"outline",onClick:()=>m(!1),disabled:c,children:"Cancel"}),e.jsx(N,{onClick:j,disabled:c,children:c?"Creating...":"Create Subscription"})]})]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{children:["All Subscriptions (",r.length,")"]}),e.jsx(ge,{children:"Complete list of active and inactive subscriptions"})]}),e.jsx(k,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(mt,{children:[e.jsx(ut,{children:e.jsxs(es,{children:[e.jsx(ve,{children:"Email"}),e.jsx(ve,{children:"Plan"}),e.jsx(ve,{children:"Status"}),e.jsx(ve,{children:"Profiles"}),e.jsx(ve,{children:"Start Date"}),e.jsx(ve,{children:"End Date"}),e.jsx(ve,{children:"Amount"}),e.jsx(ve,{children:"Actions"})]})}),e.jsx(ht,{children:r.map(g=>e.jsxs(es,{children:[e.jsx(be,{className:"font-medium",children:g.email}),e.jsx(be,{children:e.jsx(ee,{variant:"outline",children:g.planId})}),e.jsx(be,{children:v(g.status)}),e.jsx(be,{children:g.profileCount||0}),e.jsx(be,{children:g.subscriptionStartDate?Xe(new Date(g.subscriptionStartDate),"MMM dd, yyyy"):"-"}),e.jsx(be,{children:g.subscriptionEndDate?Xe(new Date(g.subscriptionEndDate),"MMM dd, yyyy"):"-"}),e.jsxs(be,{children:[g.amount," ",g.currency]}),e.jsx(be,{children:g.status!=="cancelled"&&g.status!=="expired"&&e.jsxs(N,{variant:"destructive",size:"sm",onClick:()=>T(g),children:[e.jsx(ys,{className:"mr-1 h-3 w-3"}),"Cancel"]})})]},g.id))})]})})})]}),e.jsx(hs,{open:n,onOpenChange:o,children:e.jsxs(os,{children:[e.jsxs(is,{children:[e.jsx(ls,{children:"Cancel Subscription"}),e.jsx(cs,{children:"Are you sure you want to cancel this subscription? This action cannot be undone."})]}),i&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ve,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-amber-900",children:["User: ",i.email]}),e.jsxs("p",{className:"text-sm text-amber-700",children:["Plan: ",i.planId," (",i.profileCount," profiles)"]}),e.jsxs("p",{className:"text-sm text-amber-700",children:["Status: ",i.status]})]})]})}),e.jsxs(Xs,{children:[e.jsx(N,{variant:"outline",onClick:()=>o(!1),disabled:c,children:"Go Back"}),e.jsx(N,{variant:"destructive",onClick:y,disabled:c,children:c?"Cancelling...":"Yes, Cancel Subscription"})]})]})})]})},sc=()=>{const{payments:r,fetchPayments:s}=Cs();l.useEffect(()=>{s()},[]);const t=n=>{switch(n){case"success":return e.jsx($e,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Wt,{className:"h-4 w-4 text-red-500"});case"pending":return e.jsx(ns,{className:"h-4 w-4 text-yellow-500"});default:return null}},a=n=>{switch(n){case"success":return e.jsx(ee,{className:"bg-green-500",children:"Success"});case"failed":return e.jsx(ee,{variant:"destructive",children:"Failed"});case"pending":return e.jsx(ee,{className:"bg-yellow-500",children:"Pending"});default:return e.jsx(ee,{variant:"outline",children:n})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Payment Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"View all payment transactions and their status"})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{children:["All Payments (",r.length,")"]}),e.jsx(ge,{children:"Complete payment transaction history"})]}),e.jsx(k,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(mt,{children:[e.jsx(ut,{children:e.jsxs(es,{children:[e.jsx(ve,{children:"Date"}),e.jsx(ve,{children:"User"}),e.jsx(ve,{children:"Description"}),e.jsx(ve,{children:"Amount"}),e.jsx(ve,{children:"Status"}),e.jsx(ve,{children:"Payment ID"})]})}),e.jsx(ht,{children:r.map((n,o)=>e.jsxs(es,{children:[e.jsx(be,{children:n.paidAt?Xe(new Date(n.paidAt),"MMM dd, yyyy HH:mm"):"-"}),e.jsx(be,{className:"font-medium",children:n.userEmail}),e.jsx(be,{children:n.description}),e.jsxs(be,{className:"font-bold",children:[n.amount," ",n.currency]}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[t(n.status),a(n.status)]})}),e.jsx(be,{className:"text-xs text-gray-500",children:n.razorpayPaymentId})]},n.id||o))})]})})})]})]})},tc=()=>{const{coupons:r,fetchCoupons:s,createCoupon:t,deactivateCoupon:a,adminLevel:n}=Cs(),[o,d]=l.useState(!1);l.useState(null);const[m,i]=l.useState({code:"",discountType:"percentage",discountValue:"",maxUses:"",expiresAt:"",description:"",oneTimePerUser:!1,singleUse:!1});l.useEffect(()=>{s()},[]);const h=async()=>{try{await t({code:m.code.toUpperCase(),discountType:m.discountType,discountValue:parseFloat(m.discountValue),maxUses:m.maxUses?parseInt(m.maxUses):null,expiresAt:m.expiresAt?new Date(m.expiresAt).toISOString():null,description:m.description,oneTimePerUser:m.oneTimePerUser,singleUse:m.singleUse}),d(!1),i({code:"",discountType:"percentage",discountValue:"",maxUses:"",expiresAt:"",description:"",oneTimePerUser:!1,singleUse:!1})}catch(f){console.error("Error creating coupon:",f)}},c=async f=>{try{await a(f)}catch(v){console.error("Error deactivating coupon:",v)}},u=f=>f.isActive?f.expiresAt&&new Date(f.expiresAt)<new Date?e.jsx(ee,{variant:"destructive",children:"Expired"}):f.maxUses&&f.currentUses>=f.maxUses?e.jsx(ee,{variant:"secondary",children:"Max Uses Reached"}):e.jsx(ee,{className:"bg-green-500",children:"Active"}):e.jsx(ee,{variant:"destructive",children:"Inactive"}),x=n==="super"||n==="moderator";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Coupon Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Create and manage discount coupons"})]}),x&&e.jsxs(N,{onClick:()=>d(!0),children:[e.jsx(qs,{className:"h-4 w-4 mr-2"}),"Create Coupon"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Coupons"}),e.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.length})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Active Coupons"}),e.jsx($e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.filter(f=>f.isActive).length})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Uses"}),e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.reduce((f,v)=>f+(v.currentUses||0),0)})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Expired"}),e.jsx(ca,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.filter(f=>f.expiresAt&&new Date(f.expiresAt)<new Date).length})})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{children:["All Coupons (",r.length,")"]}),e.jsx(ge,{children:"Manage discount codes and promotions"})]}),e.jsx(k,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(mt,{children:[e.jsx(ut,{children:e.jsxs(es,{children:[e.jsx(ve,{children:"Code"}),e.jsx(ve,{children:"Discount"}),e.jsx(ve,{children:"Status"}),e.jsx(ve,{children:"Usage"}),e.jsx(ve,{children:"Created"}),e.jsx(ve,{children:"Expires"}),e.jsx(ve,{children:"Actions"})]})}),e.jsx(ht,{children:r.length>0?r.map(f=>e.jsxs(es,{children:[e.jsx(be,{className:"font-mono font-bold",children:f.code}),e.jsx(be,{children:f.discountType==="percentage"?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Yo,{className:"h-4 w-4"}),f.discountValue,"% off"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"h-4 w-4"}),"$",f.discountValue," off"]})}),e.jsx(be,{children:u(f)}),e.jsxs(be,{children:[f.currentUses||0,f.maxUses&&` / ${f.maxUses}`]}),e.jsx(be,{className:"text-sm text-gray-500",children:f.createdAt&&!isNaN(new Date(f.createdAt).getTime())?Xe(new Date(f.createdAt),"MMM dd, yyyy"):"N/A"}),e.jsx(be,{className:"text-sm text-gray-500",children:f.expiresAt&&!isNaN(new Date(f.expiresAt).getTime())?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"h-3 w-3"}),Xe(new Date(f.expiresAt),"MMM dd, yyyy")]}):"No expiry"}),e.jsx(be,{children:x&&f.isActive&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>c(f.code),children:[e.jsx(ca,{className:"h-3 w-3 mr-1"}),"Deactivate"]})})]},f.code)):e.jsx(es,{children:e.jsx(be,{colSpan:7,className:"text-center text-gray-500 py-8",children:"No coupons found. Create your first coupon to get started."})})})]})})})]}),e.jsx(hs,{open:o,onOpenChange:d,children:e.jsxs(os,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(is,{children:[e.jsx(ls,{children:"Create New Coupon"}),e.jsx(cs,{children:"Add a new discount coupon for your users"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"code",children:"Coupon Code"}),e.jsx(fe,{id:"code",placeholder:"SUMMER2024",value:m.code,onChange:f=>i({...m,code:f.target.value.toUpperCase()})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"discountType",children:"Discount Type"}),e.jsxs(De,{value:m.discountType,onValueChange:f=>i({...m,discountType:f}),children:[e.jsx(Ie,{children:e.jsx(Fe,{})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"percentage",children:"Percentage"}),e.jsx(G,{value:"fixed",children:"Fixed Amount"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(oe,{htmlFor:"discountValue",children:["Discount Value ",m.discountType==="percentage"?"(%)":"($)"]}),e.jsx(fe,{id:"discountValue",type:"number",placeholder:m.discountType==="percentage"?"20":"10",value:m.discountValue,onChange:f=>i({...m,discountValue:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"maxUses",children:"Max Uses (Optional)"}),e.jsx(fe,{id:"maxUses",type:"number",placeholder:"100",value:m.maxUses,onChange:f=>i({...m,maxUses:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"expiresAt",children:"Expiry Date (Optional)"}),e.jsx(fe,{id:"expiresAt",type:"date",value:m.expiresAt,onChange:f=>i({...m,expiresAt:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(fe,{id:"description",type:"text",placeholder:"Special discount for premium users",value:m.description,onChange:f=>i({...m,description:f.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"oneTimePerUser",type:"checkbox",checked:m.oneTimePerUser,onChange:f=>i({...m,oneTimePerUser:f.target.checked}),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(oe,{htmlFor:"oneTimePerUser",className:"cursor-pointer",children:"One-time use per user (each user can only use this coupon once)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"singleUse",type:"checkbox",checked:m.singleUse,onChange:f=>i({...m,singleUse:f.target.checked}),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(oe,{htmlFor:"singleUse",className:"cursor-pointer",children:"🔒 Single use (auto-disable after FIRST use by ANY user)"})]})]}),e.jsxs(Xs,{children:[e.jsx(N,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(N,{onClick:h,disabled:!m.code||!m.discountValue,children:"Create Coupon"})]})]})})]})},ac=()=>{const{analytics:r,fetchAnalytics:s,subscriptions:t,payments:a}=Cs(),[n,o]=l.useState("30days");l.useEffect(()=>{s(n)},[n]);const d=(r==null?void 0:r.dailyRevenue)||[],m=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"],i=t.reduce((y,j)=>{const g=j.planId||"Unknown";return y[g]=(y[g]||0)+1,y},{}),h=Object.entries(i).map(([y,j])=>({name:y,value:j})),c=t.reduce((y,j)=>{const g=j.status||"unknown";return y[g]=(y[g]||0)+1,y},{}),u=Object.entries(c).map(([y,j])=>({name:y.charAt(0).toUpperCase()+y.slice(1),value:j})),x=a.reduce((y,j)=>{const g=new Date(j.paidAt||j.createdAt).toLocaleDateString();return y[g]||(y[g]={date:g,successful:0,failed:0}),j.status==="captured"||j.status==="success"?y[g].successful++:y[g].failed++,y},{}),f=Object.values(x).slice(-30).map(y=>({...y,successRate:y.successful+y.failed>0?Math.round(y.successful/(y.successful+y.failed)*100):0})),v=d.slice(-30).map((y,j)=>({date:y.date,mrr:y.revenue*30,revenue:y.revenue})),T=()=>{const j=[["Date","Revenue","MRR"],...v.map(q=>[new Date(q.date).toLocaleDateString(),q.revenue.toFixed(2),q.mrr.toFixed(2)])].map(q=>q.join(",")).join(`
`),g=new Blob([j],{type:"text/csv"}),I=window.URL.createObjectURL(g),U=document.createElement("a");U.href=I,U.download=`analytics-${new Date().toISOString()}.csv`,U.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Advanced Analytics"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Deep dive into revenue and subscription metrics"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(De,{value:n,onValueChange:o,children:[e.jsxs(Ie,{className:"w-40",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),e.jsx(Fe,{})]}),e.jsxs(Ee,{children:[e.jsx(G,{value:"7days",children:"Last 7 Days"}),e.jsx(G,{value:"30days",children:"Last 30 Days"}),e.jsx(G,{value:"90days",children:"Last 90 Days"}),e.jsx(G,{value:"1year",children:"Last Year"})]})]}),e.jsxs(N,{onClick:T,variant:"outline",children:[e.jsx(va,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),e.jsxs(et,{defaultValue:"revenue",className:"space-y-6",children:[e.jsxs(Ws,{children:[e.jsx(Ue,{value:"revenue",children:"Revenue"}),e.jsx(Ue,{value:"subscriptions",children:"Subscriptions"}),e.jsx(Ue,{value:"payments",children:"Payments"}),e.jsx(Ue,{value:"overview",children:"Overview"})]}),e.jsx(Le,{value:"revenue",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Revenue Trend"}),e.jsx(ge,{children:"Daily revenue over selected period"})]}),e.jsx(k,{children:d.length>0?e.jsx(ks,{width:"100%",height:300,children:e.jsxs(ma,{data:d,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]})}),e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date",tickFormatter:y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ss,{}),e.jsx(ps,{formatter:y=>`$${y.toFixed(2)}`,labelFormatter:y=>new Date(y).toLocaleDateString()}),e.jsx(Ys,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",fillOpacity:1,fill:"url(#colorRevenue)"})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Monthly Recurring Revenue (MRR)"}),e.jsx(ge,{children:"Estimated MRR based on daily revenue"})]}),e.jsx(k,{children:v.length>0?e.jsx(ks,{width:"100%",height:300,children:e.jsxs(jt,{data:v,children:[e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date",tickFormatter:y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ss,{}),e.jsx(ps,{formatter:y=>`$${y.toFixed(2)}`,labelFormatter:y=>new Date(y).toLocaleDateString()}),e.jsx(As,{}),e.jsx(gs,{type:"monotone",dataKey:"mrr",stroke:"#00C49F",strokeWidth:2,name:"MRR ($)"})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No MRR data available"})})]})]})}),e.jsx(Le,{value:"subscriptions",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Plan Distribution"}),e.jsx(ge,{children:"Breakdown by subscription plan"})]}),e.jsx(k,{children:h.length>0?e.jsx(ks,{width:"100%",height:300,children:e.jsxs(Hr,{children:[e.jsx(Jr,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,value:j})=>`${y}: ${j}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:h.map((y,j)=>e.jsx(Qr,{fill:m[j%m.length]},`cell-${j}`))}),e.jsx(ps,{}),e.jsx(As,{})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No subscription data available"})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Subscription Status"}),e.jsx(ge,{children:"Active vs Trial vs Expired"})]}),e.jsx(k,{children:u.length>0?e.jsx(ks,{width:"100%",height:300,children:e.jsxs(ri,{data:u,children:[e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"name"}),e.jsx(Ss,{}),e.jsx(ps,{}),e.jsx(As,{}),e.jsx(ni,{dataKey:"value",fill:"#8884d8",name:"Count"})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No status data available"})})]})]})}),e.jsx(Le,{value:"payments",className:"space-y-6",children:e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Payment Success Rate Over Time"}),e.jsx(ge,{children:"Daily payment success rate (last 30 days)"})]}),e.jsx(k,{children:f.length>0?e.jsx(ks,{width:"100%",height:400,children:e.jsxs(jt,{data:f,children:[e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date"}),e.jsx(Ss,{yAxisId:"left"}),e.jsx(Ss,{yAxisId:"right",orientation:"right"}),e.jsx(ps,{}),e.jsx(As,{}),e.jsx(gs,{yAxisId:"left",type:"monotone",dataKey:"successful",stroke:"#00C49F",strokeWidth:2,name:"Successful"}),e.jsx(gs,{yAxisId:"left",type:"monotone",dataKey:"failed",stroke:"#FF8042",strokeWidth:2,name:"Failed"}),e.jsx(gs,{yAxisId:"right",type:"monotone",dataKey:"successRate",stroke:"#8884d8",strokeWidth:2,name:"Success Rate (%)"})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:"No payment data available"})})]})}),e.jsxs(Le,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",d.reduce((y,j)=>y+j.revenue,0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"For selected time period"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Subscriptions"}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All time subscriptions"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All time payments"})]})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Avg. Transaction"}),e.jsx(Is,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",a.length>0?(a.reduce((y,j)=>y+(j.amount||0),0)/a.length).toFixed(2):"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average payment amount"})]})]})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Revenue & Subscription Growth"}),e.jsx(ge,{children:"Comprehensive view of business metrics"})]}),e.jsx(k,{children:d.length>0?e.jsx(ks,{width:"100%",height:400,children:e.jsxs(ma,{data:d,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue2",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]})}),e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date",tickFormatter:y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ss,{}),e.jsx(ps,{formatter:y=>`$${y.toFixed(2)}`,labelFormatter:y=>new Date(y).toLocaleDateString()}),e.jsx(As,{}),e.jsx(Ys,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",fillOpacity:1,fill:"url(#colorRevenue2)",name:"Revenue ($)"})]})}):e.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:"No data available for the selected time period"})})]})]})]})]})},rc=()=>{var v,T;const{auditLogs:r,auditStats:s,fetchAuditLogs:t,fetchAuditStats:a}=Cs(),[n,o]=l.useState(""),[d,m]=l.useState("all"),[i,h]=l.useState("all");l.useEffect(()=>{t({limit:100}),a()},[]);const c=()=>{const y={limit:100};d!=="all"&&(y.action=d),i!=="all"&&(y.targetType=i),t(y)},u=r.filter(y=>{var g,I,U;if(!n)return!0;const j=n.toLowerCase();return((g=y.description)==null?void 0:g.toLowerCase().includes(j))||((I=y.adminEmail)==null?void 0:I.toLowerCase().includes(j))||((U=y.action)==null?void 0:U.toLowerCase().includes(j))}),x=y=>y.includes("create")?e.jsx(ee,{className:"bg-green-500",children:y}):y.includes("update")?e.jsx(ee,{className:"bg-blue-500",children:y}):y.includes("delete")?e.jsx(ee,{variant:"destructive",children:y}):e.jsx(ee,{variant:"secondary",children:y}),f=y=>{switch(y){case"user":return e.jsx(_t,{className:"h-4 w-4"});case"coupon":return e.jsx(Ns,{className:"h-4 w-4"});case"subscription":return e.jsx(da,{className:"h-4 w-4"});default:return e.jsx(Qs,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Audit Logs"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track all administrative actions and system events"})]}),s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Total Logs"}),e.jsx(Qs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:s.totalLogs})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Today's Activity"}),e.jsx(ns,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:((T=(v=s.dailyActivity)==null?void 0:v[s.dailyActivity.length-1])==null?void 0:T.count)||0})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Action Types"}),e.jsx(da,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(s.actionBreakdown||{}).length})})]}),e.jsxs(w,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(B,{className:"text-sm font-medium",children:"Target Types"}),e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(k,{children:e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(s.targetTypeBreakdown||{}).length})})]})]}),(s==null?void 0:s.dailyActivity)&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Activity Timeline (Last 7 Days)"}),e.jsx(ge,{children:"Number of audit events per day"})]}),e.jsx(k,{children:e.jsx(ks,{width:"100%",height:200,children:e.jsxs(jt,{data:s.dailyActivity,children:[e.jsx(Ts,{strokeDasharray:"3 3"}),e.jsx(Rs,{dataKey:"date",tickFormatter:y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(Ss,{}),e.jsx(ps,{labelFormatter:y=>new Date(y).toLocaleDateString()}),e.jsx(As,{}),e.jsx(gs,{type:"monotone",dataKey:"count",stroke:"#8884d8",strokeWidth:2,name:"Events"})]})})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Search & Filter"}),e.jsx(ge,{children:"Find specific audit logs"})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(fe,{placeholder:"Search logs...",value:n,onChange:y=>o(y.target.value),className:"pl-10"})]}),e.jsxs(De,{value:d,onValueChange:m,children:[e.jsx(Ie,{className:"w-48",children:e.jsx(Fe,{placeholder:"Filter by action"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Actions"}),e.jsx(G,{value:"user.create",children:"User Create"}),e.jsx(G,{value:"user.update",children:"User Update"}),e.jsx(G,{value:"user.delete",children:"User Delete"}),e.jsx(G,{value:"coupon.create",children:"Coupon Create"}),e.jsx(G,{value:"coupon.deactivate",children:"Coupon Deactivate"})]})]}),e.jsxs(De,{value:i,onValueChange:h,children:[e.jsx(Ie,{className:"w-48",children:e.jsx(Fe,{placeholder:"Filter by target"})}),e.jsxs(Ee,{children:[e.jsx(G,{value:"all",children:"All Types"}),e.jsx(G,{value:"user",children:"User"}),e.jsx(G,{value:"coupon",children:"Coupon"}),e.jsx(G,{value:"subscription",children:"Subscription"}),e.jsx(G,{value:"payment",children:"Payment"})]})]}),e.jsxs(N,{onClick:c,children:[e.jsx(qt,{className:"h-4 w-4 mr-2"}),"Apply"]})]})})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{children:["Audit Trail (",u.length,")"]}),e.jsx(ge,{children:"Chronological record of all administrative actions"})]}),e.jsx(k,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(mt,{children:[e.jsx(ut,{children:e.jsxs(es,{children:[e.jsx(ve,{children:"Timestamp"}),e.jsx(ve,{children:"Action"}),e.jsx(ve,{children:"Admin"}),e.jsx(ve,{children:"Target"}),e.jsx(ve,{children:"Description"}),e.jsx(ve,{children:"IP Address"})]})}),e.jsx(ht,{children:u.length>0?u.map(y=>e.jsxs(es,{children:[e.jsx(be,{className:"text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),Xe(new Date(y.timestamp),"MMM dd, yyyy HH:mm:ss")]})}),e.jsx(be,{children:x(y.action)}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm",children:y.adminEmail})]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[f(y.targetType),e.jsx("span",{className:"text-sm capitalize",children:y.targetType})]})}),e.jsx(be,{className:"max-w-md",children:e.jsx("span",{className:"text-sm",children:y.description})}),e.jsx(be,{className:"text-sm text-gray-500",children:y.ipAddress||"N/A"})]},y.id)):e.jsx(es,{children:e.jsx(be,{colSpan:6,className:"text-center text-gray-500 py-8",children:"No audit logs found"})})})]})})})]}),(s==null?void 0:s.actionBreakdown)&&Object.keys(s.actionBreakdown).length>0&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Action Breakdown"}),e.jsx(ge,{children:"Distribution of actions performed"})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(s.actionBreakdown).map(([y,j])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:x(y)}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-48 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${j/s.totalLogs*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-12 text-right",children:j})]})]},y))})})]})]})},na="http://localhost:5000",nc=()=>{var E,Y;const{users:r,fetchUsers:s}=Cs(),{currentUser:t}=Ye(),{toast:a}=ss(),[n,o]=l.useState(""),[d,m]=l.useState(null),[i,h]=l.useState([]),[c,u]=l.useState(null),[x,f]=l.useState(null),[v,T]=l.useState(null),[y,j]=l.useState(!1),[g,I]=l.useState(!1),[U,q]=l.useState("saved");l.useEffect(()=>{s()},[]);const Q=async()=>{if(!n){a({title:"Error",description:"Please enter a user email to search",variant:"destructive"});return}const R=r.find(X=>X.email.toLowerCase().includes(n.toLowerCase()));if(!R){a({title:"User Not Found",description:"No user found with that email",variant:"destructive"});return}m(R),u(null),f(null),T(null),await Z(R.uid)},Z=async R=>{j(!0);try{if(!t)throw new Error("Not authenticated");const X=await t.getIdToken(),le=await fetch(`${na}/api/admin/users/${R}/business-audits`,{headers:{Authorization:`Bearer ${X}`}});if(!le.ok){const J=await le.json();throw new Error(J.error||"Failed to fetch user locations")}const H=await le.json();h(H.data.locations||[]),H.data.locations.length===0&&a({title:"No Locations",description:"This user hasn't connected any business profiles yet",variant:"default"})}catch(X){console.error("Error fetching user locations:",X),a({title:"Error",description:X.message||"Failed to fetch user's business profiles",variant:"destructive"}),h([])}finally{j(!1)}},$=async R=>{u(R),f(null),T(null),await S(R.name)},S=async R=>{if(!(!d||!t)){j(!0);try{const X=await t.getIdToken(),le=await fetch(`${na}/api/admin/audit-results/user/${d.uid}`,{headers:{Authorization:`Bearer ${X}`}});if(le.ok){const xe=((await le.json()).data.results||[]).find(W=>W.locationId===R||W.locationName===(c==null?void 0:c.title));xe?(T(xe),f(xe),q("saved"),a({title:"Saved Audit Loaded",description:`Showing saved audit from ${b(xe.timestamp)}`})):a({title:"No Saved Audit",description:"No saved audit found for this location. Click 'Fetch Live Data' to get current data.",variant:"default"})}}catch(X){console.error("Error fetching saved audit:",X)}finally{j(!1)}}},p=async()=>{if(!(!d||!t||!c)){I(!0);try{const R=await t.getIdToken(),X=await fetch(`${na}/api/admin/users/${d.uid}/locations/${encodeURIComponent(c.name)}/audit`,{headers:{Authorization:`Bearer ${R}`}});if(!X.ok)throw new Error("Failed to fetch live audit data");const le=await X.json();f(le.data),q("live"),a({title:"Live Data Fetched",description:"Showing current data from Google Business Profile API"})}catch(R){console.error("Error fetching live audit:",R),a({title:"Error",description:"Failed to fetch live audit data for this location",variant:"destructive"})}finally{I(!1)}}},b=R=>new Date(R).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=R=>R?new Intl.NumberFormat().format(R):"0",C=R=>R.includes("IMPRESSIONS")?e.jsx(Ht,{className:"h-4 w-4"}):R.includes("CALL")?e.jsx(bt,{className:"h-4 w-4"}):R.includes("WEBSITE")?e.jsx(ya,{className:"h-4 w-4"}):R.includes("DIRECTION")?e.jsx(as,{className:"h-4 w-4"}):e.jsx(da,{className:"h-4 w-4"}),ie=R=>{const X={high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-blue-100 text-blue-800"};return X[R]||X.medium},ae=R=>R>=80?"bg-green-100 text-green-800":R>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Business Audits"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View any user's business profile audit to help with customer support"})]}),e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5"}),"Select User (",r.length," total)"]}),e.jsx(ge,{children:"Search or select a user to view their business profile audits"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(fe,{placeholder:"Search by email or name...",value:n,onChange:R=>o(R.target.value),onKeyPress:R=>R.key==="Enter"&&Q(),className:"flex-1"}),e.jsxs(N,{onClick:Q,disabled:y,children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Search"]})]}),d&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-blue-900",children:"Selected User:"}),e.jsx("p",{className:"text-blue-800",children:d.email}),d.displayName&&e.jsx("p",{className:"text-sm text-blue-600",children:d.displayName})]}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{m(null),h([]),u(null),f(null),T(null)},children:"Clear"})]})}),!d&&r.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Recent Users:"}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:r.filter(R=>{var X;return!n||R.email.toLowerCase().includes(n.toLowerCase())||((X=R.displayName)==null?void 0:X.toLowerCase().includes(n.toLowerCase()))}).slice(0,10).map(R=>e.jsx("div",{onClick:()=>{m(R),o(R.email),Z(R.uid)},className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:R.email}),R.displayName&&e.jsx("p",{className:"text-xs text-gray-600",children:R.displayName})]}),e.jsx(N,{size:"sm",variant:"ghost",children:"Select →"})]})},R.uid))})]})]})]}),i.length>0&&e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5"}),"Business Profiles (",i.length,")"]}),e.jsx(ge,{children:"Click on a location to view its audit data"})]}),e.jsx(k,{children:e.jsx("div",{className:"grid gap-3",children:i.map(R=>{var X,le;return e.jsx("div",{onClick:()=>$(R),className:`p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors ${(c==null?void 0:c.name)===R.name?"bg-blue-50 border-blue-300":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:R.title}),e.jsx("p",{className:"text-sm text-gray-600",children:(le=(X=R.storefrontAddress)==null?void 0:X.addressLines)==null?void 0:le.join(", ")})]}),e.jsx(N,{size:"sm",variant:"outline",children:(c==null?void 0:c.name)===R.name?"Selected":"Select"})]})},R.name)})})})]}),c&&e.jsx(w,{children:e.jsxs(O,{children:[e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Audit Data: ",c.title]}),e.jsxs("div",{className:"flex gap-2",children:[v&&e.jsxs(ee,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Vo,{className:"h-3 w-3"}),"Saved: ",b(v.timestamp)]}),e.jsxs(N,{size:"sm",onClick:p,disabled:g,variant:U==="live"?"default":"outline",children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${g?"animate-spin":""}`}),"Fetch Live Data"]})]})]}),e.jsx(ge,{children:U==="saved"&&v?`Showing saved audit from ${b(v.timestamp)}`:U==="live"?"Showing live data from Google Business Profile API":"Select a data source to view audit"})]})}),x&&e.jsxs("div",{className:"space-y-6",children:[((E=x.performance)==null?void 0:E.timeSeriesData)&&e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"h-5 w-5"}),"Performance Metrics (Last 30 Days)"]})}),e.jsx(k,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.performance.timeSeriesData.map(R=>{var H,J,xe,W;const X=((J=(H=R.timeSeries)==null?void 0:H.datedValues)==null?void 0:J.reduce((V,de)=>V+(de.value||0),0))||0,le=R.dailyMetric.replace(/_/g," ").replace("BUSINESS ","");return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[C(R.dailyMetric),le]})}),e.jsx("p",{className:"text-2xl font-bold",children:L(X)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((W=(xe=R.timeSeries)==null?void 0:xe.datedValues)==null?void 0:W.length)||0," days of data"]})]},R.dailyMetric)})})})]}),((Y=x.recommendations)==null?void 0:Y.recommendations)&&x.recommendations.recommendations.length>0&&e.jsxs(w,{children:[e.jsx(O,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Recommendations (",x.recommendations.recommendations.length,")"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:x.recommendations.recommendations.map((R,X)=>e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:R.title}),e.jsx(ee,{className:ie(R.priority),children:R.priority})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:R.description}),R.impact&&e.jsxs("p",{className:"text-sm text-blue-600 font-medium mb-2",children:["💡 ",R.impact]}),R.actions&&R.actions.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Action Steps:"}),e.jsx("ul",{className:"space-y-1",children:R.actions.map((le,H)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}),le]},H))})]})]})})},X))})})]}),x.score&&e.jsxs(w,{children:[e.jsx(O,{children:e.jsx(B,{children:"Audit Score"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.score.overall&&e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Overall Score"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-3xl font-bold",children:[x.score.overall,"%"]}),e.jsx(ee,{className:ae(x.score.overall),children:x.score.overall>=80?"Good":x.score.overall>=60?"Fair":"Needs Work"})]})]}),x.score.performance&&e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Performance"}),e.jsxs("p",{className:"text-3xl font-bold",children:[x.score.performance,"%"]})]}),x.score.engagement&&e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Engagement"}),e.jsxs("p",{className:"text-3xl font-bold",children:[x.score.engagement,"%"]})]})]})})]})]}),!d&&!y&&e.jsx(w,{children:e.jsxs(k,{className:"py-12 text-center",children:[e.jsx(fs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No User Selected"}),e.jsx("p",{className:"text-gray-600",children:"Search for a user by email to view their business profile audits"})]})}),(y||g)&&e.jsx(w,{children:e.jsxs(k,{className:"py-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:y?"Loading...":"Fetching live audit data..."})]})})]})},oc=new oi,ic=()=>e.jsx(Ko,{client:oc,children:e.jsxs(ua,{children:[e.jsx(Ei,{}),e.jsx(Di,{}),e.jsxs(Ho,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e.jsx(_i,{children:e.jsx(_l,{children:e.jsx(hl,{children:e.jsx(rl,{children:e.jsxs(ll,{children:[e.jsxs(Jo,{children:[e.jsx(Ne,{path:"/",element:e.jsx($i,{})}),e.jsx(Ne,{path:"/terms",element:e.jsx(Ui,{})}),e.jsx(Ne,{path:"/privacy",element:e.jsx(Li,{})}),e.jsx(Ne,{path:"/refund",element:e.jsx(Gi,{})}),e.jsx(Ne,{path:"/contact",element:e.jsx(Bi,{})}),e.jsx(Ne,{path:"/login",element:e.jsx(Wa,{children:e.jsx(zi,{})})}),e.jsx(Ne,{path:"/signup",element:e.jsx(Wa,{children:e.jsx(qi,{})})}),e.jsx(Ne,{path:"/auth/google/callback",element:e.jsx(ql,{})}),e.jsx(Ne,{path:"/public-reviews/:locationId",element:e.jsx(qa,{})}),e.jsx(Ne,{path:"/review/:locationId",element:e.jsx(qa,{})}),e.jsxs(Ne,{path:"/dashboard",element:e.jsx(It,{children:e.jsx(fl,{})}),children:[e.jsx(Ne,{index:!0,element:e.jsx(yl,{})}),e.jsx(Ne,{path:"profiles/:profileId",element:e.jsx(El,{})}),e.jsx(Ne,{path:"posts",element:e.jsx(Dl,{})}),e.jsx(Ne,{path:"reviews",element:e.jsx(Fl,{})}),e.jsx(Ne,{path:"ask-for-reviews",element:e.jsx($l,{})}),e.jsx(Ne,{path:"request-reviews",element:e.jsx(Ul,{})}),e.jsx(Ne,{path:"settings",element:e.jsx(Gl,{})}),e.jsx(Ne,{path:"audit",element:e.jsx(Ol,{})}),e.jsx(Ne,{path:"billing",element:e.jsx(Ml,{})})]}),e.jsx(Ne,{path:"/dashboard/upgrade",element:e.jsx(It,{children:e.jsx(Bl,{})})}),e.jsx(Ne,{path:"/payment-success",element:e.jsx(It,{children:e.jsx(Wl,{})})}),e.jsxs(Ne,{path:"/admin",element:e.jsx(It,{children:e.jsx(zl,{children:e.jsx(Hl,{})})}),children:[e.jsx(Ne,{index:!0,element:e.jsx(Qt,{to:"/admin/dashboard",replace:!0})}),e.jsx(Ne,{path:"dashboard",element:e.jsx(Jl,{})}),e.jsx(Ne,{path:"users",element:e.jsx(Zl,{})}),e.jsx(Ne,{path:"subscriptions",element:e.jsx(ec,{})}),e.jsx(Ne,{path:"payments",element:e.jsx(sc,{})}),e.jsx(Ne,{path:"coupons",element:e.jsx(tc,{})}),e.jsx(Ne,{path:"analytics",element:e.jsx(ac,{})}),e.jsx(Ne,{path:"audits",element:e.jsx(rc,{})}),e.jsx(Ne,{path:"user-audits",element:e.jsx(nc,{})})]}),e.jsx(Ne,{path:"*",element:e.jsx(Fi,{})})]}),e.jsx(Vl,{})]})})})})}),e.jsx(Kl,{})]})]})});Qo(document.getElementById("root")).render(e.jsx(ic,{}));
